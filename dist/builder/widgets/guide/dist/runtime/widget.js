System.register(["jimu-core","jimu-for-builder","jimu-for-builder/service","jimu-layouts/layout-runtime","jimu-ui/basic/guide"],(function(e,t){var i={},s={},d={},u={},r={};return{setters:[function(e){i.GuideManager=e.GuideManager,i.Immutable=e.Immutable,i.LayoutItemType=e.LayoutItemType,i.React=e.React,i.jsx=e.jsx},function(e){s.builderActions=e.builderActions},function(e){d.userServices=e.userServices},function(e){u.searchUtils=e.searchUtils},function(e){r.COMMON_GUIDE_MODULES=e.COMMON_GUIDE_MODULES,r.STATUS=e.STATUS}],execute:function(){e((()=>{var e={8891:e=>{"use strict";e.exports=i},3137:e=>{"use strict";e.exports=s},6325:e=>{"use strict";e.exports=d},4758:e=>{"use strict";e.exports=u},2542:e=>{"use strict";e.exports=r}},t={};function o(i){var s=t[i];if(void 0!==s)return s.exports;var d=t[i]={exports:{}};return e[i](d,d.exports,o),d.exports}o.d=(e,t)=>{for(var i in t)o.o(t,i)&&!o.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.p="";var n={};return o.p=window.jimuConfig.baseUrl,(()=>{"use strict";o.r(n),o.d(n,{default:()=>u});var e=o(8891),t=o(2542),i=o(6325),s=o(4758),d=o(3137);class u extends e.React.PureComponent{constructor(s){super(s),this.handleChange=({status:e,index:s,isInjected:u,step:r})=>{if(e===t.STATUS.FINISHED||e===t.STATUS.SKIPPED||e===t.STATUS.ERROR){if(e===t.STATUS.FINISHED&&u)return this.setState({guideModule:this._masterGuide.guideModule,stepIndex:this._masterGuide.stepIndex+1,run:!0}),void this.reset();e!==t.STATUS.SKIPPED&&e!==t.STATUS.FINISHED||!t.COMMON_GUIDE_MODULES.includes(this.state.activeGuide)&&i.userServices.updateUserResource({showGuides:{[this.state.activeGuide]:!1}}),this.reset(!0),this.props.dispatch(d.builderActions.stopGuide())}else e===t.STATUS.INJECTED&&(this._masterGuide.guideModule||(this._masterGuide=this._masterGuide.set("guideModule",this.state.guideModule)),this._masterGuide=this._masterGuide.set("stepIndex",s),this.props.dispatch(d.builderActions.startGuide(r.injectedGuide)),this.setState({widgetName:r.widgetName}))},this.state={stepIndex:0,run:!1,guideModule:null,widgetName:null,activeGuide:null},this.guideManager=e.GuideManager.getInstance(),this.reset()}componentDidUpdate(e){var t,i,s,d;(null==e?void 0:e.activeGuide)!==(null===(t=this.props)||void 0===t?void 0:t.activeGuide)&&(null===(i=this.props)||void 0===i?void 0:i.activeGuide)?this.guideManager.getGuideModule(this.props.activeGuide).then((e=>{this.setState({guideModule:e,run:!0,stepIndex:0,activeGuide:this.props.activeGuide})})):e.totalWidgetCount<this.props.totalWidgetCount&&(null===(s=e.selectedWidget)||void 0===s?void 0:s.uri)!==(null===(d=this.props.selectedWidget)||void 0===d?void 0:d.uri)&&this.props.selectedWidget&&(this._addedWidget=this.props.selectedWidget)}componentDidMount(){i.userServices.initUserResource().then((e=>{(null==e?void 0:e.success)&&i.userServices.getUserResource().then((e=>{var t;void 0===(null===(t=null==e?void 0:e.showGuides)||void 0===t?void 0:t["opening-tour"])&&this.props.dispatch(d.builderActions.startGuide("opening-tour"))}))}))}reset(t=!1){t&&(this.setState({run:!1,stepIndex:0,guideModule:null,widgetName:null,activeGuide:null}),this._addedWidget=null),this._masterGuide=(0,e.Immutable)({guideModule:null,stepIndex:0})}render(){const{isAppBusy:t}=this.props,{stepIndex:i,run:s}=this.state,d=this.state.guideModule;return!t&&s?(0,e.jsx)("div",{className:"widget-guide"},d&&(0,e.jsx)(d,{run:s,stepIndex:i,widgetName:this.state.widgetName,widgetJson:this._addedWidget,onStepChange:this.handleChange})):""}}u.defaultProps={totalWidgetCount:0},u.mapExtraStateProps=(t,i)=>{var d,u,r,o;const n=null===(d=t.appStateInBuilder)||void 0===d?void 0:d.appConfig,a=null===(u=t.appStateInBuilder)||void 0===u?void 0:u.appRuntimeInfo.selection;let l;if(a){const t=s.searchUtils.findLayoutItem(n,a);t&&t.type===e.LayoutItemType.Widget&&t.widgetId&&(l=n.widgets[t.widgetId])}return{activeGuide:null===(r=null==t?void 0:t.builder)||void 0===r?void 0:r.currentGuideId,isAppBusy:!(null===(o=null==t?void 0:t.appStateInBuilder)||void 0===o?void 0:o.appRuntimeInfo.currentPageId),selectedWidget:l,totalWidgetCount:(null==n?void 0:n.widgets)?Object.keys(n.widgets).length:0}}})(),n})())}}}));