System.register(["jimu-core","jimu-theme","jimu-ui"],(function(t,e){var o={},s={},l={};return{setters:[function(t){o.React=t.React,o.SessionManager=t.SessionManager,o.UrlProtocol=t.UrlProtocol,o.css=t.css,o.esri=t.esri,o.jsx=t.jsx,o.moduleLoader=t.moduleLoader,o.portalUrlUtils=t.portalUrlUtils,o.urlUtils=t.urlUtils},function(t){s.styled=t.styled},function(t){l.Button=t.Button,l.ButtonGroup=t.ButtonGroup,l.Dropdown=t.Dropdown,l.DropdownButton=t.DropdownButton,l.DropdownItem=t.DropdownItem,l.DropdownMenu=t.DropdownMenu,l.FormFeedback=t.FormFeedback,l.FormGroup=t.FormGroup,l.InputGroup=t.InputGroup,l.Label=t.Label,l.TextInput=t.TextInput}],execute:function(){t((()=>{var t={144:function(t,e){var o,s;o=function(t,e){"use strict";var o=5e3,s="callback";function l(){return"jsonp_"+Date.now()+"_"+Math.ceil(1e5*Math.random())}function n(t){try{delete window[t]}catch(e){window[t]=void 0}}function i(t){var e=document.getElementById(t);e&&document.getElementsByTagName("head")[0].removeChild(e)}e.exports=function(t){var e=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],r=t,a=e.timeout||o,d=e.jsonpCallback||s,c=void 0;return new Promise((function(o,s){var u=e.jsonpCallbackFunction||l(),p=d+"_"+u;window[u]=function(t){o({ok:!0,json:function(){return Promise.resolve(t)}}),c&&clearTimeout(c),i(p),n(u)},r+=-1===r.indexOf("?")?"?":"&";var h=document.createElement("script");h.setAttribute("src",""+r+d+"="+u),e.charset&&h.setAttribute("charset",e.charset),e.nonce&&h.setAttribute("nonce",e.nonce),e.referrerPolicy&&h.setAttribute("referrerPolicy",e.referrerPolicy),h.id=p,document.getElementsByTagName("head")[0].appendChild(h),c=setTimeout((function(){s(new Error("JSONP request to "+t+" timed out")),n(u),i(p),window[u]=function(){n(u)}}),a),h.onerror=function(){s(new Error("JSONP request to "+t+" failed")),n(u),i(p),c&&clearTimeout(c)}}))}},void 0===(s=o.apply(e,[e,t]))||(t.exports=s)},891:t=>{"use strict";t.exports=o},796:t=>{"use strict";t.exports=s},726:t=>{"use strict";t.exports=l}},e={};function n(o){var s=e[o];if(void 0!==s)return s.exports;var l=e[o]={exports:{}};return t[o].call(l.exports,l,l.exports,n),l.exports}n.d=(t,e)=>{for(var o in e)n.o(e,o)&&!n.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:e[o]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.p="";var i={};return n.p=window.jimuConfig.baseUrl,(()=>{"use strict";n.r(i),n.d(i,{LoadStatus:()=>r,default:()=>u});var t=n(891),e=n(726);var o,s=n(144);!function(t){t.InvalidPortalUrl="InvalidPortalUrl",t.UnableToCorsAccess="UnableToCorsAccess",t.UnableToAccess="UnableToAccess"}(o||(o={}));class l{constructor(){this.validPortalInfos=[]}getDefaultProtalInfo(t){return{isValid:!1,invalidMessage:"",isWebTier:!1,supportsOAuth:!0,tokenInfo:{token:null,expires:null,ssl:!1,server:"",userId:""},url:this.getStandardPortalUrl(t),clientId:void 0}}getValidPortalInfo(e){let o=null;return this.validPortalInfos.some((s=>!!t.portalUrlUtils.isSamePortalUrl(e,s.url)&&(o=s,!0))),o}getStandardPortalUrl(e){if(!e)return"";const o=0===e.toLowerCase().indexOf("http://"),s=0===e.toLowerCase().indexOf("https://");return o||s||(e=t.urlUtils.setProtocol(e,t.UrlProtocol.Https)),e=t.portalUrlUtils.getStandardPortalUrl(e),t.urlUtils.setProtocol(e,t.UrlProtocol.Https)}validatePortalUrl(t){const e=this.getDefaultProtalInfo(t);return/www.arcgis.com/gi.test(t)?(e.isValid=!1,e.invalidMessage=o.InvalidPortalUrl):e.isValid=!0,e}fetcher(t,e){return fetch(t,e)}generateToken(e){const o=t.urlUtils.setProtocol(`${t.portalUrlUtils.getPortalRestUrl(e)}generateToken?f=json`,t.UrlProtocol.Https);return this.fetcher(o,{cache:"no-cache",credentials:"include"}).then((t=>t.json())).then((t=>t),(t=>null))}getPortalSelfInfo(e){const l=t.urlUtils.setProtocol(`${t.portalUrlUtils.getPortalRestUrl(e)}portals/self?f=json`,t.UrlProtocol.Https);return this.fetcher(l,{cache:"no-cache",credentials:"include"}).then((t=>t.json())).then((t=>t)).catch((t=>s(l,{jsonpCallback:"callback",timeout:3e3}).then((t=>({invalidPortalSelf:!0,invalidMessage:o.UnableToCorsAccess}))).catch((t=>({invalidPortalSelf:!0,invalidMessage:o.UnableToAccess})))))}getPortalInfo(e){const s=this.getDefaultProtalInfo(e);return this.getPortalSelfInfo(e).then((t=>{if(t&&!t.invalidPortalSelf&&(t.isPortal||t.urlKey))return s.isValid=!0,s.supportsOAuth=t.supportsOAuth,s.tokenInfo.userId=t.user?t.user.username:"",this.validPortalInfos.push(s),this.generateToken(e);s.isValid=!1,s.invalidMessage=(null==t?void 0:t.invalidMessage)||o.UnableToAccess})).then((o=>(o&&o.token&&(s.tokenInfo.token=o.token,s.tokenInfo.expires=o.expires,s.tokenInfo.ssl=o.ssl,s.tokenInfo.server=t.portalUrlUtils.getPortalRestUrl(e),s.isWebTier=!0,s.supportsOAuth=!1),s)))}validatePortal(t){if(!t)return Promise.reject("Portal URL is empty.");let e;const o=this.getStandardPortalUrl(t);let s=this.getValidPortalInfo(o);return s?e=Promise.resolve(s):(s=this.validatePortalUrl(o),e=s.isValid?this.getPortalInfo(o):Promise.resolve(s)),e}}var r,a=n(796);!function(t){t.Pending="Pending",t.Fulfilled="Fulfilled",t.Rejected="Rejected"}(r||(r={}));const d="https://myorg.maps.arcgis.com",c="https://myportal.company.com/arcgis";class u extends t.React.PureComponent{constructor(e){super(e),this.onPortalUrlInputChange=t=>{var e,o;const s=this.portalValidator.getDefaultProtalInfo(null===(e=null==t?void 0:t.target)||void 0===e?void 0:e.value);s.url=null===(o=null==t?void 0:t.target)||void 0===o?void 0:o.value,this.setState({selectedPortalInfo:s})},this.onClientIdInputChange=t=>{var e;this.setState({selectedPortalInfo:Object.assign(Object.assign({},this.state.selectedPortalInfo),{clientId:null===(e=null==t?void 0:t.target)||void 0===e?void 0:e.value})})},this.checkPortalUrlOnAccept=t=>{return e=this,o=void 0,l=function*(){try{let e;return t?(this.setState({loadStatus:r.Pending,selectedPortalInfo:this.portalValidator.getDefaultProtalInfo(t),showUrlList:!1}),e=yield this.portalValidator.validatePortal(t)):e=this.portalValidator.getDefaultProtalInfo(),this.setState({selectedPortalInfo:e,loadStatus:r.Fulfilled}),!e||e.invalidMessage?{valid:!1}:{valid:!0}}catch(t){return this.setState({loadStatus:r.Rejected}),{valid:!1}}},new((s=void 0)||(s=Promise))((function(t,n){function i(t){try{a(l.next(t))}catch(t){n(t)}}function r(t){try{a(l.throw(t))}catch(t){n(t)}}function a(e){var o;e.done?t(e.value):(o=e.value,o instanceof s?o:new s((function(t){t(o)}))).then(i,r)}a((l=l.apply(e,o||[])).next())}));var e,o,s,l},this.onSignInBtnClick=()=>{if(!this.state.selectedPortalInfo.isValid)return;const t={portalUrl:this.state.selectedPortalInfo.url,clientId:this.clientIdInput.current.value,supportsOAuth:this.state.selectedPortalInfo.supportsOAuth,isWebTier:this.state.selectedPortalInfo.isWebTier};this.addSigninInfo(t).then((()=>{this.signIn(t)}))},this.onUrlListBtnClick=()=>{this.setState({showUrlList:!this.state.showUrlList})},this.onUrlListItemClick=t=>{this.selectPortalUrl(t)},this.portalValidator=new l,this.state={signinInfos:[],showUrlList:!1,loadStatus:r.Pending,selectedPortalInfo:this.portalValidator.getDefaultProtalInfo()},this.urlInput=t.React.createRef(),this.clientIdInput=t.React.createRef()}componentDidMount(){this.fetchSigninInfo()}getDefaultPortalUrl(e){const o=window.jimuConfig.hostEnv||"dev",s=`${t.urlUtils.getFixedRootPath()}builder/setting.json`;return window.fetch(s).then((t=>t.json())).then((t=>{const s=(window.jimuConfig.isDevEdition?t.devEnv:t.env)[o];return s&&s.portalUrl||e[0]&&e[0].portalUrl||""}))}fetchSigninInfo(){const t=`${window.location.protocol}//${window.location.host}/signininfo`;return window.fetch(t,{cache:"no-cache"}).then((t=>t.json())).then((t=>(this.setState({signinInfos:t}),this.getDefaultPortalUrl(t).then((t=>{this.selectPortalUrl(t)})),t))).catch((t=>(console.error(t),t)))}addSigninInfo(t){const e=`${window.location.protocol}//${window.location.host}/signinInfo`;return window.fetch(e,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(t)}).then((t=>t.json())).catch((t=>{console.error(t)}))}getSigninInfo(e){let o=null;return this.state.signinInfos.some((s=>!!t.portalUrlUtils.isSamePortalUrl(s.portalUrl,e)&&(o=s,!0))),o}OAuthSignIn(e){const o=e.portalUrl+"/sharing/rest/",s=`${window.location.origin}${t.urlUtils.getFolder(t.moduleLoader.resolveModuleFullPath("jimu-core"))}/oauth-callback.html?clientID=${e.clientId}&portal=${o}&isDevEdition=${window.jimuConfig.isDevEdition}&isOutOfExb=${window.jimuConfig.isOutOfExb}&fromUrl=${window.jimuConfig.mountPath}`,l={portal:o,clientId:e.clientId,redirectUri:s,popup:!1,params:{showSignupOption:!0,signupType:"esri"}};t.esri.restAuth.UserSession.beginOAuth2(l)}webTierSignIn(){const e=this.state.selectedPortalInfo.tokenInfo,o=t.esri.restAuth.UserSession.fromCredential(e);t.SessionManager.getInstance().writeAuthInfo(o),window.location.href="/"}signIn(t){t.supportsOAuth?this.OAuthSignIn(t):this.state.selectedPortalInfo.isWebTier&&this.webTierSignIn()}validatePortal(t){return this.portalValidator.validatePortal(t)}selectPortalUrl(t,e){t?(this.setState({loadStatus:r.Pending,selectedPortalInfo:this.portalValidator.getDefaultProtalInfo(t),showUrlList:!1}),this.validatePortal(t).then((t=>{this.setState(Object.assign({selectedPortalInfo:t,loadStatus:r.Fulfilled},e))})).catch((()=>this.setState({loadStatus:r.Rejected})))):this.setState({selectedPortalInfo:this.portalValidator.getDefaultProtalInfo(),loadStatus:r.Fulfilled})}render(){const s=(0,a.styled)(e.Button)`
      display: block;
      margin: 0 auto;
    `,l=this.state.signinInfos.map(((o,s)=>(0,t.jsx)(e.DropdownItem,{key:s,active:!!t.portalUrlUtils.isSamePortalUrl(o.portalUrl,this.state.selectedPortalInfo.url),onClick:()=>this.onUrlListItemClick(o.portalUrl)},o.portalUrl))),n=this.getSigninInfo(this.state.selectedPortalInfo.url);let i,u,p;if(i=void 0!==this.state.selectedPortalInfo.clientId?this.state.selectedPortalInfo.clientId:n&&n.clientId||"",this.state.selectedPortalInfo.url||this.state.loadStatus===r.Pending||(u=(0,t.jsx)("div",null,(0,t.jsx)("div",null,d),(0,t.jsx)("div",null,c))),this.state.selectedPortalInfo&&this.state.selectedPortalInfo.invalidMessage&&this.state.loadStatus!==r.Pending)if(this.state.selectedPortalInfo.invalidMessage===o.InvalidPortalUrl)p=(0,t.jsx)("div",null,(0,t.jsx)("div",null,this.props.intl.formatMessage({id:"invalidPortalUrlMessage",defaultMessage:"Please enter the full URL of your ArcGIS Online organization or ArcGIS Enterprise, for example,"})),(0,t.jsx)("div",null,d),(0,t.jsx)("div",null,c));else if(this.state.selectedPortalInfo.invalidMessage===o.UnableToCorsAccess){const e=this.props.intl.formatMessage({id:"unableToCorsAccessMessage",defaultMessage:"Your application domain is not allowed via Cross-Origin Resource Sharing (CORS) to access"});p=(0,t.jsx)("div",null,(0,t.jsx)("div",null,`${e} ${this.state.selectedPortalInfo.url}`))}else{const e=this.props.intl.formatMessage({id:"unableToAccessMessage",defaultMessage:"Unable to access"}),o=this.props.intl.formatMessage({id:"invalidHostNameMessage",defaultMessage:"A server with the specified hostname could not be found."});p=(0,t.jsx)("div",null,(0,t.jsx)("div",null,`${e} ${this.state.selectedPortalInfo.url}`),(0,t.jsx)("div",null,o))}const h=this.state.selectedPortalInfo&&this.state.selectedPortalInfo.supportsOAuth?"displayed":"hidden";let f="hidden",g=!1;this.state.loadStatus===r.Pending&&(g=!0,f="displayed");const m=!this.state.selectedPortalInfo.isValid;return(0,t.jsx)("div",{css:(I=this.props.theme,this.props.isRTL,t.css`
    max-width: 700px;
    margin: 0 auto;
    .portal-url-input{
      margin-right: 1px;
    }
    .portal-clientId.hidden{
      display: none;
    }
    .loading-panel {
      position: absolute;
      width: 15px;
      background-color: ${I.colors.light};

      .jimu-secondary-loading {
        left: 2px;
        top: 12px;
      }

      .jimu-secondary-loading, .jimu-secondary-loading:before, .jimu-secondary-loading:after {
        width: 2px;
        height: 5px;
        left: -27px;
      }
      .jimu-secondary-loading:before {
        left: -5px;
      }
      .jimu-secondary-loading:after {
        left: 5px;
      }
    }

    .loading-panel.hidden {
      display: none;
    }

    .dropdown-menu {
      width: 700px;
    }

    .description, .message {
      color: ${I.colors.palette.dark[600]};
      width: auto;
    }

    .invalid-message {
      color: ${I.colors.palette.danger[700]};
    }
    .loading-con {
      margin-left: -1px;
    }
  `),className:"widget-set-portalurl"},(0,t.jsx)("div",{className:"mt-5 mb-2"},(0,t.jsx)(e.Label,{id:"portalUrlLabel",className:"description"}," ",this.props.intl.formatMessage({id:"portalUrlDescription",defaultMessage:"Specify the URL to your ArcGIS Online organization or ArcGIS Enterprise"})," "),(0,t.jsx)(e.ButtonGroup,{className:"w-100"},(0,t.jsx)(e.InputGroup,null,(0,t.jsx)(e.TextInput,{"aria-describedby":"portalUrlMessage1 portalUrlMessage2","aria-labelledby":"portalUrlLabel",className:"portal-url-input",disabled:g,size:"lg",placeholder:this.props.intl.formatMessage({id:"portalUrl",defaultMessage:"Portal URL"}),min:0,max:100,type:"text",checkValidityOnAccept:this.checkPortalUrlOnAccept,value:this.state.selectedPortalInfo.url||"",onChange:this.onPortalUrlInputChange,ref:this.urlInput}),(0,t.jsx)("div",{className:"d-flex loading-con"},(0,t.jsx)("div",{className:`loading-panel ${f}`},(0,t.jsx)("div",{className:"jimu-secondary-loading"})))),(0,t.jsx)(e.Dropdown,{activeIcon:!0,className:"dropdown",isOpen:this.state.showUrlList,toggle:this.onUrlListBtnClick},(0,t.jsx)(e.DropdownButton,{style:{width:"auto"},icon:!0}),(0,t.jsx)(e.DropdownMenu,{className:"dropdown-menu",zIndex:"55",style:{width:"700px"},alignment:"end"},l)))),(0,t.jsx)(e.FormFeedback,{id:"portalUrlMessage1",className:"message mx-2",valid:!0}," ",u," "),(0,t.jsx)(e.FormFeedback,{id:"portalUrlMessage2",className:"message invalid-message mx-2",valid:!0}," ",p," "),(0,t.jsx)(e.FormGroup,{className:`portal-clientId mt-5 ${h}`},(0,t.jsx)(e.Label,{className:"description",for:"clientIdText"}," ",this.props.intl.formatMessage({id:"clientIdDescription",defaultMessage:"Provide the Client ID for Experience Builder registered in the ArcGIS Enterprise you specify above"})," "),(0,t.jsx)(e.TextInput,{disabled:g,size:"lg",type:"password",name:"text",id:"clientIdText",placeholder:this.props.intl.formatMessage({id:"clientId",defaultMessage:"Client ID"}),value:i,ref:this.clientIdInput,onChange:this.onClientIdInputChange})),(0,t.jsx)(s,{disabled:g||m,size:"lg",onClick:()=>this.onSignInBtnClick()},this.props.intl.formatMessage({id:"portalUrlSignIn",defaultMessage:"Sign in"})));var I}}u.mapExtraStateProps=t=>({isRTL:t.appContext.isRTL})})(),i})())}}}));