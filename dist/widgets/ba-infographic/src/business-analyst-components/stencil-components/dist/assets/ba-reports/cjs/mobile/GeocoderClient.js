"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});var Lang_1=require("./Lang"),Environments_1=__importDefault(require("../Environments")),GeocoderClient=function(){function e(e,t){this.token=e,this.geocoderUrl=t||Environments_1.default.getUrl("geocode"),this.geocoderUrl.endsWith("/")||(this.geocoderUrl+="/")}return e.prototype.suggest=function(e,t){var o=this;return new Promise((function(n,r){if(e&&e.length){var i=new URLSearchParams({text:e});(null==t?void 0:t.location)&&i.set("location",t.location),o._request(o.geocoderUrl+"suggest",i).then((function(e){n(e.suggestions)})).catch((function(e){r(e)}))}else n([])}))},e.prototype.geocode=function(e,t){var o=this;return new Promise((function(n,r){if(e&&e.length){var i=new URLSearchParams({maxLocations:(null==t?void 0:t.maxLocations)||10,singleLine:e});(null==t?void 0:t.location)&&i.set("location",t.location),(null==t?void 0:t.outFields)&&i.set("outFields",t.outFields),(null==t?void 0:t.magicKey)&&i.set("magicKey",t.magicKey),o._request(o.geocoderUrl+"findAddressCandidates",i).then((function(e){n(e)})).catch((function(e){r(e)}))}else n([])}))},e.prototype._request=function(e,t){var o=this;return new Promise((function(n,r){t.set("token",o.token),t.set("f","json");var i=e+"?"+t.toString();fetch(i,{method:"GET"}).then((function(e){if(!e.ok)throw new Error(Lang_1.BaReportsLanguage.i18n("network-response-error"));return e.json()})).then((function(e){e.error?r(e.error):n(e)})).catch((function(e){r(e)}))}))},e}();exports.default=GeocoderClient;