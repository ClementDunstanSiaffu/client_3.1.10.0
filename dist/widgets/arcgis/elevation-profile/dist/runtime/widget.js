System.register(["jimu-core","jimu-ui","jimu-arcgis","jimu-ui/advanced/setting-components","esri/widgets/support/chartUtils","esri/intl","esri/core/lang","esri/geometry/geometryEngineAsync","esri/geometry/Polyline","esri/geometry/SpatialReference","esri/core/unitUtils","esri/widgets/Sketch/SketchViewModel","esri/Graphic","esri/layers/GraphicsLayer","esri/geometry/Extent","esri/rest/support/Query","esri/geometry/geometryEngine","esri/widgets/ElevationProfile/ElevationProfileViewModel","esri/core/watchUtils","esri/layers/ElevationLayer","esri/symbols/support/jsonUtils","esri/Color"],(function(e,t){var i={},s={},a={},o={},n={},r={},l={},h={},d={},c={},p={},u={},g={},f={},v={},m={},S={},y={},x={},w={},b={},C={};return{setters:[function(e){i.AppMode=e.AppMode,i.BaseWidget=e.BaseWidget,i.DataSourceManager=e.DataSourceManager,i.Immutable=e.Immutable,i.React=e.React,i.WidgetState=e.WidgetState,i.classNames=e.classNames,i.css=e.css,i.getAppStore=e.getAppStore,i.jsx=e.jsx},function(e){s.Alert=e.Alert,s.Button=e.Button,s.Card=e.Card,s.CardBody=e.CardBody,s.Checkbox=e.Checkbox,s.Collapse=e.Collapse,s.Icon=e.Icon,s.Label=e.Label,s.Loading=e.Loading,s.LoadingType=e.LoadingType,s.MultiSelect=e.MultiSelect,s.Option=e.Option,s.Popper=e.Popper,s.Select=e.Select,s.WidgetPlaceholder=e.WidgetPlaceholder,s.defaultMessages=e.defaultMessages},function(e){a.JimuMapViewComponent=e.JimuMapViewComponent},function(e){o.SettingRow=e.SettingRow},function(e){n.default=e.default},function(e){r.default=e.default},function(e){l.default=e.default},function(e){h.default=e.default},function(e){d.default=e.default},function(e){c.default=e.default},function(e){p.default=e.default},function(e){u.default=e.default},function(e){g.default=e.default},function(e){f.default=e.default},function(e){v.default=e.default},function(e){m.default=e.default},function(e){S.default=e.default},function(e){y.default=e.default},function(e){x.default=e.default},function(e){w.default=e.default},function(e){b.default=e.default},function(e){C.default=e.default}],execute:function(){e((()=>{var e={59857:e=>{e.exports='<svg viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M19.5 20a.5.5 0 0 0 0-1H1V1.5a.5.5 0 0 0-1 0V19a1 1 0 0 0 1 1h18.5ZM14 4a1 1 0 1 1-2 0 1 1 0 0 1 2 0Zm-.581 1.956a2.008 2.008 0 0 1-.88-.01L9.366 11.54a2 2 0 1 1-3.06.395l-1.639-2.05a2 2 0 1 1 .831-.562l1.538 1.923a1.991 1.991 0 0 1 1.452-.186l3.165-5.581a2 2 0 1 1 2.66.03l2.267 4.535a2 2 0 1 1-.894.448l-2.268-4.536ZM5 8a1 1 0 1 1-2 0 1 1 0 0 1 2 0Zm3 6a1 1 0 1 0 0-2 1 1 0 0 0 0 2Zm9-1a1 1 0 1 0 0-2 1 1 0 0 0 0 2Z" fill="#000"></path></svg>'},18371:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="m6.036 12.157 8.01-8.01a.5.5 0 1 1 .707.707l-8.01 8.01a1 1 0 0 1-1.415 0L1.146 8.682a.5.5 0 1 1 .708-.707l4.182 4.182Z" fill="#000"></path></svg>'},41553:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M9.438.994c.213 0 .397.146.44.35.151.722.257 1.34.316 1.852.374.16.725.362 1.048.599l1.728-.676a.455.455 0 0 1 .556.188l1.42 2.394a.43.43 0 0 1-.091.547 21.98 21.98 0 0 1-1.49 1.194 5.17 5.17 0 0 1-.007 1.183l1.464 1.119a.43.43 0 0 1 .111.563l-1.42 2.394a.454.454 0 0 1-.53.197 22.445 22.445 0 0 1-1.807-.66c-.325.233-.679.43-1.055.586l-.263 1.794a.446.446 0 0 1-.445.376H6.574a.446.446 0 0 1-.44-.35 21.019 21.019 0 0 1-.317-1.853 5.34 5.34 0 0 1-1.047-.598l-1.728.675a.455.455 0 0 1-.556-.187l-1.42-2.395a.43.43 0 0 1 .091-.546c.567-.49 1.063-.888 1.49-1.194a5.167 5.167 0 0 1 .008-1.183L1.19 6.243a.43.43 0 0 1-.112-.562l1.42-2.395a.455.455 0 0 1 .531-.196c.719.233 1.321.453 1.807.66.324-.233.679-.43 1.056-.587l.262-1.794A.446.446 0 0 1 6.6.994h2.839Zm-.365 1H6.985l-.28 1.866-.467.19c-.235.095-.46.21-.672.34l-.207.136-.42.293-.476-.197c-.328-.137-.718-.281-1.169-.433l-.221-.074-1.045 1.719L3.59 6.999l-.06.479a4.127 4.127 0 0 0-.021.816l.014.144.058.492-.419.294c-.288.203-.615.451-.979.746l-.177.145 1.043 1.72 1.845-.703.406.29c.204.146.42.274.645.384l.228.103.474.199.059.49c.04.338.103.731.19 1.177l.043.219h2.088l.282-1.867.466-.19c.236-.095.46-.21.672-.34l.207-.136.419-.293.476.198c.33.136.72.28 1.17.433l.22.072 1.044-1.718-1.56-1.165.06-.479a4.131 4.131 0 0 0 .02-.815l-.013-.144-.06-.492.42-.295a18.1 18.1 0 0 0 .98-.746l.176-.146-1.043-1.72-1.844.705-.406-.29a4.496 4.496 0 0 0-.646-.385l-.228-.103-.474-.199-.058-.49c-.032-.27-.08-.576-.14-.916l-.094-.48Zm-1.067 3a3 3 0 1 1 0 6 3 3 0 0 1 0-6Zm0 1a2 2 0 1 0 0 4 2 2 0 0 0 0-4Z" fill="#000"></path></svg>'},31356:e=>{e.exports='<svg viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M2 1a1 1 0 0 0-1 1v17a1 1 0 0 0 1 1h2a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H2Zm2 1H2v17h2V2ZM9 6a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h2a1 1 0 0 0 1-1V7a1 1 0 0 0-1-1H9Zm2 1H9v12h2V7ZM15 11a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1h-2a1 1 0 0 1-1-1v-8Zm1 0h2v8h-2v-8Z" fill="#000"></path></svg>'},33869:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15 7.5a.522.522 0 0 1-.516.527H2.976L6.473 11.6a.535.535 0 0 1 0 .746.508.508 0 0 1-.73 0L1 7.5l4.743-4.846a.508.508 0 0 1 .73 0 .535.535 0 0 1 0 .746L2.976 6.973h11.508c.285 0 .516.236.516.527Z" fill="#000"></path></svg>'},59788:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M2.146 4.653a.485.485 0 0 1 .708 0L8 10.24l5.146-5.587a.485.485 0 0 1 .708 0 .538.538 0 0 1 0 .738l-5.5 5.956a.485.485 0 0 1-.708 0l-5.5-5.956a.538.538 0 0 1 0-.738Z" fill="#000"></path></svg>'},25940:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M14.497 7c.277 0 .501-.224.502-.5v-.001A.499.499 0 0 0 14.5 6h-12l2.604-3.135a.528.528 0 0 0-.805-.682L1.243 5.718A1 1 0 0 0 1 6.372V6.5a.5.5 0 0 0 .5.5h12.997ZM1.503 9c-.277 0-.501.224-.502.5v.001c0 .276.224.499.499.499h12l-2.604 3.135a.528.528 0 0 0 .805.682l3.056-3.535A1 1 0 0 0 15 9.628V9.5a.5.5 0 0 0-.5-.5H1.503Z" fill="#000"></path></svg>'},59216:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M11.226 1.312c-.403-.404-1.044-.417-1.431-.03L2.49 8.587l-.48 2.674a.637.637 0 0 0 .73.73l2.673-.48 7.305-7.306c.387-.387.374-1.028-.03-1.431l-1.462-1.462Zm-8.113 9.575.32-1.781 4.991-4.992 1.462 1.462-4.992 4.991-1.781.32Zm7.473-6.012 1.402-1.4-1.462-1.463-1.401 1.402 1.461 1.461Z" fill="#000"></path><path d="M1.5 14a.5.5 0 0 0 0 1h13a.5.5 0 0 0 0-1h-13Z" fill="#000"></path></svg>'},54357:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6 6.5a.5.5 0 0 1 1 0v6a.5.5 0 0 1-1 0v-6ZM9.5 6a.5.5 0 0 0-.5.5v6a.5.5 0 0 0 1 0v-6a.5.5 0 0 0-.5-.5Z" fill="#000"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M11 0H5a1 1 0 0 0-1 1v2H.5a.5.5 0 0 0 0 1h1.6l.81 11.1a1 1 0 0 0 .995.9h8.19a1 1 0 0 0 .995-.9L13.9 4h1.6a.5.5 0 0 0 0-1H12V1a1 1 0 0 0-1-1Zm0 3V1H5v2h6Zm1.895 1h-9.79l.8 11h8.19l.8-11Z" fill="#000"></path></svg>'},46475:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="m10.308.302-.589.808 3.84 2.796L9 6.555l5.013 3.736.597-.801-3.796-2.832 4.576-2.657-5.081-3.7ZM.25 3l8.642 4.969-3.423.738 2.724 5.45-2.887 1.667-2.724-5.45-2.35 2.595L.25 3Zm.996 1.726-.01 5.644 1.527-1.684 2.909 5.771 1.155-.667-2.91-5.77 2.222-.48-4.893-2.814Z" fill="#000"></path></svg>'},11639:e=>{"use strict";e.exports=C},94129:e=>{"use strict";e.exports=g},77970:e=>{"use strict";e.exports=l},93761:e=>{"use strict";e.exports=p},14345:e=>{"use strict";e.exports=x},55606:e=>{"use strict";e.exports=v},24920:e=>{"use strict";e.exports=d},75443:e=>{"use strict";e.exports=c},24942:e=>{"use strict";e.exports=S},61339:e=>{"use strict";e.exports=h},3498:e=>{"use strict";e.exports=r},17465:e=>{"use strict";e.exports=w},23852:e=>{"use strict";e.exports=f},37902:e=>{"use strict";e.exports=m},45818:e=>{"use strict";e.exports=b},22443:e=>{"use strict";e.exports=y},97878:e=>{"use strict";e.exports=u},3476:e=>{"use strict";e.exports=n},26826:e=>{"use strict";e.exports=a},48891:e=>{"use strict";e.exports=i},30726:e=>{"use strict";e.exports=s},77756:e=>{"use strict";e.exports=o}},t={};function L(i){var s=t[i];if(void 0!==s)return s.exports;var a=t[i]={exports:{}};return e[i](a,a.exports,L),a.exports}L.d=(e,t)=>{for(var i in t)L.o(t,i)&&!L.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},L.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),L.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},L.p="";var M={};return L.p=window.jimuConfig.baseUrl,(()=>{"use strict";L.r(M),L.d(M,{default:()=>se});var e,t=L(48891),i=L(30726);!function(e){e.IconText="ICONTEXT"}(e||(e={}));var s=L(26826);function a(e){const i=e.surfaces[1].bg;return t.css`
    overflow: auto;
    background-color: ${i};
    .widget-elevation-profile {
      width: 100%;
      height: 100%;
      min-height: 200px;

      .userGuideInfo {
        font-weight: 400;
        overflow-y: auto;
        height: 65px;
      }

      .front-section {
        min-width: 200px;
        min-height: 200px;
        max-height: 250px;
        max-width: 220px;
      }

      .front-cards {
        border-radius: 7px;
      }

      .hidden {
        display: none;
      }

      .mainSection {
        padding: 20px;
      }

      .adjust-cards {
        gap: 2px 35px;
        width: 100%;
        max-height: -webkit-fill-available;
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
      }
  `}function o(e){let i="calc(100% - 83px)";return"125%"===e.typography.fontSizeRoot?i="calc(100% - 92px)":"87.5%"===e.typography.fontSizeRoot?i="calc(100% - 78px)":"75%"===e.typography.fontSizeRoot&&(i="calc(100% - 73px)"),t.css`
    .ep-widget-header {
      .chart-actions {
        float: right;
        width: 32px;
        height: 32px;
        margin: 2px 5px 2px 5px;
      }
    }

    .ep-widget-bodyContainer {
      height: ${i};

      .alignInfo {
        padding-right: 40px;
        padding-left: 40px;
      }

      .userInfo .left-part {
        font-weight: 400;
      }
    }

    .floatingInfoMsg {
      .alignDismissibleInfo {
        position: absolute;
        left: 53px;
        width: calc(100% - 109px);
        z-index: 1;
        bottom: 55px;
        margin: 0 auto;
      }

      .alignDismissibleInfo .left-part .text-left {
        overflow: hidden;
        text-overflow: ellipsis;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        display: -webkit-box;
        font-weight: 400;
      }

      .showMessage {
        display: flex;
      }

      .hideMessage {
        display: none;
      }
    }

    .ep-widget-footer {
      line-height: 1.3;
      background-color: unset;
      border: 1px solid ${e.colors.palette.light[200]};
      width: calc(100% - 9px);
      margin-left: 4px;

      .hidden {
        display: none;
      }

      .footer-display {
        display: inline-block;
      }

      .actionButton {
        float: right;
      }
    }
  `}var n=L(77756);const r={_widgetLabel:"Elevation Profile",selectLinesLabel:"Select line",selectLinesDesc:"Select a line to view the elevation.",selectButtonLabel:"Select",drawProfileLabel:"Draw profile",drawProfileDesc:"Draw a line to view the ground elevation.",drawButtonLabel:"Draw",backButtonLabel:"Reset",doneButtonLabel:"Done",clearButtonLabel:"Clear",newProfileButtonLabel:"New profile",drawUserInfo:"Click the map to place the first point and double-click to finish.",selectUserInfo:"Click a line on the map to begin.",emptyDrawStateWarning:"Draw on the map to generate an elevation profile.",emptySelectStateWarning:"Select a line on the map to generate an elevation profile.",infoMsgWhileDrawing:"Double-click or click Done to finish.",infoMsgWhileSelecting:"Select a connected line (yellow dotted) or click Done to finish.",addToSelectionWarning:"There are no additional connected lines to select.",chartRender:"Elevation Profile for the selected or drawn lines.",noFeaturesFound:"No selectable line in this location. Click a line from the selectable layers.",unknownError:"There was an unknown error generating the profile.",noProfileError:"No elevation information is available for this location.",tooComplexError:"Profile could not be generated. Input line is too complex.",invalidGeometryError:"Profile could not be generated. Invalid geometry.",invalidElevationInfoError:"Profile could not be generated. Elevation options of the line are not supported.",chartStatistics:"Profile Statistics",chartFlip:"Reverse Direction",settingsOptions:"Settings",statisticsLabel:"Profile Statistics",elevationUnitLabel:"Elevation Units",distanceUnitLabel:"Distance Units",selectionBufferLabel:"Selection Buffer",selectableLayersLabel:"Selectable layers",selectLayerLabel:"Select Layers",selectedLayerCount:"{selectedLayerCount} enabled",groundElevation:"Ground Elevation",uniformChartScaling:"Uniform Scaling",uniformChartScalingInfo:"Use a uniform scale for the Distance and Elevation axes.",selectLayerWarning:"At least one layer should be enabled for selection",meters:"Meters",metersAbbreviation:"m",feet:"Feet",feetAbbreviation:"ft",kilometers:"Kilometers",kilometersAbbreviation:"km",miles:"Miles",milesAbbreviation:"mi",yards:"Yards",yardsAbbreviation:"yd",distanceLabel:"Distance",elevationLabel:"Elevation",graphDistanceLabel:"Distance - {unit}",graphElevationLabel:"Elevation - {unit}",expandLegend:"Expand Legend",maxDistance:"MAX Distance",minElevation:"MIN Elevation",maxElevation:"MAX Elevation",avgElevation:"AVG Elevation",elevationGain:"Elevation Gain",elevationLoss:"Elevation Loss",maxPositiveSlope:"MAX Positive Slope",maxNegativeSlope:"MAX Negative Slope",avgPositiveSlope:"AVG Positive Slope",avgNegativeSlope:"AVG Negative Slope"},l=L(59857),h=L(46475),d=L(59216),c=L(33869),p=L(18371),u=L(54357),g=L(31356),f=L(25940),v=L(41553),m=L(59788),S=()=>({epIcon:{elevationIcon:l,selectIcon:h,drawIcon:d,arrowNavBack:c,doneIcon:p,clearIcon:u,chartIcon:g,flipIcon:f,settingsIcon:v,iconExpandCollapse:m}}),y=[{value:"meters",abbreviation:"metersAbbreviation"},{value:"feet",abbreviation:"feetAbbreviation"},{value:"kilometers",abbreviation:"kilometersAbbreviation"},{value:"miles",abbreviation:"milesAbbreviation"},{value:"yards",abbreviation:"yardsAbbreviation"}],x=[{value:"maxDistance",label:r.maxDistance},{value:"minElevation",label:r.minElevation},{value:"maxElevation",label:r.maxElevation},{value:"avgElevation",label:r.avgElevation},{value:"elevationGain",label:r.elevationGain},{value:"elevationLoss",label:r.elevationLoss},{value:"maxPositiveSlope",label:r.maxPositiveSlope},{value:"maxNegativeSlope",label:r.maxNegativeSlope},{value:"avgPositiveSlope",label:r.avgPositiveSlope},{value:"avgNegativeSlope",label:r.avgNegativeSlope}];var w,b;function C(e){var i;const s=t.DataSourceManager.getInstance(),a=null===(i=null==s?void 0:s.getDataSource(e))||void 0===i?void 0:i.getChildDataSources(),o=[];return null==a||a.forEach((e=>{if("GROUP_LAYER"===e.type){const t=e.getChildDataSources();t&&t.forEach((e=>{o.push(e)}))}else o.push(e)})),o}function I(e,t){let i=null==e?void 0:e.profileChartSettings.elevationUnit,s=null==e?void 0:e.profileChartSettings.linearUnit;return(null==e?void 0:e.profileChartSettings.elevationUnit)||(i="english"===(null==t?void 0:t.units)?"feet":"meters"),(null==e?void 0:e.profileChartSettings.linearUnit)||(s="english"===(null==t?void 0:t.units)?"miles":"kilometers"),[i,s]}!function(e){e.NoVisibleProfiles="no-visible-profiles",e.InvalidGeometry="invalid-geometry",e.TooComplex="too-complex",e.InvalidElevationInfo="invalid-elevation-info",e.UnknownError="unknown-error",e.RefinedButNoChartData="refined-but-no-chart-data",e.None="none"}(w||(w={})),function(e){e.MaxDistance="maxDistance",e.MinElevation="minElevation",e.MaxElevation="maxElevation",e.AvgElevation="avgElevation",e.ElevationGain="elevationGain",e.ElevationLoss="elevationLoss",e.MaxPositiveSlope="maxPositiveSlope",e.MaxNegativeSlope="maxNegativeSlope",e.AvgPositiveSlope="avgPositiveSlope",e.AvgNegativeSlope="avgNegativeSlope"}(b||(b={}));var E=L(3476);function A(e,t,i){return D(e,t,i)}function D(e,t,i){return t===i?+e:+e/P(t)*P(i)}function P(e){let t=1;switch(e){case"meters":t=1;break;case"kilometers":t=.001;break;case"feet":t=1/.3048;break;case"yards":t=1/.9144;break;case"miles":t=1/1609.344}return t}function F(e,t){const i=Math.floor(Math.log10(e)),s=e/Math.pow(10,i);let a;return a=t?s<1.5?1:s<3?2:s<5?2.5:s<7?5:10:s<=1?1:s<=2?2:s<=3?2.5:s<=5?5:10,a*Math.pow(10,i)}var k=L(3498),j=L(77970),T=L(61339),R=L(24920),U=L(75443),N=L(93761),O=function(e,t,i,s){return new(i||(i=Promise))((function(a,o){function n(e){try{l(s.next(e))}catch(e){o(e)}}function r(e){try{l(s.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(n,r)}l((s=s.apply(e,t||[])).next())}))};class V extends t.React.PureComponent{constructor(e){var s,a,o;super(e),this._chartContainer=t.React.createRef(),this.nls=e=>{const t=Object.assign({},r,i.defaultMessages);return this.props.intl&&this.props.intl.formatMessage?this.props.intl.formatMessage({id:e,defaultMessage:t[e]}):t[e]},this.componentDidUpdate=e=>{var t,i,s,a,o,n,r,l,h,d,c,p,u,g,f,v,m,S,y,x,w,b,C,L,M,I,E,A,D,P,F,k,j,T,R,U,N;if((null===(t=e.commonGeneralSettings)||void 0===t?void 0:t.showGridAxis)!==(null===(i=this.props.commonGeneralSettings)||void 0===i?void 0:i.showGridAxis)&&(null===(s=this.chart)||void 0===s?void 0:s.xAxes.values.length)>0&&this.chart.yAxes.values.length>0||e.elevationGraphColor!==this.props.elevationGraphColor){if(this.chart){this.xAxis.renderer.grid.template.disabled=!(null===(a=this.props.commonGeneralSettings)||void 0===a?void 0:a.showGridAxis),this.yAxis.renderer.grid.template.disabled=!(null===(o=this.props.commonGeneralSettings)||void 0===o?void 0:o.showGridAxis);const{am4core:e}=this.amchart4;this.chartSeries.stroke=e.color(this.props.elevationGraphColor),this.chartSeries.fill=e.color(this.props.elevationGraphColor)}return}if((null===(n=e.commonGeneralSettings)||void 0===n?void 0:n.showLegend)!==(null===(r=this.props.commonGeneralSettings)||void 0===r?void 0:r.showLegend)||(null===(l=e.commonGeneralSettings)||void 0===l?void 0:l.showAxisTitles)!==(null===(h=this.props.commonGeneralSettings)||void 0===h?void 0:h.showAxisTitles))return this.xAxis.title.visible=null===(d=this.props.commonGeneralSettings)||void 0===d?void 0:d.showAxisTitles,this.xAxis.title.textAlign="middle",this.yAxis.title.visible=null===(c=this.props.commonGeneralSettings)||void 0===c?void 0:c.showAxisTitles,this.yAxis.title.textAlign="middle",this.isRTL?this.chart.padding(0,(null===(p=this.props.commonGeneralSettings)||void 0===p?void 0:p.showAxisTitles)?5:-10,(null===(u=this.props.commonGeneralSettings)||void 0===u?void 0:u.showAxisTitles)&&(null===(g=this.props.commonGeneralSettings)||void 0===g?void 0:g.showLegend)?4:(null===(f=this.props.commonGeneralSettings)||void 0===f?void 0:f.showAxisTitles)&&!(null===(v=this.props.commonGeneralSettings)||void 0===v?void 0:v.showLegend)?-2:!(null===(m=this.props.commonGeneralSettings)||void 0===m?void 0:m.showAxisTitles)&&(null===(S=this.props.commonGeneralSettings)||void 0===S?void 0:S.showLegend)||(null===(y=this.props.commonGeneralSettings)||void 0===y?void 0:y.showAxisTitles)||(null===(x=this.props.commonGeneralSettings)||void 0===x?void 0:x.showLegend)?0:-25,5):this.chart.padding(0,5,(null===(w=this.props.commonGeneralSettings)||void 0===w?void 0:w.showAxisTitles)&&(null===(b=this.props.commonGeneralSettings)||void 0===b?void 0:b.showLegend)?4:(null===(C=this.props.commonGeneralSettings)||void 0===C?void 0:C.showAxisTitles)&&!(null===(L=this.props.commonGeneralSettings)||void 0===L?void 0:L.showLegend)?-2:!(null===(M=this.props.commonGeneralSettings)||void 0===M?void 0:M.showAxisTitles)&&(null===(I=this.props.commonGeneralSettings)||void 0===I?void 0:I.showLegend)||(null===(E=this.props.commonGeneralSettings)||void 0===E?void 0:E.showAxisTitles)||(null===(A=this.props.commonGeneralSettings)||void 0===A?void 0:A.showLegend)?0:-25,(null===(D=this.props.commonGeneralSettings)||void 0===D?void 0:D.showAxisTitles)?5:-10),this.xAxis.invalidateLabels(),this.yAxis.invalidateLabels(),void this.setState({showLegend:null===(P=this.props.commonGeneralSettings)||void 0===P?void 0:P.showLegend},(()=>{var e;this.state.showLegend?this.chart.legend?this.chart.legend.visible=this.state.showLegend:this.displayChartLegend(this.accessChartParams):(null===(e=this.chart)||void 0===e?void 0:e.legend)&&(this.chart.legend.visible=this.state.showLegend)}));const O=this.didProfileLayersSettingsChanged(null===(F=e.currentConfig)||void 0===F?void 0:F.profileSettings.layers,null===(k=this.props.currentConfig)||void 0===k?void 0:k.profileSettings.layers);(O||e.selectedLinearUnit!==this.props.selectedLinearUnit||e.selectedElevationUnit!==this.props.selectedElevationUnit||e.profileResult!==this.props.profileResult||e.theme!==this.props.theme||e.isFlip!==this.props.isFlip||e.isUniformChartScalingEnable!==this.props.isUniformChartScalingEnable||(null===(j=e.currentConfig)||void 0===j?void 0:j.advanceOptions)!==(null===(T=this.props.currentConfig)||void 0===T?void 0:T.advanceOptions))&&((O||e.theme.darkTheme!==this.props.theme.darkTheme||e.theme.colors.palette.primary[600]!==this.props.theme.colors.palette.primary[600]||e.theme.typography.fontSizeRoot!==this.props.theme.typography.fontSizeRoot||(null===(R=e.currentConfig)||void 0===R?void 0:R.advanceOptions)!==(null===(U=this.props.currentConfig)||void 0===U?void 0:U.advanceOptions))&&this.chart&&(this.chart.dispose(),this.chart=null),this.updatedProfileLayers=null===(N=this.props.currentConfig)||void 0===N?void 0:N.profileSettings.layers,this.createOrUpdateChartDefinition())},this.didProfileLayersSettingsChanged=(e,t)=>{let i=!1;return(null==t?void 0:t.length)!==(null==e?void 0:e.length)||(null==t||t.some(((t,s)=>{if(t.style.lineType!==e[s].style.lineType||t.style.lineColor!==e[s].style.lineColor||t.style.lineThickness!==e[s].style.lineThickness||t.elevationSettings.type!==e[s].elevationSettings.type||t.elevationSettings.unit!==e[s].elevationSettings.unit||t.elevationSettings.field1!==e[s].elevationSettings.field1||t.elevationSettings.field2!==e[s].elevationSettings.field2||t.distanceSettings.type!==e[s].distanceSettings.type||t.distanceSettings.field!==e[s].distanceSettings.field||t.distanceSettings.unit!==e[s].distanceSettings.unit)return i=!0,!0})),i)},this.createOrUpdateChartDefinition=()=>{if(this.props.profileResult&&this.props.profileResult.lines.length>0&&this.props.selectedLinearUnit&&this.props.selectedElevationUnit&&this.props.theme){const e=this.props.profileResult.lines[0].samples;if(e.length>0){const t=[];this.allDistances=[],e.length>0?(e.forEach(((e,i)=>{const s={x:D(e.distance,this.props.profileResult.effectiveUnits.distance,this.props.selectedLinearUnit),y:D(e.elevation,this.props.profileResult.effectiveUnits.elevation,this.props.selectedElevationUnit),pathIdx:0,pointIdx:i};t.push(s),this.allDistances.push(e.distance)})),this.minMaxOfEachProfile={},this.seriesKey=[],this.seriesValue=[],this.createDataForProfileLines(t).then((i=>{const s=[];if(this.props.isFlip){this.seriesKey.reverse(),this.seriesValue.reverse();const i=[...e].reverse();t.forEach(((e,t)=>{const a=D(i[t].elevation,this.props.profileResult.effectiveUnits.elevation,this.props.selectedElevationUnit),o={x:e.x,y:a,pathIdx:e.pathIdx,pointIdx:e.pointIdx};o[this.seriesKey[t]]=this.seriesValue[t],s.push(o)}))}const a=this.getSelectedUnits(),o=this.props.intl.formatMessage({id:"graphDistanceLabel",defaultMessage:r.graphDistanceLabel},{unit:a[0]}),n=this.props.intl.formatMessage({id:"graphElevationLabel",defaultMessage:r.graphElevationLabel},{unit:a[1]}),l={data:this.props.isFlip?s:t,series:[{x:{field:"x",label:o},y:{field:"y",label:n},color:this.props.elevationGraphColor}]};this.setState({chartDefinition:l},(()=>{var e,i;if(this.chart){this.chart.data=this.props.isFlip?s:t,this.xAxis.title.text=o,this.xAxis.title.textAlign="middle",this.yAxis.title.text=n,this.yAxis.title.textAlign="middle";const{am4core:e}=this.amchart4;return this.chart.zoomOutButton.background.fill=e.color(this.props.theme.colors.palette.primary[600]),this.chart.zoomOutButton.background.states.getKey("hover")&&this.chart.zoomOutButton.background.states.getKey("down")&&(this.chart.zoomOutButton.background.states.getKey("hover").properties.fill=e.color(this.props.theme.colors.palette.primary[500]),this.chart.zoomOutButton.background.states.getKey("down").properties.fill=e.color(this.props.theme.colors.palette.primary[800])),this.xAxis.numberFormatter=this.makeFormatter(this.xAxis,a[2]),this.yAxis.numberFormatter=this.makeFormatter(this.yAxis,a[3]),this.adjustAxisRanges(this.accessChartParams),this.xAxis.invalidateLabels(),void this.yAxis.invalidateLabels()}this.createChart({definition:l,container:this._chartContainer.current,isRTL:this.isRTL,isDarkTheme:this.props.theme.darkTheme,showGrid:null===(e=this.props.commonGeneralSettings)||void 0===e?void 0:e.showGridAxis,showTitleAxis:null===(i=this.props.commonGeneralSettings)||void 0===i?void 0:i.showAxisTitles,showLegend:this.state.showLegend})}))}))):this.setState({chartDefinition:null},(()=>{this.chart&&(this.chart.dispose(),this.chart=null)}))}}else this.setState({chartDefinition:null}),this.chart&&(this.chart.dispose(),this.chart=null)},this.checkForProfileSettings=()=>{var e,t,i,s;const a=[];return(null===(t=null===(e=this.props.drawingLayer)||void 0===e?void 0:e.graphics)||void 0===t?void 0:t.length)>0&&(null===(s=null===(i=this.props.drawingLayer.graphics.getItemAt(0))||void 0===i?void 0:i.attributes)||void 0===s?void 0:s.esriCTFeatureLayerId)&&this.props.drawingLayer.graphics.forEach((e=>{const t=e.getAttribute("esriCTFeatureLayerId");a.includes(t)||a.push(t)})),a},this.getSelectedUnits=()=>{const e=this.props.unitOptions.find((e=>e.value===this.props.selectedLinearUnit)),t=this.props.unitOptions.find((e=>e.value===this.props.selectedElevationUnit)),i=this.nls(e.value),s=this.nls(e.abbreviation);return[i,this.nls(t.value),s,this.nls(t.abbreviation)]},this._updateProfileResults=e=>{const t={distances:{},elevations:{}};var i,s,a;return t.distances=(i=e.distances,s=e.effectiveUnits.distance,a=this.props.selectedLinearUnit,i.map((e=>parseFloat(A(e,s,a).toString()))),i),t.elevations=function(e,t,i,s,a){return e.forEach((e=>{e.x=parseFloat(A(e.x,t,s).toString()),e.y=parseFloat(A(e.y,i,a).toString())})),e}(e.elevations,e.effectiveUnits.distance,e.effectiveUnits.elevation,this.props.selectedLinearUnit,this.props.selectedElevationUnit),t},this.clearChart=()=>{this.setState({chartDefinition:null})},this.getNearestElevationData=e=>{const t=this.allDistances,i=D(e,this.props.selectedLinearUnit,this.props.profileResult.effectiveUnits.distance),s=t.reduce(((e,t)=>Math.abs(t-i)<Math.abs(e-i)?t:e));if(s>=0){const e=t?t.indexOf(s):-1;if(e>=0)return this.state.chartDefinition.data[e]}return null},this.getNearestFlippedElevationData=e=>{const t=[...this.allDistances].reverse(),i=D(e,this.props.selectedLinearUnit,this.props.profileResult.effectiveUnits.distance),s=t.reduce(((e,t)=>Math.abs(t-i)<Math.abs(e-i)?t:e));if(s>=0){const e=t?t.indexOf(s):-1;if(e>=0)return this.state.chartDefinition.data[e]}return null},this.hideChartPosition=()=>{this.props.hideChartPosition()},this.createChart=e=>O(this,void 0,void 0,(function*(){var t;const i=yield E.default.loadChartsModule();if(!i)return;this.amchart4=i;const{am4core:s,am4charts:a}=i,o=e.isRTL;s.useTheme(i.am4themes_animated),e.isDarkTheme?s.useTheme(i.am4themes_dark):s.unuseTheme(i.am4themes_dark);const n=s.create(e.container,a.XYChart);this.chart=n,o?n.padding(0,e.showTitleAxis?5:-10,e.showTitleAxis&&e.showLegend?4:e.showTitleAxis&&!e.showLegend?-2:!e.showTitleAxis&&e.showLegend||e.showTitleAxis||e.showLegend?0:-25,5):n.padding(0,5,e.showTitleAxis&&e.showLegend?4:e.showTitleAxis&&!e.showLegend?-2:!e.showTitleAxis&&e.showLegend||e.showTitleAxis||e.showLegend?0:-25,e.showTitleAxis?5:-10),n.data=e.definition.data;const r=(null===(t=e.definition.series[0])||void 0===t?void 0:t.color)?e.definition.series[0].color:"#b54900";n.zoomOutButton.background.fill=s.color(this.props.theme.colors.palette.primary[600]),n.zoomOutButton.background.states.getKey("hover")&&n.zoomOutButton.background.states.getKey("down")&&(n.zoomOutButton.background.states.getKey("hover").properties.fill=s.color(this.props.theme.colors.palette.primary[500]),n.zoomOutButton.background.states.getKey("down").properties.fill=s.color(this.props.theme.colors.palette.primary[800])),n.zoomOutButton.readerTitle=this.nls("zoomOut");const l=this.getSelectedUnits(),h=n.xAxes.push(new a.ValueAxis),d=n.yAxes.push(new a.ValueAxis);this.accessChartParams={params:e,am4charts:a,amCharts4Index:i,chart:n,xAxis:h,yAxis:d,unitsAbbreviations:l,groundColor:r,isRTL:o},this.configureXAxis(this.accessChartParams),this.configureYAxis(this.accessChartParams),this.configureTooltipCursorPosition(this.accessChartParams),this.addGroundSeries(this.accessChartParams),this.adjustAxisRanges(this.accessChartParams),this.hideLastGridLines(this.accessChartParams),this.profilingWithAdvanceOptions(),this.state.showLegend&&this.displayChartLegend(this.accessChartParams),o&&(n.rtl=o,n.zoomOutButton.align="left",n.zoomOutButton.marginLeft="5px",this.xAxis.renderer.inversed=o,this.xAxis.renderer.labels.template.textAlign="middle",this.yAxis.renderer.opposite=o,this.yAxis.renderer.labels.template.textAlign="middle")})),this.profilingWithAdvanceOptions=()=>{var e;if(null===(e=this.props.currentConfig)||void 0===e?void 0:e.advanceOptions){const e=this.checkForProfileSettings();e.length>0&&e.forEach((e=>{this.addLineSeries(e,this.accessChartParams)}))}},this.hideLastGridLines=e=>{const{yAxis:t}=e,i=e=>()=>{e.renderer.grid.each((e=>{e.visible="none"!==e.dataItem.label.dom.getAttribute("display")}))};this.yAxis.events.on("rangechangeended",i(t)),this.yAxis.events.on("validated",i(t))},this.adjustAxisRanges=e=>{const{xAxis:t,yAxis:i}=e,{minX:s,maxX:a,minY:o,maxY:n}=this.getAdjustedBounds({data:this.props.profileResult,pixelWidth:t.pixelWidth,pixelHeight:i.pixelHeight});t.min=s,t.max=a,i.min=o,i.max=n},this.getAdjustedBounds=({data:e,pixelWidth:t,pixelHeight:i})=>{const s=e.statistics;let a=s.maxDistance;a=D(a,e.effectiveUnits.distance,this.props.selectedLinearUnit);let o=s.minElevation;o=D(o,e.effectiveUnits.elevation,this.props.selectedElevationUnit);let n=s.maxElevation;n=D(n,e.effectiveUnits.elevation,this.props.selectedElevationUnit);for(const e in this.minMaxOfEachProfile)this.minMaxOfEachProfile[e].max>n&&(n=this.minMaxOfEachProfile[e].max),this.minMaxOfEachProfile[e].min<o&&(o=this.minMaxOfEachProfile[e].min);const r=Math.max(a-0,.001);let l=Math.max(n-o,.001);if(e.dynamicElevationRange){const e=D(l,this.props.selectedLinearUnit,this.props.selectedElevationUnit);l=Math.max(l,e/300)}o-=.02*l,n=o+l+.02*l;const h=function(e,t,i=10){const s=F(t-e,!1);if(0===s)return[e,t];const a=F(s/(i-1),!0);return[Math.floor(e/a)*a,Math.ceil(t/a)*a]}(o,n,10);return l=h[1]-h[0],this.props.isUniformChartScalingEnable?this.getUniformBounds({bounds:{minX:0,maxX:a,minY:o,maxY:n},pixelWidth:t,pixelHeight:i,centered:!0}):{minX:0,maxX:0+r,minY:o,maxY:o+l}},this.getUniformBounds=({bounds:e,pixelWidth:t,pixelHeight:i,centered:s})=>{let{minX:a,maxX:o,minY:n,maxY:r}=e;const l=o-a,h=D(r-n,this.props.selectedElevationUnit,this.props.selectedLinearUnit)/i/(l/t);return h>=1?[a,o]=this.scaleRange([a,o],h,s):[n,r]=this.scaleRange([n,r],1/h,s),{minX:a,maxX:o,minY:n,maxY:r}},this.scaleRange=([e,t],i,s)=>{const a=(t-e)*i;if(s){const i=(e+t)/2-a/2;return[i,i+a]}return[e,e+a]},this.getFontSize=()=>{const e=this.props.theme;let t=9;return"125%"===e.typography.fontSizeRoot?t=11:"87.5%"===e.typography.fontSizeRoot?t=8:"75%"===e.typography.fontSizeRoot&&(t=7),t},this.configureXAxis=e=>{const{xAxis:t,params:i,unitsAbbreviations:s}=e,{am4core:a}=e.amCharts4Index,o=this.getFontSize();this.xAxis=t,t.title.text=i.definition.series[0].x.label,t.title.textAlign="middle",t.title.fontWeight=400,t.title.fontSize=o+3,t.title.visible=i.showTitleAxis,t.cursorTooltipEnabled=!0,t.extraTooltipPrecision=2,t.numberFormatter=this.makeFormatter(t,s[2]),t.strictMinMax=!0;const n=t.renderer.labels.template;n.fontSize=o,n.fontWeight="400",n.paddingTop=6,n.horizontalCenter="left",n.paddingLeft=0,t.renderer.line.visible=!1,t.renderer.baseGrid.disabled=!0,t.renderer.minGridDistance=50,t.renderer.minLabelPosition=.05,t.renderer.maxLabelPosition=.95,t.renderer.fontWeight=400,t.renderer.fontSize=o,t.renderer.grid.template.disabled=!i.showGrid,t.renderer.grid.template.strokeOpacity=.1,t.renderer.grid.template.stroke=a.color("f4f4f4")},this.configureYAxis=e=>{const{yAxis:t,params:i,unitsAbbreviations:s}=e,{am4core:a}=e.amCharts4Index,o=this.getFontSize();this.yAxis=t,t.title.text=i.definition.series[0].y.label,t.title.textAlign="middle",t.title.fontWeight=400,t.title.fontSize=o+3,t.title.paddingBottom=6,t.title.visible=i.showTitleAxis,t.cursorTooltipEnabled=!0,t.extraTooltipPrecision=2,t.numberFormatter=this.makeFormatter(t,s[3]),t.strictMinMax=!0,t.baseValue=-5e5;const n=t.renderer.labels.template;n.fontSize=o,n.fontWeight="400",n.verticalCenter="bottom",n.paddingLeft=4,n.paddingBottom=0,t.renderer.line.opacity=0,t.renderer.line.visible=!1,t.renderer.baseGrid.disabled=!0,t.renderer.inside=!0,t.renderer.minGridDistance=30,t.renderer.minLabelPosition=0,t.renderer.maxLabelPosition=.95,t.renderer.fontWeight=400,t.renderer.fontSize=o,t.renderer.grid.template.disabled=!i.showGrid,t.renderer.grid.template.strokeOpacity=.1,t.renderer.grid.template.stroke=a.color("f4f4f4")},this.configureTooltipCursorPosition=e=>{const{xAxis:t,yAxis:i,chart:s}=e,{am4core:a}=e.amCharts4Index,o=this.getFontSize(),n=s.tooltip;n.label.fontSize=o+3,n.label.padding(4,4,4,4),n.background.padding(0,0,0,0),n.background.cornerRadius=0,n.background.stroke=null,n.background.fill=a.color(this.props.theme.colors.white),n.label.fill=a.color(this.props.theme.colors.black);const r=new e.amCharts4Index.am4charts.XYCursor;r.trackable=!0,r.behavior="zoomXY",r.events.on("cursorpositionchanged",(e=>{var a,o;const n=t.toAxisPosition(r.xPosition),l=t.positionToValue(n),h=this.getNearestElevationData(l);if(h){if(this.props.isFlip){const e=this.getNearestFlippedElevationData(l);e&&this.props.highlightChartPositionOnMap(t.valueToPosition(e.x))}else this.props.highlightChartPositionOnMap(r.xPosition);let e=null;const n=i.measuredHeight,d=n+s.pixelPaddingTop,c=this.yAxis.numberFormatter.format(h.y,5);let p="";this.chartSeries.isHiding||this.chartSeries.isHidden||(e=h.y,p+='<div style="display:inline-block; margin: 3px 0px 3px 0px; height: 2px; width:15px; background-color:'+this.chartSeries.stroke.hex+';"></div> '+this.chartSeries.name+":  <b>"+c+"</b> <br/>");const u=this.seriesKey&&this.seriesKey[h.pointIdx]?this.seriesKey[h.pointIdx]:null;if(null===(o=null===(a=this.chart)||void 0===a?void 0:a.series)||void 0===o||o.values.forEach((t=>{if(t.dataFields.valueY===u&&!t.isHiding&&!t.isHidden){const i=this.yAxis.numberFormatter.format(h[u],5);return(null===e||e<h[u])&&(e=h[u]),p+='<div style="display:inline-block; margin: 3px 0px 3px 0px; height: 2px; width:15px; background-color:'+t.stroke.hex+';"></div> '+t.name+":  <b>"+i+"</b> <br/>",!0}})),""!==p&&this.yAxis.min<=e){s.tooltip.html=p;const t={x:r.point.x+r.parent.pixelX+s.pixelPaddingLeft,y:d-i.valueToPosition(e)*n-1};s.tooltip.pointTo(t,!0),s.tooltip.show()}}})),s.events.on("out",(()=>{s.tooltip.hide(),this.hideChartPosition()})),s.cursor=r},this.addGroundSeries=e=>{const{chart:t,groundColor:i,am4charts:s}=e,{am4core:a}=e.amCharts4Index,o=t.series.push(new s.LineSeries);this.chartSeries=o,this.props.chartInfo(this.chart),o.dataFields.valueY="y",o.dataFields.valueX="x",o.name=this.nls("groundElevation"),o.stroke=a.color(i),o.fill=a.color(i),o.strokeWidth=1.5,o.fillOpacity=.1},this.createDataForProfileLines=e=>O(this,void 0,void 0,(function*(){var t;const i=[];if(null===(t=this.props.currentConfig)||void 0===t?void 0:t.advanceOptions){const t=this.checkForProfileSettings();return t.length>0?new Promise(((s,a)=>{this.getDistanceOfAllSelectedFeatures().then((a=>{t.forEach((t=>{let s=0;this.props.drawingLayer.graphics.forEach(((o,n)=>O(this,void 0,void 0,(function*(){const r=o.attributes.esriCTFeatureLayerId,l=this.getConfiguredSettingsForLine(r);if((null==l?void 0:l.elevationSettings)&&r===t){const t=a[n],r=j.default.clone(s);s+=t;const h=e.filter((e=>e.x>=r&&e.x<=s));yield i.push(this.addElevationForSelectedFeature(l.elevationSettings,o,t,h,r))}else s+=a[n]}))))})),Promise.all(i).then((()=>{s(e)}),(()=>{s(e)}))}))})):yield Promise.resolve()}return yield Promise.resolve()})),this.getDistanceAsPerMapProjection=(e,t)=>this.props.mapView.view.spatialReference.isWebMercator||this.props.mapView.view.spatialReference.isGeographic?T.default.geodesicLength(e,t):T.default.planarLength(e,t),this.getConfiguredSettingsForLine=e=>this.updatedProfileLayers.find((t=>t.layerId===e)),this.getDistanceAsPerConfiguredFieldAndUnits=(e,t)=>{const i=t.attributes[e.field];return isNaN(Number(i))?0:D(i,e.unit,this.props.selectedLinearUnit)},this.updateMinMaxForProfile=(e,t,i)=>{this.seriesKey[e]=t+"y",this.seriesValue[e]=i,this.minMaxOfEachProfile[t]?this.minMaxOfEachProfile[t]&&(this.minMaxOfEachProfile[t].min>i&&(this.minMaxOfEachProfile[t].min=i),this.minMaxOfEachProfile[t].max<i&&(this.minMaxOfEachProfile[t].max=i)):this.minMaxOfEachProfile[t]={min:i,max:i}},this.addElevationForSelectedFeature=(e,t,i,s,a)=>O(this,void 0,void 0,(function*(){const o=new Promise((o=>{var n;let r,l;const h=t.attributes.esriCTFeatureLayerId;if("one"===e.type&&e.field1&&null!==t.attributes[e.field1])r=t.attributes[e.field1],e.unit&&e.unit!==this.props.selectedElevationUnit&&(r=D(r,e.unit,this.props.selectedElevationUnit)),s.forEach((e=>{e[h+"y"]=r,this.updateMinMaxForProfile(e.pointIdx,h,r)})),o(!0);else if("two"===e.type&&e.field1&&e.field2&&null!==t.attributes[e.field1]&&null!==t.attributes[e.field2]){r=t.attributes[e.field1],e.unit&&e.unit!==this.props.selectedElevationUnit&&(r=D(r,e.unit,this.props.selectedElevationUnit)),l=t.attributes[e.field2],e.unit&&e.unit!==this.props.selectedElevationUnit&&(l=D(l,e.unit,this.props.selectedElevationUnit));const n=(l-r)/i;s.forEach((e=>{let t=0;t=e.x-a;const i=r+n*t;e[h+"y"]=i,this.updateMinMaxForProfile(e.pointIdx,h,i)})),o(!0)}else if("z"===e.type&&t.geometry.hasZ){const e=t.geometry;if((null===(n=e.paths)||void 0===n?void 0:n.length)>0){const t=[];let i=0;e.paths.forEach((s=>{s.forEach(((a,o)=>{if(0!==o){const n=[[j.default.clone(s[o-1]),j.default.clone(a)]];t[i++]=new R.default({hasZ:e.hasZ,hasM:e.hasM,paths:n,spatialReference:e.spatialReference.toJSON()})}}))}));const a=[];t.forEach((e=>{a.push(this.getDistanceAsPerMapProjection(e,this.props.selectedLinearUnit))})),Promise.all(a).then((e=>{var i;const a=N.default.getMetersPerUnitForSR(new U.default(this.props.mapView.view.spatialReference.toJSON())),n="meters";let r=null===(i=s[0])||void 0===i?void 0:i.x;const l=this.props.drawingLayer.elevationInfo;e.forEach(((e,i)=>{const o=t[i].paths[0][0][2]*a,d=t[i].paths[0][1][2]*a,c=s.filter((t=>t.x>=r&&t.x<=r+e));let p=D(o,n,this.props.selectedElevationUnit),u=D(d,n,this.props.selectedElevationUnit);"3d"===this.props.mapView.view.type&&l&&(null==c?void 0:c.length)>0&&("relative-to-ground"!==l.mode&&"relative-to-scene"!==l.mode||(p+=c[0].y,u+=c[c.length-1].y));const g=(u-p)/e;c.forEach((e=>{if(!e[h+"y"]){let t=0;t=e.x-r;let i=p+g*t;"3d"===this.props.mapView.view.type&&"on-the-ground"===(null==l?void 0:l.mode)&&(i=e.y),e[h+"y"]=i,this.updateMinMaxForProfile(e.pointIdx,h,i)}})),r+=e})),o(!0)}),(()=>{o(!0)}))}}else e.type&&(s.forEach((e=>{e[h+"y"]=e.y,this.updateMinMaxForProfile(e.pointIdx,h,e.y)})),o(!0))}));return o})),this.getDistanceOfAllSelectedFeatures=()=>{const e=[];return this.props.drawingLayer.graphics.forEach((t=>{e.push(this.getDistanceAsPerMapProjection(t.geometry,this.props.selectedLinearUnit))})),Promise.all(e)},this.addLineSeries=(e,t)=>{let i=null,s="";const a=this.props.mapView.view.map.layers.toArray(),o=C(this.props.activeDs);if(this.updatedProfileLayers.length>0&&(i=this.updatedProfileLayers.filter((t=>t.layerId===e)),null==o||o.forEach((e=>{a.forEach((t=>{const a=t;"group"===a.type?a.layers.toArray().forEach((t=>{t.id===e.jimuChildId&&i.forEach((i=>{i.layerId===e.id&&(s=t.title)}))})):"feature"===a.type&&t.id===e.jimuChildId&&i.forEach((i=>{i.layerId===e.id&&(s=t.title)}))}))}))),1===(null==i?void 0:i.length)){const{chart:a,am4charts:o}=t,{am4core:n}=t.amCharts4Index,r=a.series.push(new o.LineSeries);r.dataFields.valueY=e+"y",r.dataFields.valueX="x",r.name=s,r.stroke=n.color(i[0].style.lineColor),r.strokeWidth=i[0].style.lineThickness,r.connect=!1,"dotted-line"===i[0].style.lineType?r.strokeDasharray="2 , 4":"dashed-line"===i[0].style.lineType&&(r.strokeDasharray="8 , 4")}},this.displayChartLegend=e=>{const{chart:t,am4charts:i,isRTL:s}=e;t.legend=new i.Legend,t.legend.itemContainers.template.paddingTop=5,t.legend.itemContainers.template.marginBottom=0,t.legend.itemContainers.template.paddingBottom=0,t.legend.position="bottom",t.legend.contentAlign=s?"right":"left",t.legend.itemContainers.template.reverseOrder=s;const a=t.legend.markers.template;a.width=15,a.height=15,t.legend.itemContainers.template.events.on("hit",(e=>{this.props.toggleLegendSeriesState(e.target.dataItem.dataContext.isHidden,e.target.dataItem.dataContext.name)}))},this.makeFormatter=(e,t)=>{const i=e.numberFormatter.clone();return i.format=(e,i,s=2)=>"string"==typeof e?"":`${k.default.formatNumber(e,{maximumFractionDigits:s})} ${t}`,i},this.minMaxOfEachProfile={},this.allDistances=[],this.seriesKey=[],this.seriesValue=[];const n=(0,t.getAppStore)().getState();this.isRTL=null===(s=null==n?void 0:n.appContext)||void 0===s?void 0:s.isRTL,this.chart=null,this.amchart4=null,this.xAxis=null,this.yAxis=null,this.chartSeries=null,this.accessChartParams=null,this.updatedProfileLayers=null===(a=this.props.currentConfig)||void 0===a?void 0:a.profileSettings.layers,this.state={chartDefinition:null,showLegend:null===(o=this.props.commonGeneralSettings)||void 0===o?void 0:o.showLegend}}render(){return(0,t.jsx)(t.React.Fragment,null,this.state&&this.state.chartDefinition&&(0,t.jsx)("div",{tabIndex:-1,className:"w-100 h-100 p-2"},(0,t.jsx)("div",{tabIndex:0,"aria-label":this.nls("chartRender"),className:"w-100 h-100",ref:this._chartContainer})))}}const{epIcon:G}=S();class B extends t.React.PureComponent{constructor(e){super(e),this.nls=e=>{const t=Object.assign({},r,i.defaultMessages);return this.props.intl&&this.props.intl.formatMessage?this.props.intl.formatMessage({id:e,defaultMessage:t[e]}):t[e]},this.componentDidMount=()=>{this.generateStats()},this.generateStats=()=>{this.selectedStats=[],this.props.activeDsConfig.profileChartSettings.selectedStatistics.forEach((e=>{e.enabled&&this.selectedStats.push({label:e.label,name:e.name})})),this.selectedStatisticsDisplay()},this.componentDidUpdate=e=>{var t,i;(null===(t=e.chartProfileResult)||void 0===t?void 0:t.statistics)===(null===(i=this.props.chartProfileResult)||void 0===i?void 0:i.statistics)&&e.selectedElevationUnit===this.props.selectedElevationUnit&&e.selectedLinearUnit===this.props.selectedLinearUnit&&e.selectedStatsDisplay===this.props.selectedStatsDisplay&&e.isFlip===this.props.isFlip||this.generateStats(),e.renderSeries!==this.props.renderSeries&&this.selectedStatisticsDisplay()},this.selectedStatisticsDisplay=()=>{const e=[];let s="",a=null,o="";this.selectedStats.forEach((n=>{var r;this.props.renderSeries||this.props.legendName!==this.props.toggledSeriesName?(o=n.name,this.props.chartProfileResult?(this.props.isFlip&&n.name!==b.AvgElevation&&n.name!==b.MaxDistance&&n.name!==b.MaxElevation&&n.name!==b.MinElevation&&(o=this.getReverseStatsOnFlip(n.name)),a=null===(r=this.props.chartProfileResult)||void 0===r?void 0:r.statistics[o],s=this.getStatsValueWithUnit(a,o)):s="-"):s="-",e.push((0,t.jsx)(t.React.Fragment,null,(0,t.jsx)("div",{tabIndex:0,className:"statistic-info"},(0,t.jsx)(i.Label,{id:this.props.parentWidgetId+this.props.index,"aria-label":this.nls(n.name),className:"statistic-label text-break mb-1 pt-3"},this.nls(n.name)),(0,t.jsx)("div",{tabIndex:0,"aria-label":s},s))))})),this.setState({statsResultList:e})},this.getReverseStatsOnFlip=e=>{switch(e){case b.MaxPositiveSlope:return b.MaxNegativeSlope;case b.MaxNegativeSlope:return b.MaxPositiveSlope;case b.AvgPositiveSlope:return b.AvgNegativeSlope;case b.AvgNegativeSlope:return b.AvgPositiveSlope;case b.ElevationLoss:return b.ElevationGain;case b.ElevationGain:return b.ElevationLoss}},this.getStatsValueWithUnit=(e,t)=>{let i="",s=null;return y.forEach((a=>{var o,n;t===b.MaxDistance?a.value===this.props.selectedLinearUnit&&(s=D(e,null===(o=this.props.chartProfileResult)||void 0===o?void 0:o.effectiveUnits.distance,this.props.selectedLinearUnit),i=this.props.intl.formatNumber(s,{maximumFractionDigits:2})+" "+this.nls(a.abbreviation)):t===b.MaxPositiveSlope||t===b.MaxNegativeSlope||t===b.AvgPositiveSlope||t===b.AvgNegativeSlope?i=null===e?"-":this.props.intl.formatNumber(e,{maximumFractionDigits:2})+" °":a.value===this.props.selectedElevationUnit&&(s=D(e,null===(n=this.props.chartProfileResult)||void 0===n?void 0:n.effectiveUnits.elevation,this.props.selectedElevationUnit),i=this.props.intl.formatNumber(s,{maximumFractionDigits:2})+" "+this.nls(a.abbreviation))})),i},this.onExpandClick=()=>{this.setState({legendExpanded:!this.state.legendExpanded})},this.state={legendExpanded:!1,statsResultList:[]}}render(){return(0,t.jsx)("div",{tabIndex:-1},(0,t.jsx)("div",{tabIndex:-1,className:"ep-legend-section ep-shadow py-1"},(0,t.jsx)(n.SettingRow,{flow:"wrap"},(0,t.jsx)("div",{tabIndex:0,className:"d-flex justify-content-between w-100 align-items-center"},(0,t.jsx)(i.Label,{id:this.props.parentWidgetId+this.props.index,"aria-label":this.props.legendName,className:"w-100 legendLabel text-break"},this.props.legendName),!this.props.singleSeriesExpandStat&&(0,t.jsx)("div",{tabIndex:0,className:this.state.legendExpanded?"arrow-up":"arrow-down"},(0,t.jsx)(i.Button,{id:this.props.parentWidgetId+this.props.index,role:"button","aria-expanded":this.state.legendExpanded,title:this.nls("expandLegend"),className:"expand-collapse-button",type:"tertiary",icon:!0,size:"sm",onClick:this.onExpandClick.bind(this)},(0,t.jsx)(i.Icon,{icon:G.iconExpandCollapse,size:"10"}))))),(0,t.jsx)(i.Collapse,{isOpen:this.state.legendExpanded||this.props.singleSeriesExpandStat},(0,t.jsx)("div",{tabIndex:-1,className:"stat-content"},(0,t.jsx)("div",{tabIndex:0,className:"profile-statistics"},this.state.statsResultList.map(((e,i)=>(0,t.jsx)(t.React.Fragment,{key:i},e))))))))}}const{epIcon:W}=S();class z extends t.React.PureComponent{constructor(e){var s,a,o;super(e),this.selectableLayers=[],this.alertElement=t.React.createRef(),this.nls=e=>{const t=Object.assign({},r,i.defaultMessages);return this.props.intl&&this.props.intl.formatMessage?this.props.intl.formatMessage({id:e,defaultMessage:t[e]}):t[e]},this.componentDidMount=()=>{this.getSelectableLayers(this.props.activeDataSource),(this.props.selectMode||this.props.drawMode)&&setTimeout((()=>{var e,t;null===(t=null===(e=this.alertElement)||void 0===e?void 0:e.current)||void 0===t||t.focus()}),100)},this.componentDidUpdate=e=>{var t,i,s,a,o,n,r,l,h,d,c,p,u,g,f,v,m,S,y,x,w;const b=I(this.props.activeDatasourceConfig,this.props.portalSelf);(e.commonDsGeneralSettings.showLegend!==(null===(t=this.props.commonDsGeneralSettings)||void 0===t?void 0:t.showLegend)||(null===(i=e.activeDatasourceConfig)||void 0===i?void 0:i.profileChartSettings.displayStatistics)!==(null===(s=this.props.activeDatasourceConfig)||void 0===s?void 0:s.profileChartSettings.displayStatistics)||e.profileResult!==this.props.profileResult||this.didStatisticsListChanged(null===(a=e.activeDatasourceConfig)||void 0===a?void 0:a.profileChartSettings.selectedStatistics,null===(o=this.props.activeDatasourceConfig)||void 0===o?void 0:o.profileChartSettings.selectedStatistics))&&this.setState({showLegend:null===(n=this.props.commonDsGeneralSettings)||void 0===n?void 0:n.showLegend,displayStats:null===(r=this.props.activeDatasourceConfig)||void 0===r?void 0:r.profileChartSettings.displayStatistics,chartResult:this.props.profileResult,selectedStatisticsList:null===(l=this.props.activeDatasourceConfig)||void 0===l?void 0:l.profileChartSettings.selectedStatistics},(()=>{this.state.displayStats||this.setState({statisticsOpen:!1}),this.displayStatisticsInfo(this.chart)})),e.noFeaturesFoundError!==this.props.noFeaturesFoundError&&this.setState({noFeaturesError:this.props.noFeaturesFoundError}),e.viewModelErrorState===this.props.viewModelErrorState&&e.profileErrorMsg===this.props.profileErrorMsg||this.setState({noValidInput:this.props.viewModelErrorState,viewModelErrorMsg:this.props.profileErrorMsg}),(null===(h=e.activeDatasourceConfig)||void 0===h?void 0:h.profileChartSettings.elevationUnit)===(null===(d=this.props.activeDatasourceConfig)||void 0===d?void 0:d.profileChartSettings.elevationUnit)&&(null===(c=e.activeDatasourceConfig)||void 0===c?void 0:c.profileChartSettings.linearUnit)===(null===(p=this.props.activeDatasourceConfig)||void 0===p?void 0:p.profileChartSettings.linearUnit)&&(null===(u=e.activeDatasourceConfig)||void 0===u?void 0:u.advanceOptions)===(null===(g=this.props.activeDatasourceConfig)||void 0===g?void 0:g.advanceOptions)||this.setState({selectedElevationUnit:(null===(f=this.props.activeDatasourceConfig)||void 0===f?void 0:f.profileChartSettings.elevationUnit)?this.props.activeDatasourceConfig.profileChartSettings.elevationUnit:b[0],selectedLinearUnit:(null===(v=this.props.activeDatasourceConfig)||void 0===v?void 0:v.profileChartSettings.linearUnit)?this.props.activeDatasourceConfig.profileChartSettings.linearUnit:b[1],isAdvanceOptionEnabled:null===(m=this.props.activeDatasourceConfig)||void 0===m?void 0:m.advanceOptions,profileLayers:null===(S=this.props.activeDatasourceConfig)||void 0===S?void 0:S.profileSettings.layers},(()=>{this.displayStatisticsInfo(this.chart),this.getSelectableLayers(this.props.activeDataSource)})),this.didProfileLayersSettingsChanged(null===(y=e.activeDatasourceConfig)||void 0===y?void 0:y.profileSettings.layers,null===(x=this.props.activeDatasourceConfig)||void 0===x?void 0:x.profileSettings.layers)&&this.setState({profileLayers:null===(w=this.props.activeDatasourceConfig)||void 0===w?void 0:w.profileSettings.layers},(()=>{this.getSelectableLayers(this.props.activeDataSource)})),e.drawingOrSelectingComplete===this.props.drawingOrSelectingComplete&&e.isNewSegmentsForSelection===this.props.isNewSegmentsForSelection&&e.noGraphicAfterFirstSelection===this.props.noGraphicAfterFirstSelection||this.setState({dismissInfoMsg:!this.props.drawingOrSelectingComplete,dismissWarningMsg:!this.props.isNewSegmentsForSelection&&!this.props.noGraphicAfterFirstSelection&&this.props.selectMode})},this.didStatisticsListChanged=(e,t)=>{let i=!1;return null==t||t.some(((t,s)=>{if(t.name!==e[s].name||t.label!==e[s].label||t.enabled!==e[s].enabled)return i=!0,!0})),i},this.didProfileLayersSettingsChanged=(e,t)=>{let i=!1;return(null==e?void 0:e.length)!==(null==t?void 0:t.length)&&(i=!0),i},this.getSelectableLayers=e=>{const t=C(e);this.selectableLayers=[];const i=[];let s=!1;null==t||t.forEach((e=>{var t;e&&e.layerDefinition&&e.layerDefinition.geometryType&&(this.state.isAdvanceOptionEnabled?0===this.state.profileLayers.length?s=!1:"esriGeometryPolyline"===e.layerDefinition.geometryType&&(null===(t=this.state.profileLayers)||void 0===t||t.forEach((t=>{t.layerId===e.id&&(this.selectableLayers.push({label:e.schema.label,value:e.id}),i.push(e.id),s=!0)}))):"esriGeometryPolyline"===e.layerDefinition.geometryType&&(this.selectableLayers.push({label:e.schema.label,value:e.id}),i.push(e.id),s=!0))})),this.props.selectabelLayersRuntime(i),this.setState({selectedLayers:i,isAnyProfileLineLayers:s})},this.onDoneClick=()=>{this.props.doneClick()?this.setState({enableForNewProfile:!0}):this.setState({enableForNewProfile:!1,initialEmptyState:!1,emptyStateIfDoneClick:!0,noFeaturesError:!1,noValidInput:!1},(()=>{setTimeout((()=>{var e,t;null===(t=null===(e=this.alertElement)||void 0===e?void 0:e.current)||void 0===t||t.focus()}),100)}))},this.toggleStatistics=()=>{this.setState({statisticsOpen:!this.state.statisticsOpen},(()=>{this.displayStatisticsInfo(this.chart)}))},this.toggleSettings=()=>{this.setState({settingsOptionsOpen:!this.state.settingsOptionsOpen})},this.highlightChartPosition=e=>{this.props.chartPosition(e)},this.hideChartPosition=()=>{this.props.hideChartPosition()},this.onChartFlip=()=>{this.setState({isFlipChart:!this.state.isFlipChart},(()=>{this.displayStatisticsInfo(this.chart)}))},this.onNewProfileClick=()=>{this.createNewProfile(),this.setState({enableForNewProfile:!1})},this.onClearButtonClick=()=>{this.createNewProfile()},this.createNewProfile=()=>{this.props.activateDrawSelectToolForNewProfile(),this.setState({initialEmptyState:!0,emptyStateIfDoneClick:!1,noFeaturesError:!1,noValidInput:!1,statisticsOpen:!1},(()=>{setTimeout((()=>{var e,t;null===(t=null===(e=this.alertElement)||void 0===e?void 0:e.current)||void 0===t||t.focus()}),100)}))},this.onElevationUnitChange=e=>{this.setState({selectedElevationUnit:e.target.value},(()=>{this.displayStatisticsInfo(this.chart)}))},this.onLinearUnitChange=e=>{this.setState({selectedLinearUnit:e.target.value},(()=>{this.displayStatisticsInfo(this.chart)}))},this.onLayerSelected=(e,t,i)=>{let s=!0;this.setState({selectedLayers:i}),0===i.length&&(s=!1),this.setState({isLayerSelected:s}),this.props.selectabelLayersRuntime(i)},this.displaySelectedFields=e=>{let t=this.nls("selectLayerLabel");return e&&e.length&&(t=this.props.intl.formatMessage({id:"selectedLayerCount",defaultMessage:r.selectedLayerCount},{selectedLayerCount:e.length})),t},this.onUniformScalingChange=e=>{this.setState({isUniformScalingEnable:e.target.checked})},this.displayStatisticsInfo=e=>{var s,a,o;const n=[];this.setState({legendStats:[]});let r=!1;(null==e?void 0:e.series)?((null===(a=null===(s=null==e?void 0:e.series)||void 0===s?void 0:s.values)||void 0===a?void 0:a[0])&&(r=!0),null===(o=null==e?void 0:e.series)||void 0===o||o.values.forEach(((e,i)=>{if(0===i)return n.push((0,t.jsx)(B,{theme:this.props.theme,intl:this.props.intl,parentWidgetId:this.props.widgetId,index:i,key:e.name+i,singleSeriesExpandStat:r,legendName:e.name,activeDsConfig:this.props.activeDatasourceConfig,selectedElevationUnit:this.state.selectedElevationUnit,selectedLinearUnit:this.state.selectedLinearUnit,chartProfileResult:this.props.profileResult,selectedStatsDisplay:this.state.selectedStatisticsList,renderSeries:this.state.renderSeries,toggledSeriesName:this.state.toggledSeriesName,isFlip:this.state.isFlipChart})),!0}))):n.push((0,t.jsx)(i.Loading,{type:i.LoadingType.Secondary})),this.setState({legendStats:n})},this.statisticsDisplay=()=>{return(0,t.jsx)("div",null,(0,t.jsx)(i.Popper,{css:(e=this.props.theme,s=this.props.chartColorRender?this.props.chartColorRender:"#b54900",t.css`
    .ep-shadow {
      box-shadow: 0 0 8px 3px rgba(0,0,0,0.2)!important;
    }

    .ep-legend {
      height: 100px;
      overflow-y: auto;
    }

    .ep-legend-section {
      border-radius: 2px;
      padding: 5px;
      margin-top: 10px;
      border-left: 3px solid ${s};
      min-width: 120px;
    }

    .cursor-pointer {
      cursor: pointer
    }

    .legendLabel {
      margin-bottom: 0px;
      font-weight: bold;
      word-wrap: break-word;
    }

    .expand-collapse-button {
      &:hover {
        color: ${e.colors.palette.secondary[900]};
      }
    }

    .arrow-up {
      transform-origin: center center;
      transform: rotate(180deg);
      transition: transform .5s ease 0s;
    }

    .arrow-down {
      transform-origin: center center;
      transform: rotate(0deg);
      transition: transform .5s ease 0s;
    }

    .stat-content {
      display: block;
      padding: 12px 15px;
      padding-top: 0;
    }

    .profile-statistics {
      --max-width: 105px;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(var(--max-width), 1fr));
      gap: 2px 22px;
      width: 100%;
    }

    .statistic-info {
      display: block;
      text-align: start;
    }

    .statistic-label {
      font-weight: 500;
    }
  `),open:this.state.statisticsOpen,reference:"statistics"+this.props.widgetId,floating:!0,headerTitle:this.nls("statisticsLabel"),placement:"auto",version:0,offset:[0,0],onHeaderClose:()=>{this.setState({statisticsOpen:!this.state.statisticsOpen})},defaultSize:{width:400,height:235}},(0,t.jsx)("div",{style:{height:"calc(100% - 15px)",overflow:"auto"},className:"pr-3 pl-3 pt-2 pb-3"},this.state.legendStats.map(((e,i)=>(0,t.jsx)(t.React.Fragment,{key:i},e))))));var e,s},this.settingsOptionsRender=()=>(0,t.jsx)("div",null,(0,t.jsx)(i.Popper,{css:(this.props.theme,t.css`
  .settingsLabel {
    margin: 0 !important;
    font-weight: 500;
  }

  .selectLayerWarningMsg {
    padding: 1px !important;
    background-color: transparent !important;
    border: none !important;
    font-size: 11px;
  }

  .selectLayerWarningMsg .left-part {
    color: var(--warning-900) !important;
    margin-right: 0 !important;
  }

  .custom-multiselect .jimu-dropdown .jimu-btn .dropdown-button-content {
    padding-top: 3px;
    padding-bottom: 3px;
  }
  `),open:this.state.settingsOptionsOpen,reference:"settingsOptions"+this.props.widgetId,placement:"right-start",version:0,offset:[0,0],toggle:e=>{this.setState({settingsOptionsOpen:!this.state.settingsOptionsOpen})}},(0,t.jsx)("div",{tabIndex:-1,style:{width:175}},(0,t.jsx)("div",{tabIndex:-1,className:"p-2"},(0,t.jsx)(i.Label,{"aria-label":this.nls("elevationUnitLabel"),className:"settingsLabel text-break"},this.nls("elevationUnitLabel")),(0,t.jsx)(i.Select,{menuRole:"menu","aria-label":this.state.selectedElevationUnit,className:"pt-1",name:"elevationUnit",size:"sm",onChange:this.onElevationUnitChange,value:this.state.selectedElevationUnit},y.map((e=>(0,t.jsx)(i.Option,{role:"option","aria-label":e.value,key:e.value,value:e.value},this.nls(e.value)))))),(0,t.jsx)("div",{className:"p-2"},(0,t.jsx)(i.Label,{"aria-label":this.nls("distanceUnitLabel"),className:"settingsLabel text-break"},this.nls("distanceUnitLabel")),(0,t.jsx)(i.Select,{menuRole:"menu","aria-label":this.state.selectedLinearUnit,className:"pt-1",name:"linearUnit",size:"sm",onChange:this.onLinearUnitChange,value:this.state.selectedLinearUnit},y.map((e=>(0,t.jsx)(i.Option,{role:"option","aria-label":e.value,key:e.value,value:e.value},this.nls(e.value)))))),this.props.selectMode&&this.state.isAnyProfileLineLayers&&(0,t.jsx)(t.React.Fragment,null,(0,t.jsx)("div",{className:"p-2"},(0,t.jsx)(i.Label,{"aria-label":this.nls("selectableLayersLabel"),className:"settingsLabel text-break"},this.nls("selectableLayersLabel")),!this.state.isLayerSelected&&(0,t.jsx)(i.Alert,{tabIndex:0,className:"w-100 selectLayerWarningMsg",onClose:function(){},open:!this.state.isLayerSelected,text:this.nls("selectLayerWarning"),type:"warning",withIcon:!0}),(0,t.jsx)(i.MultiSelect,{items:(0,t.Immutable)(this.selectableLayers),values:(0,t.Immutable)(this.state.selectedLayers),className:"pt-1 custom-multiselect",buttonProps:{showDynamicTitle:!0},size:"sm",fluid:!0,onClickItem:this.onLayerSelected,displayByValues:this.displaySelectedFields}))),(0,t.jsx)(t.React.Fragment,null,(0,t.jsx)("div",{className:"p-2"},(0,t.jsx)(i.Label,{className:"cursor-pointer settingsLabel text-break",title:this.nls("uniformChartScalingInfo")},(0,t.jsx)(i.Checkbox,{role:"checkbox",className:"mr-2 font-13","aria-label":this.nls("uniformChartScaling"),checked:this.state.isUniformScalingEnable,onChange:this.onUniformScalingChange.bind(this)}),this.nls("uniformChartScaling"))))))),this.dismissInfoMsg=()=>{this.setState({dismissInfoMsg:!this.state.dismissInfoMsg})},this.dismissWarningMsg=()=>{this.setState({dismissWarningMsg:!this.state.dismissWarningMsg})},this.getChartInfo=e=>{this.chart=e,setTimeout((()=>{this.displayStatisticsInfo(this.chart)}),50)},this.onToggleSeries=(e,t)=>{this.setState({renderSeries:e,toggledSeriesName:t})};const n=I(this.props.activeDatasourceConfig,this.props.portalSelf);this.chart=null,this.state={chartResult:this.props.profileResult,initialEmptyState:!0,emptyStateIfDoneClick:!1,enableForNewProfile:!1,settingsOptionsOpen:!1,unitOptions:y,isFlipChart:!1,selectedElevationUnit:this.props.activeDatasourceConfig?n[0]:this.props.defaultConfig.profileChartSettings.elevationUnit,selectedLinearUnit:this.props.activeDatasourceConfig?n[1]:this.props.defaultConfig.profileChartSettings.linearUnit,selectedLayers:[],profileLayers:null===(s=this.props.activeDatasourceConfig)||void 0===s?void 0:s.profileSettings.layers,isAnyProfileLineLayers:!1,isAdvanceOptionEnabled:null===(a=this.props.activeDatasourceConfig)||void 0===a?void 0:a.advanceOptions,noFeaturesError:this.props.noFeaturesFoundError,dismissInfoMsg:!this.props.drawingOrSelectingComplete,dismissWarningMsg:!this.props.isNewSegmentsForSelection&&!this.props.noGraphicAfterFirstSelection&&this.props.selectMode,statisticsOpen:!1,legendStats:[],showLegend:null===(o=this.props.commonDsGeneralSettings)||void 0===o?void 0:o.showLegend,displayStats:this.props.activeDatasourceConfig?this.props.activeDatasourceConfig.profileChartSettings.displayStatistics:this.props.defaultConfig.profileChartSettings.displayStatistics,selectedStatisticsList:this.props.activeDatasourceConfig?this.props.activeDatasourceConfig.profileChartSettings.selectedStatistics:this.props.defaultConfig.profileChartSettings.selectedStatistics,renderSeries:!0,toggledSeriesName:"",isUniformScalingEnable:!1,isLayerSelected:!0,noValidInput:this.props.viewModelErrorState,viewModelErrorMsg:this.props.profileErrorMsg},this.selectableLayers=[]}render(){var s,a,r;let l="",h="",d="";this.state.initialEmptyState&&this.props.drawMode||this.state.emptyStateIfDoneClick&&this.props.drawMode?l=this.nls("drawUserInfo"):(this.state.initialEmptyState&&this.props.selectMode||this.state.emptyStateIfDoneClick&&this.props.selectMode)&&(l=this.nls("selectUserInfo")),this.state.emptyStateIfDoneClick&&this.props.drawMode?h=this.nls("emptyDrawStateWarning"):this.state.emptyStateIfDoneClick&&this.props.selectMode&&(h=this.nls("emptySelectStateWarning")),!this.props.drawingOrSelectingComplete&&this.props.drawMode&&this.props.chartRender?d=this.nls("infoMsgWhileDrawing"):this.props.selectMode&&this.props.chartRender&&(d=this.props.isNewSegmentsForSelection&&this.props.noGraphicAfterFirstSelection?this.nls("infoMsgWhileSelecting"):this.nls("addToSelectionWarning"));const c=this.nls("noFeaturesFound"),p=this.settingsOptionsRender(),u=this.statisticsDisplay();return(0,t.jsx)("div",{className:"h-100 w-100",css:o(this.props.theme)},(0,t.jsx)("div",{style:{height:35},className:"ep-widget-header d-flex w-100"},(0,t.jsx)("div",{className:"align-items-center w-100 pt-1",style:{display:"inline-block"}},(0,t.jsx)(i.Button,{role:"button","aria-label":this.nls("settingsOptions"),"aria-haspopup":"dialog",title:this.nls("settingsOptions"),icon:!0,id:"settingsOptions"+this.props.widgetId,className:"chart-actions",active:this.state.settingsOptionsOpen,size:"sm",type:"default",onClick:this.toggleSettings},(0,t.jsx)(i.Icon,{size:16,icon:W.settingsIcon})),this.props.chartRender&&(0,t.jsx)(t.React.Fragment,null,(0,t.jsx)(i.Button,{role:"button","aria-label":this.nls("chartFlip"),title:this.nls("chartFlip"),icon:!0,className:"chart-actions",active:this.state.isFlipChart,size:"sm",type:"default",onClick:this.onChartFlip},(0,t.jsx)(i.Icon,{size:16,icon:W.flipIcon})),this.state.displayStats&&(0,t.jsx)(i.Button,{role:"button","aria-label":this.nls("chartStatistics"),"aria-haspopup":"dialog",title:this.nls("chartStatistics"),icon:!0,id:"statistics"+this.props.widgetId,className:"chart-actions",active:this.state.statisticsOpen,size:"sm",type:"default",onClick:this.toggleStatistics},(0,t.jsx)(i.Icon,{size:16,icon:W.chartIcon}))),this.state.settingsOptionsOpen&&p,this.state.statisticsOpen&&u)),(0,t.jsx)("div",{className:(0,t.classNames)("ep-widget-bodyContainer d-flex w-100",this.props.chartRender?"":"align-items-center")},this.props.displayLoadingIndicator&&(0,t.jsx)(t.React.Fragment,null,(0,t.jsx)(i.Loading,{type:i.LoadingType.Secondary})),(0,t.jsx)("div",{className:(0,t.classNames)("w-100",this.props.chartRender?"":"alignInfo align-items-center",this.props.noFeaturesFoundError?"alignInfo align-items-center":"")},!this.props.chartRender&&!this.state.noFeaturesError&&!this.state.noValidInput&&(0,t.jsx)("div",{tabIndex:0,ref:this.alertElement,"aria-label":l},(0,t.jsx)(i.Alert,{className:"mb-3 w-100 userInfo",onClose:function(){},open:!this.props.chartRender&&!this.state.noFeaturesError&&!this.state.noValidInput,text:l,type:"info",withIcon:!0})),this.state.emptyStateIfDoneClick&&!this.props.chartRender&&!this.state.noFeaturesError&&!this.state.noValidInput&&(0,t.jsx)(i.Alert,{tabIndex:0,className:"w-100 userInfo",onClose:function(){},open:this.state.emptyStateIfDoneClick&&!this.props.chartRender&&!this.state.noFeaturesError&&!this.state.noValidInput,text:h,type:"warning",withIcon:!0}),this.state.noFeaturesError&&(0,t.jsx)(i.Alert,{tabIndex:0,className:"w-100 userInfo",onClose:function(){},open:this.state.noFeaturesError,text:c,type:"warning",withIcon:!0}),this.state.noValidInput&&(0,t.jsx)(i.Alert,{tabIndex:0,className:"w-100 userInfo",onClose:function(){},open:this.state.noValidInput,text:this.state.viewModelErrorMsg,type:"warning",withIcon:!0}),this.props.chartRender&&(0,t.jsx)(V,{ref:"chartObj",intl:this.props.intl,parentWidgetId:this.props.widgetId,commonGeneralSettings:this.props.commonDsGeneralSettings,activeDs:this.props.activeDataSource,currentConfig:this.props.activeDatasourceConfig,theme:this.props.theme,selectedLinearUnit:this.state.selectedLinearUnit,selectedElevationUnit:this.state.selectedElevationUnit,profileResult:this.props.profileResult,unitOptions:this.state.unitOptions,highlightChartPositionOnMap:this.highlightChartPosition.bind(this),hideChartPosition:this.hideChartPosition.bind(this),chartInfo:this.getChartInfo.bind(this),toggleLegendSeriesState:this.onToggleSeries,elevationGraphColor:this.props.chartColorRender,isFlip:this.state.isFlipChart,isUniformChartScalingEnable:this.state.isUniformScalingEnable,drawingLayer:this.props.drawingLayer,mapView:this.props.jimuMapview}))),(0,t.jsx)("div",{className:"floatingInfoMsg"},!this.state.enableForNewProfile&&this.props.chartRender&&(0,t.jsx)(t.React.Fragment,null,(0,t.jsx)("div",{title:d},(0,t.jsx)(i.Alert,{tabIndex:0,className:(0,t.classNames)("alignDismissibleInfo",this.state.dismissInfoMsg?"showMessage":"hideMessage"),onClose:this.dismissInfoMsg,open:this.state.dismissInfoMsg,text:d,type:"info",withIcon:!0,closable:!0})),(0,t.jsx)("div",{title:d},(0,t.jsx)(i.Alert,{tabIndex:0,className:(0,t.classNames)("alignDismissibleInfo",this.state.dismissWarningMsg?"showMessage":"hideMessage"),onClose:this.dismissWarningMsg,open:this.state.dismissWarningMsg,text:d,type:"warning",withIcon:!0,closable:!0})))),(0,t.jsx)("div",{className:"ep-widget-footer"},(0,t.jsx)(n.SettingRow,null,(0,t.jsx)("div",{className:"w-100 footer-display"},(0,t.jsx)(i.Button,{role:"button","aria-label":this.nls("backButtonLabel"),title:this.nls("backButtonLabel"),className:"m-1 text-break",size:"default",type:"tertiary",onClick:this.props.onNavBack},(0,t.jsx)(i.Icon,{size:16,autoFlip:!0,icon:W.arrowNavBack}),this.nls("backButtonLabel")),(null===(s=this.props.commonDsGeneralSettings)||void 0===s?void 0:s.buttonStyle)===e.IconText&&(0,t.jsx)(i.Button,{role:"button","aria-label":this.nls("doneButtonLabel"),title:this.nls("doneButtonLabel"),className:this.state.enableForNewProfile||this.props.drawingOrSelectingComplete||this.state.noValidInput||this.props.selectMode&&this.props.chartRender&&!this.props.isNewSegmentsForSelection&&!this.props.noGraphicAfterFirstSelection?"hidden":"m-1 actionButton text-break",size:"default",type:"primary",onClick:this.onDoneClick},(0,t.jsx)(t.React.Fragment,null,(0,t.jsx)(i.Icon,{size:16,icon:W.doneIcon}),this.nls("doneButtonLabel"))),this.props.chartRender&&(null===(a=this.props.commonDsGeneralSettings)||void 0===a?void 0:a.buttonStyle)===e.IconText&&(0,t.jsx)(t.React.Fragment,null,(0,t.jsx)(i.Button,{role:"button","aria-label":this.nls("clearButtonLabel"),title:this.nls("clearButtonLabel"),className:this.state.enableForNewProfile||this.props.drawingOrSelectingComplete||this.props.selectMode&&this.props.chartRender&&!this.props.isNewSegmentsForSelection&&!this.props.noGraphicAfterFirstSelection?"hidden":"m-1 actionButton text-break",size:"default",type:"default",onClick:this.onClearButtonClick},(0,t.jsx)(i.Icon,{size:16,icon:W.clearIcon}),this.nls("clearButtonLabel"))),(this.state.enableForNewProfile||this.props.drawingOrSelectingComplete||this.state.noValidInput||this.props.selectMode&&this.props.chartRender&&!this.props.isNewSegmentsForSelection&&!this.props.noGraphicAfterFirstSelection)&&(null===(r=this.props.commonDsGeneralSettings)||void 0===r?void 0:r.buttonStyle)===e.IconText&&(0,t.jsx)(i.Button,{role:"button","aria-label":this.nls("newProfileButtonLabel"),title:this.nls("newProfileButtonLabel"),className:"m-1 actionButton text-break",size:"default",type:"primary",onClick:this.onNewProfileClick},(0,t.jsx)(t.React.Fragment,null,(0,t.jsx)(i.Icon,{size:16,icon:this.props.drawMode?W.drawIcon:W.selectIcon}),this.nls("newProfileButtonLabel")))))))}}var _=L(97878),H=L(94129),Z=L(23852),X=L(55606),Y=L(37902),K=L(24942),J=L(22443),q=L(14345),$=L(17465),Q=L(45818),ee=L(11639);const{epIcon:te}=S(),ie={style:"esriSMSCircle",color:[0,0,128,128],name:"Circle",outline:{color:[0,0,128,255],width:1},type:"esriSMS",size:18};class se extends t.BaseWidget{constructor(s){var a,o,n,l,h,d,c,p,u,g,f;super(s),this._chartDataTimer=null,this.nls=e=>{const t=Object.assign({},r,i.defaultMessages);return this.props.intl&&this.props.intl.formatMessage?this.props.intl.formatMessage({id:e,defaultMessage:t[e]}):t[e]},this.createDrawingLayers=()=>{this.drawingLayer=new Z.default({listMode:"hide",effect:"bloom(0.8, 1px, 0)"}),this.nextPossibleSelectionLayer=new Z.default({listMode:"hide",effect:"bloom(0.8, 0px, 1%)"})},this.componentDidMount=()=>{this.setState({chartColorRender:this.state.groundColor,noFeaturesError:!1,viewModelErrorState:!1})},this.activeViewChangeHandler=e=>{var i,s;e&&e.view?(this.mapView=e,this.state.jimuMapView&&(this.state.currentSketchVM&&!this.state.currentSketchVM.destroyed&&this.state.currentSketchVM.destroy(),this.clearAll(),this.setState({initialStage:!0,resultStage:!1,drawModeActive:null===(i=this.props.config.generalSettings)||void 0===i?void 0:i.isDrawToolActive,selectModeActive:null===(s=this.props.config.generalSettings)||void 0===s?void 0:s.isSelectToolActive}),this.destroyDrawingLayers(),this.createDrawingLayers()),e&&this.setState({jimuMapView:e},(()=>{if(null===e.dataSourceId)this.setState({currentDatasource:"default"},(()=>{this.activeCurrentDs=this.state.currentDatasource,this.selectedUnit=I(this.props.config.configInfo[this.state.currentDatasource],this.props.portalSelf)}));else if(this.state.jimuMapView.dataSourceId===this.props.config.activeDataSource&&this.props.config.configInfo[this.props.config.activeDataSource]){if(this.props.config.activeDataSource&&this.props.config.configInfo[this.props.config.activeDataSource]){let e=this.props.config.activeDataSource;this.state.jimuMapView&&this.state.jimuMapView.dataSourceId&&(e=Object.prototype.hasOwnProperty.call(this.props.config.configInfo,this.state.jimuMapView.dataSourceId)?this.state.jimuMapView.dataSourceId:"default",this.setState({currentDatasource:e},(()=>{this.activeCurrentDs=this.state.currentDatasource,"default"!==this.state.currentDatasource&&this.checkLineLayerAvailableInDsAndConfig(this.state.currentDatasource),this.setConfigForDatasources()})))}}else this.setState({currentDatasource:this.state.jimuMapView.dataSourceId}),this.checkLineLayerAvailableInDsAndConfig(this.state.jimuMapView.dataSourceId);setTimeout((()=>{const i={mode:"3d"===this.state.jimuMapView.view.type?"relative-to-ground":"on-the-ground",offset:null};this.drawingLayer.set("elevationInfo",i),this.nextPossibleSelectionLayer.set("elevationInfo",i),this.state.jimuMapView.view.map.addMany([this.nextPossibleSelectionLayer,this.drawingLayer]),this.createApiWidget(e),this.createEpViewModel(e);const s=(0,t.getAppStore)().getState().widgetsRuntimeInfo[this.props.id].state;s!==t.WidgetState.Opened&&s||this.loadSelectDrawToolOnLoad(this.activeCurrentDs)}),100)}))):this.setState({initialStage:!1,resultStage:!1})},this.loadSelectDrawToolOnLoad=e=>{if("default"===e)this.state.drawModeActive&&this.manageActiveDrawSelect();else if(this.state.drawModeActive||this.state.selectModeActive){if(this.state.lineLayersNotFound&&this.state.selectModeActive)return;this.manageActiveDrawSelect()}else this.setState({resultStage:!1,initialStage:!0})},this.manageActiveDrawSelect=()=>{this.setState({resultStage:!0,initialStage:!1},(()=>{this.clearAll(),this._displayDefaultCursor(),this.activateDrawOrSelectTool()}))},this.checkLineLayerAvailableInDsAndConfig=e=>{var t,i;const s=C(e);let a=!0;null==s||s.forEach((e=>{e&&e.layerDefinition&&e.layerDefinition.geometryType&&"esriGeometryPolyline"===e.layerDefinition.geometryType&&(a=!1)})),(null===(t=this.props.config.configInfo[e])||void 0===t?void 0:t.advanceOptions)&&0===(null===(i=this.props.config.configInfo[e])||void 0===i?void 0:i.profileSettings.layers.length)&&(a=!0),this.setState({lineLayersNotFound:a})},this.setConfigForDatasources=()=>{var e,t,i,s,a;const o=this.props.config.configInfo[this.state.currentDatasource];this.setState({groundColor:o?null===(e=o.profileChartSettings)||void 0===e?void 0:e.groundColor:this.defaultConfig.profileChartSettings.groundColor,graphicsHighlightColor:o?null===(t=o.profileChartSettings)||void 0===t?void 0:t.graphicsHighlightColor:this.defaultConfig.profileChartSettings.graphicsHighlightColor,chartColorRender:o?null===(i=o.profileChartSettings)||void 0===i?void 0:i.groundColor:this.defaultConfig.profileChartSettings.groundColor,customElevationLayer:o?null===(s=o.profileChartSettings)||void 0===s?void 0:s.isCustomElevationLayer:this.defaultConfig.profileChartSettings.isCustomElevationLayer,elevationLayer:o?null===(a=o.profileChartSettings)||void 0===a?void 0:a.elevationLayerURL:this.defaultConfig.profileChartSettings.elevationLayerURL,selectedLinearUnit:o?this.selectedUnit[1]:this.defaultConfig.profileChartSettings.linearUnit,selectedElevationUnit:o?this.selectedUnit[0]:this.defaultConfig.profileChartSettings.elevationUnit})},this.createDefaultConfigForDataSource=()=>{var e,t;let i,s;return i="english"===(null===(e=this.props.portalSelf)||void 0===e?void 0:e.units)?"feet":"meters",s="english"===(null===(t=this.props.portalSelf)||void 0===t?void 0:t.units)?"miles":"kilometers",{profileChartSettings:{isCustomElevationLayer:!0,elevationLayerURL:"https://elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",linearUnit:s,elevationUnit:i,displayStatistics:!0,selectedStatistics:x,groundColor:"#b54900",graphicsHighlightColor:"#b54900"}}},this.createApiWidget=e=>{var t,i;const s=new _.default({view:e?e.view:null,layer:new Z.default,updateOnGraphicClick:!1,defaultCreateOptions:{mode:"click",hasZ:"3d"===(null===(t=null==e?void 0:e.view)||void 0===t?void 0:t.type)},polylineSymbol:{type:"simple-line",color:this.state.graphicsHighlightColor,width:5},pointSymbol:Q.default.fromJSON(ie),defaultUpdateOptions:{toggleToolOnClick:!1}});s.on("create",(t=>{if("start"===t.state){const e={type:"simple-line",color:this.state.graphicsHighlightColor,width:5};this.state.currentSketchVM.set("polylineSymbol",e)}else"complete"===t.state&&(this.setState({noFeaturesError:!1}),this.state.selectModeActive&&(this.setState({loadingIndicator:!0}),e.selectFeaturesByGraphic(t.graphic,"intersects").then((e=>{this.setState({loadingIndicator:!1}),this.queryForNewSelection(e)}))))})),this.setState({currentSketchVM:s}),null===(i=null==e?void 0:e.view)||void 0===i||i.on("click",(t=>{const i=this.nextPossibleSelectionLayer;this.state.addToSelectionTool&&(t.stopPropagation(),e.view.hitTest(t).then((e=>{if(e&&e.results){const t=e.results.filter((e=>"graphic"===e.type)).filter((e=>e.graphic.layer===i&&"polyline"===e.graphic.geometry.type));t&&t.length>0&&(this.clearChart(),this.newFeatureSelection=!1,this.mapView.clearSelectedFeatures(),this.selectFeatureForProfiling(t[0].graphic))}})))}))},this.createEpViewModel=e=>{const t=[];this.state.customElevationLayer?t.push({type:"query",source:new $.default({url:this.state.elevationLayer}),color:this.state.groundColor}):t.push({type:"ground",color:this.state.groundColor}),this._defaultViewModel=new J.default({view:e?e.view:null,profiles:t}),q.default.watch(this._defaultViewModel,"errorState",(e=>{const t=this.getErrorMsgState(e);0!==(null==t?void 0:t.length)&&t&&this.setState({viewModelErrorState:t[0],profileErrorMsg:t[1]})})),q.default.watch(this._defaultViewModel,"chartData",(e=>{e&&(this._chartDataTimer&&clearTimeout(this._chartDataTimer),this._chartDataTimer=setTimeout((()=>{"created"===this._defaultViewModel.state&&this.setState({drawingOrSelectingComplete:!0}),(this.state.drawModeActive||this.state.selectModeActive)&&this.setState({viewModelErrorState:!1,startChartRendering:!0,profileResult:e})}),200))}))},this.getErrorMsgState=e=>{switch(e){case w.TooComplex:return[!0,this.nls("tooComplexError")];case w.InvalidGeometry:return[!0,this.nls("invalidGeometryError")];case w.InvalidElevationInfo:return[!0,this.nls("invalidElevationInfoError")];case w.UnknownError:return[!0,this.nls("unknownError")];case w.NoVisibleProfiles:case w.RefinedButNoChartData:return[!0,this.nls("noProfileError")];case w.None:return[]}},this.componentDidUpdate=e=>{var i,s;if(this.props.appMode!==e.appMode&&this.props.appMode===t.AppMode.Run?this.state.addToSelectionTool&&this._displayAddToSelectionCursor():this.props.appMode!==e.appMode&&this.props.appMode===t.AppMode.Design&&this._displayDefaultCursor(),!this.mapView)return;if(e.useMapWidgetIds===this.props.useMapWidgetIds&&e.config.activeDataSource===this.props.config.activeDataSource||this.props.config.configInfo[this.props.config.activeDataSource]&&this.setState({currentDatasource:this.props.config.activeDataSource},(()=>{this.checkLineLayerAvailableInDsAndConfig(this.state.currentDatasource),this.setState({customElevationLayer:this.props.config.configInfo[this.state.currentDatasource].profileChartSettings.isCustomElevationLayer,elevationLayer:this.props.config.configInfo[this.state.currentDatasource].profileChartSettings.elevationLayerURL})})),e.state!==this.props.state&&!this.state.profileResult&&(this.state.drawModeActive||this.state.selectModeActive)){const e=(0,t.getAppStore)().getState().widgetsRuntimeInfo[this.props.id].state;e!==t.WidgetState.Opened&&e||this.loadSelectDrawToolOnLoad(this.activeCurrentDs)}const a=null===(i=this.props.config.configInfo)||void 0===i?void 0:i[this.state.currentDatasource],o=null===(s=e.config.configInfo)||void 0===s?void 0:s[this.state.currentDatasource];Object.prototype.hasOwnProperty.call(this.props.config.configInfo,this.state.currentDatasource)&&(this.checkLineLayerAvailableInDsAndConfig(this.state.currentDatasource),this.setConfigForDatasources()),(null==o?void 0:o.profileChartSettings.groundColor)===(null==a?void 0:a.profileChartSettings.groundColor)&&(null==o?void 0:o.profileChartSettings.graphicsHighlightColor)===(null==a?void 0:a.profileChartSettings.graphicsHighlightColor)||this.setState({groundColor:null==a?void 0:a.profileChartSettings.groundColor,graphicsHighlightColor:null==a?void 0:a.profileChartSettings.graphicsHighlightColor},(()=>{if(this.setState({chartColorRender:this.state.groundColor}),this.drawingLayer&&this.drawingLayer.graphics.length>0){const e={type:"simple-line",color:this.state.graphicsHighlightColor,width:5};this.drawingLayer.graphics.items.forEach((t=>{t.symbol=e}))}this._defaultViewModel&&this.state.groundColor&&this._defaultViewModel.profiles.getItemAt(0).color.setColor(this.state.groundColor)})),(null==o?void 0:o.profileChartSettings.elevationUnit)===(null==a?void 0:a.profileChartSettings.elevationUnit)&&(null==o?void 0:o.profileChartSettings.linearUnit)===(null==a?void 0:a.profileChartSettings.linearUnit)||this.setState({selectedLinearUnit:null==a?void 0:a.profileChartSettings.linearUnit,selectedElevationUnit:null==a?void 0:a.profileChartSettings.elevationUnit}),(null==o?void 0:o.profileChartSettings.elevationLayerURL)===(null==a?void 0:a.profileChartSettings.elevationLayerURL)&&(null==o?void 0:o.profileChartSettings.isCustomElevationLayer)===(null==a?void 0:a.profileChartSettings.isCustomElevationLayer)||a&&o&&this.setState({elevationLayer:null==a?void 0:a.profileChartSettings.elevationLayerURL},(()=>{this.state.initialStage||this.activateToolForNewProfile(),this.createEpViewModel(this.mapView)})),(this.didProfileLayersSettingsChanged(null==o?void 0:o.profileSettings.layers,null==a?void 0:a.profileSettings.layers)||(null==o?void 0:o.advanceOptions)!==(null==a?void 0:a.advanceOptions))&&this.setState({profileLineLayers:null==a?void 0:a.profileSettings.layers},(()=>{let e=!1;(null==a?void 0:a.advanceOptions)&&0===this.state.profileLineLayers.length&&(this.onBackClick(),e=!0),this.setState({lineLayersNotFound:e})}))},this.didProfileLayersSettingsChanged=(e,t)=>{let i=!1;return(null==e?void 0:e.length)!==(null==t?void 0:t.length)&&(i=!0),i},this.componentWillUnmount=()=>{this._defaultViewModel&&this._defaultViewModel.clear(),this.destroyDrawingLayers(),this._displayDefaultCursor()},this.queryForNewSelection=e=>{let t=null;e.length>0&&e.forEach((e=>{var i,s,a,o,n,r,l;if(e.length>0){const h=this.getDSLayerID(e[0].layer.id);if("polyline"===e[0].geometry.type&&this.selectableLayersAtRuntime.includes(h)){if("3d"===this.state.jimuMapView.view.type&&(null===(s=null===(i=e[0])||void 0===i?void 0:i.layer)||void 0===s?void 0:s.elevationInfo)){const t=null===(o=null===(a=e[0])||void 0===a?void 0:a.layer)||void 0===o?void 0:o.elevationInfo;this.drawingLayer.set("elevationInfo",t),this.nextPossibleSelectionLayer.set("elevationInfo",t)}return this.newFeatureSelection=!0,this.setState({noGraphicAfterFirstSelection:!0}),t=new H.default({geometry:null===(n=e[0])||void 0===n?void 0:n.geometry,attributes:(null===(r=e[0])||void 0===r?void 0:r.attributes)?null===(l=e[0])||void 0===l?void 0:l.attributes:{}}),t.attributes.esriCTFeatureLayerId=h,this.mapView.clearSelectedFeatures(),!0}}})),this.drawingLayer&&this.drawingLayer.removeAll(),t?(this.setState({drawModeActive:!1,noFeaturesError:!1,viewModelErrorState:!1}),this.selectFeatureForProfiling(t)):(this.state.selectModeActive&&this.state.currentSketchVM.create("point"),this.setState({noFeaturesError:!0}))},this.considerLayerVisibility=e=>e.visible&&(e.minScale>=this.mapView.view.scale&&e.maxScale<=this.mapView.view.scale||0===e.minScale&&e.maxScale<=this.mapView.view.scale||0===e.maxScale&&e.minScale>=this.mapView.view.scale||0===e.minScale&&0===e.maxScale),this.getDSLayerID=e=>{var t,i;let s="";if(null===(i=null===(t=this.state)||void 0===t?void 0:t.jimuMapView)||void 0===i?void 0:i.dataSourceId){const t=C(this.state.jimuMapView.dataSourceId);null==t||t.forEach((t=>{if(t.jimuChildId===e)return s=t.id,!0}))}return s},this.queryForIndividualLayers=(e,t)=>{var i,s,a;const o=[],n=C(e),r=this.mapView.view.map.layers.toArray();let l=!0;if(null===(i=this.props.config.configInfo[this.state.currentDatasource])||void 0===i?void 0:i.advanceOptions){if((null===(s=this.props.config.configInfo[this.state.currentDatasource])||void 0===s?void 0:s.profileSettings.layers.length)>0){const e=null===(a=this.props.config.configInfo[this.state.currentDatasource])||void 0===a?void 0:a.profileSettings.layers;null==n||n.forEach((i=>{this.selectableLayersAtRuntime.forEach((s=>{s===i.id&&r.forEach((s=>{const a=s;"group"===a.type?a.layers.toArray().forEach((s=>{l=this.considerLayerVisibility(s),s.id===i.jimuChildId&&l&&e.forEach((e=>{e.layerId===i.id&&o.push(this.queryIndividualLayer(s,i,t))}))})):"feature"===a.type&&(l=this.considerLayerVisibility(a),s.id===i.jimuChildId&&l&&e.forEach((e=>{e.layerId===i.id&&o.push(this.queryIndividualLayer(s,i,t))})))}))}))}))}}else null==n||n.forEach((e=>{this.selectableLayersAtRuntime.forEach((i=>{i===e.id&&r.forEach((i=>{var s;const a=i;"group"===a.type?a.layers.toArray().forEach((i=>{var s;l=this.considerLayerVisibility(i),i.id===e.jimuChildId&&l&&(null===(s=e.layerDefinition)||void 0===s?void 0:s.geometryType)&&"esriGeometryPolyline"===e.layerDefinition.geometryType&&o.push(this.queryIndividualLayer(i,e,t))})):"feature"===a.type&&(l=this.considerLayerVisibility(a),i.id===e.jimuChildId&&l&&(null===(s=e.layerDefinition)||void 0===s?void 0:s.geometryType)&&"esriGeometryPolyline"===e.layerDefinition.geometryType&&o.push(this.queryIndividualLayer(i,e,t)))}))}))}));return o},this.queryIndividualLayer=(e,t,i)=>{return s=this,a=void 0,n=function*(){let s=null;s=this.mapView.view.map.findLayerById(e.id);const a=this.getMetersForVerticalSR(s),o=this.filterExistingFeatures(t),n=e.definitionExpression,r=Date.now();let l=null;l=new Y.default,l.geometry=i,l.returnGeometry=!0,l.returnZ=!0,l.outSpatialReference=this.state.jimuMapView.view.spatialReference,l.outFields=["*"],l.where=o?n?o+" AND "+n+" AND "+r+"="+r:o+" AND "+r+"="+r:n?n+" AND "+r+"="+r:r+"="+r;let h=[];try{yield s.queryFeatures(l).then((e=>{e.features.length>0&&e.features.forEach((e=>{if(a){const t=N.default.getMetersPerUnitForSR(new U.default(this.mapView.view.spatialReference.toJSON())),i=e.geometry;i.paths.length>0&&i.paths.forEach((e=>{e.length>0&&e.forEach((e=>{e.length>1&&(e[2]=e[2]*a/t)}))}))}e.attributes.esriCTFeatureLayerId=t.dataSourceJson.id})),h=e.features}),(e=>{console.log(e)}))}catch(e){h=[]}return h},new((o=void 0)||(o=Promise))((function(e,t){function i(e){try{l(n.next(e))}catch(e){t(e)}}function r(e){try{l(n.throw(e))}catch(e){t(e)}}function l(t){var s;t.done?e(t.value):(s=t.value,s instanceof o?s:new o((function(e){e(s)}))).then(i,r)}l((n=n.apply(s,a||[])).next())}));var s,a,o,n},this.getMetersForVerticalSR=e=>{var t,i,s,a;let o=1;return o=(null===(i=null===(t=e.sourceJSON)||void 0===t?void 0:t.sourceSpatialReference)||void 0===i?void 0:i.vcsWkid)?N.default.getMetersPerVerticalUnitForSR(new U.default({wkid:e.sourceJSON.sourceSpatialReference.vcsWkid})):(null===(a=null===(s=e.sourceJSON)||void 0===s?void 0:s.sourceSpatialReference)||void 0===a?void 0:a.vcsWkt)?N.default.getMetersPerVerticalUnitForSR(new U.default({wkid:e.sourceJSON.sourceSpatialReference.vcsWkt})):null,o},this.filterExistingFeatures=e=>{let t="";const i=e.layer.objectIdField,s=this.drawingLayer.graphics.filter((t=>!(!t.attributes||!Object.prototype.hasOwnProperty.call(t.attributes,"esriCTFeatureLayerId")||t.attributes.esriCTFeatureLayerId!==e.dataSourceJson.id)));return s.forEach(((a,o)=>{Object.prototype.hasOwnProperty.call(a.attributes,"esriCTFeatureLayerId")&&a.attributes.esriCTFeatureLayerId===e.dataSourceJson.id&&(o===s.length-1?t+=i+" <> "+a.attributes[i]:t+=i+" <> "+a.attributes[i]+" and ")})),t},this.selectFeatureForProfiling=e=>{let t=!1,i=!1;const s=this.drawingLayer.graphics.length;if(s>0){const a=this.drawingLayer.graphics.getItemAt(0).geometry,o=this.drawingLayer.graphics.getItemAt(s-1).geometry,n=a.getPoint(0,0),r=o.getPoint(0,o.paths[0].length-1),l=e.geometry.getPoint(0,0),h=e.geometry.getPoint(0,e.geometry.paths[0].length-1);K.default.intersects(l,n)?(t=!0,i=!0):K.default.intersects(h,n)?(t=!0,i=!1):K.default.intersects(h,r)?(t=!1,i=!0):K.default.intersects(l,r)&&(t=!1,i=!1)}const a={type:"simple-line",color:new ee.default(this.state.graphicsHighlightColor).toRgba(),width:5},o=e.geometry;if(i){const e=[];for(let t=o.paths.length-1;t>=0;t--){const i=[];for(let e=o.paths[t].length-1;e>=0;e--)i.push(o.paths[t][e]);e.push(i)}o.paths=e}const n=new H.default({geometry:o,attributes:e.attributes,symbol:a});this.state.addToSelectionTool||(this._activateAddToSelectionTool(),this._defaultViewModel.input=n),t?this.drawingLayer.graphics.add(n,0):this.drawingLayer.graphics.add(n),this.nextPossibleSelectionLayer.removeAll(),setTimeout((()=>{this.renderChartOnSelect(),this.highlightNextPossibleSelection()}),200)},this.createSinglePathPolyline=e=>{const t=[];e.paths.forEach((e=>{e.forEach((e=>t.push(e)))}));const i=new R.default({hasZ:e.hasZ,spatialReference:e.spatialReference.toJSON()});return i.addPath(t),i},this.renderChartOnSelect=()=>{if(this.state.addToSelectionTool){let e;if(this.drawingLayer.graphics.length>1){const t=new R.default({spatialReference:this.drawingLayer.graphics.getItemAt(0).geometry.spatialReference.toJSON()});let i=[];this.drawingLayer.graphics.forEach((e=>{const s=e.geometry;if(s.paths.length>1)s.paths.forEach((e=>{i.length>0?(e.forEach((e=>i.push(e))),t.addPath(i),i=[]):t.addPath(e)}));else{const e=t.paths.length;e>0?s.paths.forEach((i=>{i.forEach((i=>t.paths[e-1].push(i)))})):s.paths.forEach((e=>{e.forEach((e=>i.push(e)))}))}})),i.length>0&&t.addPath(i),e=new H.default({geometry:t})}else 1===this.drawingLayer.graphics.length&&(e=this.drawingLayer.graphics.getItemAt(0));this._defaultViewModel.input=e}},this.highlightNextPossibleSelection=()=>{let e,t,i,s;const a=this.drawingLayer.graphics.length;if(a>0){i=this.drawingLayer.graphics.getItemAt(0).geometry,e=i.getPoint(0,0);let o=i.paths[0].length-1;t=i.getPoint(0,o),a>1&&(s=this.drawingLayer.graphics.getItemAt(a-1).geometry,o=s.paths[0].length-1,t=s.getPoint(0,o))}const o=new H.default({geometry:e});this.nextPossibleSelectionLayer.graphics.add(o);const n=new H.default({geometry:t});this.nextPossibleSelectionLayer.graphics.add(n),this.queryForNextPossibleSelection([e,t])},this.queryForNextPossibleSelection=e=>{let t=[];e.forEach((e=>{t=t.concat(this.queryForIndividualLayers(this.state.jimuMapView.dataSourceId,this.pointToExtent(e)))})),this.setState({loadingIndicator:!0}),Promise.all(t).then((t=>{this.setState({loadingIndicator:!1});const i=[],s=t.flat();(null==s?void 0:s.length)>0&&(s.forEach((t=>{var s,a,o,n,r;if((null===(a=null===(s=null==t?void 0:t.geometry)||void 0===s?void 0:s.paths)||void 0===a?void 0:a.length)>0){const s=t.geometry.getPoint(0,0),a=t.geometry.paths[t.geometry.paths.length-1].length-1,l=t.geometry.getPoint(0,a);if(s&&K.default.intersects(e[0],s)||l&&K.default.intersects(e[0],l)||s&&K.default.intersects(e[1],s)||l&&K.default.intersects(e[1],l)){const e={type:"simple-line",color:[252,252,3,.8],style:"short-dot",width:"3d"===(null===(r=null===(n=null===(o=this.state)||void 0===o?void 0:o.jimuMapView)||void 0===n?void 0:n.view)||void 0===r?void 0:r.type)?7:4},s=new H.default({geometry:t.geometry,attributes:t.attributes,symbol:e});i.push(s)}}})),i&&i.length>0&&this.nextPossibleSelectionLayer.graphics.addMany(i)),setTimeout((()=>{this.updateStateCanAddToSelection()}),200)}),(e=>{console.log(e),this.updateStateCanAddToSelection()}))},this.updateStateCanAddToSelection=()=>{let e=!1;this.nextPossibleSelectionLayer.graphics.filter((e=>"polyline"===e.geometry.type)).length>0?e=!0:this.newFeatureSelection?this.setState({noGraphicAfterFirstSelection:!0}):this.setState({noGraphicAfterFirstSelection:!1}),e||this._deActivateAddToSelectionTool()},this._activateAddToSelectionTool=()=>{var e;this.state.addToSelectionTool||this.setState({addToSelectionTool:!0,drawingOrSelectingComplete:!1}),this.state.jimuMapView&&this.state.jimuMapView.view&&(this.state.jimuMapView.view.popup.autoOpenEnabled=!1),this._displayAddToSelectionCursor(),null===(e=this.nextPossibleSelectionLayer)||void 0===e||e.set("visible",!0)},this._deActivateAddToSelectionTool=()=>{var e;this.state.addToSelectionTool&&this.setState({addToSelectionTool:!1,drawingOrSelectingComplete:!0}),this.state.jimuMapView&&this.state.jimuMapView.view&&(this.state.jimuMapView.view.popup.autoOpenEnabled=!0),this._displayDefaultCursor(),null===(e=this.nextPossibleSelectionLayer)||void 0===e||e.set("visible",!1)},this._displayAddToSelectionCursor=()=>{this.state.jimuMapView&&this.state.jimuMapView.view&&this.state.jimuMapView.view&&this.state.jimuMapView.view.container&&null!==this.state.jimuMapView.view.container.style.cursor&&(this.state.jimuMapView.view.container.style.cursor="copy")},this.activateDrawOrSelectTool=()=>{this.state.currentSketchVM&&((this.state.drawModeActive||this.state.selectModeActive)&&this.state.currentSketchVM.cancel(),this.setState({drawingOrSelectingComplete:!1,startChartRendering:!1,viewModelErrorState:!1},(()=>{this.state.drawModeActive&&this._defaultViewModel&&this._defaultViewModel.start({mode:"sketch"}),this.state.selectModeActive&&this.state.currentSketchVM.create("point")})))},this.destroyDrawingLayers=()=>{this.drawingLayer&&(this.drawingLayer.removeAll(),this.drawingLayer.destroy()),this.nextPossibleSelectionLayer&&(this.nextPossibleSelectionLayer.removeAll(),this.nextPossibleSelectionLayer.destroy()),this.hideChartPosition()},this._displayDefaultCursor=()=>{this.state.jimuMapView&&this.state.jimuMapView.view&&this.state.jimuMapView.view&&this.state.jimuMapView.view.container&&null!==this.state.jimuMapView.view.container.style.cursor&&(this.state.jimuMapView.view.container.style.cursor=null)},this.pointToExtent=(e,t=5)=>{const i=t*(this.state.jimuMapView.view.extent.get("width")/this.state.jimuMapView.view.get("width")),s={xmin:e.x-i,ymin:e.y-i,xmax:e.x+i,ymax:e.y+i,spatialReference:this.state.jimuMapView.view.spatialReference};return new X.default(s)},this.selectableLayersAvailableAtRuntime=e=>{this.selectableLayersAtRuntime=e},this.onSelectButtonClicked=()=>{this.setState({initialStage:!1,resultStage:!0,selectModeActive:!0,drawModeActive:!1},(()=>{this.activateDrawOrSelectTool()}))},this.onDrawButtonClicked=()=>{this.setState({initialStage:!1,resultStage:!0,selectModeActive:!1,drawModeActive:!0},(()=>{this.activateDrawOrSelectTool()}))},this.onBackClick=()=>{this.clearAll(),this.setState({initialStage:!0,startChartRendering:!1,drawingOrSelectingComplete:!1,resultStage:!1,drawModeActive:!1,selectModeActive:!1})},this.clearAll=()=>{var e;(this.state.drawModeActive||this.state.selectModeActive)&&(null===(e=this.state.currentSketchVM)||void 0===e||e.cancel()),this._deActivateAddToSelectionTool(),this.clearGraphics(),this.clearChart(),this._defaultViewModel&&this._defaultViewModel.clear()},this.clearGraphics=()=>{this.drawingLayer&&this.drawingLayer.removeAll(),this.nextPossibleSelectionLayer&&this.nextPossibleSelectionLayer.removeAll(),this.hideChartPosition()},this.clearChart=()=>{this.setState({profileResult:null,noFeaturesError:!1})},this.activateToolForNewProfile=()=>{this.clearAll(),this.setState({initialStage:!1,resultStage:!0},(()=>{this.activateDrawOrSelectTool()}))},this.onDoneButtonCLicked=()=>{let e=!1;return this._defaultViewModel.stop(),"created"!==this._defaultViewModel.state&&"selected"!==this._defaultViewModel.state||(e=!0),e?this.stopFurtherSelectingLines():this.activateDrawOrSelectTool(),e},this.stopFurtherSelectingLines=()=>{this._deActivateAddToSelectionTool(),this.nextPossibleSelectionLayer&&this.nextPossibleSelectionLayer.removeAll()},this.highlightChartPosition=e=>{this._defaultViewModel&&(this._defaultViewModel.hoveredChartPosition=e)},this.hideChartPosition=()=>{this._defaultViewModel&&(this._defaultViewModel.hoveredChartPosition=null)},this.renderFrontLandingPage=()=>{var s,a;return(0,t.jsx)("div",{tabIndex:-1,className:"h-100 w-100 d-flex align-items-center mainSection"},(0,t.jsx)("div",{tabIndex:-1,className:"adjust-cards"},(0,t.jsx)(i.Card,{tabIndex:0,"aria-label":this.nls("selectLinesDesc"),button:!0,"data-testid":"selectButton",className:(0,t.classNames)("front-cards mt-3 mb-3 shadow","default"===this.state.currentDatasource||this.state.lineLayersNotFound?"hidden":"front-section"),onClick:this.onSelectButtonClicked,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||this.onSelectButtonClicked()}},(0,t.jsx)(i.CardBody,{className:"w-100 h-100 p-3"},(0,t.jsx)("h5",{className:"text-truncate",style:{textAlign:"center"}},this.nls("selectLinesLabel")),(0,t.jsx)("p",{title:this.nls("selectLinesDesc"),className:"m-3 userGuideInfo"},this.nls("selectLinesDesc")),(0,t.jsx)("div",{style:{textAlign:"center"}},(0,t.jsx)(i.Button,{role:"button","aria-label":this.nls("selectButtonLabel"),title:this.nls("selectButtonLabel"),size:"default",type:"secondary",className:"text-break"},(null===(s=this.props.config.generalSettings)||void 0===s?void 0:s.buttonStyle)===e.IconText&&(0,t.jsx)(t.React.Fragment,null,(0,t.jsx)(i.Icon,{size:"12",icon:te.selectIcon}),this.nls("selectButtonLabel")))))),(0,t.jsx)(i.Card,{tabIndex:0,"aria-label":this.nls("drawProfileDesc"),button:!0,"data-testid":"drawButton",className:(0,t.classNames)("front-cards front-section mt-3 mb-3 shadow","default"===this.state.currentDatasource||this.state.lineLayersNotFound?"h-100 ":""),onClick:this.onDrawButtonClicked,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||this.onDrawButtonClicked()}},(0,t.jsx)(i.CardBody,{className:"w-100 h-100 p-3"},(0,t.jsx)("h5",{className:"text-truncate",style:{textAlign:"center"}},this.nls("drawProfileLabel")),(0,t.jsx)("p",{title:this.nls("drawProfileDesc"),className:"m-3 userGuideInfo"},this.nls("drawProfileDesc")),(0,t.jsx)("div",{style:{textAlign:"center"}},(0,t.jsx)(i.Button,{role:"button","aria-label":this.nls("drawButtonLabel"),title:this.nls("drawButtonLabel"),size:"default",type:"secondary",className:"text-break"},(null===(a=this.props.config.generalSettings)||void 0===a?void 0:a.buttonStyle)===e.IconText&&(0,t.jsx)(t.React.Fragment,null,(0,t.jsx)(i.Icon,{size:"12",icon:te.drawIcon}),this.nls("drawButtonLabel"))))))))},this.resetToDefault=()=>{var e;(this.state.drawModeActive||this.state.selectModeActive)&&(null===(e=this.state.currentSketchVM)||void 0===e||e.cancel()),this._defaultViewModel&&this._defaultViewModel.clear(),this.clearGraphics(),this._displayDefaultCursor()},this.defaultConfig=this.createDefaultConfigForDataSource(),this.newFeatureSelection=!1,this.createDrawingLayers(),this.activeCurrentDs="default",this.selectableLayersAtRuntime=[],this.selectedUnit=I(this.props.config.configInfo[this.props.config.activeDataSource],this.props.portalSelf),this.state={initialStage:!0,resultStage:!1,selectModeActive:null===(a=this.props.config.generalSettings)||void 0===a?void 0:a.isSelectToolActive,addToSelectionTool:!1,drawModeActive:null===(o=this.props.config.generalSettings)||void 0===o?void 0:o.isDrawToolActive,drawingOrSelectingComplete:!1,currentDatasource:this.props.config.activeDataSource,currentSketchVM:null,jimuMapView:null,startChartRendering:!1,groundColor:null===(l=null===(n=this.props.config.configInfo[this.props.config.activeDataSource])||void 0===n?void 0:n.profileChartSettings)||void 0===l?void 0:l.groundColor,graphicsHighlightColor:null===(d=null===(h=this.props.config.configInfo[this.props.config.activeDataSource])||void 0===h?void 0:h.profileChartSettings)||void 0===d?void 0:d.graphicsHighlightColor,chartColorRender:"",customElevationLayer:null===(p=null===(c=this.props.config.configInfo[this.props.config.activeDataSource])||void 0===c?void 0:c.profileChartSettings)||void 0===p?void 0:p.isCustomElevationLayer,elevationLayer:null===(g=null===(u=this.props.config.configInfo[this.props.config.activeDataSource])||void 0===u?void 0:u.profileChartSettings)||void 0===g?void 0:g.elevationLayerURL,profileResult:null,selectedLinearUnit:this.selectedUnit[1],selectedElevationUnit:this.selectedUnit[0],noFeaturesError:!1,profileLineLayers:[],lineLayersNotFound:!((null===(f=this.props.config.configInfo[this.props.config.activeDataSource])||void 0===f?void 0:f.advanceOptions)&&0!==this.props.config.configInfo[this.props.config.activeDataSource].profileSettings.layers.length),viewModelErrorState:!1,profileErrorMsg:"",noGraphicAfterFirstSelection:!1,loadingIndicator:!1}}render(){const e=this.renderFrontLandingPage();let o;const n=this.props.useMapWidgetIds&&this.props.useMapWidgetIds[0];return this.props.config.useMapWidget&&Object.prototype.hasOwnProperty.call(this.props,"useMapWidgetIds")&&this.props.useMapWidgetIds&&1===this.props.useMapWidgetIds.length&&(o=(0,t.jsx)(s.JimuMapViewComponent,{useMapWidgetId:this.props.useMapWidgetIds[0],onActiveViewChange:this.activeViewChangeHandler.bind(this)})),n?(0,t.jsx)("div",{css:a(this.props.theme),className:"jimu-widget"},(0,t.jsx)("div",{className:"widget-elevation-profile"},o,this.state.initialStage&&e,this.state.resultStage&&(0,t.jsx)(z,{theme:this.props.theme,intl:this.props.intl,widgetId:this.props.id,portalSelf:this.props.portalSelf,displayLoadingIndicator:this.state.loadingIndicator,activeDataSource:this.state.currentDatasource,commonDsGeneralSettings:this.props.config.generalSettings,defaultConfig:this.defaultConfig,activeDatasourceConfig:this.props.config.configInfo[this.state.currentDatasource],profileResult:this.state.profileResult,selectMode:this.state.selectModeActive,drawMode:this.state.drawModeActive,drawingOrSelectingComplete:this.state.drawingOrSelectingComplete,isNewSegmentsForSelection:this.state.addToSelectionTool,noGraphicAfterFirstSelection:this.state.noGraphicAfterFirstSelection,chartRender:this.state.startChartRendering,chartColorRender:this.state.chartColorRender,noFeaturesFoundError:this.state.noFeaturesError,onNavBack:this.onBackClick,doneClick:this.onDoneButtonCLicked,activateDrawSelectToolForNewProfile:this.activateToolForNewProfile,selectabelLayersRuntime:this.selectableLayersAvailableAtRuntime,chartPosition:this.highlightChartPosition,hideChartPosition:this.hideChartPosition,drawingLayer:this.drawingLayer,jimuMapview:this.state.jimuMapView,viewModelErrorState:this.state.viewModelErrorState,profileErrorMsg:this.state.profileErrorMsg}))):(this.resetToDefault(),(0,t.jsx)(i.WidgetPlaceholder,{icon:te.elevationIcon,widgetId:this.props.id,"data-testid":"widgetPlaceholder",message:this.props.intl.formatMessage({id:"_widgetLabel",defaultMessage:this.nls("_widgetLabel")})}))}}se.mapExtraStateProps=e=>{var t;return{appMode:null===(t=e.appRuntimeInfo)||void 0===t?void 0:t.appMode}}})(),M})())}}}));