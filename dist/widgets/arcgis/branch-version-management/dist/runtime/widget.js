System.register(["jimu-core","jimu-ui"],(function(e,t){var s={},i={};return{setters:[function(e){s.BaseWidget=e.BaseWidget,s.DataSourceComponent=e.DataSourceComponent,s.DataSourceManager=e.DataSourceManager,s.DataSourceTypes=e.DataSourceTypes,s.Immutable=e.Immutable,s.SessionManager=e.SessionManager,s.css=e.css,s.defaultMessages=e.defaultMessages,s.esri=e.esri,s.getAppStore=e.getAppStore,s.jsx=e.jsx,s.lodash=e.lodash,s.urlUtils=e.urlUtils},function(e){i.Alert=e.Alert,i.Button=e.Button,i.Checkbox=e.Checkbox,i.Col=e.Col,i.FormGroup=e.FormGroup,i.Icon=e.Icon,i.Input=e.Input,i.InputGroup=e.InputGroup,i.Label=e.Label,i.ListGroup=e.ListGroup,i.Modal=e.Modal,i.ModalBody=e.ModalBody,i.ModalFooter=e.ModalFooter,i.ModalHeader=e.ModalHeader,i.Pagination=e.Pagination,i.Popper=e.Popper,i.Select=e.Select,i.Switch=e.Switch,i.Table=e.Table,i.TextArea=e.TextArea,i.TextInput=e.TextInput,i.Tooltip=e.Tooltip,i.WidgetPlaceholder=e.WidgetPlaceholder,i.applyMaxSizeModifier=e.applyMaxSizeModifier,i.defaultMessages=e.defaultMessages,i.getCustomFlipModifier=e.getCustomFlipModifier,i.maxSizeModifier=e.maxSizeModifier}],execute:function(){e((()=>{var e={2019:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});var i=s(8081),o=s.n(i),r=s(23645),n=s.n(r)()(o());n.push([e.id,'.textAreaStyle{width:98%}.flexColumn1{flex:1;flex-Direction:"column";display:"flex"}.mobileContainer{position:absolute;bottom:0;width:100%;height:50px}\n',""]);const a=n},23645:e=>{"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var s="",i=void 0!==t[5];return t[4]&&(s+="@supports (".concat(t[4],") {")),t[2]&&(s+="@media ".concat(t[2]," {")),i&&(s+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),s+=e(t),i&&(s+="}"),t[2]&&(s+="}"),t[4]&&(s+="}"),s})).join("")},t.i=function(e,s,i,o,r){"string"==typeof e&&(e=[[null,e,void 0]]);var n={};if(i)for(var a=0;a<this.length;a++){var l=this[a][0];null!=l&&(n[l]=!0)}for(var c=0;c<e.length;c++){var h=[].concat(e[c]);i&&n[h[0]]||(void 0!==r&&(void 0===h[5]||(h[1]="@layer".concat(h[5].length>0?" ".concat(h[5]):""," {").concat(h[1],"}")),h[5]=r),s&&(h[2]?(h[1]="@media ".concat(h[2]," {").concat(h[1],"}"),h[2]=s):h[2]=s),o&&(h[4]?(h[1]="@supports (".concat(h[4],") {").concat(h[1],"}"),h[4]=o):h[4]="".concat(o)),t.push(h))}},t}},8081:e=>{"use strict";e.exports=function(e){return e[1]}},93379:e=>{"use strict";var t=[];function s(e){for(var s=-1,i=0;i<t.length;i++)if(t[i].identifier===e){s=i;break}return s}function i(e,i){for(var r={},n=[],a=0;a<e.length;a++){var l=e[a],c=i.base?l[0]+i.base:l[0],h=r[c]||0,d="".concat(c," ").concat(h);r[c]=h+1;var u=s(d),f={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==u)t[u].references++,t[u].updater(f);else{var p=o(f,i);i.byIndex=a,t.splice(a,0,{identifier:d,updater:p,references:1})}n.push(d)}return n}function o(e,t){var s=t.domAPI(t);return s.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;s.update(e=t)}else s.remove()}}e.exports=function(e,o){var r=i(e=e||[],o=o||{});return function(e){e=e||[];for(var n=0;n<r.length;n++){var a=s(r[n]);t[a].references--}for(var l=i(e,o),c=0;c<r.length;c++){var h=s(r[c]);0===t[h].references&&(t[h].updater(),t.splice(h,1))}r=l}}},90569:e=>{"use strict";var t={};e.exports=function(e,s){var i=function(e){if(void 0===t[e]){var s=document.querySelector(e);if(window.HTMLIFrameElement&&s instanceof window.HTMLIFrameElement)try{s=s.contentDocument.head}catch(e){s=null}t[e]=s}return t[e]}(e);if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");i.appendChild(s)}},19216:e=>{"use strict";e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},3565:(e,t,s)=>{"use strict";e.exports=function(e){var t=s.nc;t&&e.setAttribute("nonce",t)}},7795:e=>{"use strict";e.exports=function(e){var t=e.insertStyleElement(e);return{update:function(s){!function(e,t,s){var i="";s.supports&&(i+="@supports (".concat(s.supports,") {")),s.media&&(i+="@media ".concat(s.media," {"));var o=void 0!==s.layer;o&&(i+="@layer".concat(s.layer.length>0?" ".concat(s.layer):""," {")),i+=s.css,o&&(i+="}"),s.media&&(i+="}"),s.supports&&(i+="}");var r=s.sourceMap;r&&"undefined"!=typeof btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(r))))," */")),t.styleTagTransform(i,e,t.options)}(t,e,s)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},44589:e=>{"use strict";e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},49154:e=>{e.exports='<svg viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M8 2.5A2.5 2.5 0 0 1 10.5 0h7A2.5 2.5 0 0 1 20 2.5v9a2.5 2.5 0 0 1-2.5 2.5H16v.5a2.5 2.5 0 0 1-2.5 2.5H12v1a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h2v-.5A2.5 2.5 0 0 1 6.5 3H8v-.5ZM5 6h5a2 2 0 0 1 2 2v8h1.5a1.5 1.5 0 0 0 1.5-1.5v-9A1.5 1.5 0 0 0 13.5 4h-7A1.5 1.5 0 0 0 5 5.5V6Zm12.5 7H16V5.5A2.5 2.5 0 0 0 13.5 3H9v-.5A1.5 1.5 0 0 1 10.5 1h7A1.5 1.5 0 0 1 19 2.5v9a1.5 1.5 0 0 1-1.5 1.5ZM2 7h8a1 1 0 0 1 1 1v10a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V8a1 1 0 0 1 1-1Z" fill="#000"></path></svg>'},71335:e=>{e.exports='<svg viewBox="0 0 8 8" xmlns="http://www.w3.org/2000/svg"><path d="M3.5 3.5v-3a.5.5 0 0 1 1 0v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3Z" fill-rule="evenodd"></path></svg>'},42351:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M2.146 4.653a.485.485 0 0 1 .708 0L8 10.24l5.146-5.587a.485.485 0 0 1 .708 0 .538.538 0 0 1 0 .738l-5.5 5.956a.485.485 0 0 1-.708 0l-5.5-5.956a.538.538 0 0 1 0-.738Z" fill="#000"></path></svg>'},23377:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M13.854 11.347a.486.486 0 0 1-.708 0L8 5.76l-5.146 5.587a.485.485 0 0 1-.708 0 .538.538 0 0 1 0-.738l5.5-5.956a.485.485 0 0 1 .708 0l5.5 5.956a.538.538 0 0 1 0 .738Z" fill="#000"></path></svg>'},8045:e=>{e.exports='<svg viewBox="0 0 26 26" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><circle fill="#6A6A6A" cx="13" cy="13" r="13"></circle><path d="M13 17a10 10 0 0 1 8.913 5.462A12.952 12.952 0 0 1 13 26c-3.45 0-6.586-1.344-8.914-3.537A10 10 0 0 1 13 17Zm0-12a5 5 0 1 1 0 10 5 5 0 0 1 0-10Z" fill="#A8A8A8"></path></g></svg>'},88643:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M16 32c8.837 0 16-7.163 16-16S24.837 0 16 0 0 7.163 0 16s7.163 16 16 16zm0-4.571C9.688 27.429 4.571 22.312 4.571 16S9.688 4.571 16 4.571 27.429 9.688 27.429 16 22.312 27.429 16 27.429z"></path></svg>'},72590:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M2 28h28a2 2 0 1 1 0 4H2a2 2 0 1 1 0-4zm8.025-3.239-2.278.253a3.2 3.2 0 0 1-3.534-3.534l.253-2.278a6.403 6.403 0 0 1 1.835-3.819L17.913 3.771a5.332 5.332 0 1 1 7.542 7.542L13.843 22.925a6.395 6.395 0 0 1-3.819 1.835z"></path></svg>'},750:e=>{e.exports='<svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M13.444 3.582A7.011 7.011 0 0 0 8 1 7.014 7.014 0 0 0 1.05 7.03c-.017.122-.031.281-.044.477A.525.525 0 0 1 .481 8 .48.48 0 0 1 0 7.492c.01-.195.024-.354.039-.476C.526 3.062 3.904 0 8 0c2.482 0 4.7 1.124 6.172 2.89l.19-1.356a.502.502 0 0 1 .994.138l-.441 3.126-3.03-.425a.5.5 0 0 1 .14-.99l1.419.199ZM1.936 13.236l-.163 1.322a.502.502 0 0 1-.996-.121l.387-3.133 3.036.371a.5.5 0 0 1-.122.993l-1.463-.179A7.01 7.01 0 0 0 8 15a7.014 7.014 0 0 0 6.947-6c.019-.128.034-.297.048-.507A.526.526 0 0 1 15.519 8a.48.48 0 0 1 .48.507 7.579 7.579 0 0 1-.042.505C15.458 12.952 12.087 16 8 16a8.01 8.01 0 0 1-6.064-2.764Z" fill="#000" fill-rule="nonzero"></path></svg>'},82002:e=>{e.exports='<svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M11 2v13h-1V2H6v13H5V2H1v12a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V2h-4ZM2 0h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2Z"></path></svg>'},81430:e=>{e.exports='<svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M8 0a4 4 0 0 1 4 4v3a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2V4a4 4 0 0 1 4-4Zm4 8H4a1 1 0 0 0-1 1v5a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V9a1 1 0 0 0-1-1ZM8 9v1h1v1H8v1h1v1H8v1H7V9h1Zm0-8a3 3 0 0 0-3 3v3h1V4a2 2 0 1 1 4 0v3h1V4a3 3 0 0 0-3-3Zm0 2a1 1 0 0 0-1 1v3h2V4a1 1 0 0 0-1-1Z" fill="#000" fill-rule="nonzero"></path></svg>'},83223:e=>{e.exports='<svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M12.827 0a.5.5 0 0 1 .5.5v14.158l1.794-2.598a.5.5 0 1 1 .759.652l-2.146 3.008a.8.8 0 0 1-1.407-.52V.5a.5.5 0 0 1 .5-.5ZM.5 16a.5.5 0 0 1 0-1h9a.5.5 0 0 1 0 1h-9Zm0-7.5a.5.5 0 0 1 0-1h9a.5.5 0 0 1 0 1h-9ZM.5 1a.5.5 0 0 1 0-1h9a.5.5 0 0 1 0 1h-9Z" fill="#000" fill-rule="nonzero"></path></svg>'},91914:e=>{e.exports='<svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M12.827 16a.5.5 0 0 1-.5-.5V.8a.8.8 0 0 1 1.407-.52l2.146 3.008a.5.5 0 0 1-.76.652l-1.793-2.598V15.5a.5.5 0 0 1-.5.5ZM.5 0h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1 0-1Zm0 7.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1 0-1Zm0 7.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1 0-1Z" fill="#000" fill-rule="nonzero"></path></svg>'},48891:e=>{"use strict";e.exports=s},30726:e=>{"use strict";e.exports=i}},t={};function o(s){var i=t[s];if(void 0!==i)return i.exports;var r=t[s]={id:s,exports:{}};return e[s](r,r.exports,o),r.exports}o.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return o.d(t,{a:t}),t},o.d=(e,t)=>{for(var s in t)o.o(t,s)&&!o.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.p="",o.nc=void 0;var r={};return o.p=window.jimuConfig.baseUrl,(()=>{"use strict";o.r(r),o.d(r,{default:()=>U});var e=o(48891),t=o(30726),s=o(93379),i=o.n(s),n=o(7795),a=o.n(n),l=o(90569),c=o.n(l),h=o(3565),d=o.n(h),u=o(19216),f=o.n(u),p=o(44589),g=o.n(p),v=o(2019),m={};m.styleTagTransform=g(),m.setAttributes=d(),m.insert=c().bind(null,"head"),m.domAPI=a(),m.insertStyleElement=f(),i()(v.Z,m),v.Z&&v.Z.locals&&v.Z.locals;var S=function(e,t,s,i){return new(s||(s=Promise))((function(o,r){function n(e){try{l(i.next(e))}catch(e){r(e)}}function a(e){try{l(i.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(n,a)}l((i=i.apply(e,t||[])).next())}))};class x{constructor(){this.defaultVersion="sde.DEFAULT",this.isOrgUser=!1,this.uniqueURLs=[]}static getInstance(){return x.instance||(x.instance=new x),x.instance}getUniqueVMSURL(t){return new Promise(((s,i)=>{const o=e.DataSourceManager.getInstance().getDataSources(),r=[],n=[];for(const s in o)if(t){if(s.includes(t)&&o[s].type===e.DataSourceTypes.FeatureLayer){const e=o[s].getDataSourceJson();if(e.url.includes("FeatureServer")){const t=e.url.substring(0,e.url.indexOf("FeatureServer"));r.includes(t)||r.push(t)}}}else if(o[s].type===e.DataSourceTypes.FeatureLayer){const e=o[s].getDataSourceJson();if(e.url.includes("FeatureServer")){const t=e.url.substring(0,e.url.indexOf("FeatureServer"));r.includes(t)||r.push(t)}}if(r.length>0){const e=r.map(((e,t)=>S(this,void 0,void 0,(function*(){let t=!1;if(t=yield this.checkValidVMS(e),t){const t=yield this.serviceNameLookup(e);n.push({url:e,name:t})}}))));Promise.all(e).then((e=>S(this,void 0,void 0,(function*(){this.uniqueURLs=n,s(n)}))))}else this.uniqueURLs=n,s(n)}))}checkValidVMS(e,t){return S(this,void 0,void 0,(function*(){let s=!1,i=e;i.includes("FeatureServer")&&(i=i.substring(0,i.indexOf("FeatureServer"))),i.includes("MapServer")&&(i=i.substring(0,i.indexOf("MapServer")));const o=i+"VersionManagementServer";let r=null;return r=t?{f:"json",token:t}:{f:"json"},s=yield this.requestService({method:"POST",url:o,params:r}).then((e=>!!e.hasOwnProperty("name")&&"Version Management Server"===e.name)).catch((e=>!1)),s}))}getVersions(e,t,s){return new Promise(((i,o)=>{if(t){let e=t;e.includes("FeatureServer")&&(e=e.substring(0,e.indexOf("FeatureServer"))),e.includes("MapServer")&&(e=e.substring(0,e.indexOf("MapServer"))),i(s?this.requestVersions(e,s):this.requestVersions(e))}else if(0===this.uniqueURLs.length)this.getUniqueVMSURL().then((t=>{let o=t[0];e&&(o=t.filter((t=>t.name===e)));const r=o[0].url;i(s?this.requestVersions(r,s):this.requestVersions(r))}));else{let t=this.uniqueURLs[0];e&&(t=this.uniqueURLs.filter((t=>t.name===e)));const o=t[0].url;i(s?this.requestVersions(o,s):this.requestVersions(o))}}))}changeGDBVersion(t,s){let i=!1;for(const o in s)s[o].type===e.DataSourceTypes.FeatureLayer&&(this.getLayerObject(s[o]).changeGDBVersion(t),i=!0),(s[o].type===e.DataSourceTypes.FeatureService||s[o].type===e.DataSourceTypes.MapService)&&(s[o].changeGDBVersion(t),i=!0);return i}createGDBVersion(e,t,s,i,o,r){return new Promise(((n,a)=>{let l=null;if(this.isOrgUser){const a=this.checkValidVersionName(e.versionName);if(a.success){if(o)l=o,l.indexOf("FeatureServer")>=0?(l=l.substring(0,l.indexOf("FeatureServer")),l+="VersionManagementServer/create"):l.indexOf("MapServer")>=0?(l=l.substring(0,l.indexOf("MapServer")),l+="VersionManagementServer/create"):l+="VersionManagementServer/create";else{let e=this.uniqueURLs[0];i&&(e=this.uniqueURLs.filter((e=>e.name===i))),l=e[0].url+"VersionManagementServer/create"}this.requestService({method:"POST",url:l,params:{f:"json",versionName:e.versionName,description:e.versionDescription,accessPermission:e.versionScope,token:t}}).then((e=>{r&&e.hasOwnProperty("versionInfo")&&this.changeGDBVersion(e.versionInfo.versionName,s),n(e)})).catch((e=>{n(e)}))}else n(a)}else n({})}))}deleteGDBVersion(t,s,i,o,r){return new Promise(((n,a)=>{if("sde.default"!==t.toLowerCase()){const a={};let l=null;if(this.isOrgUser){if(r)l=r,l.indexOf("FeatureServer")>=0?(l=l.substring(0,l.indexOf("FeatureServer")),l+="VersionManagementServer/delete"):l.indexOf("MapServer")>=0?(l=l.substring(0,l.indexOf("MapServer")),l+="VersionManagementServer/delete"):l+="VersionManagementServer/delete";else{let e=this.uniqueURLs[0];o&&(e=this.uniqueURLs.filter((e=>e.name===o))),l=e[0].url+"VersionManagementServer/delete"}this.requestService({method:"POST",url:l,params:{f:"json",versionName:t,sessionId:s,token:s}}).then((s=>{const o=[];for(const s in i)i[s].type===e.DataSourceTypes.FeatureLayer&&this.getLayerObject(i[s]).getGDBVersion()===t&&(o[s]=i[s]);this.changeGDBVersion(this.defaultVersion,o),s.version=this.defaultVersion,n(s)})).catch((e=>{n(e)}))}else n(a)}else n({error:{message:"Cannot delete Default version"}})}))}alterGDBVersion(e,t,s,i,o,r){return new Promise(((n,a)=>{let l=null;if(this.isOrgUser){const a=this.checkValidVersionName(e.versionName);if(a.success){let a=e.versionGuid.replace("{","");if(a=a.replace("}",""),o)l=o,l.indexOf("FeatureServer")>=0?(l=l.substring(0,l.indexOf("FeatureServer")),l=l+"VersionManagementServer/versions/"+a+"/alter"):l.indexOf("MapServer")>=0?(l=l.substring(0,l.indexOf("MapServer")),l=l+"VersionManagementServer/versions/"+a+"/alter"):l=l+"VersionManagementServer/versions/"+a+"/alter";else{let e=this.uniqueURLs[0];i&&(e=this.uniqueURLs.filter((e=>e.name===i))),l=e[0].url+"VersionManagementServer/versions/"+a+"/alter"}this.requestService({method:"POST",url:l,params:{f:"json",versionName:e.versionName,description:e.versionDescription,accessPermission:e.versionScope,ownerName:e.versionOwner,token:t}}).then((t=>{r&&this.changeGDBVersion(e.versionOwner+"."+e.versionName,s),n(t)})).catch((e=>{n(e)}))}else n(a)}else n({})}))}getVersionState(e,t,s,i){return new Promise(((o,r)=>{let n=null,a=e.versionGuid.replace("{","");if(a=a.replace("}",""),i)n=i,n.indexOf("FeatureServer")>=0?(n=n.substring(0,n.indexOf("FeatureServer")),n=n+"VersionManagementServer/versions/"+a):n.indexOf("MapServer")>=0?(n=n.substring(0,n.indexOf("MapServer")),n=n+"VersionManagementServer/versions/"+a):n=n+"VersionManagementServer/versions/"+a;else{let e=this.uniqueURLs[0];s&&(e=this.uniqueURLs.filter((e=>e.name===s))),n=e[0].url+"VersionManagementServer/versions/"+a}this.requestService({method:"POST",url:n,params:{f:"json",token:t}}).then((e=>{o(e)})).catch((e=>{o(e)}))}))}checkValidVersionName(e){const t={success:!0,error:{message:"Version is valid"}};return e.length<=62?" "===e.substring(0,1)?(t.success=!1,t.error.message="Version name can not start with a space"):e.match(/(?=.*[.;'"])/)&&(t.success=!1,t.error.message="Version name can not have a period, semicolon, and single or double quotes"):(t.success=!1,t.error.message="Exceeded 62 characters for version name"),t}requestVersions(e,t){return new Promise(((s,i)=>{let o=e,r={};t?(o+="VersionManagementServer/versionInfos",r={f:"json",includeHidden:!0,token:t},this.isOrgUser=!0):(o+="VersionManagementServer/versions",r={f:"json",includeHidden:!0},this.isOrgUser=!1),this.requestService({method:"POST",url:o,params:r}).then((i=>S(this,void 0,void 0,(function*(){i.hasOwnProperty("error")?t?e?(console.log("second pass, service url"),this.getVersions(e).then((e=>{e.canManage=!1,s(e)}))):(console.log("second pass, no service url"),this.getVersions().then((e=>{e.canManage=!1,s(e)}))):(i.canManage=!1,s(i)):(i.canManage=!0,s(i))})))).catch((e=>{s(e)}))}))}getLayerObject(t){return t.type,e.DataSourceTypes.FeatureLayer,t}serviceNameLookup(e){return new Promise(((t,s)=>{const i=e+"FeatureServer";this.requestService({method:"POST",url:i,params:{f:"json"}}).then((e=>{e.hasOwnProperty("documentInfo")?t(e.documentInfo.Title):t("")})).catch((e=>{t(e)}))}))}versionRead(e){return new Promise(((t,s)=>{let i=this.uniqueURLs[0],o=e.versionGuid.replace("{","");o=o.replace("}",""),i=i+"VersionManagementServer/versions/"+o+"/"+e.action+"Reading/",this.requestService({method:"POST",url:i,params:{f:"json",sessionId:e.versionGuid,token:e.token}}).then((e=>{t(e)}))}))}searchPortalUsers(e,t,s){return new Promise(((i,o)=>{let r=e+"/sharing/rest/community/users";e.includes("sharing/rest")&&(r=e+"/community/users"),this.requestService({method:"POST",url:r,params:{f:"json",q:t,token:s}}).then((e=>{i(e)})).catch((e=>{i(e)}))}))}requestService(t){return new Promise((function(s,i){const o={params:t.params,httpMethod:t.method};e.esri.restRequest.request(t.url,o).then((e=>{s(e)})).catch((e=>{s(e)}))}))}}const V={_widgetLabel:"Branch Version Management",_widgetDescription:"A widget to switch and manage branch versions in a branch versioned service.",actionLabelsDelete:"Do you want to delete this version:",actionLabelsCannotDelete:"Sorry, cannot delete Default version",actionLabelsNameNotBlank:"Version name cannot be blank",actionLabelsNoServices:"No services configured",actionLabelsNoVersions:"No versions found",buttonsCancel:"Cancel",buttonsDelete:"Delete",buttonsPost:"Post",buttonsSave:"Save",fieldColumnsAccess:"Access",fieldColumnsColumnAvailable:"Available",fieldColumnsColumnShow:"Show",fieldColumnsCommonAncestorDate:"Common Ancestor Date",fieldColumnsCreationDate:"Creation Date",fieldColumnsDescription:"Description",fieldColumnsEvaluationDate:"Evaluation Date",fieldColumnsModifiedDate:"Modified Date",fieldColumnsPreviousAncestorDate:"Previous Ancestor Date",fieldColumnsReconcileDate:"Reconcile Date",fieldColumnsVersionGuid:"Version GUID",fieldColumnsVersionId:"Version ID",fieldColumnsVersionName:"Name",fieldColumnsVersionOwner:"Owner",modalheaderDeleteVersion:"Delete Version",modalheaderUpdateVersion:"Update Version",otherheadersColumnHeader:"Column",otherheadersManage:"Manage",otherheadersManageVersion:"Manage version",otherheadersNewVersion:"New version",otherheadersOrderHeader:"Order",otherheadersVisibleHeader:"Visible",placeholderLastUpdated:"Last updated on",placeholderNumberVersions:"Number of versions:",placeholderNumberVersionsSimple:"Versions:",placeholderSearchName:"Search version name or owner",placeholderSearchOwner:"Search Owner",placeholderSelectService:"Select a service",placeholderVersionNameText:"Version name",placeholderVersionDescriptionText:"Version Description",postSuccess:"This version is successfully posted",PostFail:"This version failed to post",postConflicts:"Cannot post this version due to conflicts",simplemodeActiveVersion:"Active version:",simplemodeLoadingWait:"Loading, please wait...",tooltipsAddToTable:"Add column to the table",tooltipsAsc:"ascending",tooltipsCurrentVersion:"Current active version",tooltipsCharLimit62:"Enter up to 62 characters",tooltipsCharLimit64:"Enter up to 64 characters",tooltipsCollapseSimpleMode:"Collapse the list of versions",tooltipsDesc:"descending",tooltipsNewVersion:"Create new version",tooltipsRefreshList:"Refresh versions list",tooltipsShowHideColumns:"Show/Hide Columns",tooltipsSwitchVersion:"Switch to this version",tooltipsUpdateVersionInfo:"Update version information",tooltipsExpandSimpleMode:"Expand to see a list of versions",tooltipsMoveColumnDown:"Move column down",tooltipsMoveColumnUp:"Move column up",tooltipsNotAvailableField:"Column can not be removed from the table",tooltipsRemoveFromTable:"Remove column from the table",tooltipsSortColumns:"Sort column",versionmanagementAccessPrivileges:"Access Privileges",versionmanagementActivateVersion:"Activate this version",versionmanagementChangeOwner:"Change Owner",versionmanagementCurrentOwner:"Current: ",versionmanagementDescription:"Description",versionmanagementNo:"No",versionmanagementNoUserFound:"No user found",versionmanagementPrivateAccess:"Private - Only the owner can view and edit",versionmanagementProtectedAccess:"Protected - Anyone can view, only owner can edit",versionmanagementPublicAccess:"Public - Anyone can view and edit",versionmanagementYes:"Yes"};var w=function(e,t,s,i){return new(s||(s=Promise))((function(o,r){function n(e){try{l(i.next(e))}catch(e){r(e)}}function a(e){try{l(i.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(n,a)}l((i=i.apply(e,t||[])).next())}))};const y=o(750),b=o(71335),j=o(82002),M=o(83223),C=o(91914),O=o(72590),L=o(81430),D=o(23377),k=o(42351),I=o(8045),N=o(88643),A=o(49154),P=[(0,t.getCustomFlipModifier)({fallbackPlacements:["top","left","right"],useClosestVerticalPlacement:!0}),t.maxSizeModifier,t.applyMaxSizeModifier],T={zIndex:"2002"};class U extends e.BaseWidget{constructor(s){super(s),this.defaultVersion="sde.DEFAULT",this.refreshInterval=1,this.refreshHandler=null,this.vms=x.getInstance(),this.widRefForPopper=this.props.widgetId+"divSimpleContainer",this.delayClickPrevent=(new Date).getTime(),this._populateSwitchableSources=t=>w(this,void 0,void 0,(function*(){if(this.props.useDataSources&&this.props.useDataSources.length>0){const s=e.DataSourceManager.getInstance().getDataSources();this.setState({dsList:s},(()=>{"runtime"===t&&this.loadConfig()}))}})),this._refreshHandler=()=>{""!==this.state.selectedService&&this.pullVersions(this.state.selectedService,!1).then((()=>{""!==this.state.searchVersionValue?this.searchVersions(this.state.searchVersionValue):""!==this.state.sort.field&&this.sortVersions(this.state.sort.field,this.state.sort.direction)}))},this.loadConfig=()=>{const e=this.state.configObj;let t=[],s="";t=e.services,t.length>0&&(s=e.services[0].name,this.setState({isReady:!0,showServiceSelector:!0,vmsServices:t,maxDisplayRows:parseInt(e.pageCounter),selectedService:s},(()=>{""!==this.state.selectedService&&(this._filterRuntimeFields(),this.pullVersions(this.state.selectedService,!0))})))},this.renderServiceSelector=()=>{const{theme:s}=this.props,i=[],o=this.state.configObj;let r="";null!==o&&o.services.forEach((t=>{i.push((0,e.jsx)("option",{key:t.name,value:t.name},t.name)),""!==this.state.selectedService&&this.state.selectedService===t.name&&(r=t.name)}));const n=this._getRefreshInterval();n>-1&&(null!==this.refreshHandler&&clearInterval(this.refreshHandler),this.refreshHandler=setInterval(this._refreshHandler,n));let a=!0;const l=this._getConfigServiceObject();null!==l&&(a=l.configuredSettings.allowance.filter((e=>e.key.search(/\bDelete|\bUpdate|\bChange/g)>-1)).some((e=>!0===e.enabled)),null===this.props.user&&(a=!1));let c=!0;const h=(0,e.getAppStore)().getState().widgetsRuntimeInfo;h.hasOwnProperty(this.props.widgetId)&&h[this.props.widgetId].hasOwnProperty("state")&&(c="OPENED"===h[this.props.widgetId].state);let d=(0,e.jsx)("div",{style:{display:"flex",flex:1,flexDirection:"column",height:"96%"}},(0,e.jsx)("div",{style:{display:"flex"}},i.length>0?(0,e.jsx)("table",{style:{width:"100%"}},(0,e.jsx)("tbody",null,this._createActiveRows(a))):this.formatMessage("actionLabelsNoServices")),this.state.isModeExpand&&(0,e.jsx)("div",{style:{display:"flex",flexDirection:"row"}},(0,e.jsx)("div",{style:{display:"flex",flex:1,fontWeight:"bold",alignItems:"center",paddingTop:5,paddingBottom:5}},i.length>1?(0,e.jsx)(t.Select,{value:r,onChange:e=>{this.setState({selectedService:e.currentTarget.value,selectedVersion:"",currentDisplayIndex:0},(()=>{if(this._filterRuntimeFields(),this.pullVersions(this.state.selectedService,!0),!1===this.state.isSimpleMode){const e=this._getRefreshInterval();e>-1&&(null!==this.refreshHandler&&clearInterval(this.refreshHandler),this.refreshHandler=setInterval(this._refreshHandler,e))}}))}},i):i.length>0?(0,e.jsx)("h6",{style:{fontSize:"large"}},o.services[0].name):"")),this.state.isModeExpand&&this.state.selectedService&&this.renderVersionManagement());return this.state.isSimpleMode&&(d=this.state.isModeExpand?i.length>0?(0,e.jsx)("div",{style:{display:"flex",flex:1,flexDirection:"column",margin:0}},(0,e.jsx)("div",{className:"simple-view-header-bgcolor display-flex-row-1 cursor-hand",onClick:e=>{this.setState({isModeExpand:!this.state.isModeExpand})}},(0,e.jsx)("div",{style:{alignItems:"center",display:"flex",paddingLeft:10,paddingRight:10}},this.state.selectedVersion.hasOwnProperty("isLocked")&&this.state.selectedVersion.isLocked?(0,e.jsx)(t.Icon,{icon:L,size:"15",color:s.colors.light}):(0,e.jsx)("div",{style:{width:15,height:15}})),(0,e.jsx)("div",{className:"flex-center",style:{paddingLeft:5,paddingRight:5,fontWeight:"bold",fontSize:"medium"}},this.formatMessage("simplemodeActiveVersion")),(0,e.jsx)("div",{className:"flex-center",style:{fontWeight:"bold",flex:1,paddingLeft:5,paddingRight:5,fontSize:"medium"}}," ",this.state.selectedVersion.versionName),(0,e.jsx)("div",{style:{float:"right"}},(0,e.jsx)(t.Tooltip,{title:this.formatMessage("tooltipsCollapseSimpleMode"),placement:"bottom"},(0,e.jsx)(t.Button,{icon:!0,onClick:e=>{this.setState({isModeExpand:!this.state.isModeExpand})}},(0,e.jsx)(t.Icon,{icon:D,size:"16",color:s.colors.primary}))))),(0,e.jsx)(t.Popper,{open:!!c&&this.state.isModeExpand,floating:!1,keepMount:!0,reference:this.widRefForPopper,placement:"bottom",showArrow:!0,zIndex:2001,modifiers:P},(0,e.jsx)("div",{style:{display:"flex",flexDirection:"row",margin:5}},(0,e.jsx)("div",{style:{display:"flex",flex:1,fontWeight:"bold"}},i.length>1?(0,e.jsx)(t.Select,{value:r,menuProps:T,placeholder:this.formatMessage("placeholderSelectService"),onChange:e=>{this.setState({selectedService:e.currentTarget.value,selectedVersion:"",currentDisplayIndex:0},(()=>{this._filterRuntimeFields(),this.pullVersions(this.state.selectedService,!0)}))}},i):i.length>0?(0,e.jsx)("h6",{style:{fontSize:"large"}},o.services[0].name):this.formatMessage("actionLabelsNoServices"))),this.state.selectedService&&this.renderVersionManagementSimple())):(0,e.jsx)("div",{style:{display:"flex",flex:1,flexDirection:"column",margin:0}},this.formatMessage("actionLabelsNoServices")):i.length>0?(0,e.jsx)("div",{style:{display:"flex",flex:1,flexDirection:"column",margin:0}},(0,e.jsx)("div",{className:"simple-view-header-bgcolor display-flex-row-1 cursor-hand",onClick:e=>{this.setState({isModeExpand:!this.state.isModeExpand})}},(0,e.jsx)("div",{style:{alignItems:"center",display:"flex",paddingLeft:10,paddingRight:10}},this.state.selectedVersion.hasOwnProperty("isLocked")&&this.state.selectedVersion.isLocked?(0,e.jsx)(t.Icon,{icon:L,size:"15",color:s.colors.light}):(0,e.jsx)("div",{style:{width:15,height:15}})),(0,e.jsx)("div",{className:"flex-center",style:{paddingLeft:5,paddingRight:5,fontWeight:"bold",fontSize:"medium"}},""!=this.state.selectedVersion?this.formatMessage("simplemodeActiveVersion"):this.formatMessage("simplemodeLoadingWait")),(0,e.jsx)("div",{className:"flex-center",style:{fontWeight:"bold",flex:1,paddingLeft:5,paddingRight:5,fontSize:"medium"}}," ",this.state.selectedVersion.versionName),(0,e.jsx)("div",{style:{justifyItems:"flex-end",alignItems:"center",display:"flex"}},""!=this.state.selectedVersion?(0,e.jsx)(t.Tooltip,{title:this.formatMessage("tooltipsExpandSimpleMode"),placement:"bottom"},(0,e.jsx)(t.Button,{icon:!0,onClick:e=>{this.setState({isModeExpand:!this.state.isModeExpand})}},(0,e.jsx)(t.Icon,{icon:k,size:"16",color:s.colors.primary}))):""))):(0,e.jsx)("div",{style:{display:"flex",flex:1,flexDirection:"column",margin:0}},this.formatMessage("actionLabelsNoServices"))),d},this.renderVersionManagement=()=>{const{theme:s}=this.props;let i=!0,o=!0,r=!0,n=!0,a=!0;const l=this._getConfigServiceObject();if(null!==l){a=null!==this.getServiceToken(l.url);const e=l.configuredSettings.allowance,t=e.filter((e=>"CreateNew"===e.key));t.length>0&&(o=t[0].enabled),a||(o=!1),r=e.filter((e=>e.key.search(/\bDelete|\bUpdate|\bChange/g)>-1)).some((e=>!0===e.enabled)),a||(r=!1);const s=e.filter((e=>"Switch"===e.key));s.length>0&&(n=s[0].enabled);const c=l.configuredSettings.displayInfo;c.length>0&&(i=c.filter((e=>!0===e.show||!0===e.available)).length>1)}let c=this.state.versionList.length;return 0===c&&""===this.state.searchVersionValue&&(c=1),(0,e.jsx)("div",{style:{display:"flex",flex:1,flexDirection:"column",height:"60%"}},(0,e.jsx)("div",{style:{display:"flex",flexDirection:"row"}},a&&o?this.state.showMgmtTools&&(0,e.jsx)("div",{style:{flex:1,flexDirection:"row"}},(0,e.jsx)(t.Tooltip,{title:this.formatMessage("tooltipsNewVersion"),placement:"bottom"},(0,e.jsx)(t.Button,{icon:!0,onClick:e=>{this.resetVersionObjectData()},type:"primary"},(0,e.jsx)(t.Icon,{icon:b,size:"18",color:s.colors.light})))):"",a&&o&&(0,e.jsx)("div",{style:{width:"1%"}}),(0,e.jsx)("div",{style:{flex:1,flexDirection:"row"}},(0,e.jsx)(t.Tooltip,{title:this.formatMessage("tooltipsRefreshList"),placement:"bottom"},(0,e.jsx)(t.Button,{icon:!0,onClick:()=>{this.pullVersions(this.state.selectedService,!1).then((()=>{""!==this.state.searchVersionValue?this.searchVersions(this.state.searchVersionValue):""!==this.state.sort.field&&this.sortVersions(this.state.sort.field,this.state.sort.direction)}))}},(0,e.jsx)(t.Icon,{icon:y,size:"18",color:s.colors.dark})))),(0,e.jsx)("div",{style:{width:"1%"}}),(0,e.jsx)(t.InputGroup,null,(0,e.jsx)(t.TextInput,{type:"text",placeholder:this.formatMessage("placeholderSearchName"),value:this.state.searchVersionValue,onChange:e=>this.searchVersions(e.currentTarget.value),style:{display:"flex",flex:1}})),i&&(0,e.jsx)("div",{style:{width:"1%"}}),i&&(0,e.jsx)("div",{style:{flex:1,flexDirection:"row"}},(0,e.jsx)(t.Tooltip,{title:this.formatMessage("tooltipsShowHideColumns"),placement:"bottom"},(0,e.jsx)(t.Button,{id:this.props.widgetId+"_btnFieldMgmt",icon:!0,onClick:()=>{this.toggleDialogAction("fieldMgmt","showFieldMgmt")}},(0,e.jsx)(t.Icon,{icon:j,size:"18",color:s.colors.dark}))))),(0,e.jsx)("div",{style:{display:"flex",flex:2,flexDirection:"row",paddingTop:10,height:"60%"}},(0,e.jsx)("div",{style:{display:"flex",flex:1,overflow:"auto"}},(0,e.jsx)(t.Table,null,this._createVersionHeader(r,n),(0,e.jsx)("tbody",null,this.state.filteredVersionList.length>0?this._createVersionRows(r,n):""!==this.state.searchVersionValue?(0,e.jsx)("tr",null,(0,e.jsx)("td",{colSpan:99},this.formatMessage("actionLabelsNoVersions"))):this.state.selectedVersion.hasOwnProperty("versionGuid")?this._createVersionRows(r,n):(0,e.jsx)("tr",null,(0,e.jsx)("td",{colSpan:99})))))),(0,e.jsx)("div",{style:{paddingTop:5,display:"flex",flexDirection:"row",borderTop:"3px solid"+s.colors.secondary}},this.state.filteredVersionList.length>1&&(0,e.jsx)("div",{style:{display:"flex",flex:1,justifyContent:"flex-start"}},(0,e.jsx)(t.Pagination,{className:"mb-3",size:"lg",totalPage:this.state.filteredVersionList.length,current:this.state.currentDisplayIndex+1,onChangePage:e=>{this.setState({currentDisplayIndex:e-1},(()=>{this._checkStatus()}))}})),(0,e.jsx)("div",{style:{display:"flex",flex:1,justifyContent:this.state.filteredVersionList.length>1?"flex-end":"flex-start",fontSize:"small"}},this.formatMessage("placeholderLastUpdated")," ",this.state.timeStamp," ",(0,e.jsx)("br",null)," ",this.formatMessage("placeholderNumberVersions")," ",c.toLocaleString())))},this.renderVersionManagementSimple=()=>{const{theme:s}=this.props;let i=!0;const o=this._getConfigServiceObject();if(null!==o){const e=o.configuredSettings.allowance.filter((e=>"Switch"===e.key));e.length>0&&(i=e[0].enabled)}let r=this.state.versionList.length;return 0===r&&""===this.state.searchVersionValue&&(r=1),(0,e.jsx)("div",{style:{display:"flex",flex:1,flexDirection:"column",marginLeft:5,marginRight:5,marginBottom:5}},(0,e.jsx)("div",{style:{display:"flex",flexDirection:"row"}},(0,e.jsx)("div",{style:{flex:1,flexDirection:"row"}},(0,e.jsx)(t.Tooltip,{title:this.formatMessage("tooltipsRefreshList"),placement:"bottom"},(0,e.jsx)(t.Button,{icon:!0,onClick:()=>{this.pullVersions(this.state.selectedService,!1).then((()=>{""!==this.state.searchVersionValue?this.searchVersions(this.state.searchVersionValue):""!==this.state.sort.field&&this.sortVersions(this.state.sort.field,this.state.sort.direction)}))}},(0,e.jsx)(t.Icon,{icon:y,size:"18",color:s.colors.dark})))),(0,e.jsx)("div",{style:{width:"1%"}}),(0,e.jsx)(t.InputGroup,null,(0,e.jsx)(t.TextInput,{type:"text",placeholder:this.formatMessage("placeholderSearchName"),value:this.state.searchVersionValue,onChange:e=>this.searchVersions(e.currentTarget.value),style:{display:"flex",flex:1}}))),(0,e.jsx)("div",{style:{paddingTop:5,display:"flex",flexDirection:"row"}},(0,e.jsx)("table",{style:{fontSize:"medium",paddingTop:5,width:"100%"}},(0,e.jsx)("tbody",null,this.state.filteredVersionList.length>0?this._createVersionRowsSimple(i):""!==this.state.searchVersionValue?(0,e.jsx)("tr",null,(0,e.jsx)("td",{colSpan:99},this.formatMessage("actionLabelsNoVersions"))):this.state.selectedVersion.hasOwnProperty("versionGuid")?this._createVersionRowsSimple(i):(0,e.jsx)("tr",null,(0,e.jsx)("td",{colSpan:99}))))),(0,e.jsx)("div",{style:{paddingTop:5,display:"flex",flexDirection:"column",borderTop:"3px solid"+s.colors.secondary}},this.state.filteredVersionList.length>1&&(0,e.jsx)("div",{style:{display:"flex",flex:1,justifyContent:"flex-start"}},(0,e.jsx)(t.Pagination,{className:"mb-3",size:"sm",totalPage:this.state.filteredVersionList.length,current:this.state.currentDisplayIndex+1,onChangePage:e=>{this.setState({currentDisplayIndex:e-1},(()=>{this._checkStatus()}))}})),(0,e.jsx)("div",{style:{display:"flex",flex:1,justifyContent:"flex-start",fontSize:"small",flexDirection:"column"}},(0,e.jsx)("div",{style:{display:"flex",flex:1,justifyContent:"flex-start",flexDirection:"column"}},(0,e.jsx)("div",null,this.formatMessage("placeholderLastUpdated")," ",this.state.timeStamp),(0,e.jsx)("div",null,this.formatMessage("placeholderNumberVersionsSimple")," ",r.toLocaleString())))))},this._createVersionHeader=(s,i)=>{const{theme:o}=this.props,r=[];let n=!0;const a=this._getConfigServiceObject();null!==a&&(n=null!==this.getServiceToken(a.url));let l=[...this.state.fieldColumns];return n||(l=l.filter((e=>"versionName"===e.field||"versionOwner"===e.field))),l.sort(this._compare("order","desc")),l.forEach((s=>{s.show&&r.push((0,e.jsx)("th",{key:s.field,style:{position:"sticky",top:0,backgroundColor:o.colors.palette.light[200],border:o.colors.palette.light[300],color:o.colors.dark,fontSize:"medium",whiteSpace:"nowrap",alignItems:"top"}},s.alias,(0,e.jsx)(t.Tooltip,{title:"desc"===s.sort?this.formatMessage("tooltipsSortColumns")+" "+s.alias+" "+this.formatMessage("tooltipsDesc"):this.formatMessage("tooltipsSortColumns")+" "+s.alias+" "+this.formatMessage("tooltipsAsc"),placement:"bottom"},(0,e.jsx)(t.Button,{type:"tertiary",icon:!0,onClick:()=>{this.sortVersions(s.field,"desc"===s.sort?"asc":"desc")}},(0,e.jsx)(t.Icon,{icon:"desc"===s.sort?M:C,size:"15",color:o.colors.dark})))))})),(0,e.jsx)("thead",null,(0,e.jsx)("tr",null,s||i?(0,e.jsx)("th",{style:{position:"sticky",top:0,backgroundColor:o.colors.palette.light[200],border:o.colors.palette.light[300],color:o.colors.dark,fontSize:"medium",alignItems:"top",whiteSpace:"nowrap"}},this.formatMessage("otherheadersManage"),(0,e.jsx)(t.Button,{type:"tertiary",icon:!0})):(0,e.jsx)("th",{style:{position:"sticky",top:0,backgroundColor:o.colors.palette.light[200],border:o.colors.palette.light[300],color:o.colors.dark,fontSize:"medium",alignItems:"top",whiteSpace:"nowrap"}}),r))},this._createActiveRows=s=>{const{theme:i}=this.props,o=[];let r=!0;const n=this._getConfigServiceObject();if(null!==n){const e=this.getServiceToken(n.url);r=null!==e}return this.state.selectedVersion.hasOwnProperty("versionGuid")&&""!==this.state.selectedVersion.versionGuid&&(n=>{if(void 0!==n){const a=n.versionName;o.push((0,e.jsx)("tr",{key:n.versionName,className:"simple-view-header-bgcolor cursor-hand",onClick:e=>{this.setState({isModeExpand:!this.state.isModeExpand})}},(0,e.jsx)("td",{style:{paddingLeft:"1rem"}},(0,e.jsx)("div",{style:{display:"flex",flexDirection:"row",flex:1}},(0,e.jsx)("div",{style:{display:"flex",flexDirection:"row"}},(0,e.jsx)("div",{style:{alignItems:"center",display:"flex"}},n.hasOwnProperty("isLocked")&&n.isLocked?(0,e.jsx)(t.Icon,{icon:L,size:"15",color:i.colors.light}):(0,e.jsx)("div",{style:{width:15,height:15}})),r&&n.hasOwnProperty("isLocked")&&!1===n.isLocked&&s&&"sde.default"!==n.versionName.toLowerCase()?(0,e.jsx)("div",{style:{paddingLeft:5}},(0,e.jsx)(t.Tooltip,{title:this.formatMessage("tooltipsUpdateVersionInfo"),placement:"bottom"},(0,e.jsx)(t.Button,{icon:!0,onClick:e=>{e.stopPropagation(),this.setState({isModeExpand:!0},(()=>{this.loadExistingVersion(n)}))}},(0,e.jsx)(t.Icon,{icon:O,size:"16",color:i.colors.dark})))):(0,e.jsx)("div",{style:{display:"flex",flex:1,flexDirection:"row",paddingLeft:5}})),(0,e.jsx)("div",{style:{color:i.colors.light,fontSize:"medium",fontWeight:"bold",wordBreak:"break-all",paddingLeft:10,paddingRight:10,flex:1,display:"flex",alignItems:"center"}},this.formatMessage("simplemodeActiveVersion")," ",a),(0,e.jsx)("div",{style:{justifyItems:"flex-end",alignItems:"center",display:"flex"}},""!=this.state.selectedVersion?(0,e.jsx)(t.Tooltip,{title:this.formatMessage("tooltipsExpandSimpleMode"),placement:"bottom"},(0,e.jsx)(t.Button,{icon:!0,onClick:e=>{this.toggleExpandAction()}},(0,e.jsx)(t.Icon,{icon:this.state.isModeExpand?D:k,size:"16",color:i.colors.primary}))):"")))))}})(this.state.selectedVersion),o},this._createVersionRows=(s,i)=>{const{theme:o}=this.props,r=[];let n=!0;const a=this._getConfigServiceObject();if(null!==a){const e=this.getServiceToken(a.url);n=null!==e}const l=a=>{if(void 0!==a){const l=a.versionGuid===this.state.selectedVersion.versionGuid,c=[];let h=[...this.state.fieldColumns];n||(h=h.filter((e=>"versionName"===e.field||"versionOwner"===e.field))),h.sort(this._compare("order","desc")),h.forEach(((t,s)=>{if(t.show)if("versionName"===t.field){const t=a.versionName.substring(a.versionName.lastIndexOf(".")+1,a.versionName.length);c.push((0,e.jsx)("td",{key:t+s,className:l?"color-primary-small-font td-middle":"color-dark-small-font td-middle",style:{fontSize:"medium",wordBreak:"break-all"}},t))}else if("versionOwner"===t.field){const t=a.versionName.substring(0,a.versionName.lastIndexOf("."));c.push((0,e.jsx)("td",{key:t+s,className:l?"color-primary-small-font td-middle":"color-dark-small-font td-middle",style:{fontSize:"medium"}},t))}else if(t.field.indexOf("Date")>-1){const i=new Date(a[t.field]).toLocaleString();c.push((0,e.jsx)("td",{key:i.toLocaleString()+s,className:l?"color-primary-small-font td-middle":"color-dark-small-font td-middle",style:{fontSize:"medium"}},i.toLocaleString()))}else c.push((0,e.jsx)("td",{key:t.field+s,className:l?"color-primary-small-font td-middle":"color-dark-small-font td-middle",style:{fontSize:"medium"}},a[t.field]))})),r.push((0,e.jsx)("tr",{key:a.versionName},(0,e.jsx)("td",{style:{fontSize:"medium",verticalAlign:"middle"}},(0,e.jsx)("div",{style:{display:"flex",flexDirection:"row"}},(0,e.jsx)("div",{style:{alignItems:"center",display:"flex"}},a.hasOwnProperty("isLocked")&&a.isLocked?(0,e.jsx)(t.Icon,{icon:L,size:"15",color:o.colors.dark}):(0,e.jsx)("div",{style:{width:15,height:15}})),i?(0,e.jsx)("div",{style:{display:"flex",flexDirection:"row",paddingLeft:5}},(0,e.jsx)(t.Tooltip,{title:l?this.formatMessage("tooltipsCurrentVersion"):this.formatMessage("tooltipsSwitchVersion"),placement:"bottom"},l?(0,e.jsx)(t.Button,{icon:!0,disabled:!1},(0,e.jsx)(t.Icon,{icon:I,size:"16",color:l?o.colors.primary:o.colors.light})):(0,e.jsx)(t.Button,{icon:!0,onClick:()=>{this.switchVersion(a)}},(0,e.jsx)(t.Icon,{icon:N,size:"16",color:o.colors.palette.primary[200]})))):"",a.hasOwnProperty("isLocked")&&!1===a.isLocked&&n&&s&&"sde.default"!==a.versionName.toLowerCase()&&(0,e.jsx)("div",{style:{display:"flex",flex:1,flexDirection:"row",paddingLeft:5}},(0,e.jsx)(t.Tooltip,{title:this.formatMessage("tooltipsUpdateVersionInfo"),placement:"bottom"},(0,e.jsx)(t.Button,{icon:!0,onClick:()=>{this.loadExistingVersion(a)}},(0,e.jsx)(t.Icon,{icon:O,size:"16",color:o.colors.dark})))))),c))}};return this.state.filteredVersionList.length>0&&this.state.filteredVersionList[this.state.currentDisplayIndex].forEach((e=>{this.state.selectedVersion.hasOwnProperty("versionGuid")&&l(e)})),r},this._createVersionRowsSimple=s=>{const{theme:i}=this.props,o=[],r=s=>{let r=!1;s.versionGuid===this.state.selectedVersion.versionGuid&&(r=!0);const n=[],a=[...this.state.fieldColumns];a.sort(this._compare("order","desc")),a.forEach(((t,o)=>{t.show&&"versionName"===t.field&&(r?n.push((0,e.jsx)("td",{key:s.versionGuid,style:{width:"100%",color:i.colors.primary,fontWeight:"bold",wordBreak:"break-all"}},s.versionName)):n.push((0,e.jsx)("td",{key:s.versionGuid,style:{width:"100%",wordBreak:"break-all"}},s.versionName)))})),o.push((0,e.jsx)("tr",{key:s.versionName},(0,e.jsx)("td",{style:{paddingTop:3,paddingBottom:3}},(0,e.jsx)(t.Tooltip,{title:r?this.formatMessage("tooltipsCurrentVersion"):this.formatMessage("tooltipsSwitchVersion"),placement:"bottom"},(0,e.jsx)(t.Button,{icon:!0,onClick:()=>{this.switchVersion(s)}},(0,e.jsx)(t.Icon,{icon:r?I:N,size:"16",color:r?i.colors.primary:i.colors.palette.primary[200]})))),(0,e.jsx)("td",{width:"1%"}),(0,e.jsx)("td",null,s.hasOwnProperty("isLocked")&&s.isLocked?(0,e.jsx)(t.Icon,{icon:L,size:"15",color:i.colors.dark}):(0,e.jsx)("div",{style:{width:15,height:15}})),(0,e.jsx)("td",{width:"1%"}),n))};return this.state.filteredVersionList.length>0&&this.state.filteredVersionList[this.state.currentDisplayIndex].forEach((e=>{this.state.selectedVersion.hasOwnProperty("versionGuid")&&r(e)})),o},this.renderVersionModification=()=>{let s=!0,i=!0,o=!0,r=!0,n=!0,a=!0,l=null;const c=this._getConfigServiceObject();if(null!==c&&""!==this.state.selectedService){const e=c.configuredSettings.allowance,t=e.filter((e=>"DeleteExisting"===e.key));t.length>0&&(s=t[0].enabled);const h=e.filter((e=>"Switch"===e.key));h.length>0&&(i=h[0].enabled);const d=e.filter((e=>"UpdateName"===e.key));d.length>0&&(o=d[0].enabled);const u=e.filter((e=>"UpdateDescription"===e.key));u.length>0&&(r=u[0].enabled);const f=e.filter((e=>"ChangePrivileges"===e.key));f.length>0&&(n=f[0].enabled);const p=e.filter((e=>"ChangeOwner"===e.key));p.length>0&&(a=p[0].enabled),c.hasOwnProperty("url")&&(l=this.getSessionUserName(c.url))}return(0,e.jsx)("div",{style:{flex:1,flexDirection:"column",display:"flex",margin:5,height:"98%"}},(0,e.jsx)(t.Alert,{form:"basic",type:"warning",className:"w-100 m-2",open:this.state.showCreationAlert,text:this.state.creationAlertMsg}),(0,e.jsx)("div",{style:{display:"flex",flexDirection:"row"}},(0,e.jsx)("div",{style:{flex:1,fontWeight:"bold",fontSize:"large"}},"create"!==this.state.versionAction?this.formatMessage("otherheadersManageVersion"):this.formatMessage("otherheadersNewVersion")),(0,e.jsx)("div",{style:{flex:3}},(0,e.jsx)(t.Tooltip,{title:this.formatMessage("tooltipsCharLimit62"),placement:"bottom"},(0,e.jsx)(t.TextArea,{maxLength:62,className:"mb-3",placeholder:this.formatMessage("placeholderVersionNameText"),disabled:"create"!==this.state.versionAction&&!o,defaultValue:this.state.versionObject.versionName,onAcceptValue:e=>{""!==e?(this.manageNewVersionData(e,"versionName"),this.setState({creationAlertMsg:"",showCreationAlert:!1,disableSave:!1})):this.setState({invalidVersionName:!0,creationAlertMsg:this.formatMessage("actionLabelsNameNotBlank"),showCreationAlert:!0,disableSave:!0})}})))),(0,e.jsx)("div",{style:{display:"flex",flexDirection:"column"}},(0,e.jsx)("h6",{style:{fontWeight:"bold",fontSize:"large"}},this.formatMessage("versionmanagementDescription")),(0,e.jsx)(t.Tooltip,{title:this.formatMessage("tooltipsCharLimit64"),placement:"bottom"},(0,e.jsx)(t.TextArea,{maxLength:64,className:"mb-3",placeholder:this.formatMessage("placeholderVersionDescriptionText"),disabled:"create"!==this.state.versionAction&&!r,value:this.state.versionObject.versionDescription,onChange:e=>{this.manageNewVersionData(e.target.value,"versionDescription")}}))),(0,e.jsx)("div",{style:{display:"flex",flexDirection:"row"}},(0,e.jsx)("div",{style:{display:"flex",flexDirection:"column",flex:1.5}},(0,e.jsx)("h6",{style:{fontWeight:"bold",fontSize:"large"}},this.formatMessage("versionmanagementAccessPrivileges")),(0,e.jsx)(t.FormGroup,{tag:"fieldset",row:!0,style:{fontSize:"medium"}},(0,e.jsx)(t.Col,{sm:10},(0,e.jsx)(t.FormGroup,{check:!0},(0,e.jsx)(t.Label,{check:!0},(0,e.jsx)(t.Input,{type:"radio",name:"sharePublic",value:"public",disabled:!n,checked:"public"===this.state.versionObject.versionScope,onChange:e=>{this.manageNewVersionData(e.target.value,"versionScope")}})," ",this.formatMessage("versionmanagementPublicAccess"))),(0,e.jsx)(t.FormGroup,{check:!0},(0,e.jsx)(t.Label,{check:!0},(0,e.jsx)(t.Input,{type:"radio",name:"sharePublic",value:"protected",disabled:!n,checked:"protected"===this.state.versionObject.versionScope,onChange:e=>{this.manageNewVersionData(e.target.value,"versionScope")}})," ",this.formatMessage("versionmanagementProtectedAccess"))),(0,e.jsx)(t.FormGroup,{check:!0},(0,e.jsx)(t.Label,{check:!0},(0,e.jsx)(t.Input,{type:"radio",name:"sharePrivate",value:"private",disabled:!n,checked:"private"===this.state.versionObject.versionScope,onChange:e=>{this.manageNewVersionData(e.target.value,"versionScope")}})," ",this.formatMessage("versionmanagementPrivateAccess"))))),(0,e.jsx)("div",{style:{display:"flex",flexDirection:"row",paddingTop:10}},(0,e.jsx)("div",{style:{display:"flex",flex:1,flexDirection:"column"}},(0,e.jsx)("h6",{style:{fontWeight:"bold",fontSize:"large"}},this.formatMessage("versionmanagementActivateVersion")),(0,e.jsx)("div",{style:{display:"flex",flex:1,flexDirection:"row"}},(0,e.jsx)("div",{style:{fontSize:"medium"}},this.formatMessage("versionmanagementNo")),(0,e.jsx)("div",{style:{paddingLeft:5,paddingRight:5,paddingTop:5}},(0,e.jsx)(t.Label,{check:!0},(0,e.jsx)(t.Switch,{checked:this.state.autoSwitchVersion,disabled:!i,onChange:e=>{this.toggleAutoSwitch()}}))),(0,e.jsx)("div",{style:{fontSize:"medium"}},this.formatMessage("versionmanagementYes")))))),(0,e.jsx)("div",{style:{display:"flex",flexDirection:"column",flex:1}},(0,e.jsx)(t.FormGroup,null,(0,e.jsx)("h6",{style:{fontWeight:"bold",fontSize:"large"}},this.formatMessage("versionmanagementChangeOwner")),(0,e.jsx)("h6",{style:{fontWeight:"bold",fontSize:"medium"}},this.formatMessage("versionmanagementCurrentOwner"),""!==this.state.versionOwnerSnapshot?this.state.versionOwnerSnapshot:null!==l?l:this.props.user.username),(0,e.jsx)(t.InputGroup,null,(0,e.jsx)(t.TextInput,{type:"text",style:{width:"100%"},placeholder:this.formatMessage("placeholderSearchOwner"),disabled:!a,value:this.state.userSearchValue,onChange:e=>{this.searchPortaluser(e.currentTarget.value)}})),this.searchUserResultList()))),(0,e.jsx)("div",{style:{display:"flex",flex:1,flexDirection:"row",paddingTop:10}},(0,e.jsx)("div",{style:{display:"flex",flex:1,justifyContent:"flex-start",alignItems:"flex-end",padding:15}},(0,e.jsx)(t.Button,{type:"secondary",style:{fontSize:"medium",fontWeight:"bold"},onClick:e=>{this.toggleCreationModel(!0)}},this.formatMessage("buttonsCancel"))),(0,e.jsx)("div",{style:{display:"flex",flex:1,justifyContent:"flex-end",alignItems:"flex-end"}},(0,e.jsx)("div",{style:{display:"flex",flex:1,flexDirection:"row",justifyContent:"flex-end",alignItems:"flex-end",padding:15}},(0,e.jsx)(t.Button,{type:"primary",style:{fontSize:"medium",fontWeight:"bold"},disabled:this.state.invalidVersionName?this.state.invalidVersionName:this.state.disableSave,onClick:()=>{(new Date).getTime()-this.delayClickPrevent>500&&this.setState({disableSave:!0},(()=>{"create"===this.state.versionAction?this.createVersion():this.updateVersion()})),this.delayClickPrevent=(new Date).getTime()}},this.formatMessage("buttonsSave"))," ","create"!==this.state.versionAction&&s?(0,e.jsx)("div",{style:{width:"2%"}}):"","create"!==this.state.versionAction&&s?(0,e.jsx)(t.Button,{type:"secondary",style:{fontSize:"medium",fontWeight:"bold"},disabled:this.state.invalidVersionName,onClick:()=>{this.setState({showDeleteModal:!0})}},this.formatMessage("buttonsDelete")):""))))},this.renderFieldList=()=>{let s=!0;const i=this._getConfigServiceObject();null!==i&&(s=null!==this.getServiceToken(i.url));const{theme:o}=this.props,r=[];let n=[...this.state.fieldColumns];s||(n=n.filter((e=>"versionName"===e.field||"versionOwner"===e.field)));const a=(()=>{let e=!1;return n.filter((e=>!0===e.show)).length<=1&&(e=!0),e})();return n.sort(this._compare("order","desc")),n.forEach(((s,i)=>{(s.available||s.show)&&r.push((0,e.jsx)("tr",{key:s.field},(0,e.jsx)("td",{style:{fontSize:"medium",paddingLeft:5,paddingRight:5}},s.alias),s.available?(0,e.jsx)("td",null,(0,e.jsx)(t.Tooltip,{title:s.show?this.formatMessage("tooltipsRemoveFromTable"):this.formatMessage("tooltipsAddToTable"),placement:"bottom"},(0,e.jsx)(t.Checkbox,{className:"m-3",checked:s.show,disabled:!!s.show&&a,onChange:e=>{this.changeFieldVisible(e,i)}}))):(0,e.jsx)("td",null,(0,e.jsx)(t.Tooltip,{title:this.formatMessage("tooltipsNotAvailableField"),placement:"bottom"},(0,e.jsx)(t.Checkbox,{className:"m-3",checked:s.show,disabled:!0}))),(0,e.jsx)("td",{style:{paddingLeft:5,paddingRight:5}},(0,e.jsx)("div",{style:{display:"flex",flexDirection:"row"}},i>0?(0,e.jsx)(t.Tooltip,{title:this.formatMessage("tooltipsMoveColumnUp"),placement:"bottom"},(0,e.jsx)(t.Button,{icon:!0,type:"tertiary",size:"sm",onClick:()=>{this.changeFieldOrder("up",i)}},(0,e.jsx)(t.Icon,{icon:D,size:"16",color:"#333"}))):(0,e.jsx)(t.Button,{icon:!0,type:"tertiary",size:"sm"}),i<n.length-1?(0,e.jsx)(t.Tooltip,{title:this.formatMessage("tooltipsMoveColumnDown"),placement:"bottom"},(0,e.jsx)(t.Button,{icon:!0,type:"tertiary",size:"sm",onClick:()=>{this.changeFieldOrder("down",i)}},(0,e.jsx)(t.Icon,{icon:k,size:"16",color:"#333"}))):(0,e.jsx)(t.Button,{icon:!0,type:"tertiary",size:"sm"})))))})),(0,e.jsx)("table",{style:{}},(0,e.jsx)("thead",null,(0,e.jsx)("tr",null,(0,e.jsx)("th",{style:{fontSize:"medium",position:"sticky",top:0,backgroundColor:o.colors.primary,zIndex:999,color:o.colors.light,padding:7}},this.formatMessage("otherheadersColumnHeader")),(0,e.jsx)("th",{style:{fontSize:"medium",position:"sticky",top:0,backgroundColor:o.colors.primary,zIndex:999,color:o.colors.light,padding:7}},this.formatMessage("otherheadersVisibleHeader")),(0,e.jsx)("th",{style:{fontSize:"medium",textAlign:"right",position:"sticky",top:0,backgroundColor:o.colors.primary,zIndex:999,color:o.colors.light,padding:7}},this.formatMessage("otherheadersOrderHeader")))),(0,e.jsx)("tbody",null,r))},this.pullVersions=(e,t)=>new Promise(((e,s)=>{const i=this._getConfigServiceObject();let o=null,r=null;const n=this.state.currentDisplayIndex;if(null!==i){let s=this.getServiceToken(i.url);null===s&&(s=void 0),this.vms.getVersions(i.name,i.url,s).then((s=>{if(s.hasOwnProperty("success")){if(s.success&&s.hasOwnProperty("versions")){const a=s.versions;if(""!==this.state.selectedVersion&&this.state.selectedVersion.hasOwnProperty("versionGuid")&&""!==this.state.selectedVersion.versionGuid){const e=a.findIndex((e=>e.versionGuid===this.state.selectedVersion.versionGuid));if(e>-1)o=a[e];else{const e=this.state.versionList.filter((e=>e.versionName.toLowerCase()===this.defaultVersion.toLowerCase()));e.length>0&&(o=e[0],this.switchVersion(e[0]))}}const l=this._getCurrentTime();r=null!==o?{versionList:a,showMgmtTools:s.canManage,currentDisplayIndex:0,timeStamp:l,selectedVersion:o}:{versionList:a,showMgmtTools:s.canManage,currentDisplayIndex:0,timeStamp:l},this.setState(r,(()=>{const s=this.chunkVersions(this.state.versionList);let o=0;0!==n&&(o=s.length-1>n?n:s.length-1),this.setState({filteredVersionList:s,currentDisplayIndex:o},(()=>{if(t){const t=this.state.versionList.filter((e=>""!==this.state.urlStartUpVersion?e.versionName===this.state.urlStartUpVersion:e.versionGuid===i.configuredSettings.persistVersion));if(t.length>0)this.switchVersion(t[0]);else{const e=this.state.versionList.filter((e=>e.versionGuid===i.configuredSettings.startupVersion));if(e.length>0)this.switchVersion(e[0]);else{const e=this.state.versionList.filter((e=>e.versionName.toLowerCase()===this.defaultVersion.toLowerCase()));e.length>0?this.switchVersion(e[0]):this.switchVersion({versionName:this.defaultVersion,versionGuid:null})}}this._checkStatus(),e(!0)}else this._checkStatus(),e(!0)}))}))}}else s.hasOwnProperty("error")?(this.setState({versionList:[],filteredVersionList:[],showMgmtTools:!1}),e(!1)):e(!0)}))}})),this._checkStatus=()=>{this._getVersionStatus().then((e=>{this._mergeStatus(e)}))},this._getVersionStatus=()=>new Promise(((e,t)=>{if(this.state.filteredVersionList.length>0){const t=this._getConfigServiceObject();if(null!==t){let s=this.getServiceToken(t.url);null===s&&(s=void 0);const i=[],o=this.state.filteredVersionList[this.state.currentDisplayIndex].map((e=>w(this,void 0,void 0,(function*(){yield this.vms.getVersionState(e,s,this.state.selectedService,t.url).then((e=>{e.hasOwnProperty("versionName")&&i.push(e)}))}))));this.state.selectedVersion.hasOwnProperty("versionGuid")&&null!==this.state.selectedVersion.versionGuid&&o.push(this.vms.getVersionState(this.state.selectedVersion,s,this.state.selectedService,t.url).then((e=>{e.hasOwnProperty("versionName")&&i.push(e)}))),Promise.all(o).then((t=>{e(i)}))}}else e([])})),this._mergeStatus=e=>{if(this.state.filteredVersionList.length>0){const t=[...this.state.filteredVersionList];if(t[this.state.currentDisplayIndex].forEach((t=>{const s=e.filter((e=>e.versionGuid===t.versionGuid));s.length>0&&(t.isLocked=s[0].isLocked)})),this.state.selectedVersion.hasOwnProperty("versionGuid")&&null!==this.state.selectedVersion.versionGuid){const s=Object.assign({},this.state.selectedVersion),i=e.filter((e=>e.versionGuid===s.versionGuid));i.length>0&&(s.isLocked=i[0].isLocked),this.setState({filteredVersionList:t,selectedVersion:s})}else this.setState({filteredVersionList:t})}},this.switchVersion=t=>w(this,void 0,void 0,(function*(){const s=[],i=this.state.vmsServices.filter((e=>e.name===this.state.selectedService));if(i.length>0)for(const t in this.state.dsList)if(this.state.dsList[t].hasOwnProperty("_url")&&this.state.dsList[t]._url){const e=decodeURI(this.state.dsList[t]._url),o=decodeURI(i[0].url);e.includes(o)&&(s[t]=this.state.dsList[t])}else this.state.dsList[t].type===e.DataSourceTypes.FeatureService&&(s[t]=this.state.dsList[t]),this.state.dsList[t].type===e.DataSourceTypes.MapService&&(s[t]=this.state.dsList[t]);if(i.length>0){this.vms.changeGDBVersion(t.versionName,s);const o=e.Immutable.asMutable((0,e.Immutable)(this.state.configObj),{deep:!0});o.services.forEach((e=>{i[0].name===e.name&&(e.configuredSettings.persistVersion=t.versionGuid)})),this.setState({selectedVersion:t,selectedVersionInfo:t,configObj:o},(()=>{this.pullVersions(this.state.selectedService,!1).then((e=>{""!==this.state.searchVersionValue&&this.searchVersions(this.state.searchVersionValue),""!==this.state.sort.field&&this.sortVersions(this.state.sort.field,this.state.sort.direction)}))}))}})),this.createVersion=()=>{const t=this._getConfigServiceObject();if(null!==t)if(""!==this.state.versionObject.versionName){let s=this.getServiceToken(t.url);const i=this.getSessionUserName(t.url);null===s&&(s=void 0),this.setState({showCreationAlert:!1,creationAlertMsg:"",disableSave:!1},(()=>{this.vms.createGDBVersion(this.state.versionObject,s,this.state.dsList,this.state.selectedService,t.url,this.state.autoSwitchVersion).then((t=>w(this,void 0,void 0,(function*(){if(t.success)if(this.state.versionObject.versionOwner.toLowerCase()!==i.toLowerCase())if(""===this.state.versionObject.versionOwner)if(yield this.pullVersions(this.state.selectedService,!1),this.state.autoSwitchVersion){const s=e.Immutable.asMutable((0,e.Immutable)(this.state.configObj),{deep:!0});s.services.forEach((e=>{this.state.selectedService===e.name&&(e.configuredSettings.persistVersion=t.versionInfo.versionGuid)})),this.setState({showVersionSettingsModal:!1,selectedVersion:t.versionInfo,selectedVersionInfo:t.versionInfo,autoSwitchVersion:!1,configObj:s},(()=>w(this,void 0,void 0,(function*(){yield this.pullVersions(this.state.selectedService,!1),""!==this.state.searchVersionValue?this.searchVersions(this.state.searchVersionValue):""!==this.state.sort.field&&this.sortVersions(this.state.sort.field,this.state.sort.direction)}))))}else this.setState({showVersionSettingsModal:!1,autoSwitchVersion:!1},(()=>{""!==this.state.searchVersionValue?this.searchVersions(this.state.searchVersionValue):""!==this.state.sort.field&&this.sortVersions(this.state.sort.field,this.state.sort.direction)}));else{const e=Object.assign({},this.state.versionObject);e.versionGuid=t.versionInfo.versionGuid,this.state.autoSwitchVersion,this.setState({versionObject:e},(()=>w(this,void 0,void 0,(function*(){this.updateVersion()}))))}else if(yield this.pullVersions(this.state.selectedService,!1),this.state.autoSwitchVersion){const s=e.Immutable.asMutable((0,e.Immutable)(this.state.configObj),{deep:!0});s.services.forEach((e=>{this.state.selectedService===e.name&&(e.configuredSettings.persistVersion=t.versionInfo.versionGuid)})),this.setState({showVersionSettingsModal:!1,selectedVersion:t.versionInfo,selectedVersionInfo:t.versionInfo,autoSwitchVersion:!1,configObj:s},(()=>{""!==this.state.searchVersionValue?this.searchVersions(this.state.searchVersionValue):""!==this.state.sort.field&&this.sortVersions(this.state.sort.field,this.state.sort.direction)}))}else this.setState({showVersionSettingsModal:!1,autoSwitchVersion:!1},(()=>{""!==this.state.searchVersionValue?this.searchVersions(this.state.searchVersionValue):""!==this.state.sort.field&&this.sortVersions(this.state.sort.field,this.state.sort.direction)}));else t.hasOwnProperty("response")?this.setState({showCreationAlert:!0,creationAlertMsg:t.response.error.message}):this.setState({showCreationAlert:!0,creationAlertMsg:t.error.message})}))))}))}else this.setState({showCreationAlert:!0,creationAlertMsg:this.formatMessage("actionLabelsNameNotBlank")})},this.deleteVersion=()=>{const t=this._getConfigServiceObject();if(null!==t){let s=this.getServiceToken(t.url);null===s&&(s=void 0),this.vms.deleteGDBVersion(this.state.versionObject.version,s,this.state.dsList,this.state.selectedService,t.url).then((t=>w(this,void 0,void 0,(function*(){if(t.success)if(yield this.pullVersions(this.state.selectedService,!1),this.state.versionObject.versionGuid===this.state.selectedVersion.versionGuid){const t=this.state.versionList.filter((e=>e.versionName.toLowerCase()===this.defaultVersion.toLowerCase()));if(t.length>0){const s=e.Immutable.asMutable((0,e.Immutable)(this.state.configObj),{deep:!0});s.services.forEach((e=>{this.state.selectedService===e.name&&(e.configuredSettings.persistVersion=t[0].versionGuid)})),this.setState({showDeleteModal:!1,showDeleteAlert:!1,deleteAlertMsg:"",selectedVersion:t.length>0?t[0]:this.defaultVersion,selectedVersionInfo:t.length>0?t[0]:"",showVersionSettingsModal:!1,configObj:s},(()=>{""!==this.state.searchVersionValue?this.searchVersions(this.state.searchVersionValue):""!==this.state.sort.field&&this.sortVersions(this.state.sort.field,this.state.sort.direction)}))}else this.setState({showDeleteModal:!1,showDeleteAlert:!1,deleteAlertMsg:"",showVersionSettingsModal:!1},(()=>{""!==this.state.searchVersionValue?this.searchVersions(this.state.searchVersionValue):""!==this.state.sort.field&&this.sortVersions(this.state.sort.field,this.state.sort.direction)}))}else this.setState({showDeleteModal:!1,showDeleteAlert:!1,deleteAlertMsg:"",showVersionSettingsModal:!1},(()=>{""!==this.state.searchVersionValue?this.searchVersions(this.state.searchVersionValue):""!==this.state.sort.field&&this.sortVersions(this.state.sort.field,this.state.sort.direction)}));else this.setState({showDeleteAlert:!0,deleteAlertMsg:t.hasOwnProperty("error")?t.error.message:t.message})}))))}},this.updateVersion=()=>{const t=this._getConfigServiceObject();if(null!==t)if(""!==this.state.versionObject.versionName){let s=this.getServiceToken(t.url);null===s&&(s=void 0),this.setState({showCreationAlert:!1,creationAlertMsg:"",disableSave:!1},(()=>{this.vms.alterGDBVersion(this.state.versionObject,s,this.state.dsList,this.state.selectedService,t.url,this.state.autoSwitchVersion).then((t=>w(this,void 0,void 0,(function*(){if(t.success){yield this.pullVersions(this.state.selectedService,!1);const t=this.state.versionList.filter((e=>e.versionGuid===this.state.versionObject.versionGuid));if(t.length>0)if(this.state.autoSwitchVersion){const s=e.Immutable.asMutable((0,e.Immutable)(this.state.configObj),{deep:!0});s.services.forEach((e=>{this.state.selectedService===e.name&&(e.configuredSettings.persistVersion=t[0].versionGuid)})),this.setState({showVersionSettingsModal:!1,versionAction:"create",userSearchValue:"",configObj:s,autoSwitchVersion:!1,selectedVersion:t[0],selectedVersionInfo:t[0]},(()=>w(this,void 0,void 0,(function*(){yield this.pullVersions(this.state.selectedService,!1),""!==this.state.searchVersionValue?this.searchVersions(this.state.searchVersionValue):""!==this.state.sort.field&&this.sortVersions(this.state.sort.field,this.state.sort.direction)}))))}else if(t[0].versionName.toLowerCase()===this.state.selectedVersion.versionName.toLowerCase()){const t=this.state.versionList.filter((e=>e.versionName.toLowerCase()===this.defaultVersion.toLowerCase()));t.length>0&&(e.Immutable.asMutable((0,e.Immutable)(this.state.configObj),{deep:!0}).services.forEach((e=>{this.state.selectedService===e.name&&(e.configuredSettings.persistVersion=t[0].versionGuid)})),this.setState({showVersionSettingsModal:!1,versionAction:"create",userSearchValue:"",autoSwitchVersion:!1,selectedVersion:t[0],selectedVersionInfo:t[0]},(()=>{this.switchVersion(this.state.selectedVersion),""!==this.state.searchVersionValue?this.searchVersions(this.state.searchVersionValue):""!==this.state.sort.field&&this.sortVersions(this.state.sort.field,this.state.sort.direction)})))}else this.setState({showVersionSettingsModal:!1,versionAction:"create",userSearchValue:"",autoSwitchVersion:!1},(()=>{""!==this.state.searchVersionValue?this.searchVersions(this.state.searchVersionValue):""!==this.state.sort.field&&this.sortVersions(this.state.sort.field,this.state.sort.direction)}));else if(this.state.autoSwitchVersion)e.Immutable.asMutable((0,e.Immutable)(this.state.configObj),{deep:!0}).services.forEach((e=>{this.state.selectedService===e.name&&(e.configuredSettings.persistVersion=this.state.versionObject.versionGuid)})),this.setState({showVersionSettingsModal:!1,showCreationAlert:!1,creationAlertMsg:"",userSearchValue:"",autoSwitchVersion:!1,selectedVersion:this.state.versionObject,selectedVersionInfo:this.state.versionObject},(()=>w(this,void 0,void 0,(function*(){yield this.pullVersions(this.state.selectedService,!1),""!==this.state.searchVersionValue?this.searchVersions(this.state.searchVersionValue):""!==this.state.sort.field&&this.sortVersions(this.state.sort.field,this.state.sort.direction)}))));else{const t=this.state.versionList.filter((e=>e.versionName.toLowerCase()===this.defaultVersion.toLowerCase()));if(t.length>0){const s=e.Immutable.asMutable((0,e.Immutable)(this.state.configObj),{deep:!0});s.services.forEach((e=>{this.state.selectedService===e.name&&(e.configuredSettings.persistVersion=t[0].versionGuid)})),this.setState({showVersionSettingsModal:!1,showCreationAlert:!1,creationAlertMsg:"",userSearchValue:"",selectedVersion:t.length>0?t[0]:this.defaultVersion,selectedVersionInfo:t.length>0?t[0]:"",configObj:s},(()=>w(this,void 0,void 0,(function*(){yield this.pullVersions(this.state.selectedService,!1),""!==this.state.searchVersionValue?this.searchVersions(this.state.searchVersionValue):""!==this.state.sort.field&&this.sortVersions(this.state.sort.field,this.state.sort.direction)}))))}else this.setState({showVersionSettingsModal:!1,showCreationAlert:!1,creationAlertMsg:"",userSearchValue:""})}}else t.hasOwnProperty("response")?this.setState({showCreationAlert:!0,creationAlertMsg:t.response.error.message,userSearchValue:""}):this.setState({showCreationAlert:!0,creationAlertMsg:t.error.message,userSearchValue:""})}))))}))}else this.setState({showCreationAlert:!0,creationAlertMsg:this.formatMessage("actionLabelsNameNotBlank")})},this.searchVersions=e=>{const t=[...this.state.versionList].filter((t=>t.versionName.toLowerCase().indexOf(e.toLowerCase())>=0));""!==this.state.sort.field&&t.sort(this._compare(this.state.sort.field,this.state.sort.direction));const s=this.chunkVersions(t);this.setState({filteredVersionList:s,currentDisplayIndex:0,searchVersionValue:e},(()=>{this._checkStatus()}))},this.loadExistingVersion=e=>{if(e.versionName.toLowerCase()!==this.defaultVersion.toLowerCase()){const t=this.state.versionList.filter((t=>t.versionGuid===e.versionGuid));if(t.length>0){let e=!1;const s=Object.assign({},this.state.versionObject);t[0].versionGuid===this.state.selectedVersion.versionGuid&&(e=!0),s.version=t[0].versionName,s.versionName=t[0].versionName.substring(t[0].versionName.lastIndexOf(".")+1,t[0].versionName.length),s.versionDescription=t[0].description,s.versionScope=t[0].access,s.versionOwner=t[0].versionName.substring(0,t[0].versionName.lastIndexOf(".")),s.versionGuid=t[0].versionGuid,this.setState({versionObject:s,versionOwnerSnapshot:s.versionOwner,autoSwitchVersion:e},(()=>{this.setState({showVersionSettingsModal:!0,versionAction:"edit",userSearchValue:"",portalUsers:[],disableSave:!1,invalidVersionName:!1})}))}else if(e.versionGuid===this.state.selectedVersion.versionGuid){const e=!0,t=Object.assign({},this.state.versionObject);t.version=this.state.selectedVersion.versionName,t.versionName=this.state.selectedVersion.versionName.substring(this.state.selectedVersion.versionName.lastIndexOf(".")+1,this.state.selectedVersion.versionName.length),t.versionDescription=this.state.selectedVersion.description,t.versionScope=this.state.selectedVersion.access,t.versionOwner=this.state.selectedVersion.versionName.substring(0,this.state.selectedVersion.versionName.lastIndexOf(".")),t.versionGuid=this.state.selectedVersion.versionGuid,this.setState({versionObject:t,versionOwnerSnapshot:t.versionOwner,autoSwitchVersion:e},(()=>{this.setState({showVersionSettingsModal:!0,versionAction:"edit",userSearchValue:"",portalUsers:[],disableSave:!1,invalidVersionName:!1})}))}}else this.setState({showUpdateModal:!0})},this.manageNewVersionData=(e,t)=>{const s=Object.assign({},this.state.versionObject);s.hasOwnProperty(t)&&(s[t]=e),"versionOwner"===t?this.setState({versionObject:s,invalidVersionName:!1,userSearchValue:e},(()=>{this.searchPortaluser(e)})):this.setState({versionObject:s,invalidVersionName:!1})},this.resetVersionObjectData=()=>{const e=this._getConfigServiceObject();let t=null;null!==e&&e.hasOwnProperty("url")&&(t=this.getSessionUserName(e.url));const s=Object.assign({},this.state.versionObject);s.versionName="",s.versionDescription="",s.versionScope="public",s.versionOwner=null!==t?t:"",s.versionGuid="",this.setState({versionObject:s,versionAction:"create",versionOwnerSnapshot:null!==t?t:"",userSearchValue:"",portalUsers:[],disableSave:!0},(()=>{this.toggleCreationModel(!1)}))},this.searchPortaluser=t=>{const s=t;let i=this.props.token;const o=this._getConfigServiceObject();null!==o&&(i=this.getServiceToken(o.url));const r=e.urlUtils.getUrlHost(o.url);let n=e.urlUtils.getProtocol(o.url)+"//"+r+"/portal";const a=this.checkPortalIfFederated(r);null!==a&&(n=a.portal,i=a._token),this.vms.searchPortalUsers(n,t,i).then((e=>{if(e.hasOwnProperty("results")){const t=e.results.filter((e=>-1===e.username.indexOf("esri_")));this.setState({userSearchValue:s,portalUsers:t},(()=>{}))}else this.setState({userSearchValue:s,portalUsers:[]})}))},this.searchUserResultList=()=>{const s=[];return this.state.portalUsers.length>0?this.state.portalUsers.forEach((i=>{s.push((0,e.jsx)(t.Button,{key:i.username,type:this.state.versionObject.versionOwner===i.username?"primary":"secondary",onClick:()=>{this.manageNewVersionData(i.username,"versionOwner")}},i.fullName))})):""!==this.state.userSearchValue&&s.push((0,e.jsx)(t.Button,{key:"no_user",type:"secondary"},this.formatMessage("versionmanagementNoUserFound"))),(0,e.jsx)(t.ListGroup,null,s)},this.chunkVersions=e=>{const t=[...e];let s=[];return t.length>0&&(s=this.chunk(t,this.state.maxDisplayRows)),s},this.chunk=(e,t)=>{const s=[],i=t;let o,r;for(o=0,r=e.length;o<r;o+=i)s.push(e.slice(o,o+i));return s},this._filterRuntimeFields=()=>{const t=this._getConfigServiceObject();if(null!==t){const s=e.Immutable.asMutable((0,e.Immutable)(t.configuredSettings.displayInfo),{deep:!0}).filter((e=>!0===e.available||!0===e.show));s.forEach((e=>{for(const t in V)t.toLowerCase()===("fieldColumns"+e.field).toLowerCase()&&(e.alias=this.formatMessage(t))})),this.setState({fieldColumns:s})}},this._getRefreshInterval=()=>{let e=-1;const t=this._getConfigServiceObject();if(null!==t){const s=t.configuredSettings.allowance.filter((e=>"AutoRefreshList"===e.key));s.length>0&&s[0].enabled&&(e=6e4*parseInt(s[0].refreshInterval))}return e},this.sortVersions=(e,t)=>{const s=[...this.state.versionList],i=this.state.currentDisplayIndex;s.sort(this._compare(e,t));const o=this.chunkVersions(s);if(null!==this._getConfigServiceObject()){const s=[...this.state.fieldColumns];s.forEach((s=>{s.sort="desc",e===s.field&&(s.sort=t)}));const r={field:e,direction:t};let n=0;0!==i&&(n=o.length-1>i?i:o.length-1),this.setState({filteredVersionList:o,currentDisplayIndex:n,sort:r,fieldColumns:s},(()=>{""!==this.state.searchVersionValue&&this.searchVersions(this.state.searchVersionValue),this._checkStatus()}))}},this._compare=(e,t)=>function(s,i){let o=0,r=s[e],n=i[e];return"versionOwner"===e?(r=s.versionName.toLowerCase(),n=i.versionName.toLowerCase()):"versionName"===e?(r=r.substring(r.lastIndexOf(".")+1,r.length).toLowerCase(),n=n.substring(n.lastIndexOf(".")+1,n.length).toLowerCase()):(isNaN(r)&&(r=r.toLowerCase()),isNaN(n)&&(n=n.toLowerCase())),"desc"===t?r>n?o=1:r<n&&(o=-1):r<n?o=1:r>n&&(o=-1),o},this._getCurrentTime=()=>(new Date).toLocaleString(),this.changeFieldVisible=(e,t)=>{const s=[...this.state.fieldColumns];s.sort(this._compare("order","desc")),s[t].show=e.currentTarget.checked,this.setState({fieldColumns:s})},this.changeFieldOrder=(e,t)=>{const s=[...this.state.fieldColumns];s.sort(this._compare("order","desc"));let i=t;"up"===e?(i-=1,s[t].order=i,s[t-1].order=t):(i+=1,s[t].order=i,s[t+1].order=t),this.setState({fieldColumns:s})},this.toggleExpandAction=()=>{this.state.isModeExpand?this.setState({isModeExpand:!1}):this.setState({isModeExpand:!0})},this.toggleDialogAction=(e,t)=>{"fieldMgmt"===e&&this.setState({showFieldMgmt:!this.state.showFieldMgmt})},this.toggleCreationModel=e=>{e?this.setState({showVersionSettingsModal:!1,showCreationAlert:!1,creationAlertMsg:"",userSearchValue:"",portalUsers:[],autoSwitchVersion:!1}):this.setState({showVersionSettingsModal:!0,showCreationAlert:!1,creationAlertMsg:"",userSearchValue:"",portalUsers:[],autoSwitchVersion:!1})},this.toggleDeleteModal=e=>{e?this.setState({showDeleteModal:!1,showDeleteAlert:!1}):this.setState({showDeleteModal:!0})},this.toggleUpdateModal=e=>{e?this.setState({showUpdateModal:!1}):this.setState({showUpdateModal:!0})},this.toggleServiceSelectorModal=e=>{e?this.setState({showServiceSelector:!1}):this.setState({showServiceSelector:!0})},this.toggleAutoSwitch=()=>{this.state.autoSwitchVersion?this.setState({autoSwitchVersion:!1}):this.setState({autoSwitchVersion:!0})},this.toggleBackServiceSelector=()=>{this.setState({showServiceSelector:!0})},this._getConfigServiceObject=()=>{let e=null;const t=this.state.configObj;return null!==t&&t.services.forEach((t=>{""!==this.state.selectedService&&this.state.selectedService===t.name&&(e=t)})),e},this.getServiceToken=t=>{const s=e.urlUtils.getUrlHost(t.toLowerCase()),i=e.SessionManager.getInstance().getSessions(),o=i.filter((e=>e.portal.toLowerCase().indexOf(s)>-1));let r=null;return this.props.portalUrl.toLowerCase().includes(s)&&(r=this.props.token),o.length>0?r=o[0].token:null===r&&i.map((e=>{if(e.hasOwnProperty("federatedServers")){for(const t in e.federatedServers)t.toLowerCase().includes(s)&&(r=e.federatedServers[t].token);return!0}if(e.hasOwnProperty("trustedServers")){for(const t in e.trustedServers)t.toLowerCase().includes(s)&&(r=e.trustedServers[t].token);return!0}return!0})),r},this.checkPortalIfFederated=t=>{let s=null;const i=e.SessionManager.getInstance().getSessions(),o=i.filter((e=>e.portal.toLowerCase().indexOf(t)>-1));return o.length>0?s=o[0]:i.map((e=>{if(e.hasOwnProperty("federatedServers")){for(const i in e.federatedServers)if(i.toLowerCase().includes(t))return s=e,!0;return!1}if(e.hasOwnProperty("trustedServers")){for(const i in e.trustedServers)if(i.toLowerCase().includes(t))return s=e,!0;return!1}return!1})),s},this.getSessionUserName=t=>{const s=e.urlUtils.getUrlHost(t.toLowerCase()),i=e.SessionManager.getInstance().getSessions().filter((e=>e.portal.toLowerCase().indexOf(s)>-1));let o=null;return this.props.portalUrl.toLowerCase().includes(s)&&(o=this.props.user.username),i.length>0&&(o=i[0].username),o},this._sizePopperHeight=e=>{let t=null;return t=null!==this._getSizeOfContainer()?this._getSizeOfContainer().height-e:"auto",t},this._sizePopperWidth=e=>{let t=null;return t=null!==this._getSizeOfContainer()?this._getSizeOfContainer().width-e:"auto",t},this.formatMessage=(s,i)=>{const o=Object.assign({},V,t.defaultMessages,e.defaultMessages);return this.props.intl.formatMessage({id:s,defaultMessage:o[s]},i)},this.getStyle=t=>e.css`
      .td-middle {
        vertical-align: middle !important;
      }
      .background-light {
        background-color: ${t.colors.primary};
      }
      .display-flex-column-1 {
        flex: 1;
        flex-direction: column;
        display: flex;
      }
      .display-flex-row-1 {
        flex: 1;
        flex-direction: row;
        display: flex;
      }
      .simple-view-header-bgcolor {
        background: ${t.colors.primary};
        color: ${t.colors.light};
      }
      .overflow-auto {
        overflow: "auto";
      }
      .button-inactive-color {
        background: ${t.colors.secondary};
      }
      .button-active-color {
        background: ${t.colors.primary};
      }
      .icon-inactive-color {
        background: ${t.colors.palette.light[700]};
      }
      .icon-active-color {
        background: ${t.colors.palette.primary[700]};
      }
      .flex-center {
        align-items: center;
        display: flex;
      }
      .padding-left-right-5 {
        padding-left: 5;
        padding-right: 5;
      }
      .color-dark-small-font {
        color: ${t.colors.dark};
        font-family: ${t.typography.fontFamilyBase};
        font-size: ${t.typography.sizes.display6};
      }
      .color-primary-small-font {
        color: ${t.colors.primary};
        font-family: ${t.typography.fontFamilyBase};
        font-size: ${t.typography.sizes.display6};
        font-weight: bold;
      }
      .color-light-small-font {
        color: ${t.colors.light};
        font-family: ${t.typography.fontFamilyBase};
        font-size: ${t.typography.sizes.display6};
      }
      .cursor-hand {
        cursor: pointer;
      }
    `,this.state={isReady:!1,isSimpleMode:!!this.props.config.versionConfig.hasOwnProperty("arrangement")&&"simple"===this.props.config.versionConfig.arrangement,isModeExpand:!this.props.config.versionConfig.hasOwnProperty("expandMode")||this.props.config.versionConfig.expandMode,showMgmtTools:!1,showVersionSettingsModal:!1,showDeleteModal:!1,showUpdateModal:!1,showCreationAlert:!1,showDeleteAlert:!1,showServiceSelector:!1,showFieldMgmt:!1,creationAlertMsg:"",deleteAlertMsg:"",invalidVersionName:!1,disableSave:!1,dsList:[],vmsServices:[],versionList:[],filteredVersionList:[],configObj:e.Immutable.asMutable((0,e.Immutable)(this.props.config.versionConfig),{deep:!0}),selectedService:"",selectedVersion:"sde.DEFAULT",selectedVersionInfo:"",versionAction:"create",versionObject:{versionName:"",versionDescription:"",versionScope:"public",versionOwner:"",versionGuid:""},versionOwnerSnapshot:"",portalUsers:[],userSearchValue:"",searchVersionValue:"",autoSwitchVersion:!1,maxDisplayRows:5,currentDisplayIndex:0,fieldColumns:[],timeStamp:"",sort:{field:"",direction:""},urlStartUpVersion:""}}componentWillMount(){const t=e.Immutable.asMutable((0,e.Immutable)(this.state.configObj),{deep:!0});t.services.forEach((e=>{e.configuredSettings.persistVersion=e.configuredSettings.startupVersion})),this.setState({configObj:t})}componentDidMount(){var t;const{config:s}=this.props;if((null===(t=s.versionConfig)||void 0===t?void 0:t.services.length)>0){const t=(0,e.getAppStore)().getState().queryObject;t&&(null==t?void 0:t.data_version)&&t.data_version.split(",").forEach((e=>{const t=e.split(":");this.setState({urlStartUpVersion:t[1]})}))}}componentWillUnmount(){null!==this.refreshHandler&&clearInterval(this.refreshHandler)}componentDidUpdate(t,s){const{config:i}=this.props;if(window.jimuConfig.isInBuilder&&(this.props.hasOwnProperty("useDataSources")&&this.state.dsList.length<=0&&this._populateSwitchableSources("builder"),i.versionConfig.hasOwnProperty("arrangement")&&t.config.versionConfig.arrangement!==i.versionConfig.arrangement&&("simple"!==i.versionConfig.arrangement?this.setState({isSimpleMode:!1}):this.setState({isSimpleMode:!0})),i.versionConfig.hasOwnProperty("expandMode")&&t.config.versionConfig.expandMode!==i.versionConfig.expandMode&&(i.versionConfig.expandMode?this.setState({isModeExpand:!0}):this.setState({isModeExpand:!1})),i.versionConfig.hasOwnProperty("services")&&t.config.versionConfig.services.length!==i.versionConfig.services.length&&(i.versionConfig.services.length>0?this.setState({configObj:i.versionConfig},(()=>{this.setState({selectedService:i.versionConfig.services[0].name,vmsServices:i.versionConfig.services},(()=>{this._filterRuntimeFields(),this.pullVersions(this.state.selectedService,!1).then((()=>{const e=this.state.versionList.filter((e=>{let t=i.versionConfig.services[0].configuredSettings.startupVersion;return""!==this.state.urlStartUpVersion&&(t=this.state.urlStartUpVersion),e.versionName===t||e.versionGuid===t}));e.length>0&&this.setState({selectedVersion:e[0]})}))}))})):this.setState({configObj:i.versionConfig,selectedService:""})),i.versionConfig.hasOwnProperty("pageCounter")&&t.config.versionConfig.pageCounter!==i.versionConfig.pageCounter&&this.setState({maxDisplayRows:parseInt(i.versionConfig.pageCounter)},(()=>{this.pullVersions(this.state.selectedService,!1)})),i.versionConfig.hasOwnProperty("services")&&i.versionConfig.services.length>0&&""!==this.state.selectedService)){const s=t.config.versionConfig.services.filter((e=>!0===e.activeInBuilder)),o=i.versionConfig.services.filter((e=>!0===e.activeInBuilder));e.lodash.isDeepEqual(t.config.versionConfig.services[0].name,i.versionConfig.services[0].name)||this.forceUpdate(),s.length>0&&o.length>0&&(e.lodash.isDeepEqual(s[0].configuredSettings.displayInfo,o[0].configuredSettings.displayInfo)||this.setState({configObj:i.versionConfig},(()=>{this._filterRuntimeFields()})),e.lodash.isDeepEqual(s[0].configuredSettings.allowance,o[0].configuredSettings.allowance)||this.setState({configObj:i.versionConfig}),e.lodash.isDeepEqual(s[0].configuredSettings.startupVersion,o[0].configuredSettings.startupVersion)||this.pullVersions(this.state.selectedService,!1).then((()=>{const e=this.state.versionList.filter((e=>{let t=o[0].configuredSettings.startupVersion;return""!==this.state.urlStartUpVersion&&(t=this.state.urlStartUpVersion),e.versionName===t||e.versionGuid===t}));e.length>0&&this.setState({selectedVersion:e[0]},(()=>{this.switchVersion(e[0])}))})))}}render(){const{theme:s}=this.props;if(this.props.config.versionConfig.services.length<=0)return(0,e.jsx)(t.WidgetPlaceholder,{icon:A,widgetId:this.props.id,message:this.formatMessage("_widgetLabel")});let i=!0;const o=(0,e.getAppStore)().getState().widgetsRuntimeInfo;return o.hasOwnProperty(this.props.widgetId)&&o[this.props.widgetId].hasOwnProperty("state")&&(i="OPENED"===o[this.props.widgetId].state),(0,e.jsx)("div",{className:"gdb-version-management jimu-widget display-flex-column-1 overflow-auto",style:{backgroundColor:s.surfaces[1].bg,height:"100%",padding:10},css:this.getStyle(this.props.theme)},!1===this.state.isReady&&(0,e.jsx)(e.DataSourceComponent,{useDataSource:this.props.useDataSources&&this.props.useDataSources[0],onDataSourceCreated:()=>{this._populateSwitchableSources("runtime")},widgetId:this.props.id}),this.state.isReady&&!this.state.showVersionSettingsModal&&(0,e.jsx)("div",{id:this.widRefForPopper},this.renderServiceSelector()),this.state.showVersionSettingsModal&&this.renderVersionModification(),(0,e.jsx)(t.Modal,{isOpen:this.state.showDeleteModal},(0,e.jsx)(t.ModalHeader,{toggle:e=>{this.toggleDeleteModal(!0)}},this.formatMessage("modalheaderDeleteVersion")),(0,e.jsx)(t.ModalBody,null,(0,e.jsx)(t.Alert,{form:"basic",type:"warning",className:"w-100",open:this.state.showDeleteAlert,text:this.state.deleteAlertMsg}),this.state.versionObject.hasOwnProperty("version")?this.state.versionObject.version.toLowerCase()!==this.defaultVersion.toLowerCase()?this.formatMessage("actionLabelsDelete")+" "+this.state.versionObject.version+"?":this.formatMessage("actionLabelsCannotDelete"):""),this.state.versionObject.hasOwnProperty("version")&&this.state.versionObject.version.toLowerCase()!==this.defaultVersion.toLowerCase()?(0,e.jsx)(t.ModalFooter,null,(0,e.jsx)(t.Button,{type:"primary",onClick:this.deleteVersion},this.formatMessage("versionmanagementYes"))," ",(0,e.jsx)(t.Button,{type:"secondary",onClick:e=>{this.toggleDeleteModal(!0)}},this.formatMessage("versionmanagementNo"))):""),(0,e.jsx)(t.Modal,{isOpen:this.state.showUpdateModal},(0,e.jsx)(t.ModalHeader,{toggle:e=>{this.toggleUpdateModal(!0)}},this.formatMessage("modalheaderUpdateVersion")),(0,e.jsx)(t.ModalBody,null,(0,e.jsx)(t.Alert,{type:"warning",form:"basic",className:"w-100",text:this.formatMessage("actionLabelsCannotDelete")}))),(0,e.jsx)(t.Popper,{open:!!i&&this.state.showFieldMgmt,floating:!1,reference:this.props.widgetId+"_btnFieldMgmt",placement:"left-start",showArrow:!0,onHeaderClose:()=>{this.toggleDialogAction("fieldMgmt","showFieldMgmt")},zIndex:2001},(0,e.jsx)("div",{style:{width:"100%",height:this.state.fieldColumns.length<5?"auto":this._sizePopperHeight(100),overflow:"auto",fontSize:"medium"}},this.renderFieldList())))}_getSizeOfContainer(){const e=document.querySelector("div.gdb-version-management");return e?e.getBoundingClientRect():null}}})(),r})())}}}));