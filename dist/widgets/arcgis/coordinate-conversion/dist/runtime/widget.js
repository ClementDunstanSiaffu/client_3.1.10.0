System.register(["jimu-core","jimu-ui","jimu-arcgis","jimu-ui/advanced/coordinate-control","esri/widgets/CoordinateConversion/support/Format","esri/rest/locator","esri/geometry/Point","esri/widgets/CoordinateConversion/support/Conversion","esri/widgets/CoordinateConversion/CoordinateConversionViewModel","esri/widgets/CoordinateConversion/support/formatUtils"],(function(t,e){var s={},i={},o={},a={},n={},r={},l={},p={},d={},u={};return{setters:[function(t){s.AppMode=t.AppMode,s.BaseWidget=t.BaseWidget,s.React=t.React,s.UtilityManager=t.UtilityManager,s.css=t.css,s.defaultMessages=t.defaultMessages,s.getAppStore=t.getAppStore,s.jsx=t.jsx,s.lodash=t.lodash},function(t){i.AlertPopup=t.AlertPopup,i.Button=t.Button,i.Checkbox=t.Checkbox,i.Collapse=t.Collapse,i.Icon=t.Icon,i.Label=t.Label,i.Loading=t.Loading,i.LoadingType=t.LoadingType,i.Option=t.Option,i.Popper=t.Popper,i.Row=t.Row,i.Select=t.Select,i.TextArea=t.TextArea,i.TextInput=t.TextInput,i.defaultMessages=t.defaultMessages},function(t){o.JimuMapViewComponent=t.JimuMapViewComponent},function(t){a.CoordinateControl=t.CoordinateControl},function(t){n.default=t.default},function(t){r.default=t.default},function(t){l.default=t.default},function(t){p.default=t.default},function(t){d.default=t.default},function(t){u.default=t.default}],execute:function(){t((()=>{var t={27218:t=>{t.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.938 8A7 7 0 0 1 1.01 9H0a8.001 8.001 0 0 0 15.938-1A8 8 0 0 0 1.02 3.98L1 .702a.5.5 0 1 0-1 .006L.031 5.9l5.128-.826a.5.5 0 0 0-.16-.987L1.819 4.6A7 7 0 0 1 14.938 8Z" fill="#000"></path></svg>'},66549:t=>{t.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M18 14h10.667a2 2 0 1 1 0 4H18v10.667a2 2 0 1 1-4 0V18H3.333a2 2 0 1 1 0-4H14V3.333a2 2 0 1 1 4 0V14z"></path></svg>'},76635:t=>{t.exports='<svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="M7.294 12.695.215 5.307a.79.79 0 0 1 0-1.083c.287-.299.751-.299 1.038 0L8 11.264l6.747-7.04c.287-.299.751-.299 1.038 0a.79.79 0 0 1 0 1.083l-7.08 7.388a.968.968 0 0 1-1.41 0Z" fill="#000"></path><path d="M0 0h16v16H0z"></path></g></svg>'},93321:t=>{t.exports='<svg viewBox="0 0 14 14" xmlns="http://www.w3.org/2000/svg"><g fill-rule="nonzero" fill="none"><path d="m7.745 7 4.1 4.1a.527.527 0 0 1-.745.746L7 7.746l-4.1 4.1a.527.527 0 0 1-.746-.746l4.1-4.1-4.1-4.1a.527.527 0 0 1 .746-.746l4.1 4.1 4.1-4.1a.527.527 0 0 1 .746.746L7.746 7Z" fill="#000"></path><path d="M1 1h12v12H1z"></path></g></svg>'},25541:t=>{t.exports='<svg viewBox="0 0 12 12" xmlns="http://www.w3.org/2000/svg"><path d="M.5 9a.5.5 0 0 1-.5-.5V1a1 1 0 0 1 1-1h6.5a.5.5 0 0 1 0 1H1v7.5a.5.5 0 0 1-.5.5ZM3 3v8h8V3H3Zm0-1h8a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3a1 1 0 0 1 1-1Z" fill="#000" fill-rule="nonzero"></path></svg>'},50361:t=>{t.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.938 8A7 7 0 0 1 1.01 9H0a8.001 8.001 0 0 0 15.938-1A8 8 0 0 0 1.02 3.98L1 .702a.5.5 0 1 0-1 .006L.031 5.9l5.128-.826a.5.5 0 0 0-.16-.987L1.819 4.6A7 7 0 0 1 14.938 8Z" fill="#000"></path></svg>'},13598:t=>{t.exports='<svg viewBox="0 0 12 12" xmlns="http://www.w3.org/2000/svg"><path d="M7.185 0c.105 0 .195.118.232.24l.013.062.245 1.567c.294.145.588.29.85.465l.19.138 1.53-.603c.154-.05.264-.016.332.031l.036.03 1.224 2.11c.051.1.06.201-.01.302l-.05.06-1.286 1.025c.061.181.061.362.061.603 0 .181-.034.328-.052.467l-.01.136 1.409.965c.105.052.12.192.083.307l-.022.055-1.224 2.11c-.053.104-.195.163-.312.14l-.056-.019-1.53-.603a4.796 4.796 0 0 1-.82.494l-.22.109-.245 1.568c0 .103-.135.207-.25.234L7.246 12H4.798c-.157 0-.27-.089-.298-.19l-.253-1.619c-.293-.145-.587-.29-.85-.465l-.19-.138-1.53.603c-.153.05-.264.017-.332-.03l-.036-.03L.085 8.02c-.05-.101-.06-.202.01-.302l.051-.06 1.286-1.026c-.061-.18-.061-.362-.061-.603 0-.18.034-.328.051-.466l.01-.137-1.286-.965c-.104-.103-.164-.25-.14-.329L1.247 1.99c.102-.1.204-.16.342-.141l.087.02 1.469.603.419-.281c.135-.09.268-.17.407-.236l.214-.086.245-1.628c0-.103.135-.207.25-.234L4.738 0h2.448Zm-.658 1h-1.2l-.243 1.627-.586.192a1.42 1.42 0 0 0-.3.154l-.503.335-.441.29-1.439-.593-.59 1.017 1.207.905v.5c0 .088-.003.147-.013.228l-.044.31a.577.577 0 0 0-.004.065l.005.26.005.027.223.66L1.258 8.05l.581 1.001 1.536-.604.45.356c.162.126.334.226.712.416l.618.304.23 1.476h1.274l.23-1.476.751-.371c.206-.106.342-.182.453-.258l.126-.091.451-.356 1.506.595.587-1.01-1.272-.872v-.607l.009-.117.048-.341.003-.035v-.18l-.003-.098-.004-.034-.225-.665 1.345-1.073-.581-1.002-1.535.605-.451-.355-.126-.092a5.312 5.312 0 0 0-.59-.326l-.614-.303L6.527 1ZM6 3.75a2.25 2.25 0 1 1 0 4.5 2.25 2.25 0 0 1 0-4.5Zm0 1a1.25 1.25 0 1 0 0 2.5 1.25 1.25 0 0 0 0-2.5Z" fill="#000" fill-rule="nonzero"></path></svg>'},8294:t=>{"use strict";t.exports=l},50724:t=>{"use strict";t.exports=r},62969:t=>{"use strict";t.exports=d},30476:t=>{"use strict";t.exports=p},69715:t=>{"use strict";t.exports=n},62522:t=>{"use strict";t.exports=u},26826:t=>{"use strict";t.exports=o},48891:t=>{"use strict";t.exports=s},30726:t=>{"use strict";t.exports=i},79429:t=>{"use strict";t.exports=a}},e={};function h(s){var i=e[s];if(void 0!==i)return i.exports;var o=e[s]={exports:{}};return t[s](o,o.exports,h),o.exports}h.d=(t,e)=>{for(var s in e)h.o(e,s)&&!h.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},h.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),h.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},h.p="";var c={};return h.p=window.jimuConfig.baseUrl,(()=>{"use strict";h.r(c),h.d(c,{default:()=>M});var t=h(48891),e=h(30726),s=h(26826);function i(e){const s=e.surfaces[1].bg,i=e.colors.palette.primary[700];return t.css`
     overflow: auto;
    .widget-coordinate-conversion {
      min-width: 135px;
      padding: 15px 10px 10px 15px;
      background-color: ${s};

      .input-container {
        background-color: ${i};
        padding: 5px;
        border-radius: 2px;

        .jimu-widget-setting--row-label {
          font-weight: bold;
          color: var(--white) !important;
         }

        .actionButton {
          color: var(--primary-200);
          &:hover {
            color: var(--white);
          }
          &:disabled {
            color: var(--primary-400);
          }
        }

         .addBtn svg {
           color: ${i};
         }
        }
      }

      .actionButton {
        margin: 2px 0px 0px 2px;
      }

      .actionButton:disabled{
        cursor: default;
      }

      .jimu-widget-setting--row-label {
        font-weight: bold;
      }
    }
  `}const o={_widgetLabel:"Coordinate Conversion",basemap:"Basemap",inputLabel:"Input",coordinateLabel:"Label",addConversion:"Add Conversion",addConversionCheckboxLabel:"Add new conversion at the top of the list",outputSettings:"Output Format Settings",expandOutput:"Expand Output",removeCoordinate:"Remove Coordinate",outputSettingsEditPopupTitle:"Edit Conversion",xLabel:"X",yLabel:"Y",latLabel:"Lat",lonLabel:"Lon",eastingLabel:"Easting",northingLabel:"Northing",zoneLabel:"Zone",bandLabel:"Band",gzdLabel:"GZD",gridSquareLabel:"Grid Sq"},a=h(25541),n=h(13598),r=h(93321),l=h(50361),p=h(76635);class d extends t.React.PureComponent{constructor(s){super(s),this.outputLabel=t.React.createRef(),this._copyOutputTextbox=t.React.createRef(),this._copyDetailsTextbox=t.React.createRef(),this.editTextFocus=t.React.createRef(),this.details1Input=t.React.createRef(),this.details2Input=t.React.createRef(),this.details3Input=t.React.createRef(),this.details4Input=t.React.createRef(),this.componentDidMount=()=>{this.setDetailSection()},this.componentDidUpdate=t=>{t.displayCoordinates!==this.props.displayCoordinates&&this.setDetailSection()},this.nls=t=>{const s=Object.assign({},o,e.defaultMessages);return this.props.intl&&this.props.intl.formatMessage?this.props.intl.formatMessage({id:t,defaultMessage:s[t]}):s[t]},this.onOutputSettingsClick=()=>{this.setState({outputSettingsActive:!this.state.outputSettingsActive},(()=>{setTimeout((()=>{this.editTextFocus.current.focus()}),500)}))},this.onFormatLabelChange=t=>{const e=t.target.value;this.setState({currentOutputFormatLabel:e})},this.onFormatLabelAcceptValue=t=>{this.setState({currentOutputFormatLabel:t.trim()})},this.onFormatChange=t=>{const e=t.target.value;this.setState({outputFormatPattern:e})},this.onFormatAcceptValue=t=>{this.setState({outputFormatPattern:t.trim()})},this.onResetButtonClick=()=>{this.setState({outputFormatPattern:this.props.conversionInfo.format.defaultPattern})},this.onOutputSettingsOkClicked=()=>{("address"===this.props.conversionInfo.format.name||""!==this.state.currentOutputFormatLabel&&""!==this.state.outputFormatPattern)&&this.setState({outputSettingsActive:!1,outputFormatLabel:this.state.currentOutputFormatLabel},(()=>{this.props.onCurrentPatternChange(this.props.index,this.state.outputFormatLabel,this.state.outputFormatPattern)}))},this.onOutputSettingsCancelClicked=()=>{this.setState({outputSettingsActive:!1,outputFormatPattern:this.props.conversionInfo.format.currentPattern,currentOutputFormatLabel:this.props.displayLabel||this.props.conversionInfo.format.name})},this.onExpandClick=()=>{this.setState({isOutputFormatExpanded:!this.state.isOutputFormatExpanded},(()=>{this.props.onOutPutSettingsActive(this.props.index,this.state.isOutputFormatExpanded)}))},this.onRemoveClick=t=>{this.setState({isRemoveFormatActive:!this.state.isRemoveFormatActive}),this.props.onRemove(this.props.index)},this.onCopyButtonClick=()=>{window.getSelection&&window.getSelection().removeAllRanges(),this._copyOutputTextbox.current.select(),document.execCommand("copy"),this.setState({isCopyMessageOpen:!0}),setTimeout((()=>{window.getSelection&&window.getSelection().removeAllRanges(),this.setState({isCopyMessageOpen:!1})}),500)},this.onCoordinateCopyBtnClick=t=>{let e="";switch(t.currentTarget.id){case"refCopyDetails1"+this.props.parentWidgetId+this.props.index:e=this.state.details1Value,this.setState({isDetails1CopyMessageOpen:!0});break;case"refCopyDetails2"+this.props.parentWidgetId+this.props.index:e=this.state.details2Value,this.setState({isDetails2CopyMessageOpen:!0});break;case"refCopyDetails3"+this.props.parentWidgetId+this.props.index:e=this.state.details3Value,this.setState({isDetails3CopyMessageOpen:!0});break;case"refCopyDetails4"+this.props.parentWidgetId+this.props.index:e=this.state.details4Value,this.setState({isDetails4CopyMessageOpen:!0})}this.setState({copyDetailsTextboxValue:e},(()=>{setTimeout((()=>{this._copyDetailsTextbox.current&&(this._copyDetailsTextbox.current.select(),document.execCommand("copy"),this.setState({isDetails1CopyMessageOpen:!1,isDetails2CopyMessageOpen:!1,isDetails3CopyMessageOpen:!1,isDetails4CopyMessageOpen:!1}))}),500)}))},this.setDetailSection=()=>{const t=this.matchSegments();if(t.length>0)switch(this.props.conversionInfo.format.name){case"basemap":this.setState({details1Label:this.nls("xLabel"),details2Label:this.nls("yLabel"),details1Value:t[0],details2Value:t[1]});break;case"xy":this.setState({details1Label:this.nls("lonLabel"),details2Label:this.nls("latLabel"),details1Value:t[0],details2Value:t[1]});break;case"dd":this.setState({details1Label:this.nls("latLabel"),details2Label:this.nls("lonLabel"),details1Value:t[0],details2Value:t[2]});break;case"dms":this.setState({details1Label:this.nls("latLabel"),details2Label:this.nls("lonLabel"),details1Value:t[0]+" "+t[1]+" "+t[2],details2Value:t[4]+" "+t[5]+" "+t[6]});break;case"ddm":this.setState({details1Label:this.nls("latLabel"),details2Label:this.nls("lonLabel"),details1Value:t[0]+" "+t[1],details2Value:t[3]+" "+t[4]});break;case"usng":case"mgrs":this.setState({details1Label:this.nls("gzdLabel"),details2Label:this.nls("gridSquareLabel"),details3Label:this.nls("eastingLabel"),details4Label:this.nls("northingLabel"),details3Visible:!0,details4Visible:!0,details1Value:t[0],details2Value:t[1],details3Value:t[2],details4Value:t[3]});break;case"utm":this.setState({details1Label:this.nls("zoneLabel"),details2Label:this.nls("bandLabel"),details3Label:this.nls("eastingLabel"),details4Label:this.nls("northingLabel"),details3Visible:!0,details4Visible:!0,details1Value:t[0],details2Value:t[1],details3Value:t[2],details4Value:t[3]})}},this.matchSegments=()=>{let t,e;const s=[];if(this.props&&this.props.conversionInfo&&this.props.conversionInfo.position&&this.props.conversionInfo.position.coordinate){t=this.props.conversionInfo.position.coordinate,e=this.props.conversionInfo.format.coordinateSegments;for(let i=0;i<e.length;i++){const o=e[i],a=t.match(o.searchPattern);if(!a){s.push("");continue}let n=a[0];if(t=t.replace(n,"").trim(),o.substitution){const t=o.substitution.output(n);t&&(n=t)}s.push(this.props.isEmpty?"":n)}}return s},this.showDetailsCopyMsg=()=>{let s=0,i=!1;return this.state.isDetails1CopyMessageOpen?(s=1,i=this.state.isDetails1CopyMessageOpen):this.state.isDetails2CopyMessageOpen?(s=2,i=this.state.isDetails2CopyMessageOpen):this.state.isDetails3CopyMessageOpen?(s=3,i=this.state.isDetails3CopyMessageOpen):this.state.isDetails4CopyMessageOpen&&(s=4,i=this.state.isDetails4CopyMessageOpen),(0,t.jsx)(e.Popper,{open:i,version:0,placement:"bottom",showArrow:!0,reference:"refCopyDetails"+s+this.props.parentWidgetId+this.props.index,offset:[0,0]},(0,t.jsx)("div",{className:"p-2"},this.nls("copySuccessMessage")))},this.formatDisplayCoordinate=t=>{var e,s;return this.props.isRTL&&"xy"===(null===(s=null===(e=this.props.conversionInfo)||void 0===e?void 0:e.format)||void 0===s?void 0:s.name)&&t&&"-"===t.charAt(0)?t.substr(1)+t.substr(0,1):t},this.state={outputSettingsActive:!1,isCopyMessageOpen:!1,isDetails1CopyMessageOpen:!1,isDetails2CopyMessageOpen:!1,isDetails3CopyMessageOpen:!1,isDetails4CopyMessageOpen:!1,isOutputFormatExpanded:!!this.props.isOpen,isRemoveFormatActive:!1,currentOutputFormatLabel:this.props.displayLabel||this.props.conversionInfo.format.name,outputFormatLabel:this.props.displayLabel||this.props.conversionInfo.format.name,outputFormatPattern:this.props.conversionInfo.format.currentPattern,details1Label:"",details2Label:"",details3Label:"",details4Label:"",details3Visible:!1,details4Visible:!1,details1Value:"",details2Value:"",details3Value:"",details4Value:"",copyDetailsTextboxValue:""},this.outputLabel=t.React.createRef(),this.details1Input=t.React.createRef(),this.details2Input=t.React.createRef(),this.details3Input=t.React.createRef(),this.details4Input=t.React.createRef()}render(){const s=(i=this.props.theme,t.css`
  .outputSection {
    border-radius: 2px;
    padding: 5px;
    margin-top: 10px;
  }

  .format-label {
    width: 12.6rem;
  }

  .hidden {
    display: none;
  }

  .hidden-copy-outputCoords {
    opacity: 0.01;
    height: 0;
    position: absolute;
    z-index: -1;
  }

  .arrow-up {
    transform-origin: center center;
    transform: rotate(180deg);
    transition: transform .5s ease 0s;
  }

  .arrow-down {
    transform-origin: center center;
    transform: rotate(0deg);
    transition: transform .5s ease 0s;
  }

  .details-section-label {
    width: 50%;
    text-overflow: ellipsis;
    overflow: hidden;
  }

  .details-section-text {
    width: 50%;
  }

  .details-section-text .input-wrapper {
    padding: 2px;
  }

  .outputSettingsCoordinateLabel {
    margin-top: 5px;
  }

  .outputSettingsFormatLabel {
    margin-bottom: 0px;
    font-weight: bold;
    word-wrap: break-word;
    width: calc(100% - 120px);
    min-width: 20px;
  }

  .outputSettingsAddressLabel {
    max-width: calc(100% - 60px);
  }

  .adjust-buttons {
    display: flex;
    flex-flow: row wrap;
  }

  .invalid-value {
    border: 1px solid ${i.colors.danger};
    box-shadow: 0 0 5px ${i.colors.danger};
  }
  `);var i;return(0,t.jsx)("div",{css:s},(0,t.jsx)("div",{className:"outputSection shadow py-2"},(0,t.jsx)(e.Row,{flow:"wrap","aria-label":this.state.outputFormatLabel,className:"pl-3 pr-4"},(0,t.jsx)("div",{className:"adjust-buttons w-100 align-items-center"},(0,t.jsx)(e.Label,{id:"outputFormatLabel"+this.props.parentWidgetId+this.props.index,className:"address"===this.props.conversionInfo.format.name?"w-100 outputSettingsFormatLabel outputSettingsAddressLabel":"outputSettingsFormatLabel"},this.state.outputFormatLabel),(0,t.jsx)(e.Button,{role:"button","aria-labelledby":"outputFormatLabel"+this.props.parentWidgetId+this.props.index,"aria-haspopup":"dialog",title:this.nls("outputSettings"),className:"address"===this.props.conversionInfo.format.name?"hidden":"actionButton",type:"tertiary",icon:!0,size:"sm",active:this.state.outputSettingsActive,onClick:this.onOutputSettingsClick.bind(this)},(0,t.jsx)(e.Icon,{icon:n,size:"17"})),(0,t.jsx)(e.Button,{role:"button","aria-label":this.state.outputFormatLabel,"aria-disabled":this.props.isEmpty,disabled:this.props.isEmpty,title:this.nls("copy"),className:"actionButton",type:"tertiary",icon:!0,size:"sm",active:this.state.isCopyMessageOpen,id:"refCopy"+this.props.parentWidgetId+this.props.index,onClick:this.onCopyButtonClick.bind(this)},(0,t.jsx)(e.Icon,{icon:a,size:"17"})),"address"!==this.props.conversionInfo.format.name&&(0,t.jsx)("div",{className:this.state.isOutputFormatExpanded?"arrow-up":"arrow-down"},(0,t.jsx)(e.Button,{role:"button","aria-labelledby":"outputFormatLabel"+this.props.parentWidgetId+this.props.index,"aria-expanded":this.state.isOutputFormatExpanded,title:this.nls("expandOutput"),className:"actionButton",type:"tertiary",icon:!0,size:"sm",onClick:this.onExpandClick.bind(this)},(0,t.jsx)(e.Icon,{icon:p,size:"17"}))),(0,t.jsx)(e.Button,{role:"button","aria-labelledby":"outputFormatLabel"+this.props.parentWidgetId+this.props.index,title:this.nls("removeCoordinate"),className:"actionButton",type:"tertiary",icon:!0,size:"sm",active:this.state.isRemoveFormatActive,onClick:this.onRemoveClick.bind(this)},(0,t.jsx)(e.Icon,{icon:r,size:"17"})))),(0,t.jsx)("div",{className:"w-100 outputSettingsCoordinateLabel",ref:this.outputLabel},this.props.isEmpty?"":this.formatDisplayCoordinate(this.props.displayCoordinates)),(0,t.jsx)(e.TextArea,{tabIndex:-1,className:"hidden-copy-outputCoords",ref:this._copyOutputTextbox,value:this.props.isEmpty?"":this.props.displayCoordinates}),(0,t.jsx)(e.AlertPopup,{css:s,"aria-expanded":this.state.outputSettingsActive,isOpen:this.state.outputSettingsActive,onClickOk:this.onOutputSettingsOkClicked.bind(this),onClickClose:this.onOutputSettingsCancelClicked.bind(this),title:this.nls("outputSettingsEditPopupTitle")},(0,t.jsx)("table",{cellPadding:10},(0,t.jsx)("tbody",null,(0,t.jsx)("tr",null,(0,t.jsx)("td",null,(0,t.jsx)(e.Label,null,this.nls("coordinateLabel"))),(0,t.jsx)("td",null,(0,t.jsx)(e.TextInput,{required:!0,role:"textbox",ref:this.editTextFocus,"aria-label":this.nls("coordinateLabel"),size:"sm",value:this.state.currentOutputFormatLabel,onAcceptValue:this.onFormatLabelAcceptValue,onChange:this.onFormatLabelChange,className:""===this.state.currentOutputFormatLabel?"format-label invalid-value":"format-label"}))),(0,t.jsx)("tr",{className:"address"===this.props.conversionInfo.format.name?"hidden":""},(0,t.jsx)("td",null,(0,t.jsx)(e.Label,null,this.nls("coordinateFormat"))),(0,t.jsx)("td",null,(0,t.jsx)(e.TextInput,{required:!0,role:"textbox","aria-label":this.nls("coordinateFormat"),size:"sm",value:this.state.outputFormatPattern,onAcceptValue:this.onFormatAcceptValue,onChange:this.onFormatChange,className:""===this.state.outputFormatPattern?"invalid-value":""})),(0,t.jsx)("td",null,(0,t.jsx)(e.Button,{role:"button","aria-label":this.nls("resetFormat"),title:this.nls("resetFormat"),className:"ml-2",type:"tertiary",size:"sm",onClick:this.onResetButtonClick.bind(this)},(0,t.jsx)(e.Icon,{icon:l,size:"16"}))))))),this.state.isCopyMessageOpen&&(0,t.jsx)(e.Popper,{open:this.state.isCopyMessageOpen,version:0,placement:"bottom",showArrow:!0,reference:"refCopy"+this.props.parentWidgetId+this.props.index,offset:[0,0]},(0,t.jsx)("div",{className:"p-2"},this.nls("copySuccessMessage"))),(0,t.jsx)(e.Collapse,{isOpen:this.state.isOutputFormatExpanded},(0,t.jsx)("div",{className:"pt-2"},(0,t.jsx)(e.TextArea,{tabIndex:-1,className:"hidden-copy-outputCoords",ref:this._copyDetailsTextbox,value:this.state.copyDetailsTextboxValue}),(0,t.jsx)(e.Row,{flow:"wrap","aria-label":this.state.details1Label,className:"pl-3 pr-4"},(0,t.jsx)("div",{className:"d-flex justify-content-between w-100 align-items-center"},(0,t.jsx)(e.Label,{id:"details1Label"+this.props.parentWidgetId+this.props.index,className:"details-section-label",title:this.state.details1Label},this.state.details1Label),(0,t.jsx)(e.TextInput,{role:"textbox","aria-labelledby":"details1Label"+this.props.parentWidgetId+this.props.index,size:"sm",className:"details-section-text",ref:this.details1Input,title:this.formatDisplayCoordinate(this.state.details1Value),value:this.formatDisplayCoordinate(this.state.details1Value),readOnly:!0}),(0,t.jsx)(e.Button,{role:"button","aria-label":this.nls("copy")+" "+this.state.details1Label,disabled:this.props.isEmpty,title:this.nls("copy")+" "+this.state.details1Label,className:"actionButton",type:"tertiary",icon:!0,size:"sm",id:"refCopyDetails1"+this.props.parentWidgetId+this.props.index,active:this.state.isDetails1CopyMessageOpen,onClick:this.onCoordinateCopyBtnClick.bind(this)},(0,t.jsx)(e.Icon,{icon:a,size:"17"})))),(0,t.jsx)(e.Row,{flow:"wrap","aria-label":this.state.details2Label,className:"pl-3 pr-4 pt-3"},(0,t.jsx)("div",{className:"d-flex justify-content-between w-100 align-items-center"},(0,t.jsx)(e.Label,{id:"details2Label"+this.props.parentWidgetId+this.props.index,className:"details-section-label",title:this.state.details2Label},this.state.details2Label),(0,t.jsx)(e.TextInput,{role:"textbox","aria-labelledby":"details2Label"+this.props.parentWidgetId+this.props.index,size:"sm",className:"details-section-text",ref:this.details2Input,title:this.formatDisplayCoordinate(this.state.details2Value),value:this.formatDisplayCoordinate(this.state.details2Value),readOnly:!0}),(0,t.jsx)(e.Button,{role:"button","aria-label":this.nls("copy")+" "+this.state.details2Label,disabled:this.props.isEmpty,title:this.nls("copy")+" "+this.state.details2Label,className:"actionButton",type:"tertiary",icon:!0,size:"sm",id:"refCopyDetails2"+this.props.parentWidgetId+this.props.index,active:this.state.isDetails2CopyMessageOpen,onClick:this.onCoordinateCopyBtnClick.bind(this)},(0,t.jsx)(e.Icon,{icon:a,size:"17"})))),this.state.details3Visible&&(0,t.jsx)(e.Row,{flow:"wrap","aria-label":this.state.details3Label,className:"pl-3 pr-4 pt-3"},(0,t.jsx)("div",{className:"d-flex justify-content-between w-100 align-items-center"},(0,t.jsx)(e.Label,{id:"details3Label"+this.props.parentWidgetId+this.props.index,className:"details-section-label",title:this.state.details3Label},this.state.details3Label),(0,t.jsx)(e.TextInput,{role:"textbox","aria-labelledby":"details3Label"+this.props.parentWidgetId+this.props.index,size:"sm",className:"details-section-text",ref:this.details3Input,title:this.state.details3Value,value:this.state.details3Value,readOnly:!0}),(0,t.jsx)(e.Button,{role:"button","aria-label":this.nls("copy")+" "+this.state.details3Label,disabled:this.props.isEmpty,title:this.nls("copy")+" "+this.state.details3Label,className:"actionButton",type:"tertiary",icon:!0,size:"sm",id:"refCopyDetails3"+this.props.parentWidgetId+this.props.index,active:this.state.isDetails3CopyMessageOpen,onClick:this.onCoordinateCopyBtnClick.bind(this)},(0,t.jsx)(e.Icon,{icon:a,size:"17"})))),this.state.details3Visible&&(0,t.jsx)(e.Row,{flow:"wrap","aria-label":this.state.details4Label,className:"pl-3 pr-4 pt-3"},(0,t.jsx)("div",{className:"d-flex justify-content-between w-100 align-items-center"},(0,t.jsx)(e.Label,{id:"details4Label"+this.props.parentWidgetId+this.props.index,className:"details-section-label",title:this.state.details4Label},this.state.details4Label),(0,t.jsx)(e.TextInput,{role:"textbox","aria-labelledby":"details4Label"+this.props.parentWidgetId+this.props.index,size:"sm",className:"details-section-text",ref:this.details4Input,title:this.state.details4Value,value:this.state.details4Value,readOnly:!0}),(0,t.jsx)(e.Button,{role:"button","aria-label":this.nls("copy")+" "+this.state.details4Label,disabled:this.props.isEmpty,title:this.nls("copy")+" "+this.state.details4Label,className:"actionButton",type:"tertiary",icon:!0,size:"sm",id:"refCopyDetails4"+this.props.parentWidgetId+this.props.index,active:this.state.isDetails4CopyMessageOpen,onClick:this.onCoordinateCopyBtnClick.bind(this)},(0,t.jsx)(e.Icon,{icon:a,size:"17"})))),(this.state.isDetails1CopyMessageOpen||this.state.isDetails2CopyMessageOpen||this.state.isDetails3CopyMessageOpen||this.state.isDetails4CopyMessageOpen)&&this.showDetailsCopyMsg()))))}}const u=h(27218);class m extends t.React.PureComponent{constructor(t){super(t),this.onCoordinateChange=t=>{this.setState({addDefaultCoordinate:t.target.value},(()=>{const t=this.props.supportedFormats.find((t=>t.name===this.state.addDefaultCoordinate));this.setState({coordinateLabel:t.label}),this.resetToDefaultPattern(this.state.addDefaultCoordinate)}))},this.onFormatLabelChange=t=>{const e=t.target.value;this.setState({coordinateLabel:e})},this.onFormatLabelAcceptValue=t=>{this.setState({coordinateLabel:t.trim()})},this.onFormatChange=t=>{const e=t.target.value;this.setState({currentPattern:e})},this.onFormatAcceptValue=t=>{this.setState({currentPattern:t.trim()})},this.onResetButtonClick=()=>{const t=this.state.addDefaultCoordinate;this.resetToDefaultPattern(t)},this.resetToDefaultPattern=t=>{const e=this.props.supportedFormats.find((e=>e.name===t));e&&this.setState({currentPattern:e.defaultPattern})},this.onOkButtonClicked=()=>{if("address"===this.state.addDefaultCoordinate){if(""===this.state.coordinateLabel)return}else if("address"!==this.state.addDefaultCoordinate&&(""===this.state.coordinateLabel||""===this.state.currentPattern))return;this.setState({isAddNewFormatPopperActive:!1}),this.props.onOkClick(this.state.addDefaultCoordinate,this.state.coordinateLabel,this.state.currentPattern,this.state.canAddAtTop),this.props.onClose()},this.onCancelButtonClicked=()=>{this.setState({isAddNewFormatPopperActive:!1}),this.props.onClose()},this.onCheckBoxChange=t=>{this.setState({canAddAtTop:t.target.checked})},this.nls=t=>{const s=Object.assign({},o,e.defaultMessages);return this.props.intl&&this.props.intl.formatMessage?this.props.intl.formatMessage({id:t,defaultMessage:s[t]}):s[t]},this.state={addDefaultCoordinate:this.props.supportedFormats[0].name,isAddNewFormatPopperActive:this.props.isOpen,coordinateLabel:this.props.supportedFormats[0].label,currentPattern:this.props.supportedFormats[0].currentPattern,canAddAtTop:!1}}render(){const s=t.css`
      .hidden{
        display: none;
      }

      .cursor-pointer {
        cursor: pointer;
      }

      .invalid-value {
        border: 1px solid  ${this.props.theme.colors.danger};
        box-shadow: 0 0 5px  ${this.props.theme.colors.danger};
      }
    `;return(0,t.jsx)("div",null,(0,t.jsx)(e.AlertPopup,{css:s,"aria-expanded":this.state.isAddNewFormatPopperActive,isOpen:this.state.isAddNewFormatPopperActive,onClickOk:this.onOkButtonClicked.bind(this),onClickClose:this.onCancelButtonClicked.bind(this),title:this.nls("addConversion")},(0,t.jsx)("table",{cellPadding:10},(0,t.jsx)("tbody",null,(0,t.jsx)("tr",null,(0,t.jsx)("td",null,(0,t.jsx)(e.Label,null,this.nls("defaultCoordinate"))),(0,t.jsx)("td",null,(0,t.jsx)(e.Select,{"aria-label":this.nls("defaultCoordinate"),name:"defaultCoords",size:"sm",value:this.state.addDefaultCoordinate,onChange:this.onCoordinateChange},this.props.supportedFormats&&this.props.supportedFormats.map(((s,i)=>(0,t.jsx)(e.Option,{tabIndex:0,role:"option","aria-label":s.label,key:i,value:s.name},s.label)))))),(0,t.jsx)("tr",null,(0,t.jsx)("td",null,(0,t.jsx)(e.Label,{className:"mt-2"},this.nls("coordinateLabel"))),(0,t.jsx)("td",null,(0,t.jsx)(e.TextInput,{role:"textbox","aria-label":this.nls("coordinateLabel"),size:"sm",className:""===this.state.coordinateLabel?"invalid-value":"",value:this.state.coordinateLabel,onAcceptValue:this.onFormatLabelAcceptValue,onChange:this.onFormatLabelChange}))),(0,t.jsx)("tr",{className:"address"===this.state.addDefaultCoordinate?"hidden":""},(0,t.jsx)("td",null,(0,t.jsx)(e.Label,null,this.nls("coordinateFormat"))),(0,t.jsx)("td",null,(0,t.jsx)(e.TextInput,{role:"textbox","aria-label":this.nls("coordinateFormat"),size:"sm",className:""===this.state.currentPattern?"invalid-value":"",value:this.state.currentPattern,onAcceptValue:this.onFormatAcceptValue,onChange:this.onFormatChange})),(0,t.jsx)("td",null,(0,t.jsx)(e.Button,{role:"button","aria-label":this.nls("resetFormat"),title:this.nls("resetFormat"),size:"sm",icon:!0,type:"tertiary",className:"reset-button ml-2",onClick:this.onResetButtonClick.bind(this)},(0,t.jsx)(e.Icon,{icon:u,size:"16"})))),(0,t.jsx)("tr",null,(0,t.jsx)("td",{colSpan:3},(0,t.jsx)(e.Label,{className:"cursor-pointer"},(0,t.jsx)(e.Checkbox,{className:"mr-2 font-13",checked:this.state.canAddAtTop,onChange:this.onCheckBoxChange.bind(this),role:"checkbox","aria-label":this.nls("addConversionCheckboxLabel")}),this.nls("addConversionCheckboxLabel"))))))))}}var g=h(79429);const v=h(66549);class f extends t.React.PureComponent{constructor(t){super(t),this.nls=t=>{const s=Object.assign({},o,e.defaultMessages);return this.props.intl&&this.props.intl.formatMessage?this.props.intl.formatMessage({id:t,defaultMessage:s[t]}):s[t]},this.onAddConversion=()=>{this.setState({isAddConversionPopupOpen:!0})},this.addNewConversion=(t,e,s,i)=>{this.props.addNewConversion(t,e,s,i)},this.onAddPopperClose=()=>{this.setState({isAddConversionPopupOpen:!1})},this.onInputConversionComplete=t=>{this.props.onConversionComplete(t.mapCoordinate)},this.onInputProcessing=t=>{this.props.processing(t)},this.onInputClear=()=>{this.props.onClear()},this.addNewFormat=(t,e,s,i)=>{this.props.addNewConversion(t,e,s,i)},this.getSupportedFormats=t=>{this.setState({supportedFormats:t})},this.state={supportedFormats:null,isAddConversionPopupOpen:!1}}render(){var s,i;const o=(a=this.props.theme,t.css`
  .add-button-row {
    position: relative;
    margin-top: 0 !important;
  }

  .addBtn {
    position: absolute;
    top: 8px;
    cursor: pointer;
    border-radius: 15px;
    margin: 0 auto !important;
    height: 28px;
    width: 28px;
    background-color: ${a.colors.palette.light[100]};
    box-shadow: 0px 0px 2px 2px ${a.border.color} !important;
    display: flex;
    align-items: center;
   }

   .addBtn svg {
     margin: 0 auto;
   }
  `);var a;return(0,t.jsx)("div",{css:o,className:"input-container shadow"},(0,t.jsx)(g.CoordinateControl,{parentWidgetId:this.props.parentWidgetId,locatorURL:this.props.locatorURL,inputLabelString:this.nls("inputLabel"),defaultCoordinate:this.props.config.inputSettings.defaultCoordinate,defaultFormat:this.props.config.inputSettings.format,zoomScale:this.props.config.generalSettings.zoomScale,defaultPointSymbol:null===(i=null===(s=this.props.config)||void 0===s?void 0:s.generalSettings)||void 0===i?void 0:i.defaultPointSymbol,minCandidateScore:this.props.config.addressSettings.minCandidateScore,maxSuggestions:this.props.maxSuggestions,jimuMapview:this.props.jimuMapview,copyAllList:this.props.copyAllList,showCopy:!0,showZoom:!0,onConversionComplete:this.onInputConversionComplete,processing:this.onInputProcessing,onClear:this.onInputClear,getSupportedFormats:this.getSupportedFormats}),(0,t.jsx)(e.Row,{className:"pt-5 pl-3 add-button-row","aria-label":this.nls("addConversion")},(0,t.jsx)("div",{className:"addBtn",title:this.nls("addConversion"),id:"refAdd"+this.props.parentWidgetId,onClick:this.onAddConversion.bind(this)},(0,t.jsx)(e.Icon,{icon:v,size:"16"}))),this.state.isAddConversionPopupOpen&&this.state.supportedFormats&&this.state.supportedFormats.length>0&&(0,t.jsx)(m,{theme:this.props.theme,supportedFormats:this.state.supportedFormats,intl:this.props.intl,isOpen:this.state.isAddConversionPopupOpen,onOkClick:this.addNewConversion,onClose:this.onAddPopperClose}))}}var b=h(69715),x=h(50724);function C(t,e){return new b.default({name:"address",getConversionStrategy:()=>"server",conversionInfo:{convert:s=>new Promise(((i,o)=>{if(x.default)return x.default.locationToAddress(t,{location:s},{query:{}}).then((t=>{i({coordinate:t&&t.address&&t.score&&t.score>=e?t.address:"",location:s})}),(()=>{i({coordinate:"",location:s})}));i({coordinate:"",location:s})})),reverseConvert:s=>new Promise(((i,o)=>{if(x.default)return x.default.addressToLocations(t,{address:{SingleLine:s}},{query:{}}).then((t=>{t&&t.length>0&&(t=(t=t.filter((t=>t.score>=e&&t.location))).sort(((t,e)=>e.score-t.score)),i(t[0])),i(null)}),(()=>{i(null)}));i(null)}))},coordinateSegments:[{alias:"L",description:"Address",searchPattern:/.*/}],defaultPattern:"L"})}var L=h(8294),y=h(30476),w=h(62969),S=h(62522),I=function(t,e,s,i){return new(s||(s=Promise))((function(o,a){function n(t){try{l(i.next(t))}catch(t){a(t)}}function r(t){try{l(i.throw(t))}catch(t){a(t)}}function l(t){var e;t.done?o(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(n,r)}l((i=i.apply(t,e||[])).next())}))};const j=new L.default;class M extends t.BaseWidget{constructor(e){var s,i,a;super(e),this.nls=e=>{const s=Object.assign({},o,t.defaultMessages);return this.props.intl&&this.props.intl.formatMessage?this.props.intl.formatMessage({id:e,defaultMessage:s[e]}):s[e]},this.componentDidMount=()=>{this._isMounted=!0,this.isMapConfigured()||this.createAPIWidget()},this.didOutputSettingsChanged=(t,e)=>{let s=!1;return t.length!==e.length||(t.some(((t,i)=>{if(t.name!==e[i].name||t.label!==e[i].label||t.enabled!==e[i].enabled||t.currentPattern!==e[i].currentPattern)return s=!0,!0})),s)},this.componentDidUpdate=e=>{var s,i,o,a,n,r,l,p,d,u,h,c;this.props.appMode!==e.appMode&&this.props.appMode===t.AppMode.Design&&this._displayDefaultCursor();const m=t.lodash.isDeepEqual(this.props.useMapWidgetIds,e.useMapWidgetIds);if(!m||this.didOutputSettingsChanged(this.props.config.outputSettings,e.config.outputSettings)){const t={};this.state.outputFormatCoordVM&&this.state.outputFormatCoordVM&&this.state.outputFormatCoordVM.destroy(),t.outputFormatCoordVM=null,this.isMapConfigured()?m||(this._displayDefaultCursor(),t.showEmptyOutput=!0):(this._displayDefaultCursor(),t.jimuMapview=null),this.setState(t,(()=>{this.createAPIWidget()}))}((null===(i=null===(s=this.props.config.addressSettings)||void 0===s?void 0:s.useUtilitiesGeocodeService)||void 0===i?void 0:i.length)>0&&(null===(n=null===(a=null===(o=e.config.addressSettings)||void 0===o?void 0:o.useUtilitiesGeocodeService)||void 0===a?void 0:a[0])||void 0===n?void 0:n.utilityId)!==(null===(p=null===(l=null===(r=this.props.config.addressSettings)||void 0===r?void 0:r.useUtilitiesGeocodeService)||void 0===l?void 0:l[0])||void 0===p?void 0:p.utilityId)||0===(null===(u=null===(d=this.props.config.addressSettings)||void 0===d?void 0:d.useUtilitiesGeocodeService)||void 0===u?void 0:u.length)&&(null===(h=e.config.addressSettings)||void 0===h?void 0:h.useUtilitiesGeocodeService.length)!==(null===(c=this.props.config.addressSettings)||void 0===c?void 0:c.useUtilitiesGeocodeService.length))&&this.updateGeocodeURL()},this.componentWillUnmount=()=>{this._isMounted=!1},this.updateGeocodeURL=()=>{var t;const e=null===(t=this.state.outputFormatCoordVM)||void 0===t?void 0:t.conversions;this.getGeocodeServiceURL().then((t=>{this.setState({locatorURL:t},(()=>{if(e){const t=C(this.state.locatorURL,this.props.config.addressSettings.minCandidateScore);e.forEach((e=>{"address"===e.format.name&&(e.format=t)}))}}))}))},this.getDefaultGeocodeServiceURL=()=>{var t,e;let s="https://geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer";return(null===(e=null===(t=this.props.config)||void 0===t?void 0:t.addressSettings)||void 0===e?void 0:e.geocodeServiceUrl)?s=this.props.config.addressSettings.geocodeServiceUrl:this.props.portalSelf&&this.props.portalSelf.helperServices&&this.props.portalSelf.helperServices.geocode&&this.props.portalSelf.helperServices.geocode.length>0&&this.props.portalSelf.helperServices.geocode[0].url&&(s=this.props.portalSelf.helperServices.geocode[0].url),s},this.getGeocodeServiceURL=()=>I(this,void 0,void 0,(function*(){var t,e;let s=this.getDefaultGeocodeServiceURL();const i=yield this.getGeocodeURLFromUtility();return(null===(e=null===(t=this.props.config.addressSettings)||void 0===t?void 0:t.useUtilitiesGeocodeService)||void 0===e?void 0:e.length)>0&&(s=i),s})),this.getGeocodeURLFromUtility=()=>I(this,void 0,void 0,(function*(){var t,e,s,i;return(null===(e=null===(t=this.props.config.addressSettings)||void 0===t?void 0:t.useUtilitiesGeocodeService)||void 0===e?void 0:e.length)>0?this.getUrlOfUseUtility(null===(i=null===(s=this.props.config.addressSettings)||void 0===s?void 0:s.useUtilitiesGeocodeService)||void 0===i?void 0:i[0]):Promise.resolve("")})),this.getUrlOfUseUtility=e=>I(this,void 0,void 0,(function*(){return e?t.UtilityManager.getInstance().getUrlOfUseUtility(e).then((t=>Promise.resolve(t))):Promise.resolve("")})),this._displayDefaultCursor=()=>{this.state.jimuMapview&&this.state.jimuMapview.view&&this.state.jimuMapview.view&&this.state.jimuMapview.view.container&&null!==this.state.jimuMapview.view.container.style.cursor&&(this.state.jimuMapview.view.container.style.cursor=null)},this.onActiveViewChange=t=>{t&&t.view&&this.setState({jimuMapview:t},(()=>{this.createAPIWidget()}))},this.createAPIWidget=()=>{if(!this.state.outputFormatCoordVM){const t=new w.default({view:this.state.jimuMapview?this.state.jimuMapview.view:null});t.watch("messages",(()=>{this._isMounted&&setTimeout((()=>{if(!this._isMounted)return;t.pause();const e=S.default.generateDefaultFormats(t.messages);t.conversions.removeAll();const s=[],i=[];let o=!1;if(this._outputDisplayInfos&&this._outputDisplayInfos.length>0&&this._outputDisplayInfos.forEach((e=>{const a=e.format;let n;if(o||e.addedAtRuntime||(o=!0),e.addedAtRuntime)if("address"===a.name){const a=C(this.state.locatorURL,this.props.config.addressSettings.minCandidateScore),n={displayLabel:e.displayLabel,isOpen:e.isOpen,format:a,addedAtRuntime:!0};o?i.push(n):(t.conversions.add(new y.default({format:a})),s.push(n))}else if("basemap"!==a.name){const r=S.default.generateDefaultFormats(t.messages).filter((t=>t.name===a.name));n=new y.default({format:r[0]}),n.format.currentPattern=a.currentPattern;const l={displayLabel:e.displayLabel,isOpen:e.isOpen,format:n.format,addedAtRuntime:!0};o?i.push(l):(t.conversions.add(n),s.push(l))}})),this._outputDisplayInfos=s.slice(),this.props.config&&this.props.config.outputSettings&&this.props.config.outputSettings.length>0)this.props.config.outputSettings.forEach((e=>{if(e.enabled){let s;if("address"===e.name){const s=C(this.state.locatorURL,this.props.config.addressSettings.minCandidateScore);t.conversions.add(new y.default({format:s})),this._outputDisplayInfos.push({displayLabel:e.label,isOpen:!1,format:s})}else if("basemap"!==e.name){const i=S.default.generateDefaultFormats(t.messages).filter((t=>t.name===e.name));s=new y.default({format:i[0]}),s.format.currentPattern=e.currentPattern,t.conversions.add(s),this._outputDisplayInfos.push({displayLabel:e.label,isOpen:!1,format:i[0]})}}})),i&&i.length>0&&i.forEach((e=>{const s=new y.default({format:e.format});t.conversions.add(s),this._outputDisplayInfos.push({displayLabel:e.displayLabel,isOpen:e.isOpen,format:s.format,addedAtRuntime:!0})}));else{const s=C(this.state.locatorURL,this.props.config.addressSettings.minCandidateScore);t.conversions.add(new y.default({format:s})),this._outputDisplayInfos.push({displayLabel:this.nls("address"),isOpen:!1,format:s}),e.forEach((e=>{let s;"basemap"!==e.name&&(s=new y.default({format:e}),s.format.currentPattern=e.currentPattern,t.conversions.add(s),this._outputDisplayInfos.push({displayLabel:this.nls(e.name),isOpen:!1,format:e}))}))}this.setState({outputFormatCoordVM:t},(()=>{null===this.state.selectedInputLocation?this.setState({selectedInputLocation:j,showLoading:!1},(()=>{this.updateOutputConversions()})):this.updateOutputConversions()}))}),400)}))}},this.onCoordinateSystemRemove=t=>{this.state.outputFormatCoordVM.conversions.remove(this.state.outputFormatCoordVM.conversions.getItemAt(t)),this._outputDisplayInfos.splice(t,1),this.updateOutputConversions()},this.updateDisplayState=(t,e)=>{this._outputDisplayInfos[t].isOpen=e},this.updateCurrentPattern=(t,e,s)=>{this.state.outputFormatCoordVM.conversions.getItemAt(t).format.currentPattern=s,this._outputDisplayInfos[t].displayLabel=e,this.updateOutputConversions()},this.updateOutputConversions=()=>{this.state.selectedInputLocation&&this.setState({showLoading:!0},(()=>{var t;null===(t=this.state.outputFormatCoordVM)||void 0===t||t.updateConversions(this.state.outputFormatCoordVM.conversions.toArray(),this.state.selectedInputLocation).then((()=>{this.state.outputFormatCoordVM&&this.renderOutputList(this.state.outputFormatCoordVM.conversions)}),(t=>{this.setState({showLoading:!1}),console.log(t.message)}))}))},this.renderOutputList=e=>{const s=[];this.outputCoordinateList=[],this.setState({outputList:[]}),e.forEach(((e,i)=>{let o=e.displayCoordinate;const a=this._outputDisplayInfos[i]?this._outputDisplayInfos[i].displayLabel:e.format.name;"address"!==e.format.name||""!==o&&null!==o||(o=this.nls("noAddressFoundMsg")),this.outputCoordinateList.push(a+"\r\n"+o),s.push((0,t.jsx)(d,{displayLabel:a,isOpen:!!this._outputDisplayInfos[i]&&this._outputDisplayInfos[i].isOpen,parentWidgetId:this.props.id,intl:this.props.intl,theme:this.props.theme,index:i,key:i,displayCoordinates:o,onRemove:this.onCoordinateSystemRemove.bind(this),conversionInfo:e,onOutPutSettingsActive:this.updateDisplayState.bind(this),onCurrentPatternChange:this.updateCurrentPattern.bind(this),isEmpty:this.state.showEmptyOutput,isRTL:this.isRTL}))})),this.setState({outputList:s,showLoading:!1})},this.addNewFormat=(t,e,s,i)=>{let o;if("address"===t){const t=C(this.state.locatorURL,this.props.config.addressSettings.minCandidateScore);o=new y.default({format:t})}else{const e=S.default.generateDefaultFormats(this.state.outputFormatCoordVM.messages).filter((e=>e.name===t));e[0].currentPattern=s,o=new y.default({format:e[0]})}const a={displayLabel:e,isOpen:!1,format:o.format,addedAtRuntime:!0};i?(this.state.outputFormatCoordVM.conversions.splice(0,0,o),this._outputDisplayInfos.splice(0,0,a)):(this.state.outputFormatCoordVM.conversions.add(o),this._outputDisplayInfos.push(a)),this.updateOutputConversions()},this.onInputConversionComplete=t=>{this.setState({selectedInputLocation:t||j,showEmptyOutput:!1},(()=>{this.updateOutputConversions()}))},this.onInputProcessing=t=>{this.setState({showLoading:t})},this.onInputClear=()=>{this.setState({selectedInputLocation:j,showEmptyOutput:!0},(()=>{this.updateOutputConversions()}))},this.isMapConfigured=()=>this.props.useMapWidgetIds&&1===this.props.useMapWidgetIds.length,this.canLoadInputSettings=()=>!this.isMapConfigured()||!!this.state.jimuMapview;const n=this.getDefaultGeocodeServiceURL();this.outputCoordinateList=[],this._outputDisplayInfos=[],this._isMounted=!1,this.isRTL=!1;const r=(0,t.getAppStore)().getState();this.isRTL=null===(s=null==r?void 0:r.appContext)||void 0===s?void 0:s.isRTL,this.state={conversionInfo:[],supportedFormats:[],outputFormatCoordVM:null,jimuMapview:null,outputList:[],locatorURL:n,selectedInputLocation:null,showEmptyOutput:!0,showLoading:!0},(null===(a=null===(i=this.props.config.addressSettings)||void 0===i?void 0:i.useUtilitiesGeocodeService)||void 0===a?void 0:a.length)>0&&this.updateGeocodeURL()}render(){var o,a,n,r;let l=6;return((null===(a=null===(o=this.props.config)||void 0===o?void 0:o.addressSettings)||void 0===a?void 0:a.maxSuggestions)||0===(null===(r=null===(n=this.props.config)||void 0===n?void 0:n.addressSettings)||void 0===r?void 0:r.maxSuggestions))&&(l=this.props.config.addressSettings.maxSuggestions),(0,t.jsx)("div",{css:i(this.props.theme),className:"jimu-widget"},(0,t.jsx)("div",{className:"widget-coordinate-conversion"},this.isMapConfigured()&&(0,t.jsx)(s.JimuMapViewComponent,{useMapWidgetId:this.props.useMapWidgetIds[0],onActiveViewChange:this.onActiveViewChange}),this.canLoadInputSettings()&&(0,t.jsx)(f,{copyAllList:this.outputCoordinateList,parentWidgetId:this.props.id,intl:this.props.intl,config:this.props.config,theme:this.props.theme,jimuMapview:this.state.jimuMapview,locatorURL:this.state.locatorURL,minCandidateScore:this.props.config.addressSettings.minCandidateScore,maxSuggestions:l,onConversionComplete:this.onInputConversionComplete,processing:this.onInputProcessing,onClear:this.onInputClear,addNewConversion:this.addNewFormat}),(0,t.jsx)("div",{className:"mt-4"},this.state.outputList),this.state.showLoading&&(0,t.jsx)(e.Loading,{type:e.LoadingType.Secondary})))}}M.mapExtraStateProps=t=>{var e;return{appMode:null===(e=t.appRuntimeInfo)||void 0===e?void 0:e.appMode}}})(),c})())}}}));