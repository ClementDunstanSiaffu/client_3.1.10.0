System.register(["jimu-core","jimu-arcgis","jimu-ui","esri/widgets/support/chartUtils","esri/layers/GraphicsLayer","esri/geometry/Polygon","esri/request","esri/portal/PortalItem","esri/widgets/Sketch/SketchViewModel","esri/portal/Portal","esri/layers/ImageryLayer","esri/layers/support/RasterFunction","esri/core/watchUtils"],(function(e,t){var l={},r={},a={},o={},n={},i={},s={},u={},c={},d={},g={},h={},p={};return{setters:[function(e){l.React=e.React,l.classNames=e.classNames,l.css=e.css,l.jsx=e.jsx},function(e){r.JimuMapViewComponent=e.JimuMapViewComponent},function(e){a.Alert=e.Alert,a.AlertPopup=e.AlertPopup,a.Button=e.Button,a.ButtonGroup=e.ButtonGroup,a.Checkbox=e.Checkbox,a.Dropdown=e.Dropdown,a.DropdownButton=e.DropdownButton,a.DropdownItem=e.DropdownItem,a.DropdownMenu=e.DropdownMenu,a.Form=e.Form,a.FormGroup=e.FormGroup,a.Icon=e.Icon,a.Label=e.Label,a.NumericInput=e.NumericInput,a.Select=e.Select,a.Slider=e.Slider,a.Tab=e.Tab,a.Tabs=e.Tabs,a.TextArea=e.TextArea,a.TextInput=e.TextInput},function(e){o.default=e.default},function(e){n.default=e.default},function(e){i.default=e.default},function(e){s.default=e.default},function(e){u.default=e.default},function(e){c.default=e.default},function(e){d.default=e.default},function(e){g.default=e.default},function(e){h.default=e.default},function(e){p.default=e.default}],execute:function(){e((()=>{var e={51623:(e,t,l)=>{"use strict";l.d(t,{Z:()=>i});var r=l(8081),a=l.n(r),o=l(23645),n=l.n(o)()(a());n.push([e.id,".widget-wro{padding:0px;width:100%;height:100%;background-color:var(--white)}.widget-wro-loading-msg{margin:4px 6px}.widget-wro-loading-error-msg{margin:4px 6px;font-style:italic}.widget-wro-modeler{display:flex;flex-direction:column;width:100%;height:100%}.widget-wro-header{margin:10px 10px 5px;font-weight:bold}.widget-wro-body{flex:1 1 auto;overflow:hidden}.widget-wro-tabs{width:100%;height:100%}.widget-wro-tabs>.tab-nav{border-bottom:none}.widget-wro-tabs>.tab-content{width:100%;height:calc(100% - 71px)}.widget-wro-tabs .nav-item{width:33.33%;height:70px}.widget-wro-tabs .nav-item .nav-link.jimu-btn{display:flex;flex-direction:column;justify-content:space-around;padding-left:0.5rem;padding-right:0.5rem;position:relative;border:none !important}.widget-wro-tabs .nav-item .jimu-link:before{width:24px;height:24px;border-radius:50px;z-index:1;color:var(--primary-500);background-color:var(--white);border:2px solid var(--primary-500)}.widget-wro-tabs .nav-item .jimu-link.active:before{background-color:var(--primary-500);color:var(--white);border-color:var(--primary-500)}.widget-wro-tabs .nav-item .jimu-link.disabled:before{background-color:var(--light-100);color:var(--light-800);border-color:var(--light-400)}.widget-wro-tabs .nav-item:first-of-type .jimu-link:before{content:'1'}.widget-wro-tabs .nav-item:nth-of-type(2) .jimu-link:before{content:'2'}.widget-wro-tabs .nav-item:nth-of-type(3) .jimu-link:before{content:'3'}.widget-wro-tabs .nav-item .jimu-link:after{content:' ';width:100%;height:3px;background:var(--primary-500);position:absolute;top:20px;z-index:0}.widget-wro-tabs .nav-item .jimu-link.active:after{background:var(--primary-500)}.widget-wro-tabs .nav-item .jimu-link.disabled:after{background:var(--light-400)}.widget-wro-tabs .nav-item .jimu-link.disabled{cursor:not-allowed}.widget-wro-tabs .nav-item .tab-title{color:var(--black)}.widget-wro-tabs .nav-item .jimu-link.disabled .tab-title{color:var(--light-600)}.widget-wro-layers-panel,.widget-wro-model-panel,.widget-wro-chart-panel{width:100%;height:100%}.widget-wro-panel-header{padding:10px;font-size:14px;font-weight:bold;line-height:32px;height:52px}.widget-wro-layers-panel{display:flex;flex-direction:column;width:100%;height:100%}.widget-wro-layers-body{flex:1 1 auto;display:flex;flex-direction:column;width:100%;height:100%;overflow:auto}.widget-wro-layers-list{flex:1 1 auto;margin:0;padding:10px;padding-top:4px;list-style-type:none;overflow:auto}.widget-wro-layers-buttons{padding:1rem 0rem;display:flex;flex-direction:row-reverse;justify-content:space-between}.widget-wro-nav-buttons{padding:0.5rem 0rem 1rem;display:flex;flex-direction:row-reverse;justify-content:space-between;width:100%}.widget-wro-layers-buttons .btn-group,.widget-wro-layers-buttons .btn-group .btn{width:100%}.widget-wro-layers-buttons .btn-group .btn svg{margin-left:0.5rem;margin-right:0.5rem;vertical-align:middle}.widget-wro-nav-btn{display:flex;align-items:center}.widget-wro-nav-btn.jimu-btn .jimu-icon{margin:0px 6px}.widget-wro-layer-title{margin:0 8px}.widget-wro-model-panel{display:flex;flex-direction:column;width:100%;height:100%}.widget-wro-model-panel-body{flex:1 1 auto;display:flex;flex-direction:column;width:100%;height:100%;overflow:auto}.widget-wro-model-layers-list{flex:1 1 auto;margin:0;padding:0px;padding-top:4px;list-style-type:none;overflow:auto}.widget-wro-model-item{display:flex;align-items:center;justify-content:space-between;margin:6px 10px}.widget-wro-model-item-label{display:flex}.widget-wro-model-item-input-section{display:flex;align-items:center;margin:0 0.3rem}.widget-wro-model-item-remap-btn{margin:0 6px}.widget-wro-model-item-percent{display:inline-block;width:1rem;text-align:center}.widget-wro-model-total{padding:10px;display:flex;justify-content:space-between;font-weight:bold;border-top:1px solid var(--dark-100);border-bottom:1px solid var(--dark-100)}.widget-wro-model-buttons{padding:1rem}.widget-wro-model-buttons .btn-group{width:100%;display:flex;justify-content:flex-end}.widget-wro-model-buttons .btn-group .btn{width:33%;margin-left:6px;margin-right:6px}.widget-wro-model-buttons .alert-panel{width:100%;margin-top:1rem}.widget-wro-input-weight{width:2.6rem}.widget-wro-remap-panel{background-color:var(--light-300);padding:8px 18px;position:relative}.widget-wro-remap-panel:after{content:\"\";width:0px;height:0px;position:absolute;top:-10px;right:86px;border:5px solid transparent;border-bottom-color:var(--light-300)}.jimu-rtl .widget-wro-remap-panel:after{right:auto;left:86px}.widget-wro-remap-range{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px}.widget-wro-remap-range:last-of-type{margin-bottom:0px}.widget-wro-remap-slider{display:inline-block;width:120px}.widget-wro-remap-numeric-input{display:inline-block;width:26px;margin:0 6px;text-align:right}.widget-wro-remap-numeric-input .jimu-numeric-input-input{width:26px}.widget-wro-color-dropdown-menu{max-height:300px;overflow-y:auto}.widget-wro-color-ramp{display:flex;font-size:13px;font-weight:400}.widget-wro-color-ramp .widget-wro-color-ramp-container{display:flex;align-items:center;flex-direction:row}html[dir=\"rtl\"] .widget-wro-color-ramp-container{flex-direction:row-reverse}.widget-wro-color-ramp .widget-wro-color-ramp-colors{margin-left:2px;margin-right:2px}.widget-wro-color-ramp .widget-wro-color-ramp-color{display:inline-block;width:5px;height:8px;margin-bottom:2px}.widget-wro-flex-between{display:flex;justify-content:space-between;align-items:center}.widget-wro-flex-column{display:flex;flex-direction:column}.widget-wro-chart-panel{display:flex;flex-direction:column;width:100%;height:100%}.widget-wro-chart-header{padding:10px;font-size:14px;font-weight:bold;line-height:32px}.widget-wro-chart-body{flex:1 1 auto;display:flex;flex-direction:column;width:100%;height:100%;overflow:auto;padding:10px}.widget-wro-chart-tools{white-space:nowrap}.widget-wro-chart-button{margin-left:0.2rem !important;margin-right:0.2rem !important;text-decoration:none !important}.widget-wro-chart-select-layer-section{font-weight:normal;margin-top:10px;height:2rem;text-align:center}.widget-wro-chart-note{margin-top:1rem;font-style:italic}.widget-wro-model-working,.widget-wro-chart-working{margin-top:0.4rem;font-weight:normal;font-size:smaller;height:0.8rem;text-align:center}.widget-wro-chart-warning{margin-top:1rem;font-weight:normal;font-style:italic;height:0.8rem;text-align:center}.widget-wro-chart-warning .alert-panel,.widget-wro-chart-note .alert-panel{width:100%;padding:4px 8px !important;line-height:22px}.widget-wro-model-working{margin-top:2px}.widget-wro-chart-component{width:100%;height:100%}.widget-wro-chart-buttons{padding:1rem 0rem;display:flex;justify-content:space-between}.widget-wro-export-popup .modal-content{min-width:400px;margin-bottom:200px}.widget-wro-export-popup.widget-wro-invalid-modal .modal-footer .btn-primary{color:var(--light-800);background-color:var(--light-200);border-color:var(--light-200);box-shadow:none;pointer-events:none}.widget-wro-form textarea{height:4rem}.widget-wro-fadein{animation:widget-wro-kf-fadein 10s}.widget-wro-alert-container{padding:10px;display:flex;align-items:center;justify-content:center}.widget-wro-alert-container .alert-panel{width:100%}.u-hidden{display:none !important}@keyframes widget-wro-kf-fadein{0%{opacity:0}100%{opacity:1}}@keyframes widget-wro-kf-spinner{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}\n",""]);const i=n},23645:e=>{"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var l="",r=void 0!==t[5];return t[4]&&(l+="@supports (".concat(t[4],") {")),t[2]&&(l+="@media ".concat(t[2]," {")),r&&(l+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),l+=e(t),r&&(l+="}"),t[2]&&(l+="}"),t[4]&&(l+="}"),l})).join("")},t.i=function(e,l,r,a,o){"string"==typeof e&&(e=[[null,e,void 0]]);var n={};if(r)for(var i=0;i<this.length;i++){var s=this[i][0];null!=s&&(n[s]=!0)}for(var u=0;u<e.length;u++){var c=[].concat(e[u]);r&&n[c[0]]||(void 0!==o&&(void 0===c[5]||(c[1]="@layer".concat(c[5].length>0?" ".concat(c[5]):""," {").concat(c[1],"}")),c[5]=o),l&&(c[2]?(c[1]="@media ".concat(c[2]," {").concat(c[1],"}"),c[2]=l):c[2]=l),a&&(c[4]?(c[1]="@supports (".concat(c[4],") {").concat(c[1],"}"),c[4]=a):c[4]="".concat(a)),t.push(c))}},t}},8081:e=>{"use strict";e.exports=function(e){return e[1]}},93379:e=>{"use strict";var t=[];function l(e){for(var l=-1,r=0;r<t.length;r++)if(t[r].identifier===e){l=r;break}return l}function r(e,r){for(var o={},n=[],i=0;i<e.length;i++){var s=e[i],u=r.base?s[0]+r.base:s[0],c=o[u]||0,d="".concat(u," ").concat(c);o[u]=c+1;var g=l(d),h={css:s[1],media:s[2],sourceMap:s[3],supports:s[4],layer:s[5]};if(-1!==g)t[g].references++,t[g].updater(h);else{var p=a(h,r);r.byIndex=i,t.splice(i,0,{identifier:d,updater:p,references:1})}n.push(d)}return n}function a(e,t){var l=t.domAPI(t);return l.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;l.update(e=t)}else l.remove()}}e.exports=function(e,a){var o=r(e=e||[],a=a||{});return function(e){e=e||[];for(var n=0;n<o.length;n++){var i=l(o[n]);t[i].references--}for(var s=r(e,a),u=0;u<o.length;u++){var c=l(o[u]);0===t[c].references&&(t[c].updater(),t.splice(c,1))}o=s}}},90569:e=>{"use strict";var t={};e.exports=function(e,l){var r=function(e){if(void 0===t[e]){var l=document.querySelector(e);if(window.HTMLIFrameElement&&l instanceof window.HTMLIFrameElement)try{l=l.contentDocument.head}catch(e){l=null}t[e]=l}return t[e]}(e);if(!r)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");r.appendChild(l)}},19216:e=>{"use strict";e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},3565:(e,t,l)=>{"use strict";e.exports=function(e){var t=l.nc;t&&e.setAttribute("nonce",t)}},7795:e=>{"use strict";e.exports=function(e){var t=e.insertStyleElement(e);return{update:function(l){!function(e,t,l){var r="";l.supports&&(r+="@supports (".concat(l.supports,") {")),l.media&&(r+="@media ".concat(l.media," {"));var a=void 0!==l.layer;a&&(r+="@layer".concat(l.layer.length>0?" ".concat(l.layer):""," {")),r+=l.css,a&&(r+="}"),l.media&&(r+="}"),l.supports&&(r+="}");var o=l.sourceMap;o&&"undefined"!=typeof btoa&&(r+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),t.styleTagTransform(r,e,t.options)}(t,e,l)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},44589:e=>{"use strict";e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},35384:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M7.5 1.914 6.475 2.94a.5.5 0 1 1-.707-.707L8 0l2.157 2.157a.5.5 0 0 1-.707.707l-.95-.95V7.5h5.586l-1.1-1.1a.5.5 0 1 1 .706-.708L16 8l-2.232 2.232a.5.5 0 1 1-.707-.707L14.086 8.5H8.5v5.586l1.025-1.025a.5.5 0 1 1 .707.707L8 16l-2.308-2.308a.5.5 0 1 1 .707-.707l1.101 1.1V8.5H1.914l.95.95a.5.5 0 0 1-.707.707L0 8l2.232-2.232a.5.5 0 1 1 .707.707L1.914 7.5H7.5V1.914Z" fill="#000"></path></svg>'},96314:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M8 1 0 5.5 8 10l8-4.5L8 1Zm5.96 7.477-.606-.341 1.02-.574L16 8.477l-8 4.5-8-4.5 1.627-.915 1.02.574-.607.341L8 11.83l5.96-3.353Zm2.04 3-1.647-.927-1.02.574.627.353L8 14.83l-5.96-3.353.628-.353-1.02-.574L0 11.477l8 4.5 8-4.5ZM8 2.148 2.04 5.5 8 8.853 13.96 5.5 8 2.148Z" fill="#000"></path></svg>'},32373:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M11.086 4.35c0-2.794-1.045-4.35-2.865-4.35-1.095 0-2.323.748-3.72 2.204l.69.732.215-.22C6.542 1.584 7.49 1.033 8.221 1.033c1.19 0 1.884 1.032 1.884 3.319 0 .87.35 1.453.997 1.729.358.152.682.199 1.301.207l.787.002c.923.018 1.21.146 1.305.553.207.89-1.364 1.958-4.88 2.98l-.64.179.245.999.325-.09c4.285-1.199 6.313-2.554 5.903-4.313-.232-.997-.788-1.284-2.04-1.333l-.396-.009h-.55c-.518-.005-.772-.038-.99-.131-.266-.114-.386-.312-.386-.773ZM.25 3l8.642 4.969-3.422.738 2.723 5.45-2.886 1.667-2.724-5.45-2.351 2.595L.25 3Zm.996 1.726-.01 5.644 1.527-1.684 2.91 5.771 1.154-.667-2.91-5.77 2.222-.48-4.893-2.814Z" fill="#000"></path></svg>'},36811:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M16 11V0L6 2.982v2.162h.91l-.001-1.49 8.181-2.44v8.882H8.434V11H16ZM.25 3l8.642 4.969-3.422.738 2.723 5.45-2.886 1.667-2.724-5.45-2.351 2.595L.25 3Zm.996 1.726-.01 5.644 1.527-1.684 2.91 5.771 1.154-.667-2.91-5.77 2.222-.48-4.893-2.814Z" fill="#000"></path></svg>'},77799:e=>{e.exports='<svg viewBox="0 0 18 16" xmlns="http://www.w3.org/2000/svg"><g fill="#FFF" fill-rule="evenodd"><path d="M7.085 1a1.5 1.5 0 0 1 2.83 0H14v1H9.915a1.5 1.5 0 0 1-2.83 0H0V1h7.085ZM1.085 7a1.5 1.5 0 0 1 2.83 0H8v1H3.915a1.5 1.5 0 0 1-2.83 0H0V7h1.085ZM3.085 14H0v-1h3.085a1.5 1.5 0 0 1 2.83 0H8v1H5.915a1.5 1.5 0 0 1-2.83 0ZM13.987 15.13a.784.784 0 0 0 1.06.267l1.444-.845a.793.793 0 0 0 .256-1.125l-.945-1.506 1.13-.321a.8.8 0 0 0 .561-.657.792.792 0 0 0-.367-.78L11.72 6.63a.777.777 0 0 0-.822-.023.8.8 0 0 0-.397.69v6.267c0 .296.162.56.417.7a.794.794 0 0 0 .856-.072l1.097-.83 1.117 1.77Zm.9-3.989-.64.183 1.553 2.473-1.075.63-1.3-2.06-.29-.46-1.635 1.237V7.68l4.717 3.084-1.33.377Z"></path></g></svg>'},14345:e=>{"use strict";e.exports=p},72019:e=>{"use strict";e.exports=i},23852:e=>{"use strict";e.exports=n},92055:e=>{"use strict";e.exports=g},91524:e=>{"use strict";e.exports=h},69383:e=>{"use strict";e.exports=d},71293:e=>{"use strict";e.exports=u},68831:e=>{"use strict";e.exports=s},97878:e=>{"use strict";e.exports=c},3476:e=>{"use strict";e.exports=o},26826:e=>{"use strict";e.exports=r},48891:e=>{"use strict";e.exports=l},30726:e=>{"use strict";e.exports=a}},t={};function w(l){var r=t[l];if(void 0!==r)return r.exports;var a=t[l]={id:l,exports:{}};return e[l](a,a.exports,w),a.exports}w.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return w.d(t,{a:t}),t},w.d=(e,t)=>{for(var l in t)w.o(t,l)&&!w.o(e,l)&&Object.defineProperty(e,l,{enumerable:!0,get:t[l]})},w.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),w.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},w.p="",w.nc=void 0;var m={};return w.p=window.jimuConfig.baseUrl,(()=>{"use strict";w.r(m),w.d(m,{default:()=>_e});var e=w(48891);const t={_widgetLabel:"Suitability Modeler",wro_general_back:"Back",wro_general_cancel:"Cancel",wro_general_clear:"Clear",wro_general_close:"Close",wro_general_export:"Export",wro_general_information:"Information",wro_general_loading:"Loading...",wro_general_next:"Next",wro_general_run:"Run",wro_general_save:"Save",wro_general_saveAs:"Save As",wro_general_warning:"Warning",wro_step_1:"1",wro_step_2:"2",wro_step_3:"3",wro_tabs_layers:"Layers",wro_tabs_model:"Model",wro_tabs_chart:"Chart",wro_main_modelIssue:"Model Issue",wro_main_runError:"Error running model",wro_main_caption:"Suitability Modeler",wro_main_browsePrompt:"Weighted overlay service",wro_main_selectLayersCaption:"Select layers",wro_main_selectLayers:"Layers",wro_main_designModelCaption:"Design model",wro_main_designModel:"Design model",wro_main_transparency:"Transparency",wro_main_visible:"Visible",wro_main_total:"Total",wro_main_unableToLoad:"Unable to load model.",wro_main_setSymbology:"Set symbology",wro_main_setScores:"Set scores",wro_remap_label:"{name} ({minmax})",wro_saveModel_save:"Export",wro_saveModel_title:"Title",wro_saveModel_titleRequired:"Title (required)",wro_saveModel_summary:"Summary",wro_saveModel_description:"Description",wro_saveModel_tags:"Tags",wro_saveModel_folder:"Folder",wro_saveModel_homeFolderPattern:"{username} (Home)",wro_saveModel_failed:"Export failed.",wro_saveModel_success_msg:"Model exported successfully.",wro_saveModel_failed_msg:"Failed to export model.",wro_chart_prompt:"Features",wro_chart_generate:"Generate chart",wro_chart_working:"Updating...",wro_chart_polygonTool:"Draw a polygon",wro_chart_freehandPolygonTool:"Draw a freehand polygon",wro_chart_selectTool:"Select from a layer",wro_chart_zoomPanTool:"Pan",wro_chart_clearButton:"Clear",wro_chart_selectLayerPlaceholder:"Choose a layer",wro_chart_noSubjectLayers:"Your map has no polygon layers.",wro_chart_noModelLayer:"The model hasn't been run",wro_chart_tipPattern:"{category} - {label}: {percent}%",wro_chart_tipPattern2:"{category}: {percent}%",wro_chart_labelPattern:"{category} - {label}",wro_chart_noData:"No model results within chart area, please create a new selection.",wro_colorRamp_low:"Low",wro_colorRamp_high:"High",wro_colorRamp_tipPattern:"{label} ({value})",wro_colorRamp_flipCaption:"Flip",wro_colorRamp_1:"Extremely Low",wro_colorRamp_2:"Very Low",wro_colorRamp_3:"Low",wro_colorRamp_4:"Low Medium",wro_colorRamp_5:"Medium",wro_colorRamp_6:"High Medium",wro_colorRamp_7:"High",wro_colorRamp_8:"Very High",wro_colorRamp_9:"Extremely High",wro_1_9_green_yellow_red:"Green Yellow Red",wro_1_9_red_yellow_green:"Red Yellow Green",wro_1_9_yellow_to_dark_red:"Yellow to Dark Red",wro_1_9_dark_red_to_yellow:"Dark Red to Yellow",wro_1_9_light_gray_to_dark_gray:"Light Gray to Dark Gray",wro_1_9_dark_gray_to_light_gray:"Dark Gray to Light Gray",wro_1_9_light_brown_to_dark_brown:"Light Brown to Dark Brown",wro_1_9_dark_brown_to_light_brown:"Dark Brown to Light Brown",wro_1_9_full_spectrum_bright_red_to_blue:"Full Spectrum - Bright Red to Blue",wro_1_9_full_spectrum_bright_blue_to_red:"Full Spectrum - Bright Blue to Red",wro_1_9_partial_spectrum_yellow_to_blue:"Partial Spectrum - Yellow to Blue",wro_1_9_partial_spectrum_blue_to_yellow:"Partial Spectrum - Blue to Yellow",wro_1_9_yellow_green_to_dark_blue:"Yellow-Green to Dark Blue",wro_1_9_dark_blue_to_yellow_green:"Dark Blue to Yellow-Green",wro_1_9_cold_to_hot_diverging:"Cold to Hot Diverging",wro_1_9_hot_to_cold_diverging:"Hot to Cold Diverging",wro_1_9_surface_low_to_high:"Surface - Low to High",wro_1_9_surface_high_to_low:"Surface - High to Low",wro_validation_validating:"Validating...",wro_validation_invalidServiceUrl:"The weighted overlay service URL is invalid.",wro_validation_undefinedItemUrl:"This item's URL is not defined.",wro_validation_errorloadingService:"Unable to load service",wro_validation_errorLoadingItem:"Unable to load chart.",wro_validation_errorLoadingItemWithMsg:"Unable to load chart. See server error message ({message}).",wro_validation_errorQueryingLayers:"Unable to query service layers",wro_validation_noLayers:"There are no modeling layers",wro_validation_noModel:"No model",wro_validation_noMap:"No map",wro_validation_notAnImageService:"This item is not an image Service",wro_validation_notAWroService:"This configured item is not a weighted overlay service",wro_validation_notAllowRasterFunction:"allowRasterFunction must be set to true",wro_validation_notNearestResampling:"defaultResamplingMethod must be Nearest",wro_validation_missingFieldPattern:"{field} is a required field",wro_validation_wroServiceNotDefined:"No weighted overlay service was configured"};var l=w(26826),r=w(30726),a=w(36811),o=w.n(a);const n=t=>{const l=window.SVG,{className:r}=t,a=function(e,t){var l={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(l[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(l[r[a]]=e[r[a]])}return l}(t,["className"]),n=(0,e.classNames)("jimu-icon jimu-icon-component",r);return l?e.React.createElement(l,Object.assign({className:n,src:o()},a)):e.React.createElement("svg",Object.assign({className:n},a))};var i=w(32373),s=w.n(i);const u=t=>{const l=window.SVG,{className:r}=t,a=function(e,t){var l={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(l[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(l[r[a]]=e[r[a]])}return l}(t,["className"]),o=(0,e.classNames)("jimu-icon jimu-icon-component",r);return l?e.React.createElement(l,Object.assign({className:o,src:s()},a)):e.React.createElement("svg",Object.assign({className:o},a))};var c=w(96314),d=w.n(c);const g=t=>{const l=window.SVG,{className:r}=t,a=function(e,t){var l={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(l[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(l[r[a]]=e[r[a]])}return l}(t,["className"]),o=(0,e.classNames)("jimu-icon jimu-icon-component",r);return l?e.React.createElement(l,Object.assign({className:o,src:d()},a)):e.React.createElement("svg",Object.assign({className:o},a))};var h=w(35384),p=w.n(h);const b=t=>{const l=window.SVG,{className:r}=t,a=function(e,t){var l={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(l[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(l[r[a]]=e[r[a]])}return l}(t,["className"]),o=(0,e.classNames)("jimu-icon jimu-icon-component",r);return l?e.React.createElement(l,Object.assign({className:o,src:p()},a)):e.React.createElement("svg",Object.assign({className:o},a))};var v=w(3476);class y extends e.React.PureComponent{constructor(t){super(t),this.initChart=e=>{return t=this,l=void 0,a=function*(){var t,l;try{let r=this.am4chartsModule;if(r||(r=this.am4chartsModule=yield v.default.loadChartsModule()),this.pieChart)try{this.pieChart.dispose(),this.pieChart=null}catch(e){console.error(e)}const{am4core:a,am4charts:o}=r,n=this.props.wroContext.getTheme();(null==n?void 0:n.darkTheme)?a.useTheme(r.am4themes_dark):a.unuseTheme(r.am4themes_dark);const i=!("rtl"!==(null===(t=null===document||void 0===document?void 0:document.documentElement)||void 0===t?void 0:t.dir)),s=null===(l=null===document||void 0===document?void 0:document.documentElement)||void 0===l?void 0:l.lang;let u="{category} {value.percent.formatNumber('#.00')}%";const c="{category}";let d="{value.percent.formatNumber('#.00')}%";"ar"===s&&(d="%{value.percent.formatNumber('#.00')}"),"tr"===s&&(u="{category} %{value.percent.formatNumber('#.00')}",d="%{value.percent.formatNumber('#.00')}");const g=a.create(this.chartRef.current,o.PieChart);g.rtl=i,g.radius=a.percent(90);const h=g.series.push(new o.PieSeries);h.dataFields.value="value",h.dataFields.category="label",h.slices.template.propertyFields.fill="fillColor",h.labels.template.disabled=!0,h.ticks.template.disabled=!0,h.slices.template.tooltipText=u,h.legendSettings.labelText=c,h.legendSettings.valueText=d;const p=g.legend=new o.Legend;p.position="bottom",p.maxHeight=130,p.maxWidth=340,p.scrollable=!0,p.layout="vertical",p.valueLabels.template.align="right",p.valueLabels.template.textAlign="end",i&&(p.reverseOrder=!0,p.itemContainers.template.reverseOrder=!0);const w=p.markers.template;w.width=15,w.height=15,h.slices.template.states.getKey("active").properties.shiftRadius=0,p.itemContainers.template.clickable=!1,p.itemContainers.template.focusable=!1,p.itemContainers.template.cursorOverStyle=a.MouseCursorStyle.default,e&&(g.data=e),this.pieChart=g}catch(e){console.error("Error creating chart",e)}},new((r=void 0)||(r=Promise))((function(e,o){function n(e){try{s(a.next(e))}catch(e){o(e)}}function i(e){try{s(a.throw(e))}catch(e){o(e)}}function s(t){var l;t.done?e(t.value):(l=t.value,l instanceof r?l:new r((function(e){e(l)}))).then(n,i)}s((a=a.apply(t,l||[])).next())}));var t,l,r,a},this.chartRef=e.React.createRef(),this.state={needsRefresh:!1}}componentDidMount(){this.initChart()}componentDidUpdate(e){var t;const l=this.props.wroModel,r=e.wroModel,a=l&&"chart-panel"===l.activePanel,o=r&&"chart-panel"===r.activePanel;let n;if(e.histogramData!==this.props.histogramData){n=[];const e=this.props.histogramData;(null==e?void 0:e.colorCounts)&&e.colorCounts.length>0&&e.colorCounts.forEach((e=>{const t="rgb("+e.rgb[0].toString()+","+e.rgb[1].toString()+","+e.rgb[2].toString()+")",l={label:e.label,value:e.count,fillColor:t};n.push(l)})),this.pieChart&&(this.pieChart.data=n)}e.wroStatus.themeId!==this.props.wroStatus.themeId&&(n||(n=null===(t=this.pieChart)||void 0===t?void 0:t.data),this.initChart(n)),a&&!o&&this.state.needsRefresh&&(this.pieChart&&(this.pieChart.invalidateRawData(),this.pieChart.legend.deepInvalidate()),this.setState({needsRefresh:!1})),a||!o||this.state.needsRefresh||this.setState({needsRefresh:!0})}componentWillUnmount(){this.pieChart&&(this.pieChart.dispose(),this.pieChart=null)}render(){return(0,e.jsx)("div",{ref:this.chartRef,className:"widget-wro-chart-component"})}}var f=w(23852),_=w(72019),x=w(68831),L=function(e,t,l,r){return new(l||(l=Promise))((function(a,o){function n(e){try{s(r.next(e))}catch(e){o(e)}}function i(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?a(e.value):(t=e.value,t instanceof l?t:new l((function(e){e(t)}))).then(n,i)}s((r=r.apply(e,t||[])).next())}))};function M(e,t,l,r){return L(this,void 0,void 0,(function*(){if(e.highlightHandle&&(e.highlightHandle.remove(),e.highlightHandle=null),r&&r.length>0){const a=yield t.whenLayerView(l);a&&(e.highlightHandle=a.highlight(r))}}))}function C(e){let t=null;return e&&1===e.length?t=e[0]:e&&e.length>1&&(t=new _.default({spatialReference:e[0].spatialReference}),e.forEach((e=>{e.rings&&e.rings.forEach((e=>{t.addRing(e)}))}))),t}var S=w(71293);function R(e){const t=j(e);return!!(null==t?void 0:t.renderingRule)}function j(e){const t=e.wroModel,l=e.wroContext.getView();if((null==l?void 0:l.map)&&(null==t?void 0:t.mapLayerId))return l.map.findLayerById(t.mapLayerId)}var k=w(97878);class I extends e.React.PureComponent{constructor(e){super(e),this.watchHandles=[],this.activateSketch=(e,t,l)=>{this.cancelSketch();const r="selectLayer"===e,a=this.props.wroContext.getView();if(null==a?void 0:a.map){this.setGraphicsLayerVisibility(this.drawGfxLayerId,!r);const e=r?this.selGfxLayerId:this.drawGfxLayerId,o=this.ensureGraphicsLayer(a,e),n=this.activeSketchViewModel=new k.default({view:a,layer:o});n.on("create",(e=>{if("complete"===e.state){if(r){this.clearHighlightHandle();const t=e.graphic.geometry,l=this.newTask(a,t);this.computeHistograms(l).catch((()=>{})),o.remove(e.graphic)}else{e.graphic&&(e.graphic.symbol={type:"simple-fill",color:[0,255,255,.4],style:"solid",outline:{color:[0,0,0,.6],width:1}});const t=this.newTask(a,null);this.computeHistograms(t).catch((()=>{}))}n.create(t,l)}})),n.create(t,l)}},this.cancelSketch=()=>{const e=this.activeSketchViewModel;if(e){try{e.cancel(),e.destroy()}catch(e){console.error("Error canceling SketchViewModel",e)}this.activeSketchViewModel=null}},this.canComputeHistograms=()=>R(this.props),this.clearHandles=e=>{Array.isArray(e)&&e.forEach((e=>{try{e&&e.remove()}catch(e){console.error(e)}}))},this.clearHighlightHandle=()=>{this.clearHandles([this.highlightHandle]),this.highlightHandle=null},this.computeHistograms=e=>{return t=this,l=void 0,a=function*(){this.clearHighlightHandle();const t=this.props.wroContext.nls,l=this.workingId=Date.now(),r=!!e.featureSelectionGeometry;this.setState({isWorking:!0,showWarning:!1,showError:!1});try{const a=yield function(e){var t;return L(this,void 0,void 0,(function*(){let l,r;if((null===(t=e.imageLayer)||void 0===t?void 0:t.renderingRule)&&(l=e.featureSelectionGeometry?yield function(e){var t;return L(this,void 0,void 0,(function*(){let l;const r=e.view,a=e.featureMapLayerId,o=e.featureSelectionGeometry,n=a&&(null===(t=null==r?void 0:r.map)||void 0===t?void 0:t.findLayerById(a));if(n&&o&&"function"==typeof n.createQuery&&"function"==typeof n.queryFeatures){M(e,r,n,null).catch((()=>{}));const t=n.createQuery();t.returnGeometry=!0,t.geometry=o;const a=yield n.queryFeatures(t);if(null==a?void 0:a.features){M(e,r,n,a.features).catch((()=>{}));const t=[];a.features.forEach((e=>{e.geometry&&t.push(e.geometry.clone())})),t.length>0&&(l=C(t))}}return l}))}(e):yield function(e){var t;return L(this,void 0,void 0,(function*(){let l;const r=e.view,a=e.graphicsMapLayerId,o=a&&(null===(t=null==r?void 0:r.map)||void 0===t?void 0:t.findLayerById(a));if(null==o?void 0:o.graphics){const e=[];o.graphics.forEach((t=>{t.geometry&&"polygon"===t.geometry.type&&e.push(t.geometry.clone())})),e.length>0&&(l=C(e))}return l}))}(e),l)){const t=yield function(e,t){return L(this,void 0,void 0,(function*(){let l;if((null==e?void 0:e.renderingRule)&&t){const r=`${e.url}/computeHistograms`,a=function(e,t){let l,r,a=0,o=0;const n=e.imageMaxWidth,i=e.imageMaxHeight,s=t.extent;a=s.width,o=s.height,a<1&&(a=1),o<1&&(o=1);const u=Math.ceil(a/n),c=Math.ceil(o/i);return l=Math.max(u,c),r={x:l,y:l},r}(e,t),o={f:"json"};o.geometry=JSON.stringify(t.toJSON()),o.geometryType="esriGeometryPolygon",o.renderingRule=JSON.stringify(e.renderingRule.toJSON()),o.pixelSize=JSON.stringify(a);const n={query:o,responseType:"json"};l=yield(0,x.default)(r,n),l=null==l?void 0:l.data}return l}))}(e.imageLayer,l);r=function(e,t){var l;const r=e.wroContext.nls,a={noDataCount:0,colorCounts:[]},o=e.imageLayer,n=null==o?void 0:o.renderingRule;if(!n||!t||!t.histograms||0===t.histograms.length)return a;const i=t.histograms[0],s=Math.round(i.min),u=Math.round(i.max)-1;0===s&&i.counts>0&&(a.noDataCount=i.counts[0]);let c=0;const d=null===(l=null==n?void 0:n.functionArguments)||void 0===l?void 0:l.Colormap;return d&&d.forEach((e=>{let t=0;const l=e[0];let o=null;const n=[e[1],e[2],e[3]];t=l<s||l>u?0:i.counts[l-s],c+=t;const d=r("wro_colorRamp_"+l.toString());d&&(o=r("wro_chart_labelPattern",{category:l.toString(),label:d})),t>0&&a.colorCounts.push({count:t,value:l,pct:0,label:o,rgb:n})})),a.noDataCount>0&&(c+=a.noDataCount),c>0&&a.colorCounts.forEach((e=>{const t=e.count/c*100;e.pct=t})),a}(e,t)}return r}))}(e);if(l!==this.workingId&&e.highlightHandle&&this.clearHandles([e.highlightHandle]),l===this.workingId){let l=null;(null==a?void 0:a.colorCounts)&&0===a.colorCounts.length&&(l=t("wro_chart_noData")),e.highlightHandle&&(this.highlightHandle=e.highlightHandle),r?(this.selGeometry=e.featureSelectionGeometry,this.setState({histogramDataSelect:a,isWorking:!1,showWarning:!!l,warning:l})):(this.selGeometry=null,this.setState({histogramDataDraw:a,isWorking:!1,showWarning:!!l,warning:l}))}}catch(e){console.error("Error computing histograms",e),l===this.workingId&&this.setState({isWorking:!1,showError:!0,warning:(null==e?void 0:e.message)?t("wro_validation_errorLoadingItemWithMsg",{message:String(e.message)}):t("wro_validation_errorLoadingItem")})}},new((r=void 0)||(r=Promise))((function(e,o){function n(e){try{s(a.next(e))}catch(e){o(e)}}function i(e){try{s(a.throw(e))}catch(e){o(e)}}function s(t){var l;t.done?e(t.value):(l=t.value,l instanceof r?l:new r((function(e){e(l)}))).then(n,i)}s((a=a.apply(t,l||[])).next())}));var t,l,r,a},this.ensureGraphicsLayer=(e,t)=>function(e,t){let l;return t&&(l=e.map.findLayerById(t)),l||(l=new f.default({id:t,title:t,listMode:"hide"}),e.map.add(l)),l}(e,t),this.getGraphicsLayer=e=>{const t=this.props.wroContext.getView();if(null==t?void 0:t.map)return t.map.findLayerById(e)},this.getImageLayer=()=>j(this.props),this.getLayers=()=>function(e){const t=[],l=e.wroContext.getView();return(null==l?void 0:l.map)&&(l.map.allLayers.forEach((e=>{"feature"===e.type&&"polygon"===e.geometryType&&t.push(e)})),t.reverse()),t}(this.props),this.handleClearClicked=()=>{this.workingId=null;const e=this.getGraphicsLayer(this.drawGfxLayerId);e&&e.removeAll(),this.clearHighlightHandle(),this.setState({histogramDataDraw:null,histogramDataSelect:null,showWarning:!1,showError:!1,isWorking:!1})},this.handleDrawPolygonClicked=()=>{this.clearHighlightHandle(),this.activateSketch("drawPolygon","polygon"),this.setState({activeTool:"drawPolygon",histogramDataSelect:null,showWarning:!1,showError:!1,zoomPanActive:!1})},this.handleDrawFreehandPolygonClicked=()=>{this.clearHighlightHandle(),this.activateSketch("drawFreehandPolygon","polygon",{mode:"freehand"}),this.setState({activeTool:"drawFreehandPolygon",histogramDataSelect:null,showWarning:!1,showError:!1,zoomPanActive:!1})},this.handleMapLayerSelected=e=>{let t=e.target.value;"string"==typeof t&&0!==t.length||(t=null),t!==this.state.selectedMapLayerId&&this.clearHighlightHandle(),this.setState({selectedMapLayerId:t,showWarning:!1,showError:!1,histogramDataSelect:null})},this.handleSelectLayerClicked=()=>{this.activateSketch("selectLayer","rectangle"),this.setState({activeTool:"selectLayer",showWarning:!1,showError:!1,zoomPanActive:!1})},this.handleZoomPanClicked=()=>{this.watchImageLayer(),this.cancelSketch(),this.setState({showWarning:!1,showError:!1,zoomPanActive:!0})},this.newTask=(e,t)=>{const l=function(e,t,l,r,a,o){return{wroContext:e,view:t,imageLayer:l,featureMapLayerId:r,featureSelectionGeometry:a,graphicsMapLayerId:o}}(this.props.wroContext,e,this.getImageLayer(),this.state.selectedMapLayerId,t,this.drawGfxLayerId);return l},this.resetState=()=>{this.cancelSketch(),this.clearHighlightHandle(),this.setState({activeTool:null,histogramDataDraw:null,histogramDataSelect:null,isWorking:!1,selectedMapLayerId:null,showWarning:!1,showError:!1,warning:null,zoomPanActive:!0})},this.setGraphicsLayerVisibility=(e,t)=>{const l=this.getGraphicsLayer(e);l&&(l.visible=t)},this.handlePanelClicked=()=>{const e=this.props.wroContext.modelController,t=this.props.wroModel;t&&e.setActivePanel(t,"model-panel")};const t=this.props.wroContext.getId();this.drawGfxLayerId=`${t}_drawGfxLayerId`,this.selGfxLayerId=`${t}_selGfxLayerId`,this.state={activeTool:null,histogramDataDraw:null,histogramDataSelect:null,isWorking:!1,selectedMapLayerId:null,showWarning:!1,showError:!1,warning:null,zoomPanActive:!0}}componentDidUpdate(e,t){const l=this.props.wroModel,r=e.wroModel,a=l&&"chart-panel"===l.activePanel,o=r&&"chart-panel"===r.activePanel;!a&&this.activeSketchViewModel&&this.cancelSketch();const n=null==l?void 0:l.mapLayerId,i=null==r?void 0:r.mapLayerId;if(i&&n!==i&&this.unwatchImageLayer(),n&&n!==i&&this.watchImageLayer(),e.wroStatus.viewId!==this.props.wroStatus.viewId)this.resetState(),this.watchView();else if(this.canComputeHistograms()){if(a&&!o&&!this.state.zoomPanActive){const e=this.state.activeTool;"drawPolygon"===e?this.activateSketch("drawPolygon","polygon"):"drawFreehandPolygon"===e?this.activateSketch("drawFreehandPolygon","polygon",{mode:"freehand"}):"selectLayer"===e&&this.activateSketch("selectLayer","rectangle"),this.setState({showWarning:!1,showError:!1})}}else this.resetState(),this.watchImageLayer()}componentWillUnmount(){this.cancelSketch(),this.unwatchView()}unwatchImageLayer(){this.imageLayerHandle&&(this.clearHandles([this.imageLayerHandle]),this.imageLayerHandle=null)}unwatchView(){this.unwatchImageLayer(),this.clearHighlightHandle(),this.clearHandles(this.watchHandles),this.watchHandles=[]}watchImageLayer(){this.unwatchImageLayer();const e=this.getImageLayer();e&&"function"==typeof e.watch&&(this.imageLayerHandle=e.watch("renderingRule",((e,t,l,r)=>{const a=()=>{const e=this.props.wroContext.getView();if(this.state.histogramDataDraw){const t=this.newTask(e,null);this.computeHistograms(t).catch((()=>{}))}},o=this.props.wroContext.getView();if(this.state.histogramDataSelect&&this.selGeometry){const e=this.newTask(o,this.selGeometry);this.computeHistograms(e).then((()=>{a()})).catch((()=>{}))}else a()})))}watchView(){this.unwatchView(),this.watchImageLayer();const e=this.props.wroContext.getView();if(null==e?void 0:e.map){const t=e.map.allLayers.on("change",(t=>{const l=this.state.selectedMapLayerId;l&&(e.map.findLayerById(l)||this.setState({selectedMapLayerId:null}))}));this.watchHandles.push(t)}}render(){const t=this.props.wroContext.nls,l=this.props.wroModel,{activeTool:a,isWorking:o,selectedMapLayerId:i,zoomPanActive:s}=this.state,c=this.canComputeHistograms();let d;if(c){if(c&&(null==l?void 0:l.mapLayerId)){const l=this.getLayers();if("selectLayer"===a)if(l&&l.length>0){const a=[];l.forEach((t=>{const l=(0,e.jsx)("option",{key:t.id,value:t.id},t.title);a.push(l)})),d=(0,e.jsx)(r.Select,{placeholder:t("wro_chart_selectLayerPlaceholder"),value:i,onChange:this.handleMapLayerSelected},a)}else d=(0,e.jsx)("span",{className:"widget-wro-chart-note"},(0,e.jsx)(r.Alert,{closable:!0,form:"basic",text:t("wro_chart_noSubjectLayers"),type:"warning",withIcon:!0}))}}else d=(0,e.jsx)("span",{className:"widget-wro-chart-note"},t("wro_chart_noModelLayer"));const h=!!d;let p=(0,e.jsx)("div",{className:"widget-wro-chart-working"}," ");return o?p=(0,e.jsx)("div",{className:"widget-wro-chart-working"},(0,e.jsx)("span",null,t("wro_chart_working"))):this.state.showWarning&&this.state.warning?p=(0,e.jsx)("div",{className:"widget-wro-chart-warning"},(0,e.jsx)(r.Alert,{closable:!0,form:"basic",text:this.state.warning,type:"warning",withIcon:!0})):this.state.showError&&this.state.warning&&(p=(0,e.jsx)("div",{className:"widget-wro-chart-warning"},(0,e.jsx)(r.Alert,{closable:!0,form:"basic",text:this.state.warning,type:"error",withIcon:!0}))),(0,e.jsx)("div",{className:"widget-wro-chart-panel"},(0,e.jsx)("div",{className:"widget-wro-chart-header"},(0,e.jsx)("div",{className:"widget-wro-flex-between"},(0,e.jsx)("span",{className:"widget-wro-chart-features-label"},t("wro_chart_prompt")),(0,e.jsx)(r.ButtonGroup,{className:"widget-wro-chart-tools"},(0,e.jsx)("span",{className:"working","data-dojo-attach-point":"workingNode"}),(0,e.jsx)(r.Button,{className:"widget-wro-chart-button",active:!s&&"drawPolygon"===a,disabled:!c,icon:!0,title:t("wro_chart_polygonTool"),onClick:this.handleDrawPolygonClicked},(0,e.jsx)(n,{size:"m"})),(0,e.jsx)(r.Button,{className:"widget-wro-chart-button",active:!s&&"drawFreehandPolygon"===a,disabled:!c,icon:!0,title:t("wro_chart_freehandPolygonTool"),onClick:this.handleDrawFreehandPolygonClicked},(0,e.jsx)(u,{size:"m"})),(0,e.jsx)(r.Button,{className:"widget-wro-chart-button",active:!s&&"selectLayer"===a,disabled:!c,icon:!0,title:t("wro_chart_selectTool"),onClick:this.handleSelectLayerClicked},(0,e.jsx)(g,{size:"m"})),(0,e.jsx)(r.Button,{className:"widget-wro-chart-button",active:s,disabled:!c,icon:!0,title:t("wro_chart_zoomPanTool"),onClick:this.handleZoomPanClicked},(0,e.jsx)(b,{size:"m"})),(0,e.jsx)(r.Button,{className:"widget-wro-chart-button",disabled:!c||!!o,type:"link",onClick:this.handleClearClicked},t("wro_general_clear")))),h&&(0,e.jsx)("div",{className:"widget-wro-chart-select-layer-section"},d),p),(0,e.jsx)("div",{className:"widget-wro-chart-body"},this.renderChart()))}renderChart(){const t=this.props.wroContext,l=this.props.wroModel,r=this.props.wroStatus;let a;return a="selectLayer"===this.state.activeTool?this.state.histogramDataSelect:this.state.histogramDataDraw,(0,e.jsx)(y,{histogramData:a,wroContext:t,wroModel:l,wroStatus:r})}}class N extends e.React.PureComponent{constructor(){super(...arguments),this.handlePanelClicked=()=>{const e=this.props.wroContext.modelController,t=this.props.wroModel;t&&e.setActivePanel(t,"model-panel")}}render(){const t=this.props.wroContext.nls,l=this.props.wroModel,r=null==l?void 0:l.loadErrors,a=null==l?void 0:l.rasterLayers,o=!!this.props.wroStatus.viewId;let n=[];if(this.props.wroStatus.isModelLoading)n=[(0,e.jsx)("li",{key:"loading",className:"widget-wro-loading-msg"},t("wro_general_loading"))];else if(r&&r.length>0)r.forEach((t=>{n.push((0,e.jsx)("li",{key:t.message,className:"widget-wro-loading-error-msg"},t.message))}));else if(l)a&&0!==a.length?a&&a.length>0&&a.forEach((e=>{const t=this.renderLayer(e,l);n.push(t)})):n=[(0,e.jsx)("li",{key:"noLayers",className:"widget-wro-loading-error-msg"},t("wro_validation_noLayers"))];else{let l="wro_validation_noModel";o||(l="wro_validation_noMap"),n=[(0,e.jsx)("li",{key:"noMap",className:"widget-wro-loading-error-msg widget-wro-fadein"},t(l))]}return(0,e.jsx)("div",{className:"widget-wro-layers-panel"},(0,e.jsx)("div",{className:"widget-wro-layers-body"},(0,e.jsx)("ul",{className:"widget-wro-layers-list"},n),(0,e.jsx)("div",{className:"widget-wro-layers-footer"})))}renderLayer(t,l){const a=this.props.wroContext.modelController,o=t.title,n=a.isLayerSelected(l,t.rasterLayerId);return(0,e.jsx)("li",{key:t.name},(0,e.jsx)(r.Label,null,(0,e.jsx)(r.Checkbox,{checked:n,onChange:(e,r)=>{e&&a.selectLayer(l,t.rasterLayerId,!!r)}}),(0,e.jsx)("span",{className:"widget-wro-layer-title"},o)))}}var P=w(77799),E=w.n(P);let O,D=!1;function T(e){let t;return O&&O.some((l=>(e===l.name&&(t=l),!!t))),t}function V(){return O||(O=[{name:"1_9_green_yellow_red",label:null,colors:[{label:null,value:1,rgb:[38,115,0]},{label:null,value:2,rgb:[86,148,0]},{label:null,value:3,rgb:[39,181,0]},{label:null,value:4,rgb:[197,219,0]},{label:null,value:5,rgb:[255,255,0]},{label:null,value:6,rgb:[255,195,0]},{label:null,value:7,rgb:[250,142,0]},{label:null,value:8,rgb:[242,85,0]},{label:null,value:9,rgb:[230,0,0]}]},{name:"1_9_red_yellow_green",label:null,colors:[{label:null,value:1,rgb:[230,0,0]},{label:null,value:2,rgb:[242,85,0]},{label:null,value:3,rgb:[250,142,0]},{label:null,value:4,rgb:[255,195,0]},{label:null,value:5,rgb:[255,255,0]},{label:null,value:6,rgb:[197,219,0]},{label:null,value:7,rgb:[39,181,0]},{label:null,value:8,rgb:[86,148,0]},{label:null,value:9,rgb:[38,115,0]}]},{name:"1_9_yellow_to_dark_red",label:null,colors:[{label:null,value:1,rgb:[255,255,128]},{label:null,value:2,rgb:[252,233,106]},{label:null,value:3,rgb:[250,209,85]},{label:null,value:4,rgb:[247,190,67]},{label:null,value:5,rgb:[242,167,46]},{label:null,value:6,rgb:[207,122,31]},{label:null,value:7,rgb:[173,83,19]},{label:null,value:8,rgb:[138,46,10]},{label:null,value:9,rgb:[107,0,0]}]},{name:"1_9_dark_red_to_yellow",label:null,colors:[{label:null,value:1,rgb:[107,0,0]},{label:null,value:2,rgb:[138,46,10]},{label:null,value:3,rgb:[173,83,19]},{label:null,value:4,rgb:[207,122,31]},{label:null,value:5,rgb:[242,167,46]},{label:null,value:6,rgb:[247,190,67]},{label:null,value:7,rgb:[250,209,85]},{label:null,value:8,rgb:[252,233,106]},{label:null,value:9,rgb:[255,255,128]}]},{name:"1_9_light_gray_to_dark_gray",label:null,colors:[{label:null,value:1,rgb:[219,219,219]},{label:null,value:2,rgb:[196,196,196]},{label:null,value:3,rgb:[176,176,176]},{label:null,value:4,rgb:[156,156,156]},{label:null,value:5,rgb:[135,135,135]},{label:null,value:6,rgb:[117,117,117]},{label:null,value:7,rgb:[99,99,99]},{label:null,value:8,rgb:[84,84,84]},{label:null,value:9,rgb:[69,69,69]}]},{name:"1_9_dark_gray_to_light_gray",label:null,colors:[{label:null,value:1,rgb:[69,69,69]},{label:null,value:2,rgb:[84,84,84]},{label:null,value:3,rgb:[99,99,99]},{label:null,value:4,rgb:[117,117,117]},{label:null,value:5,rgb:[135,135,135]},{label:null,value:6,rgb:[156,156,156]},{label:null,value:7,rgb:[176,176,176]},{label:null,value:8,rgb:[196,196,196]},{label:null,value:9,rgb:[219,219,219]}]},{name:"1_9_light_brown_to_dark_brown",label:null,colors:[{label:null,value:1,rgb:[250,233,212]},{label:null,value:2,rgb:[242,208,184]},{label:null,value:3,rgb:[235,187,160]},{label:null,value:4,rgb:[224,163,135]},{label:null,value:5,rgb:[217,144,113]},{label:null,value:6,rgb:[207,124,91]},{label:null,value:7,rgb:[194,103,70]},{label:null,value:8,rgb:[184,84,53]},{label:null,value:9,rgb:[171,65,36]}]},{name:"1_9_dark_brown_to_light_brown",label:null,colors:[{label:null,value:1,rgb:[171,65,36]},{label:null,value:2,rgb:[184,84,53]},{label:null,value:3,rgb:[194,103,70]},{label:null,value:4,rgb:[207,124,91]},{label:null,value:5,rgb:[217,144,113]},{label:null,value:6,rgb:[224,163,135]},{label:null,value:7,rgb:[235,187,160]},{label:null,value:8,rgb:[242,208,184]},{label:null,value:9,rgb:[250,233,212]}]},{name:"1_9_full_spectrum_bright_red_to_blue",label:null,colors:[{label:null,value:1,rgb:[255,0,0]},{label:null,value:2,rgb:[255,119,0]},{label:null,value:3,rgb:[255,200,0]},{label:null,value:4,rgb:[238,255,56]},{label:null,value:5,rgb:[182,255,143]},{label:null,value:6,rgb:[89,255,225]},{label:null,value:7,rgb:[51,194,255]},{label:null,value:8,rgb:[56,106,255]},{label:null,value:9,rgb:[0,0,255]}]},{name:"1_9_full_spectrum_bright_blue_to_red",label:null,colors:[{label:null,value:1,rgb:[0,0,255]},{label:null,value:2,rgb:[56,106,255]},{label:null,value:3,rgb:[51,194,255]},{label:null,value:4,rgb:[89,255,225]},{label:null,value:5,rgb:[182,255,143]},{label:null,value:6,rgb:[238,255,56]},{label:null,value:7,rgb:[255,200,0]},{label:null,value:8,rgb:[255,119,0]},{label:null,value:9,rgb:[255,0,0]}]},{name:"1_9_partial_spectrum_yellow_to_blue",label:null,colors:[{label:null,value:1,rgb:[242,241,162]},{label:null,value:2,rgb:[252,250,98]},{label:null,value:3,rgb:[255,255,0]},{label:null,value:4,rgb:[255,149,0]},{label:null,value:5,rgb:[255,0,0]},{label:null,value:6,rgb:[245,5,189]},{label:null,value:7,rgb:[176,7,237]},{label:null,value:8,rgb:[99,24,204]},{label:null,value:9,rgb:[7,29,173]}]},{name:"1_9_partial_spectrum_blue_to_yellow",label:null,colors:[{label:null,value:1,rgb:[7,29,173]},{label:null,value:2,rgb:[99,24,204]},{label:null,value:3,rgb:[176,7,237]},{label:null,value:4,rgb:[245,5,189]},{label:null,value:5,rgb:[255,0,0]},{label:null,value:6,rgb:[255,149,0]},{label:null,value:7,rgb:[255,255,0]},{label:null,value:8,rgb:[252,250,98]},{label:null,value:9,rgb:[242,241,162]}]},{name:"1_9_yellow_green_to_dark_blue",label:null,colors:[{label:null,value:1,rgb:[255,255,128]},{label:null,value:2,rgb:[182,245,88]},{label:null,value:3,rgb:[113,235,47]},{label:null,value:4,rgb:[59,214,45]},{label:null,value:5,rgb:[61,184,104]},{label:null,value:6,rgb:[42,156,154]},{label:null,value:7,rgb:[33,110,158]},{label:null,value:8,rgb:[31,62,140]},{label:null,value:9,rgb:[12,16,120]}]},{name:"1_9_dark_blue_to_yellow_green",label:null,colors:[{label:null,value:1,rgb:[12,16,120]},{label:null,value:2,rgb:[31,62,140]},{label:null,value:3,rgb:[33,110,158]},{label:null,value:4,rgb:[42,156,154]},{label:null,value:5,rgb:[61,184,104]},{label:null,value:6,rgb:[59,214,45]},{label:null,value:7,rgb:[113,235,47]},{label:null,value:8,rgb:[182,245,88]},{label:null,value:9,rgb:[255,255,128]}]},{name:"1_9_cold_to_hot_diverging",label:null,colors:[{label:null,value:1,rgb:[40,146,199]},{label:null,value:2,rgb:[109,169,179]},{label:null,value:3,rgb:[160,194,155]},{label:null,value:4,rgb:[206,222,129]},{label:null,value:5,rgb:[250,250,100]},{label:null,value:6,rgb:[252,196,76]},{label:null,value:7,rgb:[250,141,52]},{label:null,value:8,rgb:[242,89,34]},{label:null,value:9,rgb:[232,16,20]}]},{name:"1_9_hot_to_cold_diverging",label:null,colors:[{label:null,value:1,rgb:[232,16,20]},{label:null,value:2,rgb:[242,89,34]},{label:null,value:3,rgb:[250,141,52]},{label:null,value:4,rgb:[252,196,76]},{label:null,value:5,rgb:[250,250,100]},{label:null,value:6,rgb:[206,222,129]},{label:null,value:7,rgb:[160,194,155]},{label:null,value:8,rgb:[109,169,179]},{label:null,value:9,rgb:[40,146,199]}]},{name:"1_9_surface_low_to_high",label:null,colors:[{label:null,value:1,rgb:[112,153,89]},{label:null,value:2,rgb:[176,196,124]},{label:null,value:3,rgb:[242,238,162]},{label:null,value:4,rgb:[242,224,150]},{label:null,value:5,rgb:[242,206,133]},{label:null,value:6,rgb:[217,169,130]},{label:null,value:7,rgb:[194,140,124]},{label:null,value:8,rgb:[255,184,193]},{label:null,value:9,rgb:[255,242,255]}]},{name:"1_9_surface_high_to_low",label:null,colors:[{label:null,value:1,rgb:[255,242,255]},{label:null,value:2,rgb:[255,184,193]},{label:null,value:3,rgb:[194,140,124]},{label:null,value:4,rgb:[217,169,130]},{label:null,value:5,rgb:[242,206,133]},{label:null,value:6,rgb:[242,224,150]},{label:null,value:7,rgb:[242,238,162]},{label:null,value:8,rgb:[176,196,124]},{label:null,value:9,rgb:[112,153,89]}]}]),O}class A extends e.React.PureComponent{render(){const t=this.props.lowLabel,l=this.props.highLabel,r=[],a=T(this.props.defName);a&&a.colors.forEach((e=>{r.push(this.renderColor(e))}));const o=e.css`
      margin: 0 6px;
    `;return(0,e.jsx)("div",{className:"widget-wro-color-ramp"},(0,e.jsx)("span",{css:o},t),(0,e.jsx)("span",{className:"widget-wro-color-ramp-container"},r),(0,e.jsx)("span",{css:o},l))}renderColor(t){let l=null,r=t.label;const a=t.value.toString();r&&(r=r.trim()),r&&r.length>0&&a&&a.length>0?l=this.props.nls("wro_colorRamp_tipPattern",{label:r,value:a}):r&&r.length>0?l=r:a&&a.length>0&&(l=a);const o=t.rgb,n={backgroundColor:"rgb("+o[0].toString()+","+o[1].toString()+","+o[2].toString()+")"};return(0,e.jsx)("span",{key:t.value.toString(),className:"widget-wro-color-ramp-color",style:n,title:l})}}class H extends e.React.PureComponent{render(){const t=this.props.wroContext.nls,l=this.props.wroModel,a=this.props.wroContext.modelController,o=t("wro_colorRamp_low"),n=t("wro_colorRamp_high");let i;const s=null==l?void 0:l.colormapName;if(s){const t=T(s);t&&(i=(0,e.jsx)(A,{defName:t.name,lowLabel:o,highLabel:n,nls:this.props.wroContext.nls}))}const u=[],c=V();return l&&c&&c.forEach((t=>{u.push((0,e.jsx)(r.DropdownItem,{key:t.name,onClick:()=>{a.setColormapName(l,t.name)}},(0,e.jsx)(A,{defName:t.name,lowLabel:o,highLabel:n,nls:this.props.wroContext.nls})))})),(0,e.jsx)("div",{className:"widget-wro-colormap-selector"},(0,e.jsx)(r.Dropdown,{title:t("wro_main_setSymbology")},(0,e.jsx)(r.DropdownButton,null,i),(0,e.jsx)(r.DropdownMenu,{className:"widget-wro-color-dropdown-menu"},u)))}}class F{clear(e){return(e=U.cloneModel(e)).colormapName="1_9_green_yellow_red",e.modelLayers&&e.modelLayers.forEach((t=>{t.selected=!1,t.remapOpen=!1,t.weight=null;const l=U.findRasterLayer(e,t.rasterLayerId);(null==l?void 0:l.remapRanges)&&(t.remapRanges=U.cloneRemapRanges(l.remapRanges))})),e.activePanel="layers-panel",this.onModelChange(e,!0),e}isLayerSelected(e,t){const l=U.findModelLayer(e,t);return!!(null==l?void 0:l.selected)}isValid(e){let t=0;return(null==e?void 0:e.modelLayers)&&e.modelLayers.forEach((e=>{e.selected&&"number"==typeof e.weight&&(t+=e.weight)})),100===t}onModelChange(e,t){}onStatusChange(e){}selectLayer(e,t,l){e=U.cloneModel(e);const r=U.findModelLayer(e,t);if(r&&!l){const l=U.findRasterLayer(e,t);(null==l?void 0:l.remapRanges)&&(r.remapRanges=U.cloneRemapRanges(l.remapRanges)),r.remapOpen=!1,r.weight=null}return r&&(r.selected=!!l),this.onModelChange(e),e}setActivePanel(e,t){return(e=U.cloneModel(e)).activePanel=t,this.onModelChange(e),e}setColormapName(e,t){return(e=U.cloneModel(e)).colormapName=t,this.onModelChange(e),e}setMapLayerId(e,t){return(e=U.cloneModel(e)).mapLayerId=t,e.lastRun=this.stringifyCriteria(e),this.onModelChange(e),e}setRemapOpen(e,t,l){e=U.cloneModel(e);const r=U.findModelLayer(e,t);return r&&(r.remapOpen=!!l),this.onModelChange(e),e}setRemapOutputValue(e,t,l,r){e=U.cloneModel(e);const a=U.findModelLayer(e,t);return a&&(a.remapRanges[l].outputValue=r),this.onModelChange(e),e}setWeight(e,t,l){e=U.cloneModel(e);const r=U.findModelLayer(e,t);return r&&(r.weight=l),this.onModelChange(e),e}stringifyCriteria(e){const t=[];return e.modelLayers&&e.modelLayers.forEach((e=>{e.selected&&"number"==typeof e.weight&&e.weight>0&&t.push({remapRanges:e.remapRanges,weight:e.weight})})),JSON.stringify({colormapName:e.colormapName,mapLayerId:e.mapLayerId,modelLayers:t,serviceUrl:e.serviceUrl})}}class U{static cloneModel(e){return JSON.parse(JSON.stringify(e))}static cloneRasterLayers(e){return JSON.parse(JSON.stringify(e))}static cloneRemapRanges(e){return JSON.parse(JSON.stringify(e))}static cloneStatus(e){return JSON.parse(JSON.stringify(e))}static findModelLayer(e,t){let l;return e.modelLayers&&e.modelLayers.some((e=>(e.rasterLayerId===t&&(l=e),!!l))),l}static findRasterLayer(e,t){let l;return e.rasterLayers&&e.rasterLayers.some((e=>(e.rasterLayerId===t&&(l=e),!!l))),l}static initModel(e,t){const l=this.newWroModel();return l.serviceUrl=e.serviceUrl,t&&t.length>0&&(l.loadErrors=JSON.parse(JSON.stringify(t))),(null==e?void 0:e.rasterLayers)&&(l.rasterLayers=this.cloneRasterLayers(e.rasterLayers),l.rasterLayers.forEach((e=>{const t=this.newModelLayer();t.rasterLayerId=e.rasterLayerId,t.title=e.title,e.remapRanges&&(t.remapRanges=this.cloneRemapRanges(e.remapRanges)),t.remapRanges&&t.remapRanges.length>0&&l.modelLayers.push(t)}))),l}static newIssue(){return{detail:null,message:null}}static newModelLayer(){return{rasterLayerId:null,remapOpen:!1,remapRanges:[],selected:!1,title:null,weight:null}}static newRasterLayer(){return{metadata:null,name:null,rasterLayerId:null,remapRanges:[],title:null,url:null}}static newRemapRange(){return{inputMax:null,inputMin:null,label:null,originalOutputValue:null,outputValue:null}}static newWroModel(){return{activePanel:null,colormapName:"1_9_green_yellow_red",lastRun:null,loadErrors:[],mapLayerId:null,modelLayers:[],rasterLayers:[],serviceUrl:null}}static newWroStatus(){return{activePanel:null,isModelLoading:!1,isModelRunning:!1,themeId:null,viewId:null}}}function G(e,t){t||(t={});const l={rasterFunction:"Local",rasterFunctionArguments:{Operation:e,ExtentType:0,CellsizeType:1,Rasters:t.rasters||[]}};return t.outputPixelType&&(l.outputPixelType=t.outputPixelType),l}function B(e,t,l,r){const a=[];let o,n,i,s=!1;return r&&(o=r.labels,n=r.noDataLabels,i=r.sortBy),Array.isArray(e)&&Array.isArray(t)&&e.length===2*t.length&&(s=Array.isArray(o)&&o.length===t.length,t.forEach(((t,l)=>{const r=2*l,n=U.newRemapRange();n.label=null,n.inputMin=e[r],n.inputMax=e[r+1],n.outputValue=t,n.originalOutputValue=t,n.label=s?o[l]:W(n.inputMin,n.inputMax),a.push(n)}))),Array.isArray(l)&&l.length>0&&(s=Array.isArray(n)&&n.length===l.length/2,l.forEach(((e,t)=>{if(t%2==0){const r=U.newRemapRange();r.label=null,r.inputMin=e,r.inputMax=l[t+1],r.outputValue=0,r.originalOutputValue=0,r.label=s?n[t]:W(r.inputMin,r.inputMax),a.push(r)}}))),a.length>0?(i&&a.sort(((e,t)=>e[i]<t[i]?-1:e[i]>t[i]?1:0)),a):void 0}function W(e,t){return e===t?`${e}`:`${e} - ${t}`}function J(e){let t;const l=e.modelLayers.filter((e=>!!(e.selected&&"number"==typeof e.weight&&e.weight>0))).map((e=>{const t=function(e){if(!e)return;const t={},l=[],r=[],a=[],o=[],n=[],i=!0,s="InputRanges",u="OutputValues",c="NoDataRanges",d="Labels",g="NoDataLabels";return e.forEach((e=>{const t=e.label||W(e.inputMin,e.inputMax);e.outputValue?(l.push(e.inputMin),l.push(e.inputMax),r.push(e.outputValue),o.push(t)):(a.push(e.inputMin),a.push(e.inputMax),n.push(t))})),r.length>0&&(t[s]=l,t[u]=r,i&&(t[d]=o)),a.length>0&&(t[c]=a,i&&(t[g]=n)),t}(e.remapRanges);return t.Raster="$"+e.rasterLayerId.toString(),t.weight=e.weight/100,t})),r=T(e.colormapName);r&&(t=r.colors.map((e=>[e.value].concat(e.rgb))));const a=function(e,t){const l=e.map((e=>{const t=function(e){return e||(e={}),{rasterFunction:"Remap",rasterFunctionArguments:{Raster:e.Raster||"$$",UseTable:!1,InputRanges:e.InputRanges||[],OutputValues:e.OutputValues||[],NoDataRanges:e.NoDataRanges||[],AllowUnmatched:!0}}}(e);return G(3,{rasters:[t,e.weight]})})),r=G(55,{rasters:l});return function(e){return e||(e={}),{rasterFunction:"Colormap",rasterFunctionArguments:{Raster:e.raster||"$$",Colormap:e.colormap||[]}}}({raster:G(49,{rasters:[r],outputPixelType:"U8"}),colormap:t})}(l,t);return a}var z=w(69383);class Z extends e.React.PureComponent{constructor(e){super(e),this.home="__home__",this.chk=e=>"string"==typeof e&&(e=e.trim()).length>0?e:null,this.close=()=>{this.props.close&&this.props.close()},this.exportModel=()=>{const e=this.portal,t=this.itemData,l=this.serviceUrl,{title:r,summary:a,description:o,tags:n,folder:i}=this.state;if(!e||!e.user||!r)return;const s={title:r,summary:a,description:o,tags:n,itemData:t,portal:e,serviceUrl:l};i!==this.home&&(s.folder=i),this.props.exportModel&&this.props.exportModel(s),this.close()},this.handleDescriptionChange=e=>{const t=this.chk(e.target.value);this.setState({description:t})},this.handleFolderChange=e=>{const t=this.chk(e.target.value);this.setState({folder:t})},this.handleSummaryChange=e=>{const t=this.chk(e.target.value);this.setState({summary:t})},this.handleTagsChange=e=>{const t=this.chk(e.target.value);this.setState({tags:t})},this.handleTitleChange=e=>{const t=this.chk(e.target.value);this.setState({title:t,hasTitle:!!t})},this._handleToggle=e=>{e?this.exportModel():this.close()},this.init=()=>{return e=this,t=void 0,r=function*(){try{const e=this.props.wroModel;this.serviceUrl=e.serviceUrl,this.itemData=function(e){const t=J(e);if(t)return{renderingRule:t}}(e);const t=[],l=this.props.wroContext.getPortalUrl(),r=new z.default({url:l});if(yield r.load(),r.user){this.portal=r;const e=yield r.user.fetchFolders();e&&e.forEach((e=>{t.push({id:e.id,title:e.title})}))}t.length>0&&this.setState({folders:t,hasPortal:!!r.user})}catch(e){console.error(e)}},new((l=void 0)||(l=Promise))((function(a,o){function n(e){try{s(r.next(e))}catch(e){o(e)}}function i(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?a(e.value):(t=e.value,t instanceof l?t:new l((function(e){e(t)}))).then(n,i)}s((r=r.apply(e,t||[])).next())}));var e,t,l,r},this.state={title:null,summary:null,description:null,tags:null,folder:this.home,folders:null,hasPortal:!1,hasTitle:!1}}componentDidMount(){this.init().catch((()=>{}))}render(){const t=this.props.wroContext.nls,l=this.state.title?"widget-wro-valid-modal":"widget-wro-invalid-modal";return(0,e.jsx)("div",null,(0,e.jsx)(r.AlertPopup,{className:`widget-wro-export-popup ${l}`,isOpen:!0,okLabel:t("wro_general_export"),title:t("wro_general_export"),toggle:this._handleToggle},this.renderForm()))}renderForm(){const t=this.props.wroContext.nls,l=this.props.wroContext.getId()+"_export",a=this.props.wroContext.getUser(),o=(null==a?void 0:a.username)||"",n=!!this.state.title,i=this.home,s=[],u=t("wro_saveModel_homeFolderPattern",{username:o});s.push((0,e.jsx)("option",{key:i,value:i},u));const c=this.state.folders;c&&c.forEach((t=>{s.push((0,e.jsx)("option",{key:t.id,value:t.id},t.title))}));let d="wro_saveModel_title";return n||(d="wro_saveModel_titleRequired"),(0,e.jsx)(r.Form,{className:"widget-wro-form"},(0,e.jsx)(r.FormGroup,null,(0,e.jsx)(r.Label,{for:l+"_title"},t(d)),(0,e.jsx)(r.TextInput,{id:l+"_title",type:"text",onChange:this.handleTitleChange})),(0,e.jsx)(r.FormGroup,null,(0,e.jsx)(r.Label,{for:l+"_summary"},t("wro_saveModel_summary")),(0,e.jsx)(r.TextInput,{id:l+"_summary",type:"text",onChange:this.handleSummaryChange})),(0,e.jsx)(r.FormGroup,null,(0,e.jsx)(r.Label,{for:l+"_description"},t("wro_saveModel_description")),(0,e.jsx)(r.TextArea,{id:l+"_description",onChange:this.handleDescriptionChange})),(0,e.jsx)(r.FormGroup,null,(0,e.jsx)(r.Label,{for:l+"_tags"},t("wro_saveModel_tags")),(0,e.jsx)(r.TextInput,{id:l+"_tags",type:"text",defaultValue:"weightedOverlayModel, geodesign",onChange:this.handleTagsChange})),(0,e.jsx)(r.FormGroup,null,(0,e.jsx)(r.Label,{for:l+"_folder"},t("wro_saveModel_folder")),(0,e.jsx)(r.Select,{id:l+"_folder",defaultValue:i,onChange:this.handleFolderChange},s)))}}class $ extends e.React.PureComponent{render(){const t=this.props.wroModel,l=this.props.modelLayer,r=[],a=null==l?void 0:l.remapRanges;return a&&a.forEach(((e,a)=>{r.push(this.renderRange(e,a,l,t))})),(0,e.jsx)("div",{className:"widget-wro-remap-panel"},r)}renderRange(t,l,a,o){const n=this.props.wroContext.nls,i=this.props.wroContext.modelController,s="remap_"+a.rasterLayerId.toString()+"_"+l.toString();let u;u=t.inputMin===t.inputMax?`${t.inputMin}`:`${t.inputMin} - ${t.inputMax}`;const c=n("wro_remap_label",{name:t.label,minmax:u}),d=e.css`
      white-space: nowrap;
    `;return(0,e.jsx)("div",{key:s+"_item",className:"widget-wro-remap-range"},(0,e.jsx)("div",{className:"widget-wro-remap-range-label",title:c},c),(0,e.jsx)("div",{key:s+"_inputSection",css:d},(0,e.jsx)(r.Slider,{key:s+"_slider",className:"widget-wro-remap-slider",min:0,max:9,step:1,value:t.outputValue,onChange:e=>{const t=parseInt(e.target.value);i.setRemapOutputValue(o,a.rasterLayerId,l,t)}}),(0,e.jsx)(r.NumericInput,{key:s+"_input",className:"widget-wro-remap-numeric-input",size:"sm",min:0,max:9,precision:0,showHandlers:!1,value:t.outputValue,onChange:e=>{"number"==typeof e&&i.setRemapOutputValue(o,a.rasterLayerId,l,e)}})))}}var q=w(92055),Y=w(91524);function Q(e,t){var l;return t&&(null===(l=null==e?void 0:e.map)||void 0===l?void 0:l.findLayerById(t))}function K(e,t){return l=this,r=void 0,o=function*(){const l=e.getView();if(null==l?void 0:l.map){const r=J(t),a=Y.default.fromJSON(r);let o=Q(l,t.mapLayerId);return o?(o.renderingRule=a,o.visible||(o.visible=!0),e.modelController.setMapLayerId(t,o.id)):(o=new q.default({renderingRule:a,url:t.serviceUrl}),yield o.load(),l.map.add(o,0),e.modelController.setMapLayerId(t,o.id)),o}},new((a=void 0)||(a=Promise))((function(e,t){function n(e){try{s(o.next(e))}catch(e){t(e)}}function i(e){try{s(o.throw(e))}catch(e){t(e)}}function s(t){var l;t.done?e(t.value):(l=t.value,l instanceof a?l:new a((function(e){e(l)}))).then(n,i)}s((o=o.apply(l,r||[])).next())}));var l,r,a,o}var X=w(14345),ee=function(e,t,l,r){return new(l||(l=Promise))((function(a,o){function n(e){try{s(r.next(e))}catch(e){o(e)}}function i(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?a(e.value):(t=e.value,t instanceof l?t:new l((function(e){e(t)}))).then(n,i)}s((r=r.apply(e,t||[])).next())}))};class te extends e.React.PureComponent{constructor(e){super(e),this.handleClearClicked=()=>{const e=this.props.wroContext,t=this.props.wroContext.modelController,l=this.props.wroModel;l&&(function(e,t){const l=e.getView();if(null==l?void 0:l.map){const e=Q(l,t.mapLayerId);e&&(e.visible=!1,e.renderingRule=null)}}(e,l),t.clear(l))},this.closeAlert=()=>{this.setState({alertMessage:null})},this.closeExport=()=>{this.setState({showExport:!1})},this.exportModel=e=>ee(this,void 0,void 0,(function*(){if(this.state.isExporting)return;this.setState({isExporting:!0,showExportSuccessMsg:!1,showExportFailedMsg:!1});const t=this.props.wroContext.nls;try{yield function(e){return t=this,l=void 0,a=function*(){const{title:t,summary:l,description:r,tags:a,folder:o}=e,{itemData:n,portal:i,serviceUrl:s}=e;let u=[];"string"==typeof a&&(u=a.split(",").filter((e=>e.length>0))),0===u.length&&(u=["weightedOverlayModel","geodesign"]);const c={item:new S.default({type:"Image Service",typeKeywords:["geodesignModelerLayer"],title:t,snippet:l,description:r,tags:u,url:s})};n&&(c.data=JSON.stringify(n)),o&&(c.folder=o),yield i.user.addItem(c)},new((r=void 0)||(r=Promise))((function(e,o){function n(e){try{s(a.next(e))}catch(e){o(e)}}function i(e){try{s(a.throw(e))}catch(e){o(e)}}function s(t){var l;t.done?e(t.value):(l=t.value,l instanceof r?l:new r((function(e){e(l)}))).then(n,i)}s((a=a.apply(t,l||[])).next())}));var t,l,r,a}(e),this.setState({isExporting:!1,showExportSuccessMsg:!0})}catch(e){console.error(e),console.error("Error exporting WRO model",e);const l=(null==e?void 0:e.message)||t("wro_saveModel_failed");this.setState({isExporting:!1,alertMessage:l,showExportFailedMsg:!0})}})),this.handleExportClicked=()=>{this.state.isRunning||this.state.isExporting||this.runModel(!0).catch((()=>{}))},this.handleLayersPanelClicked=()=>{const e=this.props.wroContext.modelController,t=this.props.wroModel;t&&e.setActivePanel(t,"layers-panel")},this.handleChartPanelClicked=()=>{const e=this.props.wroContext.modelController,t=this.props.wroModel;t&&e.setActivePanel(t,"chart-panel")},this.handleRunClicked=()=>{this.state.isRunning||this.runModel(!1).catch((()=>{}))},this.runModel=e=>ee(this,void 0,void 0,(function*(){if(this.state.isRunning)return;const t=this.props.wroContext.nls,l=this.props.wroContext,r=this.props.wroModel;if(r){this.setState({isRunning:!0,isLayerRefreshing:!0});try{const t={isRunning:!1,isLayerRefreshing:!1},a=yield K(l,r);if(a){const e=l.getView();e&&(t.isLayerRefreshing=!0,e.whenLayerView(a).then((e=>{X.default.whenFalseOnce(e,"updating",(()=>{this.setState({isLayerRefreshing:!1})}))})))}e&&(t.showExport=!0),this.setState(t)}catch(e){console.error("Error running WRO model",e);const l=(null==e?void 0:e.message)||t("wro_main_runError");this.setState({isRunning:!1,isLayerRefreshing:!1,alertMessage:l})}}})),this.state={alertMessage:null,isExporting:!1,isLayerRefreshing:!1,isRunning:!1,showExport:!1,showExportSuccessMsg:!1,showExportFailedMsg:!1}}render(){const t=this.props.wroContext.nls,l=this.props.wroContext,a=this.props.wroModel,o=this.props.wroStatus,n=null==a?void 0:a.modelLayers,i=[];let s;n&&n.forEach((e=>{if(e.selected){const t=this.renderLayer(e,a);i.push(t)}}));const u=this.state.alertMessage;let c;return u&&(s=(0,e.jsx)(r.AlertPopup,{isOpen:!0,hideOK:!0,cancelLabel:t("wro_general_close"),title:t("wro_main_modelIssue"),toggle:this.closeAlert},(0,e.jsx)("div",{style:{fontSize:"small",minWidth:"300px"}},u))),this.state.showExport&&(c=(0,e.jsx)(Z,{wroContext:l,wroModel:a,wroStatus:o,close:this.closeExport,exportModel:this.exportModel})),(0,e.jsx)("div",{className:"widget-wro-model-panel"},(0,e.jsx)("div",{className:"widget-wro-panel-header widget-wro-flex-between"},(0,e.jsx)("div",null,(0,e.jsx)("span",null,t("wro_main_designModelCaption")),s,c),(0,e.jsx)(H,{wroContext:l,wroModel:a,wroStatus:o})),(0,e.jsx)("div",{className:"widget-wro-model-panel-body"},(0,e.jsx)("ul",{className:"widget-wro-model-layers-list"},i),(0,e.jsx)("div",{className:"widget-wro-model-footer"},this.renderAlerts(),this.renderTotal(),this.renderButtons())))}renderButtons(){const t=this.props.wroContext.nls,l=this.props.wroContext.modelController,a=this.props.wroModel,o=this.props.wroContext.getView(),{isExporting:n,isRunning:i}=this.state,s=!!this.props.wroStatus.viewId,u=!!a,c=[];let d=!1;a&&(d=l.isValid(a));let g=!0;if(a&&a.lastRun&&a.mapLayerId&&l.stringifyCriteria(a)===a.lastRun){const e=Q(o,a.mapLayerId);e&&e.visible&&(g=!1)}let h=!1;const p=!!this.props.wroContext.getConfig().allowExport,w=this.props.wroContext.getUser();return p&&w&&w.privileges&&-1!==w.privileges.indexOf("portal:user:createItem")&&(h=!0),c.push((0,e.jsx)(r.Button,{key:"clear",disabled:!u,onClick:this.handleClearClicked},t("wro_general_clear"))),h&&c.push((0,e.jsx)(r.Button,{key:"export",disabled:!d||!s||i||n||g,onClick:this.handleExportClicked},t("wro_general_export"))),c.push((0,e.jsx)(r.Button,{key:"run",type:"primary",disabled:!d||!s||i||!g,onClick:this.handleRunClicked},t("wro_general_run"))),(0,e.jsx)("div",null,(0,e.jsx)("div",{className:"widget-wro-model-buttons"},(0,e.jsx)("div",{className:"widget-wro-flex-between widget-wro-flex-column"},(0,e.jsx)(r.ButtonGroup,null,c))))}renderAlerts(){const t=[],l=this.props.wroContext.nls,{showExportSuccessMsg:a,showExportFailedMsg:o}=this.state;return t.push((0,e.jsx)(r.Alert,{key:"success",closable:!0,form:"basic",onClose:()=>{this.setState({showExportSuccessMsg:!1})},open:a,text:l("wro_saveModel_success_msg"),type:"success",withIcon:!0}),(0,e.jsx)(r.Alert,{key:"failed",closable:!0,form:"basic",onClose:()=>{this.setState({showExportFailedMsg:!1})},open:o,text:l("wro_saveModel_failed_msg"),type:"error",withIcon:!0})),(0,e.jsx)("div",{className:"widget-wro-alert-container "+(a||o?"":"u-hidden")},t)}renderLayer(t,l){const a=this.props.wroContext.nls,o=this.props.wroContext.modelController,n=this.props.wroContext,i=this.props.wroStatus,s="layer_"+t.rasterLayerId.toString();let u,c=t.weight;return"number"!=typeof c&&(c=0),t.remapOpen&&(u=(0,e.jsx)($,{modelLayer:t,wroContext:n,wroModel:l,wroStatus:i})),(0,e.jsx)("li",{key:s+"_li"},(0,e.jsx)("div",{key:s+"_item",className:"widget-wro-model-item"},(0,e.jsx)("div",{className:"widget-wro-model-item-label"},t.title),(0,e.jsx)("div",{key:s+"_section",className:"widget-wro-model-item-input-section"},(0,e.jsx)(r.Button,{size:"sm",icon:!0,active:t.remapOpen,className:"widget-wro-model-item-remap-btn",onClick:()=>{o.setRemapOpen(l,t.rasterLayerId,!t.remapOpen)},title:a("wro_main_setScores")},(0,e.jsx)(r.Icon,{icon:E()})),(0,e.jsx)(r.NumericInput,{key:s+"_input",className:"widget-wro-input-weight",size:"sm",min:0,max:100,precision:0,showHandlers:!1,defaultValue:c,onChange:e=>{"number"!=typeof e&&(e=null),o.setWeight(l,t.rasterLayerId,e)}}),(0,e.jsx)("span",{className:"widget-wro-model-item-percent"},"%"))),u)}renderTotal(){var t;const l=this.props.wroContext.nls,r=this.props.wroModel,a=!!this.props.wroStatus.viewId,{isRunning:o,isLayerRefreshing:n}=this.state,i=null===(t=null===document||void 0===document?void 0:document.documentElement)||void 0===t?void 0:t.lang;let s=0;const u=null==r?void 0:r.modelLayers;u&&u.forEach((e=>{e.selected&&"number"==typeof e.weight&&(s+=e.weight)}));let c=s.toString()+"%";"ar"!==i&&"tr"!==i||(c="%"+s.toString());const d=this.props.wroContext.getTheme();let g,h;return g=100===s?e.css`
        background-color: ${d.colors.palette.success[100]};
      `:e.css`
        background-color: ${d.colors.palette.danger[100]};
      `,a?(o||n)&&(h=(0,e.jsx)("span",{className:"widget-wro-model-working"},l("wro_chart_working"))):h=(0,e.jsx)("span",{className:"widget-wro-chart-note"},l("wro_validation_noMap")),(0,e.jsx)("div",{className:"widget-wro-model-total",css:g},(0,e.jsx)("span",null,l("wro_main_total")),h,(0,e.jsx)("span",null,c))}}class le extends e.React.PureComponent{constructor(t){super(t),this.canEnableChart=()=>R(this.props),this.canEnableDesignModel=()=>{const e=this.props.wroModel;let t=!1;return(null==e?void 0:e.modelLayers)&&(t=e.modelLayers.some((e=>!!e.selected))),t},this.chartPanelRef=e.React.createRef()}componentDidUpdate(e){const t=this.props.wroContext.modelController,l=this.props.wroModel;if(l&&e.wroModel!==l){const e=l.activePanel;("model-panel"!==e||this.canEnableDesignModel())&&("chart-panel"!==e||this.canEnableChart())||t.setActivePanel(l,"layers-panel")}}render(){const t=this.props.wroContext.nls,l=this.props.wroContext.modelController,a=this.props.wroContext,o=this.props.wroModel,n=this.props.wroStatus,i=!!o,s=(null==o?void 0:o.activePanel)||"layers-panel",u=!this.canEnableDesignModel(),c=!this.canEnableChart();return(0,e.jsx)("div",{className:"widget-wro-modeler"},(0,e.jsx)("h4",{className:"widget-wro-header",style:{display:this.props.wroContext.getLabel()?"block":"none"}},this.props.wroContext.getLabel()),(0,e.jsx)("div",{className:"widget-wro-body"},(0,e.jsx)(r.Tabs,{className:"widget-wro-tabs",value:s,onChange:e=>{o&&l.setActivePanel(o,e)},type:"underline"},(0,e.jsx)(r.Tab,{id:"layers-panel",title:t("wro_main_selectLayersCaption")},(0,e.jsx)(N,{wroContext:a,wroModel:o,wroStatus:n})),(0,e.jsx)(r.Tab,{id:"model-panel",title:t("wro_main_designModelCaption"),disabled:!i||u},(0,e.jsx)(te,{wroContext:a,wroModel:o,wroStatus:n})),(0,e.jsx)(r.Tab,{id:"chart-panel",title:t("wro_chart_generate"),disabled:!i||c},(0,e.jsx)(I,{ref:this.chartPanelRef,wroContext:a,wroModel:o,wroStatus:n})))))}}var re=function(e,t,l,r){return new(l||(l=Promise))((function(a,o){function n(e){try{s(r.next(e))}catch(e){o(e)}}function i(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?a(e.value):(t=e.value,t instanceof l?t:new l((function(e){e(t)}))).then(n,i)}s((r=r.apply(e,t||[])).next())}))};class ae{checkMixedContent(e){return"string"==typeof window.location.href&&0===window.location.href.indexOf("https://")&&"string"==typeof e&&0===e.indexOf("http://")&&(e="https:"+e.substring(5)),e}loadModel(e,t,l){return re(this,void 0,void 0,(function*(){const r=e.nls,a=[];let o,n=U.newWroModel(),i=null;l="string"==typeof l?l.trim():null;const s=(e,t)=>{const l=U.newIssue();l.message=e,(null==t?void 0:t.message)&&(l.detail=t.message),a.push(l)};if((t="string"==typeof t?t.trim():null)||l||0!==a.length||s(r("wro_validation_wroServiceNotDefined")),!t&&l&&0===a.length){this.itemId=l,i=new S.default({id:l});try{yield i.load()}catch(e){console.error("Error loading item",l,e),s(r("wro_validation_errorLoadingItem"),e)}if(0===a.length&&(!this.serviceTitle&&i.title&&(this.serviceTitle=i.title),(t="string"==typeof i.url?i.url.trim():null)||s(r("wro_validation_undefinedItemUrl"))),0===a.length)try{const e=yield i.fetchData("json");o=null==e?void 0:e.renderingRule}catch(e){console.error("Error fetching item data",l,e),s(r("wro_validation_errorLoadingItem"),e)}}if(t&&0===a.length){if(this.serviceUrl=this.checkMixedContent(t),0!==this.serviceUrl.indexOf("http://")&&0!==this.serviceUrl.indexOf("https://"))s(r("wro_validation_invalidServiceUrl"));else try{new URL(this.serviceUrl)||s(r("wro_validation_invalidServiceUrl"))}catch(e){s(r("wro_validation_invalidServiceUrl"))}if(0===a.length)try{this.serviceJson=yield this.readServiceJson(this.serviceUrl),!this.serviceTitle&&this.serviceJson&&this.serviceJson.name&&(this.serviceTitle=this.serviceJson.name)}catch(e){console.error("Error loading service",this.serviceUrl,e),s(r("wro_validation_errorloadingService"),e)}if(0===a.length&&function(e,t,l){const r=(e,t)=>{const r=U.newIssue();r.message=e,(null==t?void 0:t.message)&&(r.detail=t.message),l.push(r)};if(!(t.currentVersion>=10.3&&t.rasterTypeInfos))return void r(e("wro_validation_notAWroService"));t.allowRasterFunction||r(e("wro_validation_notAllowRasterFunction")),"Nearest"!==t.defaultResamplingMethod&&r(e("wro_validation_notNearestResampling"));const a=t.fields||[];["Title","Url","Description","InputRanges","OutputValues","NoDataRanges","RangeLabels","NoDataRangeLabels"].forEach((t=>{if(!a.some((e=>t===e.name))){const l=e("wro_validation_missingFieldPattern",{field:t});r(l)}}))}(e.nls,this.serviceJson,a),0===a.length)try{yield this.queryRasters(this.serviceUrl)}catch(e){console.error("Error querying mosaic",this.serviceUrl,e),s(r("wro_validation_errorQueryingLayers"),e)}}const u=this.rasterLayers&&this.rasterLayers.length>0;return 0!==a.length||u||s(r("wro_validation_noLayers")),n=U.initModel(this,a),o&&0===a.length&&function(e,t){let l,r,a=t;if(l=a.rasterFunctionArguments,"Colormap"===a.rasterFunction){const e=l.Colormap;e&&(r=function(e){let t;return O&&O.some((l=>(l.colors.every(((t,l)=>{let r=!1;const a=[t.value].concat(t.rgb),o=e[l];return a&&o&&a.length===o.length&&(r=a.every(((e,t)=>e===o[t]))),r}))&&(t=l.name),!!t))),t}(e)),a=l.Raster,l=a.rasterFunctionArguments}"Local"===a.rasterFunction&&49===l.Operation?(a=l.Rasters[0],l=a.rasterFunctionArguments):"Local"===a.rasterFunction&&48===l.Operation&&(l.Operation=49,a=l.Rasters[0],l=a.rasterFunctionArguments),"Local"===a.rasterFunction&&55===l.Operation&&l.Rasters&&(l.Rasters.map((t=>{var l;if(null===(l=null==t?void 0:t.rasterFunctionArguments)||void 0===l?void 0:l.Rasters){const l={};return t.rasterFunctionArguments.Rasters.forEach((t=>{if(isNaN(t)){l.id=parseInt(t.rasterFunctionArguments.Raster.substr(1),10);const r=U.findRasterLayer(e,l.id);l.remapRanges=function(e){let t;if(e){const l={inputRangesArgumentName:"InputRanges",outputValuesArgumentName:"OutputValues",noDataRangesArgumentName:"NoDataRanges",labelsArgumentName:"Labels",noDataLabelsArgumentName:"NoDataLabels"};t=B(e[l.inputRangesArgumentName],e[l.outputValuesArgumentName],e[l.noDataRangesArgumentName],{labels:e[l.labelsArgumentName],noDataLabels:e[l.noDataLabelsArgumentName],sortBy:"inputMin"})}return t}(t.rasterFunctionArguments),(null==r?void 0:r.remapRanges)&&r.remapRanges.forEach(((e,t)=>{const r=l.remapRanges[t];r&&(r.label=e.label)}))}else l.weight=100*t})),l}return null})).forEach((t=>{if(t&&"number"==typeof t.id&&"number"==typeof t.weight&&t.weight>0&&t.weight<=100){const l=U.findModelLayer(e,t.id);l&&(l.selected=!0,l.weight=t.weight,t.remapRanges&&(l.remapRanges=t.remapRanges))}})),r&&(e.colormapName=r))}(n,o),n}))}queryRasters(e){return re(this,void 0,void 0,(function*(){e+="/query";return(0,x.default)(e,{query:{f:"json",where:"1=1",outFields:["*"],returnGeometry:!1},responseType:"json"}).then((e=>{var t;const l=null===(t=null==e?void 0:e.data)||void 0===t?void 0:t.features;if(l&&l.length>0&&l[0].attributes){const e="Title";l.sort(((t,l)=>t.attributes[e]<l.attributes[e]?-1:t.attributes[e]>l.attributes[e]?1:0));const t=[];l.forEach((e=>{const l=function(e){try{if(e.attributes&&"ForestFragmentation_US_USFS_2002"===e.attributes.Name&&"Forest Fragmentation"===e.attributes.Title&&49===e.attributes.OBJECTID)return null}catch(e){}const t=e.attributes;let l,r,a,o,n,i;return t&&(i=U.newRasterLayer(),i.rasterLayerId=t.OBJECTID,i.name=t.Name,i.title=t.Title,i.url=t.Url,i.metadata=t.Metadata,t.InputRanges&&"string"==typeof t.InputRanges&&t.OutputValues&&"string"==typeof t.OutputValues&&(l=t.InputRanges.split(",").map((e=>parseFloat(e.trim()))),r=t.OutputValues.split(",").map((e=>parseInt(e.trim(),10))),t.RangeLabels&&"string"==typeof t.RangeLabels&&(o=t.RangeLabels.split(",").map((e=>e.trim())))),t.NoDataRanges&&"string"==typeof t.NoDataRanges&&(a=t.NoDataRanges.split(",").map((e=>parseFloat(e.trim()))),t.NoDataRangeLabels&&"string"==typeof t.NoDataRangeLabels&&(n=t.NoDataRangeLabels.split(",").map((e=>e.trim())))),i.remapRanges=B(l,r,a,{labels:o,noDataLabels:n,sortBy:"inputMin"})),i}(e);l&&(l.url=this.checkMixedContent(l.url),t.push(l))})),this.rasterLayers=t}}))}))}readServiceJson(e){return re(this,void 0,void 0,(function*(){return(0,x.default)(e,{query:{f:"json"},responseType:"json"}).then((e=>null==e?void 0:e.data))}))}}class oe{constructor(){this.modelController=new F,this.getConfig=()=>{},this.getId=()=>null,this.getLabel=()=>null,this.getPortal=()=>{},this.getPortalUrl=()=>null,this.getTheme=()=>{},this.getUser=()=>{},this.getView=()=>{}}loadModel(e,t){return l=this,r=void 0,o=function*(){const l=new ae;return yield l.loadModel(this,e,t)},new((a=void 0)||(a=Promise))((function(e,t){function n(e){try{s(o.next(e))}catch(e){t(e)}}function i(e){try{s(o.throw(e))}catch(e){t(e)}}function s(t){var l;t.done?e(t.value):(l=t.value,l instanceof a?l:new a((function(e){e(l)}))).then(n,i)}s((o=o.apply(l,r||[])).next())}));var l,r,a,o}nls(e,t){return e}}var ne=w(93379),ie=w.n(ne),se=w(7795),ue=w.n(se),ce=w(90569),de=w.n(ce),ge=w(3565),he=w.n(ge),pe=w(19216),we=w.n(pe),me=w(44589),be=w.n(me),ve=w(51623),ye={};ye.styleTagTransform=be(),ye.setAttributes=he(),ye.insert=de().bind(null,"head"),ye.domAPI=ue(),ye.insertStyleElement=we(),ie()(ve.Z,ye),ve.Z&&ve.Z.locals&&ve.Z.locals;let fe=0;class _e extends e.React.PureComponent{constructor(l){super(l),this.autoRunModel=e=>{var t;const l=this.wroContext,r=this.state.wroModel,a=this.state.jimuMapView;(null===(t=null==a?void 0:a.view)||void 0===t?void 0:t.map)&&r&&(r.mapLayerId||e)&&l.modelController.isValid(r)&&K(l,r).then((()=>{})).catch((e=>{console.error("Error running WRO model",e)}))},this.clearLayers=(e,t)=>{const l=this.wroContext,r=this.props.id;if(null==e?void 0:e.map){let a=e.map.findLayerById(`${r}_drawGfxLayerId`);a&&e.map.remove(a),a=e.map.findLayerById(`${r}_selGfxLayerId`),a&&e.map.remove(a),(null==t?void 0:t.mapLayerId)&&function(e,t){const l=e.getView();if(null==l?void 0:l.map){const e=Q(l,t.mapLayerId);e&&l.map.remove(e)}}(l,t)}},this.handleActiveViewChange=e=>{var t;const l=this.state.wroModel,r=this.state.jimuMapView;(null===(t=null==r?void 0:r.view)||void 0===t?void 0:t.map)&&this.clearLayers(null==r?void 0:r.view,l);const a=U.cloneStatus(this.state.wroStatus);a.viewId=e?this.newViewId():null,this.setState({jimuMapView:e,wroStatus:a},(()=>{}))},this.newThemeId=()=>"themeId_"+(fe++).toString(),this.newViewId=()=>"viewId_"+(fe++).toString(),this.nls=(e,l)=>this.props.intl?this.props.intl.formatMessage({id:e,defaultMessage:t[e]},l):e,this.onWroModelChange=(e,t)=>{var l,r,a,o;try{if(t){const e=null===(o=null===(a=null===(r=null===(l=this.modelerRef)||void 0===l?void 0:l.current)||void 0===r?void 0:r.chartPanelRef)||void 0===a?void 0:a.current)||void 0===o?void 0:o.handleClearClicked;e&&e()}}catch(e){console.error(e)}this.setState({wroModel:e})},this.onWroStatusChange=e=>{this.setState({wroStatus:e})},this.modelerRef=e.React.createRef();const r=U.newWroStatus();var a;this.state={jimuMapView:null,wasModelLoaded:!1,wroModel:null,wroStatus:r},a=this.nls,D||(O||(O=[{name:"1_9_green_yellow_red",label:null,colors:[{label:null,value:1,rgb:[38,115,0]},{label:null,value:2,rgb:[86,148,0]},{label:null,value:3,rgb:[39,181,0]},{label:null,value:4,rgb:[197,219,0]},{label:null,value:5,rgb:[255,255,0]},{label:null,value:6,rgb:[255,195,0]},{label:null,value:7,rgb:[250,142,0]},{label:null,value:8,rgb:[242,85,0]},{label:null,value:9,rgb:[230,0,0]}]},{name:"1_9_red_yellow_green",label:null,colors:[{label:null,value:1,rgb:[230,0,0]},{label:null,value:2,rgb:[242,85,0]},{label:null,value:3,rgb:[250,142,0]},{label:null,value:4,rgb:[255,195,0]},{label:null,value:5,rgb:[255,255,0]},{label:null,value:6,rgb:[197,219,0]},{label:null,value:7,rgb:[39,181,0]},{label:null,value:8,rgb:[86,148,0]},{label:null,value:9,rgb:[38,115,0]}]},{name:"1_9_yellow_to_dark_red",label:null,colors:[{label:null,value:1,rgb:[255,255,128]},{label:null,value:2,rgb:[252,233,106]},{label:null,value:3,rgb:[250,209,85]},{label:null,value:4,rgb:[247,190,67]},{label:null,value:5,rgb:[242,167,46]},{label:null,value:6,rgb:[207,122,31]},{label:null,value:7,rgb:[173,83,19]},{label:null,value:8,rgb:[138,46,10]},{label:null,value:9,rgb:[107,0,0]}]},{name:"1_9_dark_red_to_yellow",label:null,colors:[{label:null,value:1,rgb:[107,0,0]},{label:null,value:2,rgb:[138,46,10]},{label:null,value:3,rgb:[173,83,19]},{label:null,value:4,rgb:[207,122,31]},{label:null,value:5,rgb:[242,167,46]},{label:null,value:6,rgb:[247,190,67]},{label:null,value:7,rgb:[250,209,85]},{label:null,value:8,rgb:[252,233,106]},{label:null,value:9,rgb:[255,255,128]}]},{name:"1_9_light_gray_to_dark_gray",label:null,colors:[{label:null,value:1,rgb:[219,219,219]},{label:null,value:2,rgb:[196,196,196]},{label:null,value:3,rgb:[176,176,176]},{label:null,value:4,rgb:[156,156,156]},{label:null,value:5,rgb:[135,135,135]},{label:null,value:6,rgb:[117,117,117]},{label:null,value:7,rgb:[99,99,99]},{label:null,value:8,rgb:[84,84,84]},{label:null,value:9,rgb:[69,69,69]}]},{name:"1_9_dark_gray_to_light_gray",label:null,colors:[{label:null,value:1,rgb:[69,69,69]},{label:null,value:2,rgb:[84,84,84]},{label:null,value:3,rgb:[99,99,99]},{label:null,value:4,rgb:[117,117,117]},{label:null,value:5,rgb:[135,135,135]},{label:null,value:6,rgb:[156,156,156]},{label:null,value:7,rgb:[176,176,176]},{label:null,value:8,rgb:[196,196,196]},{label:null,value:9,rgb:[219,219,219]}]},{name:"1_9_light_brown_to_dark_brown",label:null,colors:[{label:null,value:1,rgb:[250,233,212]},{label:null,value:2,rgb:[242,208,184]},{label:null,value:3,rgb:[235,187,160]},{label:null,value:4,rgb:[224,163,135]},{label:null,value:5,rgb:[217,144,113]},{label:null,value:6,rgb:[207,124,91]},{label:null,value:7,rgb:[194,103,70]},{label:null,value:8,rgb:[184,84,53]},{label:null,value:9,rgb:[171,65,36]}]},{name:"1_9_dark_brown_to_light_brown",label:null,colors:[{label:null,value:1,rgb:[171,65,36]},{label:null,value:2,rgb:[184,84,53]},{label:null,value:3,rgb:[194,103,70]},{label:null,value:4,rgb:[207,124,91]},{label:null,value:5,rgb:[217,144,113]},{label:null,value:6,rgb:[224,163,135]},{label:null,value:7,rgb:[235,187,160]},{label:null,value:8,rgb:[242,208,184]},{label:null,value:9,rgb:[250,233,212]}]},{name:"1_9_full_spectrum_bright_red_to_blue",label:null,colors:[{label:null,value:1,rgb:[255,0,0]},{label:null,value:2,rgb:[255,119,0]},{label:null,value:3,rgb:[255,200,0]},{label:null,value:4,rgb:[238,255,56]},{label:null,value:5,rgb:[182,255,143]},{label:null,value:6,rgb:[89,255,225]},{label:null,value:7,rgb:[51,194,255]},{label:null,value:8,rgb:[56,106,255]},{label:null,value:9,rgb:[0,0,255]}]},{name:"1_9_full_spectrum_bright_blue_to_red",label:null,colors:[{label:null,value:1,rgb:[0,0,255]},{label:null,value:2,rgb:[56,106,255]},{label:null,value:3,rgb:[51,194,255]},{label:null,value:4,rgb:[89,255,225]},{label:null,value:5,rgb:[182,255,143]},{label:null,value:6,rgb:[238,255,56]},{label:null,value:7,rgb:[255,200,0]},{label:null,value:8,rgb:[255,119,0]},{label:null,value:9,rgb:[255,0,0]}]},{name:"1_9_partial_spectrum_yellow_to_blue",label:null,colors:[{label:null,value:1,rgb:[242,241,162]},{label:null,value:2,rgb:[252,250,98]},{label:null,value:3,rgb:[255,255,0]},{label:null,value:4,rgb:[255,149,0]},{label:null,value:5,rgb:[255,0,0]},{label:null,value:6,rgb:[245,5,189]},{label:null,value:7,rgb:[176,7,237]},{label:null,value:8,rgb:[99,24,204]},{label:null,value:9,rgb:[7,29,173]}]},{name:"1_9_partial_spectrum_blue_to_yellow",label:null,colors:[{label:null,value:1,rgb:[7,29,173]},{label:null,value:2,rgb:[99,24,204]},{label:null,value:3,rgb:[176,7,237]},{label:null,value:4,rgb:[245,5,189]},{label:null,value:5,rgb:[255,0,0]},{label:null,value:6,rgb:[255,149,0]},{label:null,value:7,rgb:[255,255,0]},{label:null,value:8,rgb:[252,250,98]},{label:null,value:9,rgb:[242,241,162]}]},{name:"1_9_yellow_green_to_dark_blue",label:null,colors:[{label:null,value:1,rgb:[255,255,128]},{label:null,value:2,rgb:[182,245,88]},{label:null,value:3,rgb:[113,235,47]},{label:null,value:4,rgb:[59,214,45]},{label:null,value:5,rgb:[61,184,104]},{label:null,value:6,rgb:[42,156,154]},{label:null,value:7,rgb:[33,110,158]},{label:null,value:8,rgb:[31,62,140]},{label:null,value:9,rgb:[12,16,120]}]},{name:"1_9_dark_blue_to_yellow_green",label:null,colors:[{label:null,value:1,rgb:[12,16,120]},{label:null,value:2,rgb:[31,62,140]},{label:null,value:3,rgb:[33,110,158]},{label:null,value:4,rgb:[42,156,154]},{label:null,value:5,rgb:[61,184,104]},{label:null,value:6,rgb:[59,214,45]},{label:null,value:7,rgb:[113,235,47]},{label:null,value:8,rgb:[182,245,88]},{label:null,value:9,rgb:[255,255,128]}]},{name:"1_9_cold_to_hot_diverging",label:null,colors:[{label:null,value:1,rgb:[40,146,199]},{label:null,value:2,rgb:[109,169,179]},{label:null,value:3,rgb:[160,194,155]},{label:null,value:4,rgb:[206,222,129]},{label:null,value:5,rgb:[250,250,100]},{label:null,value:6,rgb:[252,196,76]},{label:null,value:7,rgb:[250,141,52]},{label:null,value:8,rgb:[242,89,34]},{label:null,value:9,rgb:[232,16,20]}]},{name:"1_9_hot_to_cold_diverging",label:null,colors:[{label:null,value:1,rgb:[232,16,20]},{label:null,value:2,rgb:[242,89,34]},{label:null,value:3,rgb:[250,141,52]},{label:null,value:4,rgb:[252,196,76]},{label:null,value:5,rgb:[250,250,100]},{label:null,value:6,rgb:[206,222,129]},{label:null,value:7,rgb:[160,194,155]},{label:null,value:8,rgb:[109,169,179]},{label:null,value:9,rgb:[40,146,199]}]},{name:"1_9_surface_low_to_high",label:null,colors:[{label:null,value:1,rgb:[112,153,89]},{label:null,value:2,rgb:[176,196,124]},{label:null,value:3,rgb:[242,238,162]},{label:null,value:4,rgb:[242,224,150]},{label:null,value:5,rgb:[242,206,133]},{label:null,value:6,rgb:[217,169,130]},{label:null,value:7,rgb:[194,140,124]},{label:null,value:8,rgb:[255,184,193]},{label:null,value:9,rgb:[255,242,255]}]},{name:"1_9_surface_high_to_low",label:null,colors:[{label:null,value:1,rgb:[255,242,255]},{label:null,value:2,rgb:[255,184,193]},{label:null,value:3,rgb:[194,140,124]},{label:null,value:4,rgb:[217,169,130]},{label:null,value:5,rgb:[242,206,133]},{label:null,value:6,rgb:[242,224,150]},{label:null,value:7,rgb:[242,238,162]},{label:null,value:8,rgb:[176,196,124]},{label:null,value:9,rgb:[112,153,89]}]}]),O.forEach((e=>{e.label=a("wro_"+e.name)||e.name,e.colors.forEach((e=>{e.label=a("wro_colorRamp_"+e.value.toString())||""+e.value.toString()}))})),D=!0);const o=this.wroContext=new oe;o.nls=this.nls,o.getConfig=()=>this.props.config,o.getId=()=>this.props.id,o.getLabel=()=>this.props.config.displayLabel?this.props.label:null,o.getPortal=()=>this.props.portalSelf,o.getPortalUrl=()=>this.props.portalUrl,o.getTheme=()=>this.props.theme,o.getUser=()=>this.props.user,o.getView=()=>{var e;return null===(e=this.state.jimuMapView)||void 0===e?void 0:e.view},o.modelController.onModelChange=this.onWroModelChange,o.modelController.onStatusChange=this.onWroStatusChange}componentDidUpdate(e,t){var l,r;const a=this.wroContext,o=this.state.wroModel,n=this.state,i=this.props,s=i.config,u=e.config,c=s.serviceUrl,d=s.itemId,g=u.serviceUrl,h=u.itemId;let p;const w=()=>(void 0===p&&(p={}),p),m=()=>(w(),p.wroStatus||(p.wroStatus=U.cloneStatus(n.wroStatus)),p.wroStatus);if(i.theme!==e.theme&&(m().themeId=this.newThemeId()),i.label!==e.label&&m(),s.displayLabel!==u.displayLabel&&m(),s.allowExport!==u.allowExport&&m(),!c&&!d)return this.clearLayers(null===(l=n.jimuMapView)||void 0===l?void 0:l.view,o),w().wroModel=null,void this.setState(p);let b=!0;if((g&&g===c||h&&h===d)&&(b=!1),!n.jimuMapView||t.jimuMapView||n.wasModelLoaded||(b=!0),b)this.clearLayers(null===(r=n.jimuMapView)||void 0===r?void 0:r.view,o),m().isModelLoading=!0,w().wroModel=null,this.setState(p),this.loadModel(a,c,d,!0);else{p&&this.setState(p);const e=n.jimuMapView;if(e&&e!==t.jimuMapView&&n.wasModelLoaded&&o&&o.mapLayerId){const e=!0;this.autoRunModel(e)}}}componentWillUnmount(){var e;const t=null===(e=this.state.jimuMapView)||void 0===e?void 0:e.view,l=this.state.wroModel;this.clearLayers(t,l)}loadModel(e,t,l,r){e.loadModel(t,l).then((e=>{const t=e,l=U.cloneStatus(this.state.wroStatus);l.isModelLoading=!1,this.setState({wasModelLoaded:!0,wroModel:t,wroStatus:l},(()=>{r&&this.autoRunModel(r)}))})).catch((e=>{console.error("Error loading WRO model",e);const t=U.cloneStatus(this.state.wroStatus);t.isModelLoading=!1,this.setState({wroStatus:t})}))}render(){var t;const r=this.wroContext,a=this.state.wroModel,o=this.state.wroStatus;return(0,e.jsx)("div",{className:"widget-wro jimu-widget"},(0,e.jsx)(le,{ref:this.modelerRef,wroContext:r,wroModel:a,wroStatus:o}),(0,e.jsx)(l.JimuMapViewComponent,{useMapWidgetId:null===(t=this.props.useMapWidgetIds)||void 0===t?void 0:t[0],onActiveViewChange:this.handleActiveViewChange}))}}})(),m})())}}}));