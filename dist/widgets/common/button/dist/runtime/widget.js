System.register(["jimu-core","jimu-ui"],(function(t,e){var s={},i={};return{setters:[function(t){s.AppMode=t.AppMode,s.BaseVersionManager=t.BaseVersionManager,s.ExpressionPartType=t.ExpressionPartType,s.ExpressionResolverComponent=t.ExpressionResolverComponent,s.ExpressionResolverErrorCode=t.ExpressionResolverErrorCode,s.Immutable=t.Immutable,s.LinkType=t.LinkType,s.React=t.React,s.appActions=t.appActions,s.classNames=t.classNames,s.css=t.css,s.getAppStore=t.getAppStore,s.jsx=t.jsx},function(t){i.DistanceUnits=t.DistanceUnits,i.Icon=t.Icon,i.Link=t.Link,i.defaultMessages=t.defaultMessages,i.styleUtils=t.styleUtils,i.utils=t.utils}],execute:function(){t((()=>{var t={48891:t=>{"use strict";t.exports=s},30726:t=>{"use strict";t.exports=i}},e={};function o(s){var i=e[s];if(void 0!==i)return i.exports;var n=e[s]={exports:{}};return t[s](n,n.exports,o),n.exports}o.d=(t,e)=>{for(var s in e)o.o(e,s)&&!o.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},o.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),o.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.p="";var n={};return o.p=window.jimuConfig.baseUrl,(()=>{"use strict";o.r(n),o.d(n,{default:()=>a});var t,e=o(48891),s=o(30726);!function(t){t.Left="LEFT",t.Right="RIGHT"}(t||(t={}));class i extends e.BaseVersionManager{constructor(){super(...arguments),this.versions=[{version:"1.0.0",description:"The first release.",upgrader:t=>{let e=t;return e.getIn(["styleConfig","name"])&&(e=e.set("styleConfig",e.styleConfig.without("name"))),e.getIn(["styleConfig","customStyle"])&&(e=e.set("styleConfig",e.styleConfig.without("customStyle"))),e.getIn(["styleConfig","themeStyle","quickStyleType"])&&(e=e.setIn(["styleConfig","themeStyle"],{quickStyleType:e.styleConfig.themeStyle.quickStyleType})),e=e.setIn(["styleConfig","useCustom"],!1),e}},{version:"1.1.0",description:"1.1.0",upgrader:t=>{let e=t;return e.getIn(["styleConfig","useCustom"])&&e.getIn(["styleConfig","customStyle","regular","border","width"])&&(e=e.setIn(["styleConfig","customStyle","regular","border","width"],s.utils.stringOfLinearUnit(e.getIn(["styleConfig","customStyle","regular","border","width"])))),e.getIn(["styleConfig","useCustom"])&&e.getIn(["styleConfig","customStyle","hover","border","width"])&&(e=e.setIn(["styleConfig","customStyle","hover","border","width"],s.utils.stringOfLinearUnit(e.getIn(["styleConfig","customStyle","hover","border","width"])))),e}}]}}const r=new i;function p(t,i,o){const n=t?"default":"hover",r=(0,e.Immutable)(o),p=r.getIn(["components","button","variants",i,n,"color"]),l=r.getIn(["components","button","sizes","default","fontSize"]);return{color:p,size:parseFloat(s.styleUtils.remToPixel(l))}}var l;!function(t){t[t.None=0]="None",t[t.Main=1]="Main",t[t.Sub=2]="Sub"}(l||(l={}));class a extends e.React.PureComponent{constructor(i){var o,n,r,a,u;super(i),this.repeat=0,this.getTextFromProps=()=>{var t,e,i,o;return"string"==typeof(null===(e=null===(t=this.props.config)||void 0===t?void 0:t.functionConfig)||void 0===e?void 0:e.text)?null===(o=null===(i=this.props.config)||void 0===i?void 0:i.functionConfig)||void 0===o?void 0:o.text:this.props.intl.formatMessage({id:"variableButton",defaultMessage:s.defaultMessages.variableButton})},this.setRepeatType=()=>{const t=this.props.repeatedDataSource;let e;e=t?0===t.recordIndex?l.Main:l.Sub:l.None,this.repeat=e},this.getTipExpression=()=>{var t,s;return this.props.config&&this.props.config.functionConfig&&this.props.config.functionConfig.toolTipExpression&&this.props.config.functionConfig.toolTipExpression||(0,e.Immutable)({name:"",parts:[{type:e.ExpressionPartType.String,exp:`"${(null===(s=null===(t=this.props.config)||void 0===t?void 0:t.functionConfig)||void 0===s?void 0:s.toolTip)||""}"`}]})},this.getTextExpression=()=>{var t,s;return this.props.config&&this.props.config.functionConfig&&this.props.config.functionConfig.textExpression&&this.props.config.functionConfig.textExpression||(0,e.Immutable)({name:"",parts:[{type:e.ExpressionPartType.String,exp:`"${(null===(s=null===(t=this.props.config)||void 0===t?void 0:t.functionConfig)||void 0===s?void 0:s.text)||this.getTextFromProps()}"`}]})},this.getUrlExpression=()=>this.props.config&&this.props.config.functionConfig&&this.props.config.functionConfig.linkParam&&this.props.config.functionConfig.linkParam&&this.props.config.functionConfig.linkParam.expression||null,this.onTextExpResolveChange=t=>{if(t.isSuccessful)this.setState({text:t.value});else{let s="";t.value===e.ExpressionResolverErrorCode.Failed&&(s=this.state.textExpression&&this.state.textExpression.name),this.setState({text:s})}},this.onTipExpResolveChange=t=>{if(t.isSuccessful)this.setState({toolTip:t.value});else{let s="";t.value===e.ExpressionResolverErrorCode.Failed&&(s=this.state.tipExpression&&this.state.tipExpression.name),this.setState({toolTip:s})}},this.onUrlExpResolveChange=t=>{if(t.isSuccessful)this.setState({url:t.value});else{let s="";t.value===e.ExpressionResolverErrorCode.Failed&&(s=this.state.urlExpression&&this.state.urlExpression.name),this.setState({url:s})}},this.showQuickStylePanel=()=>{if(!window.jimuConfig.isInBuilder)return!1;const t=this.repeat,{active:e}=this.props;return this.props.showQuickStyle&&e&&t!==l.Sub},this.getWhetherUseQuickStyle=t=>!!(t&&t.styleConfig&&t.styleConfig.themeStyle&&t.styleConfig.themeStyle.quickStyleType),this.getIconStyle=(t,i)=>{const o=t||{},n=i||{};return e.css`
      & img, & svg{
        color: ${o.color};
        fill: ${o.color};
        width: ${o.size}${s.DistanceUnits.PIXEL};
        height: ${o.size}${s.DistanceUnits.PIXEL};
      }
      &:hover{
        img, svg{
          color: ${n.color};
          fill: ${n.color};
          width: ${n.size}${s.DistanceUnits.PIXEL};
          height: ${n.size}${s.DistanceUnits.PIXEL};
        }
      }
    `},this.removeUndefinedStyle=t=>{if(!t)return t;const e={};return Object.keys(t).forEach((s=>{("string"==typeof t[s]&&t[s].indexOf("undefined")<0||"number"==typeof t[s])&&(e[s]=t[s])})),e},this.getLinkComponent=()=>{const i=this.props.config,o=i.functionConfig.linkParam,n=this.state.text,r=this.state.toolTip;let p,l;if(i.styleConfig&&i.styleConfig.customStyle){const t=i.styleConfig.customStyle.regular,o=i.styleConfig.customStyle.hover;if(i.styleConfig.useCustom){const i=s.styleUtils.toCSSStyle(t&&t.without("iconProps").asMutable({deep:!0})),n=s.styleUtils.toCSSStyle(o&&o.without("iconProps").asMutable({deep:!0}));if(this.props.active&&this.props.appMode!==e.AppMode.Run){const s=(0,e.getAppStore)().getState().widgetsState[this.props.id]||(0,e.Immutable)({});p={style:s.isConfiguringHover?Object.assign(Object.assign({},this.removeUndefinedStyle(i)),this.removeUndefinedStyle(n)):i,hoverStyle:n},l=this.getIconStyle(s.isConfiguringHover?Object.assign(Object.assign({},null==t?void 0:t.iconProps),null==o?void 0:o.iconProps):null==t?void 0:t.iconProps,null==o?void 0:o.iconProps)}else p={style:i,hoverStyle:n},l=this.getIconStyle(t&&t.iconProps,o&&o.iconProps)}}const a=this.getWhetherUseQuickStyle(i)?{type:i.styleConfig.themeStyle.quickStyleType}:{type:"default"};let u,c,h;o&&o.linkType&&(c=o.openType,h={linkType:o.linkType},o.linkType===e.LinkType.WebAddress?h.value=this.state.url:(h.value=o.value,u=this.props.queryObject));const g=i.functionConfig.icon,d=this.props.isRTL,f=g&&(!g.position||g.position===t.Left)&&(0,e.jsx)(s.Icon,{icon:g.data,className:(0,e.classNames)({"mr-2 ml-0":!!n&&!d,"ml-2 mr-0":!!n&&d,"mx-0":!n})}),y=g&&g.position&&g.position===t.Right&&(0,e.jsx)(s.Icon,{icon:g.data,className:(0,e.classNames)({"ml-2 mr-0":!!n&&!d,"mr-2 ml-0":!!n&&d,"mx-0":!n})});return(0,e.jsx)(s.Link,Object.assign({to:h,target:c,queryObject:u,title:r,className:"widget-button-link text-truncate w-100 h-100 p-0 d-flex align-items-center justify-content-center",role:(null==h?void 0:h.value)&&h.linkType!==e.LinkType.Dialog?"link":"button",customStyle:p},a,{css:l}),(0,e.jsx)("span",{className:"text-truncate widget-button-text"},d?y:f,n,d?f:y))},this.onQuickStyleChange=t=>{let{config:e}=this.props;const s=this.props.id,i=this.props.builderSupportModules,o=i&&i.jimuForBuilderLib.getAppConfigAction;o&&(e=e.setIn(["styleConfig","useCustom"],!1),e=e.setIn(["styleConfig","themeStyle","quickStyleType"],t),e=e.setIn(["styleConfig","customStyle","regular"],{iconProps:p(!0,t,this.props.theme)}),e=e.setIn(["styleConfig","customStyle","hover"],{iconProps:p(!1,t,this.props.theme)}),o().editWidgetProperty(s,"config",e).exec())},this.onClick=t=>{t.exbEventType="linkClick"},this.onQuickStyleClose=()=>this.props.dispatch(e.appActions.widgetStatePropChange(this.props.id,"showQuickStyle",!1)),this.getQuickStyleComponent=()=>{var t,s,i,o,n;const r=this.props.builderSupportModules&&this.props.builderSupportModules.widgetModules&&this.props.builderSupportModules.widgetModules.QuickStyle;return r?(0,e.jsx)(r,{onChange:this.onQuickStyleChange,reference:this.domNode&&this.domNode.current,onClose:this.onQuickStyleClose,selectedType:!(null===(s=null===(t=this.props.config)||void 0===t?void 0:t.styleConfig)||void 0===s?void 0:s.useCustom)&&(null===(n=null===(o=null===(i=this.props.config)||void 0===i?void 0:i.styleConfig)||void 0===o?void 0:o.themeStyle)||void 0===n?void 0:n.quickStyleType),onInitDragHandler:this.props.onInitDragHandler,onInitResizeHandler:this.props.onInitResizeHandler}):null},this.state={text:this.getTextFromProps(),toolTip:(null===(n=null===(o=this.props.config)||void 0===o?void 0:o.functionConfig)||void 0===n?void 0:n.toolTip)||"",url:(null===(u=null===(a=null===(r=this.props.config)||void 0===r?void 0:r.functionConfig)||void 0===a?void 0:a.linkParam)||void 0===u?void 0:u.value)||"",textExpression:this.props.useDataSourcesEnabled&&this.getTextExpression(),tipExpression:this.props.useDataSourcesEnabled&&this.getTipExpression(),urlExpression:this.props.useDataSourcesEnabled&&this.getUrlExpression(),mouted:!1},this.domNode=e.React.createRef()}componentDidMount(){window.jimuConfig.isInBuilder&&(this.setRepeatType(),this.props.active&&!this.props.hasEverMount&&this.props.dispatch(e.appActions.widgetStatePropChange(this.props.id,"showQuickStyle",!0)),this.props.hasEverMount||this.props.dispatch(e.appActions.widgetStatePropChange(this.props.id,"hasEverMount",!0)),this.setState({mouted:!0}))}componentDidUpdate(t,s){this.props.useDataSourcesEnabled||this.props.config===t.config&&!t.useDataSourcesEnabled||this.setState({text:this.getTextFromProps(),toolTip:this.props.config&&this.props.config.functionConfig&&this.props.config.functionConfig.toolTip,url:this.props.config&&this.props.config.functionConfig&&this.props.config.functionConfig.linkParam&&this.props.config.functionConfig.linkParam.value}),!this.props.useDataSourcesEnabled||this.props.config===t.config&&t.useDataSourcesEnabled||this.setState({textExpression:this.getTextExpression(),tipExpression:this.getTipExpression(),urlExpression:this.getUrlExpression()}),window.jimuConfig.isInBuilder&&(this.props.appMode!==t.appMode&&this.props.appMode===e.AppMode.Run||!this.props.active&&t.active)&&this.props.dispatch(e.appActions.widgetStatePropChange(this.props.id,"showQuickStyle",!1))}render(){const t=this.props.useDataSourcesEnabled,s=this.showQuickStylePanel(),i=this.getLinkComponent(),o=this.getQuickStyleComponent();return(0,e.jsx)("div",{className:"jimu-widget widget-button w-100 h-100",css:(this.props.theme,e.css`
    &>a {
      display: flex !important;
      justify-content: center;
    }

    .widget-button-text{
      line-height: initial;
    }

  `),ref:this.domNode,onClick:this.onClick,onTouchEnd:this.onClick},i,s&&o,(0,e.jsx)("div",{style:{display:"none"}},t&&(0,e.jsx)("div",null,(0,e.jsx)(e.ExpressionResolverComponent,{useDataSources:this.props.useDataSources,expression:this.state.textExpression,onChange:this.onTextExpResolveChange,widgetId:this.props.id}),(0,e.jsx)(e.ExpressionResolverComponent,{useDataSources:this.props.useDataSources,expression:this.state.tipExpression,onChange:this.onTipExpResolveChange,widgetId:this.props.id}),(0,e.jsx)(e.ExpressionResolverComponent,{useDataSources:this.props.useDataSources,expression:this.state.urlExpression,onChange:this.onUrlExpResolveChange,widgetId:this.props.id}))))}}a.mapExtraStateProps=(t,s)=>{let i=!1;const o=t.appRuntimeInfo.selection;if(o&&t.appConfig.layouts[o.layoutId]){const e=t.appConfig.layouts[o.layoutId].content[o.layoutItemId];i=e&&e.widgetId===s.id}const n=t.appContext.isInBuilder&&i,r=t.widgetsState[s.id]||(0,e.Immutable)({});return{active:n,showQuickStyle:!!r.showQuickStyle,appMode:n?t.appRuntimeInfo.appMode:null,queryObject:t.queryObject,hasEverMount:r.hasEverMount,isRTL:t.appContext.isRTL}},a.versionManager=r})(),n})())}}}));