System.register(["jimu-core","jimu-layouts/layout-runtime","jimu-ui/advanced/setting-components","jimu-ui","jimu-core/react","jimu-arcgis","jimu-theme"],(function(e,t){var o={},n={},l={},s={},r={},i={},a={};return{setters:[function(e){o.AppMode=e.AppMode,o.BaseVersionManager=e.BaseVersionManager,o.ClauseLogic=e.ClauseLogic,o.ClauseOperator=e.ClauseOperator,o.DataRecordSetChangeMessage=e.DataRecordSetChangeMessage,o.DataRecordsSelectionChangeMessage=e.DataRecordsSelectionChangeMessage,o.DataSourceComponent=e.DataSourceComponent,o.DataSourceFilterChangeMessage=e.DataSourceFilterChangeMessage,o.DataSourceManager=e.DataSourceManager,o.DataSourceStatus=e.DataSourceStatus,o.Immutable=e.Immutable,o.JimuFieldType=e.JimuFieldType,o.MessageManager=e.MessageManager,o.QueryScope=e.QueryScope,o.React=e.React,o.ReactRedux=e.ReactRedux,o.RecordSetChangeType=e.RecordSetChangeType,o.UtilityManager=e.UtilityManager,o.classNames=e.classNames,o.css=e.css,o.dataSourceUtils=e.dataSourceUtils,o.esri=e.esri,o.i18n=e.i18n,o.jsx=e.jsx,o.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules,o.lodash=e.lodash,o.polished=e.polished},function(e){n.PageVisibilityContext=e.PageVisibilityContext,n.ViewVisibilityContext=e.ViewVisibilityContext},function(e){l.OutputDsAddress=e.OutputDsAddress,l.SearchServiceType=e.SearchServiceType},function(e){s.Button=e.Button,s.Checkbox=e.Checkbox,s.Dropdown=e.Dropdown,s.DropdownButton=e.DropdownButton,s.DropdownItem=e.DropdownItem,s.DropdownMenu=e.DropdownMenu,s.Icon=e.Icon,s.Link=e.Link,s.TextInput=e.TextInput,s.defaultMessages=e.defaultMessages,s.hooks=e.hooks},function(e){r.useEffect=e.useEffect},function(e){i.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules},function(e){a.useTheme=e.useTheme}],execute:function(){e((()=>{var e={20864:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M13 6.133c0 .598-.28 1.46-.825 2.51-.53 1.02-1.247 2.102-1.981 3.102A45.718 45.718 0 0 1 8 14.492a48.01 48.01 0 0 1-2.194-2.747c-.734-1-1.451-2.081-1.98-3.102C3.28 7.593 3 6.731 3 6.133 3 3.277 5.26 1 8 1s5 2.277 5 5.133Zm1 0c0 2.685-3.768 7.311-5.332 9.115C8.258 15.722 8 16 8 16s-.258-.279-.668-.752C5.768 13.444 2 8.819 2 6.133 2 2.746 4.686 0 8 0s6 2.746 6 6.133ZM10 5.5a2 2 0 1 1-4 0 2 2 0 0 1 4 0Zm1 0a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" fill="#000"></path></svg>'},59788:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M2.146 4.653a.485.485 0 0 1 .708 0L8 10.24l5.146-5.587a.485.485 0 0 1 .708 0 .538.538 0 0 1 0 .738l-5.5 5.956a.485.485 0 0 1-.708 0l-5.5-5.956a.538.538 0 0 1 0-.738Z" fill="#000"></path></svg>'},96009:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M13.854 11.347a.486.486 0 0 1-.708 0L8 5.76l-5.146 5.587a.485.485 0 0 1-.708 0 .538.538 0 0 1 0-.738l5.5-5.956a.485.485 0 0 1 .708 0l5.5 5.956a.538.538 0 0 1 0 .738Z" fill="#000"></path></svg>'},55339:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="m8.745 8 6.1 6.1a.527.527 0 1 1-.745.746L8 8.746l-6.1 6.1a.527.527 0 1 1-.746-.746l6.1-6.1-6.1-6.1a.527.527 0 0 1 .746-.746l6.1 6.1 6.1-6.1a.527.527 0 0 1 .746.746L8.746 8Z" fill="#000"></path></svg>'},30224:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0Zm-1.27 4.936a6.5 6.5 0 1 1 .707-.707l4.136 4.137a.5.5 0 1 1-.707.707l-4.137-4.137Z" fill="#000"></path></svg>'},54357:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6 6.5a.5.5 0 0 1 1 0v6a.5.5 0 0 1-1 0v-6ZM9.5 6a.5.5 0 0 0-.5.5v6a.5.5 0 0 0 1 0v-6a.5.5 0 0 0-.5-.5Z" fill="#000"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M11 0H5a1 1 0 0 0-1 1v2H.5a.5.5 0 0 0 0 1h1.6l.81 11.1a1 1 0 0 0 .995.9h8.19a1 1 0 0 0 .995-.9L13.9 4h1.6a.5.5 0 0 0 0-1H12V1a1 1 0 0 0-1-1Zm0 3V1H5v2h6Zm1.895 1h-9.79l.8 11h8.19l.8-11Z" fill="#000"></path></svg>'},79964:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M8 2.125 14.334 14H1.667L8 2.125Zm-.882-.47a1 1 0 0 1 1.765 0l6.333 11.874A1 1 0 0 1 14.334 15H1.667a1 1 0 0 1-.882-1.47L7.118 1.653ZM8 4.874a.905.905 0 0 0-.9.995l.35 3.507a.552.552 0 0 0 1.1 0L8.9 5.87a.905.905 0 0 0-.9-.995Zm1 7a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z" fill="#000"></path></svg>'},26826:e=>{"use strict";e.exports=i},48891:e=>{"use strict";e.exports=o},51315:e=>{"use strict";e.exports=r},74758:e=>{"use strict";e.exports=n},34796:e=>{"use strict";e.exports=a},30726:e=>{"use strict";e.exports=s},77756:e=>{"use strict";e.exports=l}},t={};function c(o){var n=t[o];if(void 0!==n)return n.exports;var l=t[o]={exports:{}};return e[o](l,l.exports,c),l.exports}c.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return c.d(t,{a:t}),t},c.d=(e,t)=>{for(var o in t)c.o(t,o)&&!c.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},c.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),c.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},c.p="";var u={};return c.p=window.jimuConfig.baseUrl,(()=>{"use strict";c.r(u),c.d(u,{default:()=>Le});var e,t,o,n=c(48891),l=c(74758),s=c(77756);!function(e){e.ResultPanel="Result_Panel",e.OtherWidgets="Other_Widgets"}(e||(e={})),function(e){e.Style1="Style1",e.Style2="Style2"}(t||(t={})),function(e){e.None="",e.Init="init",e.Loading="loading",e.Loaded="loaded",e.Warning="warning",e.Error="error"}(o||(o={}));var r=c(30726),i=c(51315);const a={_widgetLabel:"Search",showResult:"Show search results for {searchText}",hideResult:"Hide search results for {searchText}",allSearchSources:"All search sources",noResult:'No results found for "{searchText}"',couldNotRetrieve:"Could not retrieve current location.",showMoreResult:"Show more results",clearAllHistories:"Clear all histories",clearHistorie:"Clear history",clearThisHistories:"Remove this history",clearRecentSearches:"Recent searches",searchIn:"Search in {value}",searchResults:"Search result"};var d=c(59788),v=c.n(d);const g=e=>{const t=window.SVG,{className:o}=e,l=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(n=Object.getOwnPropertySymbols(e);l<n.length;l++)t.indexOf(n[l])<0&&Object.prototype.propertyIsEnumerable.call(e,n[l])&&(o[n[l]]=e[n[l]])}return o}(e,["className"]),s=(0,n.classNames)("jimu-icon jimu-icon-component",o);return t?n.React.createElement(t,Object.assign({className:s,src:v()},l)):n.React.createElement("svg",Object.assign({className:s},l))};var m=c(96009),p=c.n(m);const h=e=>{const t=window.SVG,{className:o}=e,l=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(n=Object.getOwnPropertySymbols(e);l<n.length;l++)t.indexOf(n[l])<0&&Object.prototype.propertyIsEnumerable.call(e,n[l])&&(o[n[l]]=e[n[l]])}return o}(e,["className"]),s=(0,n.classNames)("jimu-icon jimu-icon-component",o);return t?n.React.createElement(t,Object.assign({className:s,src:p()},l)):n.React.createElement("svg",Object.assign({className:s},l))},{useRef:f,useState:S}=n.React,y=e=>{const t=r.hooks.useTranslate(a,r.defaultMessages),o=n.css`
    & {
      box-sizing: border-box;
      width: ${n.polished.rem(32)}
    }
    .setting-dropdown-button {
      border-radius: 0;
      svg {
        margin: 0 !important;
      }
    }
  `,[l,s]=S(!0),[c,u]=n.React.useState(!1),{className:d,datasourceConfig:v,onDatasourceConfigChange:m}=e,p=f(null);return(0,i.useEffect)((()=>{var e;const t=0===(null===(e=null==v?void 0:v.filter((e=>!(null==e?void 0:e.enable))))||void 0===e?void 0:e.length);s(t)}),[v]),(0,n.jsx)("div",{className:`${d||""}`,css:o,role:"group","aria-label":t("searchIn",{value:""})},(0,n.jsx)(r.Dropdown,{className:"w-100 h-100",toggle:e=>{var t;const o=null==e?void 0:e.target;if(null===(t=null==p?void 0:p.current)||void 0===t?void 0:t.contains(o))return!1;u(!c)},isOpen:c},(0,n.jsx)(r.DropdownButton,{className:"h-100 setting-dropdown-button",arrow:!1,icon:!0,title:t("searchIn",{value:""})},!c&&(0,n.jsx)(g,{size:16,className:"mr-1 d-inline-block",autoFlip:!0}),c&&(0,n.jsx)(h,{size:16,className:"mr-1 d-inline-block",autoFlip:!0})),(0,n.jsx)(r.DropdownMenu,{trapFocus:!1,autoFocus:!1,style:{maxHeight:"auto"}},(0,n.jsx)("div",{ref:p},(0,n.jsx)(r.DropdownItem,{onClick:()=>{const e=null==v?void 0:v.map((e=>{var t;return null===(t=e.setIn(["enable"],!0))||void 0===t?void 0:t.asMutable({deep:!0})}));m(e)},disabled:l,title:t("all")},(0,n.jsx)(r.Checkbox,{checked:l,disabled:l,className:"mr-2"}),t("all")),(0,n.jsx)(r.DropdownItem,{divider:!0}),null==v?void 0:v.map(((e,t)=>{var o;const l=1===(null===(o=null==v?void 0:v.filter((e=>null==e?void 0:e.enable)))||void 0===o?void 0:o.length)&&(null==e?void 0:e.enable);return(0,n.jsx)(r.DropdownItem,{key:`${null==e?void 0:e.label}${t}`,title:null==e?void 0:e.label,disabled:l,onClick:()=>{((e,t)=>{const o=null==v?void 0:v.setIn([t,"enable"],e);m(o)})(!(null==e?void 0:e.enable),t)}},(0,n.jsx)(r.Checkbox,{checked:null==e?void 0:e.enable,disabled:l,className:"mr-2"}),null==e?void 0:e.label)}))))))};var b=c(26826);const x="address",I={alias:"ADDRESS",type:"string",name:x},w=(Object.assign(Object.assign({},I),{jimuName:x}),(e,t)=>G(null==t?void 0:t.outputDataSourceId)&&(null==t?void 0:t.isSupportSuggest)?j(t,e):Promise.resolve({})),j=(e,t)=>C(null==e?void 0:e.geocodeURL,t,null==e?void 0:e.maxSuggestions).then((o=>{let n=[];o.forEach(((o,l)=>{const s=o.text;if(s&&!$(n,s)){const l={suggestionHtml:A(s,t),suggestion:s,configId:null==e?void 0:e.configId,magicKey:null==o?void 0:o.magicKey};n.push(l)}})),n=F(n,"suggestion");const l={suggestionItem:n.splice(0,e.maxSuggestions),layer:null==e?void 0:e.label,icon:null==e?void 0:e.icon};return Promise.resolve(l)})).catch((e=>Promise.reject(e))),R=(e,t,o,l)=>{if(G(null==o?void 0:o.outputDataSourceId))return U(P(o.outputDataSourceId),n.DataSourceStatus.NotReady),N({address:e,maxResultNumber:t,searchResultView:l,geocodeItem:o})},N=e=>{const{address:t,maxResultNumber:o,geocodeItem:l}=e,{outputDataSourceId:s,singleLineFieldName:r,defaultAddressFieldName:i}=l,a=P(s),c={geocodeItem:l,address:t,maxResultNumber:o,singleLineFieldName:r,addressFields:(null==l?void 0:l.addressFields)||[]};return O(c).then((e=>(0,b.loadArcGISJSAPIModules)(["esri/layers/FeatureLayer","esri/Graphic"]).then((o=>{var r;const[c,u]=o,d=null==e?void 0:e.filter((e=>null==e?void 0:e.address));let v;const g=null==d?void 0:d.map(((e,t)=>{const o=e.attributes;return o.address=e.address,i&&(o[i]=e.address),o.objectid=t,v=e.extent,new u({attributes:o,geometry:e.location})})),m=new c({id:`${s}_layer`,fields:null===(r=null==l?void 0:l.addressFields)||void 0===r?void 0:r.map((e=>({alias:e.alias,type:"string",name:e.jimuName}))),objectIdField:"objectid",geometryType:"point",source:g,fullExtent:v});a.layer=m;const p=t?n.DataSourceStatus.Unloaded:n.DataSourceStatus.NotReady;return U(a,p),Promise.resolve(n.DataSourceStatus.Unloaded)})))).catch((e=>Promise.reject(e)))},O=e=>{const{geocodeItem:t,address:o,maxResultNumber:l,singleLineFieldName:s,addressFields:r}=e,{geocodeURL:i,magicKey:a}=t;return(0,b.loadArcGISJSAPIModules)(["esri/rest/locator"]).then((e=>{var t;const[c]=e,u=s||"SingleLine";let d=(0,n.Immutable)({maxSuggestions:l});const v=null===(t=null==r?void 0:r.map((e=>null==e?void 0:e.jimuName)))||void 0===t?void 0:t.join(",");return v&&(d=d.set("outFields",v)),d=d.setIn([u],o),a&&(d=d.set("magicKey",a)),c.addressToLocations(i,{address:null==d?void 0:d.asMutable({deep:!0})},{query:{}}).then((e=>(e=e.sort(((e,t)=>t.score-e.score))).filter((e=>e.location))),(e=>(console.error(e.message),[])))}))},C=(e,t,o)=>(0,b.loadArcGISJSAPIModules)(["esri/rest/locator"]).then((n=>{const[l]=n;return l.suggestLocations(e,{text:t,maxSuggestions:o}).then((e=>e||[]),(e=>(console.error(e.message),[])))})),D=(e,t,o,l=!1)=>{const s=null==e?void 0:e.outputDataSourceId,r=P(null==e?void 0:e.outputDataSourceId),i={where:"1=1",pageSize:t,page:1,returnGeometry:!0};return null==r?void 0:r.load(i,{widgetId:o}).then((t=>(l&&M(s,o,[],n.RecordSetChangeType.Remove),setTimeout((()=>{l&&M(s,o,t)}),100),Promise.resolve({records:t,configId:e.configId,dsId:s,isGeocodeRecords:!0}))))},M=(e,t,o,l=n.RecordSetChangeType.Update)=>{const s=P(e),r=new n.DataRecordSetChangeMessage(t,e,l,{records:o,dataSource:s});n.MessageManager.getInstance().publishMessage(r)},T=(e,t,o,n=!1)=>{const l=[];for(const r in e){const i=e[r];let a;a=i.searchServiceType===s.SearchServiceType.FeatureService?Z(i,t,o):D(i,t,o,n),l.push(a)}return Promise.all(l)},P=e=>e?n.DataSourceManager.getInstance().getDataSource(e):null,F=(e,t)=>{const o=e[0]?[e[0]]:[];for(let n=1;n<e.length;n++){const l=e[n];let s=!1;for(let e=0;e<o.length;e++)if(l[t]===o[e][t]){s=!0;break}s||o.push(l)}return o},k=e=>{const t=`${e}_recent_searches`;let o=localStorage.getItem(t);return o&&(o=unescape(o)),o?null==o?void 0:o.split("/@/"):[]},L=(e,t)=>{var o,n,l;return null===(l=null===(n=null===(o=null==e?void 0:e.asMutable({deep:!0}))||void 0===o?void 0:o.datasourceConfig)||void 0===n?void 0:n.filter((e=>e.configId===t)))||void 0===l?void 0:l[0]},E=e=>{let t=0;for(const o in e)t++;return t};function $(e,t){return e.filter((e=>t===(null==e?void 0:e.suggestion))).length>0}function A(e,t){if(!t)return e;const o=new RegExp(`(${t})`,"gi"),n=new RegExp(`(${t})`,"gi");return e.match(o)?e.replace(n,"<strong >$1</strong>"):e}function U(e,t){e.setStatus(t),e.setCountStatus(t)}function G(e){return!!e&&!!P(e)}function V(e){return e?[-32,3]:[0,3]}var B=function(e,t,o,n){return new(o||(o=Promise))((function(l,s){function r(e){try{a(n.next(e))}catch(e){s(e)}}function i(e){try{a(n.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?l(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(r,i)}a((n=n.apply(e,t||[])).next())}))};function _(e,t,o){var l,s;return B(this,void 0,void 0,(function*(){const r=(null==t?void 0:t.datasourceConfig)||[];if(!G(null===(l=null==o?void 0:o.useDataSource)||void 0===l?void 0:l.dataSourceId))return Promise.resolve({});const i=(null==o?void 0:o.searchFields)||[],a=null===(s=null==r?void 0:r.filter((e=>(null==e?void 0:e.configId)===o.configId)))||void 0===s?void 0:s[0];return function(e,t,o,l,s){var r;return B(this,void 0,void 0,(function*(){const{label:i,icon:a,configId:c}=o,u=null===(r=null==t?void 0:t.useDataSource)||void 0===r?void 0:r.dataSourceId,d=P(u),v=null==t?void 0:t.SuggestionSQL,g={outFields:l.map((e=>e.name)),returnDistinctValues:!0,returnGeometry:!1,orderByFields:null};((null==v?void 0:v.sql)||"string"==typeof(null==v?void 0:v.sql))&&(g.where=null==v?void 0:v.sql);const m=new RegExp(`(${e})`,"gi");return function(e,t){return B(this,void 0,void 0,(function*(){return t?yield t.query(e,{scope:n.QueryScope.InRuntimeView}).then((e=>B(this,void 0,void 0,(function*(){return yield function(e,t){return B(this,void 0,void 0,(function*(){return yield Promise.resolve((null==t?void 0:t.records)||[])}))}(0,e)})))):yield Promise.resolve([])}))}(g,d).then((t=>B(this,void 0,void 0,(function*(){let o=[];l.forEach((l=>{t.forEach((t=>{const s=n.i18n.getIntl(),r=t.getFormattedFieldValue(null==l?void 0:l.name,s);if(r&&!$(o,r)&&r.match(m)){const t={suggestionHtml:A(r,e),suggestion:r,configId:c,isFromSuggestion:!0};o.push(t)}}))})),o=F(o,"suggestion");const r={suggestionItem:o.splice(0,s),layer:i,icon:a};return Promise.resolve(r)})))).catch((e=>Promise.resolve({suggestionItem:[],layer:null,icon:null})))}))}(e,o,a,i,null==t?void 0:t.maxSuggestions)}))}function z(e,t,o,l){if(t){const s=[];t.forEach((t=>{let r=e;const i=null==o?void 0:o.getFieldCodedValueList(null==t?void 0:t.name);if(i&&(null==i||i.forEach((e=>{r===(null==e?void 0:e.label)&&(r=null==e?void 0:e.value)}))),t.type===n.JimuFieldType.Number&&!Number(r))return!1;const a=function(e,t){let o;return e===n.JimuFieldType.Number?o=n.ClauseOperator.NumberOperatorIs:e===n.JimuFieldType.String&&(o=t?n.ClauseOperator.StringOperatorIs:n.ClauseOperator.StringOperatorContains),o}(t.type,l),c=t.type===n.JimuFieldType.Number?Number(r):r,u=n.dataSourceUtils.createSQLClause(null==t?void 0:t.name,a,c);s.push(u)}));const r=n.dataSourceUtils.createSQLExpression(n.ClauseLogic.Or,s);return n.dataSourceUtils.getArcGISSQL(r,o)}}function H(e,t,o){var l;const s=null===(l=null==e?void 0:e.useDataSource)||void 0===l?void 0:l.dataSourceId,r=P(s),i=null==e?void 0:e.SQL,a=o?(null==i?void 0:i.sql)||"1=0":"1=1",c=(0,n.Immutable)({outFields:["*"],where:a,returnGeometry:!0});r&&r.updateQueryParams(c,t)}const Z=(e,t,o)=>{var n,l;const s=null===(n=null==e?void 0:e.useDataSource)||void 0===n?void 0:n.dataSourceId;if(!G(s))return Promise.resolve({});const r=P(s),i={where:(null===(l=null==e?void 0:e.SQL)||void 0===l?void 0:l.sql)||"1=0",pageSize:t,page:1,returnGeometry:!0};return null==r?void 0:r.load(i,{widgetId:o}).then((t=>Promise.resolve({records:t,configId:e.configId,dsId:s,isGeocodeRecords:!1})))};var J=c(54357),q=c.n(J);const K=e=>{const t=window.SVG,{className:o}=e,l=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(n=Object.getOwnPropertySymbols(e);l<n.length;l++)t.indexOf(n[l])<0&&Object.prototype.propertyIsEnumerable.call(e,n[l])&&(o[n[l]]=e[n[l]])}return o}(e,["className"]),s=(0,n.classNames)("jimu-icon jimu-icon-component",o);return t?n.React.createElement(t,Object.assign({className:s,src:q()},l)):n.React.createElement("svg",Object.assign({className:s},l))};var Q=c(20864),W=c.n(Q);const X=e=>{const t=window.SVG,{className:o}=e,l=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(n=Object.getOwnPropertySymbols(e);l<n.length;l++)t.indexOf(n[l])<0&&Object.prototype.propertyIsEnumerable.call(e,n[l])&&(o[n[l]]=e[n[l]])}return o}(e,["className"]),s=(0,n.classNames)("jimu-icon jimu-icon-component",o);return t?n.React.createElement(t,Object.assign({className:s,src:W()},l)):n.React.createElement("svg",Object.assign({className:s},l))};var Y=c(79964),ee=c.n(Y);const te=e=>{const t=window.SVG,{className:o}=e,l=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(n=Object.getOwnPropertySymbols(e);l<n.length;l++)t.indexOf(n[l])<0&&Object.prototype.propertyIsEnumerable.call(e,n[l])&&(o[n[l]]=e[n[l]])}return o}(e,["className"]),s=(0,n.classNames)("jimu-icon jimu-icon-component",o);return t?n.React.createElement(t,Object.assign({className:s,src:ee()},l)):n.React.createElement("svg",Object.assign({className:s},l))},{useState:oe}=n.React,ne=e=>{const t=r.hooks.useTranslate(a,r.defaultMessages),{serviceList:o,onLocationChange:l}=e,[i,c]=oe(!1),[u,d]=n.React.useState(null);n.React.useEffect((()=>{v()}),[o]);const v=()=>{var e;for(const t in o){const n=null===(e=o[t])||void 0===e?void 0:e.asMutable({deep:!0});if(n.searchServiceType===s.SearchServiceType.GeocodeService){d(n);break}}},g=e=>{const t=`${e.coords.longitude},${e.coords.latitude}`;u?((e,t)=>t?(0,b.loadArcGISJSAPIModules)(["esri/rest/locator"]).then((o=>{const[n]=o;return(e=>{const t=e&&e.coords;return t?(0,b.loadArcGISJSAPIModules)(["esri/geometry/Point"]).then((e=>{const[o]=e;return new o({longitude:t.longitude,latitude:t.latitude,z:t.altitude||null,spatialReference:{wkid:4326}})})):Promise.resolve(null)})(t).then((t=>n.locationToAddress(e,{location:t},{query:{}}).then((e=>Promise.resolve(e.address)),(e=>(console.error(e.message),[])))))})):Promise.resolve(null))(null==u?void 0:u.geocodeURL,e).then((e=>{l(e)})):l(t)},m=()=>{c(!0)};return(0,n.jsx)("div",null,!i&&(0,n.jsx)(r.DropdownItem,{onClick:()=>{var e,t;e=g,t=m,navigator.geolocation?navigator.geolocation.getCurrentPosition(e,t):t&&t()},title:t("useCurrentLocation")},(0,n.jsx)(X,{className:"mr-2"}),t("useCurrentLocation")),i&&(0,n.jsx)(r.DropdownItem,{title:t("couldNotRetrieve")},(0,n.jsx)(te,{className:"mr-2"}),t("couldNotRetrieve")))};var le=c(34796);const se=(e,t)=>{var o,l,s,r,i,a,c,u,d,v,g,m,p,h;return n.css`
    & {
      max-height: ${n.polished.rem(300)};
      width: ${n.polished.rem(null===(o=null==t?void 0:t.current)||void 0===o?void 0:o.clientWidth)};
      overflow: auto;
      padding-top: 0;
      padding-bottom: 0;
      visibility: unset !important;
    }
    &.result-list-con .dropdown-item {
      text-overflow: ellipsis;
      white-space: pre-wrap;
    }
    &.result-list-con .dropdown-item:disabled, &.result-list-con .dropdown-item:disabled:hover {
      color: ${null===(r=null===(s=null===(l=null==e?void 0:e.colors)||void 0===l?void 0:l.palette)||void 0===s?void 0:s.secondary)||void 0===r?void 0:r[800]};
      background-color: ${null===(c=null===(a=null===(i=null==e?void 0:e.colors)||void 0===i?void 0:i.palette)||void 0===a?void 0:a.light)||void 0===c?void 0:c[200]};
    }
    &.result-list-con .dropdown-item:hover, &.result-list-con .dropdown-item:focus {
      color: ${null===(u=null==e?void 0:e.colors)||void 0===u?void 0:u.black};
      background-color: ${null===(g=null===(v=null===(d=null==e?void 0:e.colors)||void 0===d?void 0:d.palette)||void 0===v?void 0:v.light)||void 0===g?void 0:g[100]};
    }
    &.result-list-con .dropdown-divider {
      margin-left: 0;
      margin-right: 0;
    }
    &.result-list-con .dropdown-item.active {
      background: ${null===(m=null==e?void 0:e.colors)||void 0===m?void 0:m.primary};
      color: ${null===(p=null==e?void 0:e.colors)||void 0===p?void 0:p.white};
    }
    .show-result-button:active, &.result-list-con .show-result-button:focus, &.result-list-con .show-result-button:hover {
      background-color: ${null===(h=null==e?void 0:e.colors)||void 0===h?void 0:h.white};
    }
    .dropdown-menu--inner {
      max-height: none;
    }
    .jimu-dropdown-item {
      min-height: ${n.polished.rem(32)};
    }
    .clear-recent-search-con {
      color: var(--primary) !important;
      height: ${n.polished.rem(40)};
      margin-top: ${n.polished.rem(-4)};
    }
    .dropdown-divider {
      min-height: 0;
    }
    .item-p-l {
      padding-left: ${n.polished.rem(42)} !important;
    }
    .source-label-con {
      color: var(--black) !important;
      font-weight: bold !important;
    }
  `},re=()=>n.css`
    .search-dropdown-button {
      position: absolute;
      top: 0;
      bottom: 0;
      height: auto;
      z-index: -1;
    }
    & {
      position: initial;
    }
  `,{useRef:ie}=n.React,ae=new(0,n.esri.Sanitizer),ce=e=>{const t=r.hooks.useTranslate(a,r.defaultMessages),{isRecentSearches:o,className:l,reference:s,searchSuggestion:i,isOpen:c,searchText:u,canUseOutoutDsLength:d,serviceList:v,isShowCurrentLocation:g,config:m,toggel:p,onRecordItemClick:h,clearSearches:f,setSuggestionFirstItem:S}=e,y=(0,le.useTheme)(),b=ie(!1),x=(e,t)=>{0!==e||b.current||(S(t),b.current=!0)},I=(null==m?void 0:m.datasourceConfig)||[];return(0,n.jsx)("div",null,(0,n.jsx)(r.Dropdown,{className:"w-100",size:"lg",isOpen:c,toggle:p,css:re()},(0,n.jsx)(r.DropdownButton,{className:"sr-only search-dropdown-button",style:{padding:0}}),(0,n.jsx)(r.DropdownMenu,{className:(0,n.classNames)("result-list-con",l),offset:V(I.length>1),trapFocus:!1,autoFocus:!1,css:se(y,s),style:{maxHeight:"auto"}},!u&&g&&(0,n.jsx)(ne,{serviceList:v,isShowCurrentLocation:!0,onLocationChange:h}),(()=>{let e=[];return i.forEach((t=>{const o=(null==t?void 0:t.suggestionItem)||[];e=e.concat(o)})),u&&0===e.length})()&&(0,n.jsx)(r.DropdownItem,{className:"text-center py-2",disabled:!0,title:t("noResult",{searchText:u})},t("noResult",{searchText:u})),(b.current=null,null==i?void 0:i.map(((e,t)=>{var o,l,s;const a=(null==i?void 0:i.length)>1&&(null===(o=null==e?void 0:e.suggestionItem)||void 0===o?void 0:o.length)>0;return(0,n.jsx)("div",{key:`${null==e?void 0:e.layer}-${t}`,role:"group","aria-label":null==e?void 0:e.layer},a&&(0,n.jsx)(r.DropdownItem,{className:"source-label-con",disabled:!0,title:null==e?void 0:e.layer},(null==e?void 0:e.icon)&&(0,n.jsx)(r.Icon,{className:"mr-2",color:null===(l=null==y?void 0:y.colors)||void 0===l?void 0:l.primary,size:16,icon:null===(s=null==e?void 0:e.icon)||void 0===s?void 0:s.svg}),null==e?void 0:e.layer),((e,t=!1)=>{const o=null==e?void 0:e.suggestionItem,l=null==e?void 0:e.icon;return null==o?void 0:o.map(((o,s)=>{var i;const a=ae.sanitize(o.suggestionHtml),c={configId:null==o?void 0:o.configId,isFromSuggestion:null==o?void 0:o.isFromSuggestion,magicKey:null==o?void 0:o.magicKey};return(0,n.jsx)(r.DropdownItem,{className:(0,n.classNames)("d-flex align-items-center py-2",{"item-p-l":t}),key:`${null==e?void 0:e.layer}${s}`,title:o.suggestion,onClick:()=>{((e,t)=>{const{configId:o,isFromSuggestion:n,magicKey:l}=t||{};o&&(n||l)?h(e,t):h(e)})(o.suggestion,c)},ref:e=>{x(s,e)}},l&&1===d&&(0,n.jsx)(r.Icon,{className:"mr-2",color:null===(i=null==y?void 0:y.colors)||void 0===i?void 0:i.primary,size:16,icon:null==l?void 0:l.svg}),(0,n.jsx)("div",{className:"flex-grow-1",dangerouslySetInnerHTML:{__html:a}}))}))})(e,(()=>{if((null==i?void 0:i.length)<2)return!1;let e=0,t=0;return null==i||i.forEach((o=>{var n;const l=null==o?void 0:o.icon;l&&(e+=1),(null===(n=o.suggestionItem)||void 0===n?void 0:n.length)>0&&l&&(t+=1)})),t>0&&e>0})()))}))),o&&(0,n.jsx)(r.DropdownItem,{divider:!0}),o&&(0,n.jsx)(r.DropdownItem,{className:"clear-recent-search-con",title:t("clearRecentSearches"),onClick:f},(0,n.jsx)(K,{className:"mr-2"}),t("clearRecentSearches")))))},{useEffect:ue,useRef:de}=n.React,ve=e=>{const t=r.hooks.useTranslate(a),{reference:o,searchText:l,id:i,config:c,serviceList:u,isOpentResultListDefault:d,setResultFirstItem:v,handleDsIdOfSelectedResultItemChange:m}=e,{resultMaxNumber:p}=c,f=de([]),S=de(!1),y=de(null),b=de(!1);let x={};const I=(0,le.useTheme)(),[w,j]=n.React.useState((0,n.Immutable)({})),[R,N]=n.React.useState({}),[O,C]=n.React.useState(null),[D,M]=n.React.useState(d),[F,k]=n.React.useState(!1),[$,A]=n.React.useState(0);ue((()=>{U()}),[u]),ue((()=>{f.current=[]}),[l]);const U=()=>{S.current=!1;const e=T(null==u?void 0:u.asMutable({deep:!0}),p,i);Promise.all([e]).then((e=>{S.current=!0;let t=w||(0,n.Immutable)({}),o=[];null==e||e.forEach((e=>{o=o.concat(e)}));const l={};o.forEach((e=>{const{records:o,configId:n,dsId:s,isGeocodeRecords:r}=e;l[n]=o;const i=Q(o,n,s,r);t=t.setIn([n],i)})),N(l),j(t),A($+1),Y(),z()}))},G=()=>{var e;if(E(u)<2)return!1;let t=0,o=0;for(const n in w){const l=L(c,n),s=null==l?void 0:l.icon;s&&(t+=1),(null===(e=w[n])||void 0===e?void 0:e.length)>0&&s&&(o+=1)}return o>0&&t>0},B=(e,t=!1)=>null==e?void 0:e.map(((e,o)=>{var l,s;const{configId:i,value:a,recordId:d,outputDsId:v}=e,g=X(i,d),m=O===g,p=L(c,i),h=null==p?void 0:p.icon,f=m?null===(l=null==I?void 0:I.colors)||void 0===l?void 0:l.white:null===(s=null==I?void 0:I.colors)||void 0===s?void 0:s.primary,S=E(u);return(0,n.jsx)(r.DropdownItem,{className:(0,n.classNames)("d-flex align-items-center",{"item-p-l":t}),key:g,active:m,title:a.join(", "),ref:e=>{_(o,e)},onClick:()=>{J({isActive:m,key:g,recordId:d,dsId:v,configId:i})}},h&&1===S&&(0,n.jsx)(r.Icon,{className:"mr-2",color:f,size:16,icon:null==h?void 0:h.svg}),(0,n.jsx)("div",null,a.join(", ")))})),_=(e,t)=>{0!==e||b.current||(v(t),b.current=!0)},z=()=>{var e;if(ee())return;const t=[];for(const o in u){const n=u[o],l=(null==n?void 0:n.searchServiceType)===s.SearchServiceType.GeocodeService?null==n?void 0:n.outputDataSourceId:null===(e=null==n?void 0:n.useDataSource)||void 0===e?void 0:e.dataSourceId,r=H(l,o);r&&t.push(r)}const o=Z(t,null==f?void 0:f.current);f.current=t,o&&o[0]?C(o[0]):C(null)},H=(e,t)=>{var o;const n=P(e).getSelectedRecords(),l=null===(o=null==n?void 0:n[0])||void 0===o?void 0:o.getId();return n&&l?X(t,l):null},Z=(e,t)=>(null==e?void 0:e.length)>(null==t?void 0:t.length)?e.concat(t).filter((o=>!e.includes(o)||!t.includes(o)))||[]:e||[],J=e=>{const{isActive:t,recordId:o,dsId:l,configId:s}=e,r=P(l),a=t?[]:K(s,o);n.MessageManager.getInstance().publishMessage(new n.DataRecordsSelectionChangeMessage(i,a)),m(o?l:null),o&&(t?r.selectRecordsByIds([]):r.selectRecordsByIds([o]),!t&&q(s))},q=e=>{var t,o;for(const n in w)if(e!==n){const e=null===(o=null===(t=w[n])||void 0===t?void 0:t[0])||void 0===o?void 0:o.outputDsId,l=P(e);l&&l.selectRecordsByIds([])}},K=(e,t)=>{const o=(null==R?void 0:R[e])||[];return(null==o?void 0:o.filter((e=>(null==e?void 0:e.getId())===t)))||[]},Q=(e,t,o,l)=>{var s;const r=(null===(s=null==u?void 0:u[t])||void 0===s?void 0:s.displayFields)||[],i=[],a=n.i18n.getIntl();return null==e||e.forEach((e=>{const n=[];r.forEach((t=>{const o=e.getFormattedFieldValue(t.jimuName,a);(o||0===o)&&n.push(o)}));const l={value:n,configId:t,outputDsId:o,recordId:null==e?void 0:e.getId()};i.push(l),W(l)})),i},W=e=>{!(null==x?void 0:x.recordId)&&e.recordId&&(x=e)},X=(e,t)=>`${e}_${t}`,Y=()=>{if(!(null==c?void 0:c.isAutoSelectFirstResult)||!(null==x?void 0:x.recordId)||F)return;const{configId:e,recordId:t,outputDsId:o}=x,n=X(e,t);J({isActive:!1,key:n,recordId:t,dsId:o,configId:e}),k(!0)},ee=()=>{var e;let t=0;for(const o in w)t+=(null===(e=null==w?void 0:w[o])||void 0===e?void 0:e.length)||0;return 0===t&&S.current};return(0,n.jsx)("div",{role:"group","aria-label":t("searchResults")},(0,n.jsx)(r.Dropdown,{className:"w-100 dropdown-con",size:"lg",isOpen:!0,toggle:e=>{var t;const o=null==e?void 0:e.target;if(null===(t=null==y?void 0:y.current)||void 0===t?void 0:t.contains(o))return!1;ee()||M(!1)},"aria-expanded":!0,css:re()},(0,n.jsx)(r.DropdownButton,{className:"sr-only search-dropdown-button",style:{padding:0}}),(0,n.jsx)(r.DropdownMenu,{version:$,className:"result-list-con",offset:V(E(c.datasourceConfig)>1),trapFocus:!1,autoFocus:!1,css:se(I,o),style:{maxHeight:"auto"}},(0,n.jsx)("div",{ref:y},!ee()&&(0,n.jsx)(r.DropdownItem,{className:"d-flex align-items-center show-result-button",onClick:()=>{M(!D),A($+1)},title:t("searchResults")},(0,n.jsx)("div",{className:"flex-grow-1 font-weight-bold"},t("searchResults")),!D&&l?(0,n.jsx)(g,null):(0,n.jsx)(h,null)),D&&(0,n.jsx)("div",null,!ee()&&(0,n.jsx)(r.DropdownItem,{divider:!0}),ee()&&(0,n.jsx)(r.DropdownItem,{className:"text-center",disabled:!0,title:t("noResult",{searchText:l})},t("noResult",{searchText:l})),!ee()&&(()=>{var e,t;const o=[];b.current=null;for(const l in w){const s=null===(e=null==w?void 0:w.asMutable({deep:!0}))||void 0===e?void 0:e[l],i=L(c,l),a=null==i?void 0:i.label,d=null==i?void 0:i.icon,v=E(u),g=(0,n.jsx)("div",{key:`${l}_${a}_con`,role:"group","aria-label":a},s.length>0&&(0,n.jsx)("div",null,v>1&&(0,n.jsx)(r.DropdownItem,{className:"source-label-con",disabled:!0,key:`${l}_${a}`,title:a},d&&(0,n.jsx)(r.Icon,{className:"mr-2",color:null===(t=null==I?void 0:I.colors)||void 0===t?void 0:t.primary,size:16,icon:null==d?void 0:d.svg}),a),B(s,G())));o.push(g)}return o})())))))};var ge=c(30224),me=c.n(ge);const pe=e=>{const t=window.SVG,{className:o}=e,l=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(n=Object.getOwnPropertySymbols(e);l<n.length;l++)t.indexOf(n[l])<0&&Object.prototype.propertyIsEnumerable.call(e,n[l])&&(o[n[l]]=e[n[l]])}return o}(e,["className"]),s=(0,n.classNames)("jimu-icon jimu-icon-component",o);return t?n.React.createElement(t,Object.assign({className:s,src:me()},l)):n.React.createElement("svg",Object.assign({className:s},l))};var he=c(55339),fe=c.n(he);const Se=e=>{const t=window.SVG,{className:o}=e,l=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(n=Object.getOwnPropertySymbols(e);l<n.length;l++)t.indexOf(n[l])<0&&Object.prototype.propertyIsEnumerable.call(e,n[l])&&(o[n[l]]=e[n[l]])}return o}(e,["className"]),s=(0,n.classNames)("jimu-icon jimu-icon-component",o);return t?n.React.createElement(t,Object.assign({className:s,src:fe()},l)):n.React.createElement("svg",Object.assign({className:s},l))},{useSelector:ye}=n.ReactRedux,{useState:be,useEffect:xe,useRef:Ie,useMemo:we}=n.React,je=o=>{var l,i,c,u,d,v;const g=r.hooks.useTranslate(a,r.defaultMessages),m=(0,le.useTheme)(),p=ye((e=>null==e?void 0:e.queryObject)),h=ye((e=>{var t;return null===(t=null==e?void 0:e.appRuntimeInfo)||void 0===t?void 0:t.appMode})),f=Ie((e=>{})),S=Ie(null),y=Ie(null),b=Ie(null),x=Ie(null),I=Ie(!1),j=Ie(null),{config:N,className:O,reference:C,id:D,datasourceConfig:F,isShowSearchInput:L,isInCurrentView:$,isWidgetInCurrentPage:A,onShowSearchInputChange:V}=o,{isShowRecentSearches:B,recentSearchesMaxNumber:Z,linkParam:J,searchResultView:q,resultMaxNumber:K,arrangementStyle:Q}=N,[W,X]=be(null),[Y,ee]=be(!1),[te,oe]=be(!1),[ne,se]=be(!1),[re,ie]=be({}),[ae,ue]=be(null),[de,ge]=be([]),[me,he]=be(!1),[fe,je]=be(!1),[Re,Ne]=be(!1),[Oe,Ce]=be(null),De=n.css`
    .input-wrapper {
      height: 100% !important;
    }
    .loading-con {
      @keyframes loading {
        0% {transform: rotate(0deg); };
        100% {transform: rotate(360deg)};
      }
      width: ${n.polished.rem(16)};
      height: ${n.polished.rem(16)};
      min-width: ${n.polished.rem(16)};
      border: 2px solid ${null===(c=null===(i=null===(l=null==m?void 0:m.colors)||void 0===l?void 0:l.palette)||void 0===i?void 0:i.secondary)||void 0===c?void 0:c[300]};
      border-radius: 50%;
      border-top: 2px solid ${null===(v=null===(d=null===(u=null==m?void 0:m.colors)||void 0===u?void 0:u.palette)||void 0===d?void 0:d.primary)||void 0===v?void 0:v[500]};
      box-sizing: border-box;
      animation:loading 2s infinite linear;
      box-sizing: border-box;
    }
    .search-button {
      width: ${n.polished.rem(32)};
      border-radius: 0;
    }
    .search-input-con input{
      width: 100%;
    }
    .search-link-con {
      width: 0;
      height: 0;
      overflow: hidden;
    }
  `;xe((()=>{Je()}),[F]),xe((()=>{I.current&&$&&A?(je(!1),n.lodash.defer((()=>{Fe(!0)}))):je(!0),$&&A||he(!1)}),[$,A]),xe((()=>{me&&h===n.AppMode.Design&&he(!1)}),[h]),xe((()=>{Te(ae),f.current=n.lodash.debounce(Me,400)}),[ae,N]);const Me=r.hooks.useEventCallback((e=>{const t=((e,t,o)=>{const n=[];for(const l in t){const r=t[l];let i;i=r.searchServiceType===s.SearchServiceType.FeatureService?_(e,o,r):w(e,r),n.push(i)}return Promise.all(n)})(e,null==ae?void 0:ae.asMutable({deep:!0}),N);Promise.all([t]).then((e=>{const t=null==e?void 0:e[0];ee(!1),t&&ge(t),x.current&&oe(!0)})).catch((e=>{ee(!1)}))})),Te=e=>{let t=!1;for(const o in e){const n=e[o];((null==n?void 0:n.searchServiceType)===s.SearchServiceType.FeatureService||(null==n?void 0:n.isSupportSuggest))&&(t=!0)}Ne(t)},Pe=r.hooks.useEventCallback((()=>{var e,t;for(const o in ae)if((null===(e=ae[o])||void 0===e?void 0:e.searchServiceType)===s.SearchServiceType.GeocodeService){const e=null===(t=ae[o])||void 0===t?void 0:t.outputDataSourceId,l=P(e);l.selectRecordsByIds([]),U(l,n.DataSourceStatus.NotReady),M(e,D,[],n.RecordSetChangeType.Remove)}})),Fe=e=>{I.current=e,e||je(!0),he(e)},ke=()=>{let e=!0;if(!j.current)return e;const t=j.current;for(const o in t){const n=t[o];if(e=!((null==n?void 0:n.magicKey)||(null==n?void 0:n.isFromSuggestion)),!e)break}return e},Le=(t,o=!1)=>{if(me&&!o)return;Be(t),oe(!1);const n={serviceList:j.current,searchText:t,searchResultView:q,id:D};Ee(),(t=>{const{serviceList:o,searchText:n,searchResultView:l,id:r}=t,i=[];for(const t in o){const a=o[t],{searchServiceType:c,resultMaxNumber:u}=a;if(c===s.SearchServiceType.FeatureService)H(a,r,n);else if(c===s.SearchServiceType.GeocodeService){const t=l===e.ResultPanel?u:null,o=R(n,t,a,l);i.push(o)}}return Promise.all(i)})(n).then((e=>{$e(),t&&Ae(t)}))},Ee=()=>{if(n.MessageManager.getInstance().publishMessage(new n.DataRecordsSelectionChangeMessage(D,[])),Oe){const e=P(Oe);null==e||e.selectRecordsByIds([])}},$e=()=>{var e;for(const t in ae){const o=ae[t];let l;(null==o?void 0:o.searchServiceType)===s.SearchServiceType.FeatureService?l=null===(e=null==o?void 0:o.useDataSource)||void 0===e?void 0:e.dataSourceId:(null==o?void 0:o.searchServiceType)===s.SearchServiceType.GeocodeService&&(l=null==o?void 0:o.outputDataSourceId),n.MessageManager.getInstance().publishMessage(new n.DataSourceFilterChangeMessage(D,l))}},Ae=t=>{q===e.OtherWidgets?(ze(),t&&(Ve()?_e():Ue())):Ge()},Ue=()=>{const e=T(j.current,K,D);Promise.all([e]).then((e=>{let t=[],o=[];null==e||e.forEach((e=>{t=t.concat(e)})),t.forEach((e=>{const t=(null==e?void 0:e.records)||[];o=o.concat(t)})),(null==o?void 0:o.length)>0?_e():Ge()}))},Ge=()=>{T(j.current,K,D,!0),Fe(!0)},Ve=()=>{let e=[];return de.forEach((t=>{e=e.concat(null==t?void 0:t.suggestionItem)})),e.length>0},Be=e=>{(e=>{const{searchText:t,id:o,recentSearchesMaxNumber:n,isShowRecentSearches:l}=e,s=`${o}_recent_searches`;if(!l||!t)return!1;let r=k(o);r.includes(t)||(r.unshift(t),r=r.splice(0,n||10),localStorage.setItem(s,escape(r.join("/@/"))))})({searchText:e,id:D,recentSearchesMaxNumber:Z,isShowRecentSearches:B})},_e=()=>{var e;if(!(null==S?void 0:S.current))return!1;null===(e=null==S?void 0:S.current)||void 0===e||e.click()},ze=()=>{const t=q===e.ResultPanel?K:null,o=T(j.current,t,D,!0);Promise.all([o])},He=we((()=>(e=>{let t,o;return(null==e?void 0:e.linkType)&&(t=null==e?void 0:e.openType,o={linkType:null==e?void 0:e.linkType},o.value=null==e?void 0:e.value),{linkTo:o,target:t}})(J)),[J]),Ze=(e,t)=>{ne&&se(!1),ge([]),X(e),x.current=e,Qe(e,t)},Je=()=>{var e;let t=(0,n.Immutable)({});null===(e=null==F?void 0:F.asMutable({deep:!0}))||void 0===e||e.forEach((e=>{if(!(null==e?void 0:e.enable))return!1;const{configId:o}=e;let n;n=(null==e?void 0:e.searchServiceType)===s.SearchServiceType.GeocodeService?Ke(e):qe(e),t=t.setIn([o],n)})),ue(t)},qe=r.hooks.useEventCallback((e=>{var t;if(!(null==e?void 0:e.enable)||(null==e?void 0:e.searchServiceType)===s.SearchServiceType.GeocodeService)return!1;const{configId:o,useDataSource:n,displayFields:l,searchFields:r,searchExact:i,hint:a,searchServiceType:c}=e,u=(null===(t=null==ae?void 0:ae[o])||void 0===t?void 0:t.asMutable({deep:!0}))||{},d={useDataSource:n,displayFields:l,searchFields:r,searchExact:i,maxSuggestions:null==N?void 0:N.maxSuggestions,resultMaxNumber:K,hint:a,searchServiceType:c,configId:o};return Object.assign(u,d)})),Ke=e=>{var t;if(!(null==e?void 0:e.enable)||(null==e?void 0:e.searchServiceType)===s.SearchServiceType.FeatureService)return!1;const{configId:o,hint:n,geocodeURL:l,outputDataSourceId:r,label:i,searchServiceType:a,singleLineFieldName:c,displayFields:u,defaultAddressFieldName:d,addressFields:v,isSupportSuggest:g}=e,m=(null===(t=null==ae?void 0:ae[o])||void 0===t?void 0:t.asMutable({deep:!0}))||{},p={hint:n,geocodeURL:l,outputDataSourceId:r,icon:null==e?void 0:e.icon,maxSuggestions:null==N?void 0:N.maxSuggestions,resultMaxNumber:K,label:i,searchServiceType:a,configId:o,singleLineFieldName:c||"",displayFields:u,defaultAddressFieldName:d,addressFields:v||[],isSupportSuggest:g};return Object.assign(m,p)},Qe=r.hooks.useEventCallback(((e,t)=>{var o,l,r;let i=ae;for(const t in ae){const n=null===(l=null===(o=ae[t])||void 0===o?void 0:o.useDataSource)||void 0===l?void 0:l.dataSourceId;if(ae[t].searchServiceType===s.SearchServiceType.GeocodeService||!G(n))continue;const a=P(n),c=(null===(r=ae[t].searchFields)||void 0===r?void 0:r.asMutable({deep:!0}))||[],u=z(e,c,a,ae[t].searchExact||!1),d=z(e,c,a,!1);i=i.setIn([t,"SQL"],u).setIn([t,"SuggestionSQL"],d)}ue(i),((e,t)=>{const{configId:o,magicKey:l,isFromSuggestion:s}=t||{};let r=o?(0,n.Immutable)({}).setIn([o],e[o]):(0,n.Immutable)(e);for(const e in r)l&&(r=r.setIn([e,"magicKey"],l||null)),s&&(r=r.setIn([e,"isFromSuggestion"],s||null));j.current=null==r?void 0:r.asMutable({deep:!0}),ie(null==r?void 0:r.asMutable({deep:!0}))})(null==i?void 0:i.asMutable({deep:!0}),t)})),We=e=>{if(!e&&B){const e=k(D);if(0===(null==e?void 0:e.length))return!1;const t=e.map((e=>({suggestionHtml:e,suggestion:e,isRecentSearche:!0})));ge([{suggestionItem:t,layer:null,icon:null}]),oe(!0),se(!0)}else ge([{suggestionItem:[],layer:null,icon:null}]),se(!1)},Xe=r.hooks.useEventCallback((()=>{var e,t;let o;const n=Ye();for(const n in ae)o=(null===(e=null==ae?void 0:ae[n])||void 0===e?void 0:e.hint)&&(null===(t=null==ae?void 0:ae[n])||void 0===t?void 0:t.hint);const l=(null==N?void 0:N.hint)||g("findAddressOrPlace");return o=o||g("findAddressOrPlace"),1!==n?l:o})),Ye=r.hooks.useEventCallback((()=>E(ae))),et=te&&!Y&&!me,tt=e=>{var t,o;40===e.keyCode&&y&&(et?null===(t=null==y?void 0:y.current)||void 0===t||t.focus():me&&(null===(o=null==b?void 0:b.current)||void 0===o||o.focus()))};return(0,n.jsx)("div",{className:`h-100 align-items-center position-relative d-flex flex-grow-1 ${O||""}`,css:De},(0,n.jsx)("div",{className:"h-100 flex-grow-1 search-input-con"},(0,n.jsx)("div",{className:"h-100 w-100",onKeyUp:e=>{tt(e)}},L&&(0,n.jsx)(r.TextInput,{value:W||"",onChange:e=>{var t;const o=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value,n=(null==o?void 0:o.length)>2;if(Ze(o),Fe(!1),!n||!Re)return oe(!1),0===(null==o?void 0:o.length)&&Le("",!0),!1;!Y&&ee(!0),f.current(o)},onFocus:e=>{var t;const o=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value;We(o),o||!(null==N?void 0:N.isUseCurrentLoation)||te||(oe(!0),We||ge([{suggestionItem:[],layer:null,icon:null}]))},onKeyUp:e=>{var t;if(!e||!e.target)return;const o=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value;13===e.keyCode&&ke()&&(Ze(o),Le(o)),tt(e)},className:"h-100 w-100",suffix:(0,n.jsx)("div",{className:"d-flex align-items-center"},Y&&(0,n.jsx)("div",{className:"loading-con mr-1"}),W&&(null==W?void 0:W.length)>0&&(0,n.jsx)(r.Button,{icon:!0,type:"tertiary",size:"sm",onClick:()=>{Ze(""),Pe(),ee(!1),Fe(!1),Le("",!0)}},(0,n.jsx)(Se,null))),placeholder:Xe(),title:W||Xe()})),(0,n.jsx)(ce,{serviceList:(0,n.Immutable)(re),canUseOutoutDsLength:Ye(),isOpen:(()=>{if((null==N?void 0:N.maxSuggestions)>0)return et&&Re;{const e=!W&&(null==N?void 0:N.isUseCurrentLoation)||ne;return et&&e}})(),reference:C,searchText:W,searchSuggestion:de,toggel:()=>{oe(!te)},onRecordItemClick:(e,t)=>{Ze(e,t),Le(e)},isRecentSearches:ne,clearSearches:()=>{(e=>{const t=`${e}_recent_searches`;localStorage.setItem(t,"")})(D),ge([]),oe(!1),se(!1)},isShowCurrentLocation:null==N?void 0:N.isUseCurrentLoation,setSuggestionFirstItem:e=>{y.current=e},config:N}),me&&(0,n.jsx)(ve,{serviceList:(0,n.Immutable)(re),config:N,reference:C,searchText:W,id:D,setResultFirstItem:e=>{b.current=e},isOpentResultListDefault:fe,handleDsIdOfSelectedResultItemChange:e=>{Ce(e)}})),(0,n.jsx)(r.Button,{className:"search-button h-100",type:"primary",icon:!0,onClick:()=>{(e=>{Q===t.Style2?(V(!L),oe(!1)):ke()&&Le(e)})(W)},title:g("SearchLabel")},(0,n.jsx)(pe,null)),q===e.OtherWidgets&&(0,n.jsx)("div",{className:"search-link-con"},(0,n.jsx)(r.Link,{ref:S,to:null==He?void 0:He.linkTo,target:null==He?void 0:He.target,queryObject:p})))},Re=e=>{const{datasourceConfig:t,id:o}=e;return(0,n.jsx)("div",null,null==t?void 0:t.map((e=>(e=>{const{configId:t}=e,l=null==e?void 0:e.outputDataSourceId,s=null==e?void 0:e.useDataSource,r={dataSourceId:l,mainDataSourceId:l};return(0,n.jsx)("div",{key:`${t}_con`},s&&(0,n.jsx)(n.DataSourceComponent,{useDataSource:(0,n.Immutable)(s),query:null,key:`${t}_useDataSource`,widgetId:o}),l&&(0,n.jsx)(n.DataSourceComponent,{useDataSource:(0,n.Immutable)(r),query:null,key:`${t}_outputDataSource`,widgetId:o}))})(e))))};var Ne=function(e,t,o,n){return new(o||(o=Promise))((function(l,s){function r(e){try{a(n.next(e))}catch(e){s(e)}}function i(e){try{a(n.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?l(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(r,i)}a((n=n.apply(e,t||[])).next())}))};const Oe={jimuName:s.OutputDsAddress,alias:"ADDRESS",type:n.JimuFieldType.String,name:s.OutputDsAddress};class Ce extends n.BaseVersionManager{constructor(){super(...arguments),this.versions=[{version:"1.9.0",description:"For geocode service, use arrary of Schema to set displayFields",upgrader:e=>{var t,o;const n=null===(o=null===(t=null==e?void 0:e.asMutable({deep:!0}))||void 0===t?void 0:t.datasourceConfig)||void 0===o?void 0:o.map((e=>((null==e?void 0:e.searchServiceType)===s.SearchServiceType.FeatureService||(null==e?void 0:e.displayFields)||(e.displayFields=[Oe],e.addressFields=[Oe],e.defaultAddressFieldName=Oe.jimuName),e)));return e.setIn(["datasourceConfig"],n)}},{version:"1.10.0",description:"For locator service, need to save support for suggest in config",upgrader:e=>Ne(this,void 0,void 0,(function*(){var t,o;const l=e=>Ne(this,void 0,void 0,(function*(){return n.UtilityManager.getInstance().getUrlOfUseUtility(e).then((e=>Promise.resolve(e)))})),r=null===(o=null===(t=null==e?void 0:e.asMutable({deep:!0}))||void 0===t?void 0:t.datasourceConfig)||void 0===o?void 0:o.map((e=>(null==e?void 0:e.searchServiceType)===s.SearchServiceType.FeatureService?Promise.resolve(e):l(null==e?void 0:e.useUtility).then((t=>(0,n.loadArcGISJSAPIModules)(["esri/request"]).then((o=>{const[n]=o;return n(t,{query:{f:"json"},responseType:"json"}).then((t=>{var o;const n=(null==t?void 0:t.data)||{};if(null==n?void 0:n.capabilities){const t=(null===(o=null==n?void 0:n.capabilities)||void 0===o?void 0:o.split(","))||[],l=null==t?void 0:t.includes("Suggest");return e.isSupportSuggest=l,Promise.resolve(e)}return Promise.resolve(e)}))})))))),i=r?yield Promise.all(r):[];return e.setIn(["datasourceConfig"],i)}))}]}}const De=new Ce;var Me=function(e,t,o,n){return new(o||(o=Promise))((function(l,s){function r(e){try{a(n.next(e))}catch(e){s(e)}}function i(e){try{a(n.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?l(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(r,i)}a((n=n.apply(e,t||[])).next())}))};const{useEffect:Te,useState:Pe,useRef:Fe}=n.React,ke=e=>{const{config:o,id:s}=e,r=Fe(null),[i,a]=Pe((0,n.Immutable)([])),[c,u]=Pe(!1);Te((()=>{g()}),[o]);const d=n.css`
    & {
      height: ${n.polished.rem(32)};
      margin-top: 1px;
      margin-left: 1px;
    }
  `,v=e=>{e&&a(e)},g=()=>Me(void 0,void 0,void 0,(function*(){const e=((null==o?void 0:o.datasourceConfig)||(0,n.Immutable)([])).map((e=>Me(void 0,void 0,void 0,(function*(){let t=null==e?void 0:e.setIn(["enable"],!0);return(null==e?void 0:e.useUtility)&&(yield m(null==e?void 0:e.useUtility).then((e=>{t=t.setIn(["geocodeURL"],e)}))),Promise.resolve(null==t?void 0:t.asMutable({deep:!0}))}))));yield Promise.all(e).then((e=>{a((0,n.Immutable)(e))}))})),m=e=>Me(void 0,void 0,void 0,(function*(){return n.UtilityManager.getInstance().getUrlOfUseUtility(e).then((e=>Promise.resolve(e)))})),p=()=>(null==o?void 0:o.arrangementStyle)===t.Style1||c,h=e=>{u(e)};return(0,n.jsx)(l.ViewVisibilityContext.Consumer,null,(({isInView:e,isInCurrentView:t})=>{const a=!e||t;return(0,n.jsx)(l.PageVisibilityContext.Consumer,null,(e=>{var t;return(0,n.jsx)("div",{className:"widget-search jimu-widget"},(0,n.jsx)("div",{className:"d-flex w-100 align-items-center",css:d,ref:r},(0,n.jsx)("div",null,(null===(t=null==o?void 0:o.datasourceConfig)||void 0===t?void 0:t.length)>1&&p()&&(0,n.jsx)(y,{className:"h-100",config:o,datasourceConfig:i,onDatasourceConfigChange:v})),(0,n.jsx)(je,{id:s,className:"flex-grow-1 h-100",reference:r,datasourceConfig:i,config:o,isShowSearchInput:p(),onShowSearchInputChange:h,isInCurrentView:a,isWidgetInCurrentPage:e}),(0,n.jsx)(Re,{id:s,datasourceConfig:i})))}))}))};ke.versionManager=De;const Le=ke})(),u})())}}}));